<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>R Shiny: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css">
<script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="manifest" href="../site.webmanifest">
<link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='../aio.html';">Learner View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      R Shiny
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            R Shiny
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<hr>
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  R Shiny
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../aio.html">Learner View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="shiny_1.html">1. Web development 101</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="shiny_2.html">2. R Shiny--The Ground Floor</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="shiny_3.html">3. R Shiny--The First Floor (Rendering, Inputs, and Reactivity)</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="shiny_4.html">4. DTs and Leaflets and Plotlys, Oh my!</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr>
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width resources">
<a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-shiny_1"><p>Content from <a href="shiny_1.html">Web development 101</a></p>
<hr>
<p>Last updated on 2024-07-15 |

        <a href="https://github.com/carpentries/r_shiny_workshop/edit/main/episodes/shiny_1.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 35 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How is a website built?</li>
<li>How is building a website using R Shiny similar to/different from
doing so the “usual” way?</li>
<li>What does a website “look like,” under the hood? What are the most
common website “building blocks?”</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Meet the languages used to build websites.</li>
<li>Describe how R Shiny relates to other web development
languages.</li>
<li>Picture a typical website’s structure.</li>
<li>List components of a typical website.</li>
<li>Develop a foundational understanding of HTML and CSS.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p><strong>Important</strong>: This course assumes you have working
knowledge of the R programming language and the RStudio Integrated
Development Environment (IDE). If either is new to you, you could
struggle with this course (although the “normal R code” we’ll write will
generally be basic). You may consider taking an Intro R course before
this one.</p>
<p>By contrast, this course assumes <strong>no</strong> web development
experience. If you have some, this course may be too introductory or
simplified to capture your full attention, though you may still find it
interesting as an overview of the R Shiny framework.</p>
<section><h2 class="section-heading" id="the-webs-languages">The web’s languages<a class="anchor" aria-label="anchor" href="#the-webs-languages"></a>
<a class="anchor" aria-label="anchor" href="#the-webs-languages"></a>
</h2>
<hr class="half-width">
<p>R is a <strong>programming language,</strong> a fancy way of saying
<em>it’s a system with which we can direct a computer to do things for
us</em>.</p>
<p>Just like a human language, R possesses:</p>
<ul>
<li><p>” nouns” (<strong>objects</strong>),</p></li>
<li><p>“verbs” (<strong>functions</strong>),</p></li>
<li><p>“punctuation” (<strong>operators</strong> like <code>&lt;-</code>
and <code>%&gt;%</code>),</p></li>
<li><p>“questions” (<strong>logical tests</strong> like
<code>x == y</code>), and</p></li>
<li><p>“grammar/syntax” (<strong>rules</strong> like <code>1a</code>
being an unacceptable object name but <code>a1</code> being
valid).</p></li>
</ul>
<p>To have a successful “R conversation,” we must form valid and
complete R “sentences” (<strong>commands</strong>) and “paragraphs”
(<strong>code blocks</strong>) in which we create nouns, subject them to
verbs, and follow all the rules, just as we would for a human
language.</p>
<p>R Shiny, meanwhile, is <em>not</em> a <strong>programming
language.</strong> Instead, it (in combination with R) is what a web
developer might call a <strong>framework</strong>: a set of tools used
to build a complete website. Specifically, it leverages R and its
conventions/grammar/syntax to accomplish that task (as opposed to using
other, comparable tools).</p>
<p>To appreciate how R Shiny is distinct as a web development framework,
and to understand how to use it <em>well</em>, we need to understand a
few basic things about “normal” web development. These are:</p>
<ol style="list-style-type: decimal">
<li><p>What <em>languages</em> are typically used to build websites,
what each is for, and how each works at a basic level,</p></li>
<li><p>The <em>structure</em> of a typical website (the “wheres”),
and</p></li>
<li><p>The typical <em>components</em> (the “whats”) of a
website.</p></li>
</ol>
<p>Those will be this first lesson’s topics.</p>
</section><section><h2 class="section-heading" id="how-the-web-is-woven">How the web is woven<a class="anchor" aria-label="anchor" href="#how-the-web-is-woven"></a>
<a class="anchor" aria-label="anchor" href="#how-the-web-is-woven"></a>
</h2>
<hr class="half-width">
<p>To generalize, a website is constructed using several languages, each
to accomplish discrete objectives. The most notable of these are
<strong>HTML</strong>, <strong>CSS</strong>, and
<strong>JavaScript</strong> (<strong>JS</strong> for short):</p>
<ul>
<li><p><strong>HTML</strong> is used to <em>structure</em> a website.
It’s how a web developer specifies <strong>what</strong> elements a user
can see and <strong>where</strong> these should go on the page.</p></li>
<li><p><strong>CSS</strong> is used to <em>design</em> a website. It’s
how a web developer specifies <strong>how</strong> each element should
<strong>look</strong> (its colors, size, <em>etc.</em>).</p></li>
<li>
<p><strong>JavaScript</strong> is used to code a website’s
<em>behaviors</em>. A website is largely just an application running
inside of your browser (<em>e.g.</em>, Edge or Safari). While it runs,
any changes to the website are likely coded using JavaScript.</p>
<ul>
<li>For example, if a webpage contains a button, and if the button
disappears when pressed (a shift in the site’s HTML), the page turns
green (a shift in the site’s CSS), and some data you provided are sent
to a database (a shift in the app’s relationship with the wider
internet), JS is likely dictating those shifts.</li>
</ul>
</li>
</ul>
<p>Together, HTML, CSS, and JS make up the languages commonly used to
assemble the “<em>front end</em>,” “<em>user interface</em>,” or
“<em>client side</em>” of a website. A website’s <strong>user
interface</strong> (UI for short) is what a user sees and interacts
with.</p>
<p>As far as most users are concerned, the UI that they see <em>is</em>
the website; most assume a website is just the “one thing” and that it
lives somewhere “out there,” on the internet.</p>
<p>However, there is <em>always</em> a second “half” to a website.
Somewhere in the world, a <em>server</em> (a computer, basically, but
more automated than a personal computer) acts as a website’s
<strong>host</strong>, receiving requests for information, sending that
information out to users, and handling new data collection.</p>
<p>A server might also need to store private data, such as passwords, or
do complex operations that would be awkward to have a user’s computer
do. It also may perform security checks to ensure users aren’t
trafficking malware or spam.</p>
<p>For all these purposes and more, websites have “back ends” or “server
sides” that run on their servers. Here, SQL might be used to carefully
store or read data from large databases, and a whole host of other
programming languages might be used for complex operations and other
tasks, including JS again but also PHP, Python, Ruby on Rails, and C#,
just to name a few!</p>
<p>When a web developer talks about a framework, they are referring to
the <em>entire</em> set of tools and languages needed to build both
halves of a website. So, for example, HTML + CSS + JS (front end) + PHP
+ SQL (back end) is a popular framework.</p>
<p>To recap, here’s how a website actually works:</p>
<ol style="list-style-type: decimal">
<li><p>When you visit a website, a server hosting that website gets a
request from your browser to “see the website.”</p></li>
<li><p>The server responds by sending your browser a packet of files
(including a bunch of HTML, CSS, and JS files, usually).</p></li>
<li><p>These are opened by your browser and deciphered (it’s fluent in
all these languages).</p></li>
<li><p>Your browser then builds the website you can then see and
interact with per the instructions the server sent. The website is not
“out there somewhere;” it’s “alive” on <em>your</em> computer!</p></li>
<li><p>When the website needs “further instructions” of how to behave or
what content to show, the “dialogue” you’ve started with the server
continues, and new files are sent, received, and deciphered.</p></li>
</ol>
<div id="discussion1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Discussion<a class="anchor" aria-label="anchor" href="#discussion1"></a>
</h3>
<div class="callout-content">
<p>Have you ever had to clear your browser’s <strong>cache</strong>?
What do you think gets deleted when you do that?</p>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>A good portion of your cache (in terms of numbers of files, anyway)
will be HTML, CSS, and JS files sent to you by servers to build the
websites you’ve been visiting! However, there will be additional files,
including image and video files (which can be <em>very</em> bulky),
files for special fonts that website want you to use (perhaps because
their logo uses them), and JSON files (text files that can store data),
among others.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level4">
<h4 id="where-r-shiny-fits-in">Where R Shiny fits in<a class="anchor" aria-label="anchor" href="#where-r-shiny-fits-in"></a>
</h4>
<p>When you build a website using R Shiny, you’ll be writing two kinds
of code (for the most part):</p>
<ul>
<li><p>“Normal” R code and</p></li>
<li><p>“R-like,” or “R Shiny” code.</p></li>
</ul>
<p>The latter will <em>look</em> a lot like R code to you (that’s the
point!). However, when a Shiny app is compiled, your R Shiny code will
be translated into the equivalent HTML, CSS, and JS code so a browser
can understand it. This means we can build the <em>entire</em> UI of a
website <em>without</em> needing to know much, if any*, HTML, CSS, or JS
(*sort of)!</p>
<p>The “normal” R code you’ll write into your app, meanwhile, will
largely operate within your website’s “back end’ (or”server side”),
where it may manipulate data sets, send data to storage locations, keep
track of user actions, etc. This means we can build the entire server
side of a website without needing to know much, if any*, JS, PHP, Ruby
on Rails, Python, SQL, etc. (*unless we want to)!</p>
<p>So, the R + R Shiny framework enables us to build both halves of a
fully interactive, complex website without necessarily knowing
<em>any</em> other web development languages or frameworks!</p>
<p>In particular, R admirably takes the place of other, general
programming languages typically used for handling server-side tasks,
such as Python or PHP, <em>especially</em> when those tasks revolve
around data manipulation, management, or display—R excels at all things
“data!”</p>
<div id="discussion2" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Discussion<a class="anchor" aria-label="anchor" href="#discussion2"></a>
</h3>
<div class="callout-content">
<p>Hopefully, you now recognize that websites can be built both with and
without R Shiny. What is <em>different</em> about building a website
using R Shiny, then?</p>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>A few things are different about building a website using R Shiny,
but I think the two most important differences are:</p>
<ol style="list-style-type: decimal">
<li><p>Whereas writing “pure” HTML, CSS, and JS is often necessary to
build a website’s UI, (deep) knowledge of these languages is
<strong>not</strong> required to build a website using R Shiny. Instead,
you will write R code + R Shiny code, and these will get “translated”
into the equivalent HTML, CSS, and JS code for you.<br><br>
Granted, this means you <em>still</em> need to learn how to write “R
Shiny code,” and you may or may not find this code much more familiar
than the code it’s replacing (though you <em>probably</em> will). More
on that in a sec…</p></li>
<li><p>Normally, to construct the “back end” of a website, a general
programming language like PHP or Python is used. These languages are
quite different from JS, so designing a conventional website often
requires programming in (at least) two <em>different</em> general
programming languages (<em>e.g.</em>, JS and PHP), at least one of which
you may never have encountered before (JS and PHP are not widely used
for other purposes).<br><br>
With R Shiny, you can code <em>both</em> the front and back ends of a
website using the “look and feel,” at least, of just <em>one</em>
general programming language (R).</p></li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="lets-meet-html-and-css">Let’s meet HTML and CSS<a class="anchor" aria-label="anchor" href="#lets-meet-html-and-css"></a>
<a class="anchor" aria-label="anchor" href="#lets-meet-html-and-css"></a>
</h2>
<hr class="half-width">
<p>I said above that R Shiny ensures you don’t <em>need</em> to learn
HTML and CSS to build a website. That statement is no lie!</p>
<p>…However, because some of your R Shiny code must be <em>translated
into</em> HTML/CSS code, there is a forced similarity between the two
systems such that, much of the time, you’ll <em>really</em> be writing
more or less thinly veiled HTML/CSS code, even when you’re writing
“Shiny code.”</p>
<p>This code may <em>look</em> “R-like,” but it won’t always
<em>feel</em> “R-like,” and some of the Shiny code you’ll be asked to
write will seem downright foreign because of all the ways it will be
beholden to these other two languages.</p>
<p>As such, to build a <em>really</em> nice Shiny app, and to feel like
you know not just <em>what</em> your code is doing but <em>why</em> it
looks the way it does, it’s helpful to understand the very basics of
HTML and CSS.</p>
<p>If the prospect of learning two more languages sounds daunting,
perhaps because learning R was difficult, <em>don’t panic</em>! Compared
to learning R, learning the basics of HTML and CSS is <em>much</em>
easier because these languages aren’t <em>general</em>
<em>programming</em> languages like R is. They have much narrower
purposes, so they need a lot fewer “words” and “rules” to do their jobs
than R does. Knowing even a <em>little</em> about these two languages
will go a <em>long</em> way, I promise!</p>
<div class="section level3">
<h3 id="html-101">HTML 101<a class="anchor" aria-label="anchor" href="#html-101"></a>
</h3>
<p>We’ll start with HTML, since it’s the foundation of a website. Pretty
much everything an R Shiny developer <strong>really</strong> needs to
understand about HTML can be collapsed into four key concepts:</p>
<div class="section level4">
<h4 id="key-concept-1-all-websites-are-just-boxes-within-boxes">Key concept #1: All websites are just “boxes within boxes”<a class="anchor" aria-label="anchor" href="#key-concept-1-all-websites-are-just-boxes-within-boxes"></a>
</h4>
<p>At its core, every website is just a box containing one or more
additional boxes, each of which might contain <em>yet more</em> boxes,
and so on all the way down.</p>
<p>By “box” here, I mean “a container that holds stuff,” not “a
rectangle” (though a lot of website boxes <em>are</em> rectangles).</p>
<p>All HTML does is tell your browser which boxes go inside which other
boxes and what every box should contain. Besides other boxes, HTML boxes
can hold blocks of text, pictures, links, menus, lists, and much
more—all the stuff we associate with the websites we visit.</p>
<p>In terms of raw code, every HTML box looks <em>something</em> like
this:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">HTML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode html" tabindex="0"><code class="sourceCode html"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id </span><span class="op">=</span> <span class="st">"my_box"</span><span class="dt">&gt;</span>My box's contents<span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code></pre>
</div>
<p>That means (almost) every HTML box has:</p>
<ul>
<li><p>An <strong>opening tag</strong> (<em>e.g.</em>,
<code>&lt;div...&gt;</code>), which tells the browser where the box
“starts.”</p></li>
<li><p>A <strong>closing tag</strong> (<em>e.g.</em>,
<code>&lt;/div&gt;</code>), which tells the browser where a box has
“ended.”</p></li>
<li><p>Space for <em>contents</em> (here, that’s the text
<code>My box's contents</code>), found between the opening tag’s
<code>&gt;</code> and the closing tag’s <code>&lt;</code>.</p></li>
<li>
<p>Space inside the opening tag for <em>attributes</em>, which are
things that make boxes “special.”</p>
<ul>
<li>Here, we gave our box a unique <code>id</code> attribute called
<code>"my_box"</code> using <code>attribute = "value"</code>
format.</li>
</ul>
</li>
</ul>
<p>In R Shiny, you can build the exact same box but using “R-like
code:”</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">div</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"my box"</span>,</span>
<span>    <span class="st">"My box's contents"</span><span class="op">)</span></span></code></pre>
</div>
<p>Here, we’ve replaced HTML’s <strong>tag notation system</strong>
involving <code>&lt;&gt;</code>s with R’s <strong>function notation
system</strong> and its <code>( )</code>s, and we specify attributes and
box contents using R’s traditional <strong>function argument
system</strong>.</p>
</div>
<div class="section level4">
<h4 id="key-concept-2-websites-have-heads-and-bodies">Key concept #2: Websites have heads and bodies<a class="anchor" aria-label="anchor" href="#key-concept-2-websites-have-heads-and-bodies"></a>
</h4>
<p>To oversimplify a little, every website is just an HTML box
(<code>&lt;HTML&gt;...&lt;/HTML&gt;</code>) containing two smaller
boxes: a “head” (<code>&lt;head&gt;...&lt;/head&gt;</code>) and a “body”
(<code>&lt;body&gt;...&lt;/body&gt;</code>).</p>
<p>The head’s contents are (mostly) invisible to a user; instead, the
head contains further instructions for <em>how</em> the browser should
construct the website.</p>
<p>The body box, meanwhile, contains everything the user can see and
interact with.</p>
<p>In R Shiny, we don’t need to build the HTML, head, or body
boxes—those will be made for us. Instead, we will spend most of our time
just specifying the stuff that will go inside the body box.</p>
<p>However, we can (and sometimes will need to) put things in the head
box. This is done using the <code>tags$head()</code> function:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>tags<span class="sc">$</span><span class="fu">head</span>(<span class="co">#...)</span></span></code></pre>
</div>
</div>
<div class="section level4">
<h4 id="key-concept-3-inline-vs--block-elements">Key concept #3: Inline vs. block elements<a class="anchor" aria-label="anchor" href="#key-concept-3-inline-vs--block-elements"></a>
</h4>
<p>Broadly speaking, there are two kinds of body HTML boxes:
<strong>inline</strong> boxes and <strong>block</strong> boxes. The
difference is how each type is displayed when a website is built.</p>
<p>A <strong>block element</strong> takes up the <em>entire</em>
horizontal “row” it is played on. In other words, it’ll occupy the
<em>entire</em> width of the browser window (if allowed), and it’ll
force the next item to go <em>below</em> it rather than <em>next</em> to
it, as though the browser was forced to hit the “Enter” key after
building it.</p>
<p>For example, the <code>&lt;p&gt;...&lt;/p&gt;</code> element (created
in Shiny using <code>p()</code>) creates “paragraph” boxes (or, more
accurately, boxes for text blocks, which can be more or less than one
paragraph in size). If you put several consecutive paragraph boxes
inside your body box, they would display in a column, with the first one
at the top and the last one at the bottom, and each would occupy the
full width of the screen available to them:</p>
<figure><img src="../fig/clipboard-3243983914.png" class="figure mx-auto d-block"></figure><p><strong>Inline elements</strong>, meanwhile, only take up as much
horizontal space as they have to (by default) to accommodate the size of
their contents, and thus they can go next to each other on the same line
(if there’s room); they don’t <em>force</em> new lines after them.</p>
<p>For example, the <code>&lt;a&gt;...&lt;/a&gt;</code> element (made in
R using <code>a()</code>) is a box that holds a link. You could use
several such boxes within a single paragraph box without creating a new
line after each one.</p>
<p>Certain kinds of website elements “stand alone” or “stand apart” from
others, such as headings and navigation bars. These will generally be
block elements. Other elements “fit together,” such as links and images.
These will generally be inline elements.</p>
</div>
<div class="section level4">
<h4 id="key-concept-4-the-flow">Key concept #4: The Flow<a class="anchor" aria-label="anchor" href="#key-concept-4-the-flow"></a>
</h4>
<p>These days, a user might view your website on a very <em>wide</em>
screen (like that of a projector) or a very <em>narrow</em> small screen
(like that of a cell phone in portrait mode, or even a smart
watch!).</p>
<p>If your website has, say, five elements to display, it may not make
sense to <em>arrange</em> those five elements the same way on a narrow
screen as you would on a wide screen, just as you probably wouldn’t
arrange the same furniture in a tiny room the same as you would in a
huge room.</p>
<p>Careless arrangement of elements is often obvious to even casual
users. On narrow screens, elements that are too big “spill” visibly out
of the containers meant to hold them, and when too many elements are
stacked side by side, tedious scroll bars may be the only way of seeing
elements that are otherwise “off-screen.”</p>
<p>On wide screens, meanwhile, small elements (especially small block
elements) may look silly without constraints, such as when a single
sentence spans the entire width of the screen. As another example, font
sizes that feel appropriate on a small screen might be unacceptable when
viewed on a computer monitor.</p>
<p>It’s hard <em>enough</em> to craft <em>one</em> great website,
though—it’d be a <em>nightmare</em> having to design a different-looking
website for <em>every</em> <em>possible</em> screen size your users
might have!</p>
<p>Thankfully, then, most websites are designed to “flow,” or
automatically reorganize their contents according to the size of the
user’s screen. For example:</p>
<ul>
<li><p>Elements that could sit side by side on a large screen may shift
to being stacked vertically.</p></li>
<li><p>Elements that might be large on wide screens (such as images) may
be shrunk to fit comfortably inside their boxes on narrow
screens.</p></li>
<li><p>Some elements may even “teleport” to new locations on the page as
a screen narrows so that, if all elements are now arranged vertically,
their order is more logical to a user encountering them that
way.</p></li>
</ul>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge1"></a>
</h3>
<div class="callout-content">
<p>Try it: Go to <a href="../www.dictionary.com" title='A link to dictionary.com, a good site for demonstrating the HTML concept of the "flow."'>dictionary.com</a>
and vary the width of your browser window by pulling its edges inward.
How does this website “flow?”</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>For me, I saw a number of changes as I shrunk my browser screen: The
menu at the top became a collapsed “hamburger” menu (a button with three
lines that opens to reveal options), the links slid below the search
bar, the word of the day box shrank, and the games sidebar teleported to
much further down on the page.</p>
</div>
</div>
</div>
</div>
<p>R Shiny comes with some custom HTML boxes that are “fluid,” meaning
their size is flexible and changes automatically according to the size
of their contents. Like inline elements, these boxes will only take up
as much space as necessary. However, their contents will automatically
stack vertically if the screen becomes too narrow. Additionally, they
can be divided into “rows” and “columns” so that elements can be
arranged in a grid-like fashion on wide-enough screens:</p>
<figure><img src="../fig/clipboard-3147076736.png" class="figure mx-auto d-block"></figure><p>The first step of building a great Shiny app is to design your app’s
<em>layout</em>. What elements should exist, and where should they go?
How big does each need to be? What kinds of devices will your users use?
It’s important to remember that your app may not look the same for every
user and to design it with that in mind!</p>
</div>
</div>
<div class="section level3">
<h3 id="css-101">CSS 101<a class="anchor" aria-label="anchor" href="#css-101"></a>
</h3>
<p>If HTML is the language that tells a browser <strong>what</strong> to
display and <strong>where</strong> to display it, then CSS is the
language that tells a browser <strong>how</strong> to display it.</p>
<p>Compared to HTML, CSS is even easier to learn (at least, that’s my
opinion!). CSS code consists of functional units called
<strong>rules</strong>. Each rule consists of a
<strong>selector</strong> and a list of one or more
<strong>properties</strong> paired with <strong>values</strong>:</p>
<ul>
<li><p>The <strong>selector</strong> is the part that tells a browser
which box(es) to adjust the appearance of.</p></li>
<li><p>The list of <strong>properties</strong> tells the browser which
characteristics of those boxes to change.</p></li>
<li><p>The list of <strong>values</strong> tells the browser the new
values to set for each of those characteristics.</p></li>
</ul>
<p>Here is what a <strong>CSS rule</strong> might look like:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">CSS<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode css" tabindex="0"><code class="sourceCode css"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>p<span class="fu">.intro</span><span class="op">,</span> div<span class="pp">#firstintro</span> {</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="kw">font-style</span><span class="ch">:</span> <span class="dv">italic</span><span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="kw">font-size</span><span class="ch">:</span> <span class="dv">large</span><span class="op">;</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>} </span></code></pre>
</div>
<p>On the first line, we have our selector, which is targeting two
different groups of entities simultaneously, with the two targets
separated by a comma:</p>
<ol style="list-style-type: decimal">
<li><p>The first target is paragraph boxes (<code>p()</code>s), but
<em>only</em> those with the <code>intro</code> class attribute. A
<strong>class</strong> is an HTML <strong><em>attribute</em></strong>
that allows many boxes to be controlled and styled as one. A period is
used to connect an HTML element type with a <strong>class</strong> in a
CSS selector (<em>e.g.</em>, <code>p.intro</code>).</p></li>
<li>
<p>Our second target is <code>div</code>s (a generic HTML box), but
<em>only</em> the one with the <strong>id</strong> attribute
<code>firstintro</code>. <code>id</code>s allow us to control or style
just one specific element. A hashtag connects an HTML element type with
an <code>id</code> in a CSS selector (<em>e.g.</em>,
<code>div#firstintro</code>).</p>
<ul>
<li><p>To target all elements of a type (<em>e.g.</em>, all
<code>div()</code>s), write only the element name without any periods or
hashtags (e.g. <code>div</code>)</p></li>
<li><p>If multiple different types of elements (such as divs and ps)
have the same class, you can omit an element type and just specify the
class (e.g., <code>.intro</code>).</p></li>
</ul>
</li>
</ol>
<p>Inside of our rule’s braces, we have a list. Each list item is a
pairing of a <strong>property name</strong> (<em>e.g.</em>,
<code>font-style</code>) and a new <strong>value</strong>
(<em>e.g.</em>, <code>italic</code>). The property and the value are
separated with a colon, and the pairing ends with a semi-colon. If you
get the punctuation or spelling of a CSS rule wrong (easy to do!), it
won’t work, so watch out!</p>
<p>CSS rules get more complex than this one, but they can also be much
simpler, so if this rule makes sense to you, you’re in great shape!</p>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge2"></a>
</h3>
<div class="callout-content">
<p>Try it: W3Schools is a <em>fantastic</em> resource for learning HTML
and CSS. <a href="https://www.w3schools.com/css/default.asp" title="W3Schools is a great resource for learning HTML and CSS; check out their CSS tutorial" class="external-link">Go
to their CSS page and check out some of the tutorial pages on the
left-hand side.</a></p>
<p>Using the “CSS Text” tutorial, write a CSS rule that would change the
font color of all paragraph boxes to red and make all their text
center-aligned.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>Here’s how you’d write this rule:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">CSS<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode css" tabindex="0"><code class="sourceCode css"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>p {</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="kw">color</span><span class="ch">:</span> <span class="cn">red</span><span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="kw">text-align</span><span class="ch">:</span> <span class="dv">center</span><span class="op">;</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>}</span></code></pre>
</div>
<p>Notice that we can target all p elements by not specifying any
classes or ids—just our element name. Don’t forget your colons or
semi-colons! Also, notice that, unlike in R, text values in CSS (like
“red” and “center”) aren’t quoted.</p>
</div>
</div>
</div>
</div>
<p>Why should you bother learning any CSS? Unfortunately, understanding
some CSS is <strong>essential</strong> to craft an <em>attractive</em> R
Shiny app. Without specifying your own CSS, you’ll need to:</p>
<ol style="list-style-type: decimal">
<li><p>Accept the <em>very</em> basic default stylingof R Shiny stuff,
or</p></li>
<li><p>Use generic themes available from packages such as
<code>bslib</code> that are used on countless websites already.</p></li>
</ol>
<p>These are fine options if your apps are simple or have limited or
indifferent user bases, but, in my experience, neither is
<em>nearly</em> as satisfying as learning to style your app
yourself!</p>
</div>
</section><section><h2 class="section-heading" id="nothing-is-new-on-the-web">Nothing is new on the web<a class="anchor" aria-label="anchor" href="#nothing-is-new-on-the-web"></a>
<a class="anchor" aria-label="anchor" href="#nothing-is-new-on-the-web"></a>
</h2>
<hr class="half-width">
<p>We’ve talked about how a website is built, and we’ve looked at the
specific roles played by HTML and CSS in that process. In particular, we
discussed the concept of HTML boxes and how a website is just a series
of these boxes, stacked inside each other. Then, the style of those
boxes and their contents is customized using CSS.</p>
<p>But what typically goes <strong><em>inside</em></strong> all those
boxes?!</p>
<p>With the internet now over 30 years old, most people have been
interacting with the web for a <em>long time</em>! We’ve developed many
collective expectations for how websites should look and feel. As such,
most websites are comprised of immediately-recognizable components,
including:</p>
<ul>
<li><p>A <strong>header</strong> (a box permanently hooked to the top of
the screen/page or to the top of a section of the page). This could
contain elements like a title, a logo, a navigation menu,
<em>etc.</em></p></li>
<li><p>A <strong>footer</strong> (similar to a header but at the bottom
of the screen/page/section). This might contain contact info, legal
information, links, disclaimers, version information,
<em>etc.</em></p></li>
<li><p>A “main content area,” which might be a single rectangle or
multiple rectangles of (un)equal size (such as a smaller “sidebar” and a
larger “main panel”). This area may contain blocks of text, media such
as videos, articles, graphics, <em>etc.</em></p></li>
<li><p>Text blocks, which might contain paragraphs, links, quotes,
articles, lists, headings, etc.</p></li>
<li><p>Forms containing information-gathering <strong>widgets</strong>,
elements a user interact withs and expects a response, such as a
drop-down menu or a slider.</p></li>
<li><p><strong>Modals</strong> (which you may know as “pop-ups”), which
partially or wholly obscure the webpage and may contain additional
information, options, or alerts.</p></li>
<li><p>Backgrounds holding images, solid colors, gradients, or
patterns.</p></li>
<li><p>Navigation systems, such as buttons, scroll bars, or drop-down
menus that allow users to move around a site.</p></li>
</ul>
<p>All these elements (and more!) can be added to the websites you
design using R Shiny. As such, some of the first, and most important,
decisions you’ll make when building a Shiny app is deciding:</p>
<ol style="list-style-type: decimal">
<li><p><strong>What</strong> elements your app will contain,</p></li>
<li><p><strong>Where</strong> they will go, and</p></li>
<li><p>What they’ll enable a user to <strong>do</strong>.</p></li>
</ol>
<p>While the list above is not exhaustive, it should help you start
making these decisions.</p>
<div id="challenge3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge3"></a>
</h3>
<div class="callout-content">
<p>Consider the webpage below:</p>
<figure><img src="../fig/clipboard-1560346890.png" class="figure mx-auto d-block"></figure><p>Like all webpages, this one is just a series of “boxes inside of
other boxes.” Draw a version of the site as a series of nested boxes,
labeling what each box seems designed to hold (don’t bother drawing
every box, just the “major” ones).</p>
<p>As you do, list the different components that you recognize (buttons,
text blocks, etc.).</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<p>Here’s what I noticed and identified:</p>
<figure><img src="../fig/clipboard-2886539574.png" class="figure mx-auto d-block"></figure><p>You may have noticed more, fewer, or different things—that’s ok!</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Websites are typically built using HTML, CSS, and JS to construct
the “client side” of the site, which runs in a user’s browser on their
computer, and by using SQL plus a general programming language like
Python to construct the “server side” of the website, which runs
remotely on a server that communicates back and forth with the user’s
browser.</li>
<li>R Shiny allows you to build a website using just R + R Shiny code,
such that a deep understanding of other web development languages is not
required.</li>
<li>However, a <em>little</em> familiarity with HTML and CSS is helpful
for building a great app as well as for understanding what you are doing
when you are writing “R Shiny” code.</li>
<li>That’s ok because HTML and CSS are more approachable languages than
general programming languages like R.</li>
<li>HTML is a system for telling a browser what to put where when
building a website. Websites are just “boxes holding stuff and other
boxes.” Some of these boxes force new lines after them; others don’t.
How boxes “flow” on wide versus narrow screens is an important design
consideration.</li>
<li>CSS is a system for telling a browser how to display each element on
a website. It consists of rules applied to specific HTML boxes that
specify new values for those boxes’ aesthetic properties.</li>
<li>Website design has matured enough that most websites look and feel
similar and share many elements, such as buttons, links, widgets,
articles, media blocks, and so on. R Shiny lets us add these same
elements to our websites, so we have many options when deciding what
elements to include.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-shiny_2"><p>Content from <a href="shiny_2.html">R Shiny--The Ground Floor</a></p>
<hr>
<p>Last updated on 2024-07-15 |

        <a href="https://github.com/carpentries/r_shiny_workshop/edit/main/episodes/shiny_2.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 15 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How should I start to build a Shiny app?</li>
<li>What code’s required to get a Shiny app to start?</li>
<li>What goes in my <code>server.R</code> file? My <code>ui.R</code>
file? My <code>global.R</code> file?</li>
<li>How do I design an app that will look and nicely on any device?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Build out the files and folders needed to house your app.</li>
<li>Learn the names to use for these files and folders.</li>
<li>Value the convenience of a <code>global.R</code> file.</li>
<li>Link an external stylesheet to your app.</li>
<li>Structure your <code>ui.R</code> file by nesting Shiny HTML
boxes.</li>
<li>Open your browser’s developer tools dashboard to examine your app’s
HTML and CSS code.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="preface">Preface<a class="anchor" aria-label="anchor" href="#preface"></a>
</h3>
<p>In the previous lesson, we learned the basics of web development and
how R Shiny relates to other web development
<strong>frameworks</strong>. In the next lesson, we’ll start building a
Shiny app together. First, though, there are several steps we should
take to set ourselves up for success.</p>
</div>
<div class="section level3">
<h3 id="installing-packages">Installing packages<a class="anchor" aria-label="anchor" href="#installing-packages"></a>
</h3>
<p>We’ll use a number of add-on R <strong>packages</strong> in our app.
If you haven’t already, install those now:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##RUN THIS CODE IN YOUR CONSOLE PANE--**DON'T** INCLUDE IT INSIDE YOUR SHINY FILES. YOU ONLY NEED TO INSTALL PACKAGES **ONCE EVER**.</span></span>
<span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"shiny"</span>, <span class="st">"dplyr"</span>, <span class="st">"ggplot2"</span>, <span class="st">"leaflet"</span>, <span class="st">"DT"</span>, <span class="st">"plotly"</span>, <span class="st">"gapminder"</span>, <span class="st">"countrycode"</span>, <span class="st">"sf"</span><span class="op">)</span></span></code></pre>
</div>
<p>Note that <code>dplyr</code> and <code>ggplot2</code> are part of the
<code>tidyverse</code>, which can be installed using
<code>install.packages('tidyverse')</code>. However, that installation
can take awhile, and we won’t use other <code>tidyverse</code> packages,
so it’s faster to install just the two packages above <em>a la
carte</em>.</p>
<p>We need to turn all these packages on in order to access their
features, but we need to do some more set up first.</p>
</div>
<section><h2 class="section-heading" id="establishing-our-shiny-apps-project-folder">Establishing our Shiny app’s Project Folder<a class="anchor" aria-label="anchor" href="#establishing-our-shiny-apps-project-folder"></a>
<a class="anchor" aria-label="anchor" href="#establishing-our-shiny-apps-project-folder"></a>
</h2>
<hr class="half-width">
<p>It’s useful to make a single folder (we’ll call it our “<strong>root
directory</strong>” or <strong>root</strong> for short) to house all our
app’s files and then to make that folder an <strong>R Project
folder</strong>. You don’t need to know what all that means if you don’t
already; just know it’s valuable.</p>
<p>Here’s how you do it:</p>
<ol style="list-style-type: decimal">
<li><p>In RStudio, go to <code>File</code>, then select the second
option, <code>New Project</code>.</p></li>
<li><p>In the pop-up that appears, select the first option,
<code>New Directory</code>.</p></li>
<li><p>Next, we’ll select the type of project we’re creating. One of the
options you’ll be presented says <code>Shiny application</code>, but
<em>don’t</em> pick that one. Select the <em>first</em> option,
<code>New Project</code>, <em>instead</em>.</p></li>
<li><p>On the next screen, use the <code>Browse</code> button to find a
location on your computer in which to place your project folder. Then,
give the project some name related to the app you’re building. There are
some other options here that, if you’re familiar with Git or
<code>renv</code>, you might consider. Otherwise, click
<code>Create Project</code>.</p></li>
</ol>
<p><strong>Important</strong>: Once the Project is created, you will see
a <code>.Rproj</code> file appear inside the new folder. From now on, to
work on your Shiny app, launch this file to start an RStudio session
connected to your Project. Doing so will save you time and energy!</p>
</section><section><h2 class="section-heading" id="creating-the-necessary-files">Creating the necessary files<a class="anchor" aria-label="anchor" href="#creating-the-necessary-files"></a>
<a class="anchor" aria-label="anchor" href="#creating-the-necessary-files"></a>
</h2>
<hr class="half-width">
<p>It’s my recommendation that you build Shiny apps using the so-called
three-file system:</p>
<ul>
<li><p>Go to <code>File</code>, select <code>New File</code>, then
select <code>R Script</code>. Repeat this process two more times to
create three <strong>script</strong> files in total.</p></li>
<li>
<p>Then, give them these <em>exact</em> names (all lowercase):</p>
<ul>
<li><p><code>ui.R</code></p></li>
<li><p><code>server.R</code></p></li>
<li><p><code>global.R</code></p></li>
</ul>
</li>
</ul>
<p>These files will hold our app’s client side (<strong>user
interface</strong>) code, back-end (<strong>server</strong>) code, and
setup code, respectively.</p>
<p>R Shiny will recognize these exact names as “special,” so using them
enables some handy features. One of these is that, in the top-right
corner of the Script Pane, you should see a “Run App” button with a
green play arrow whenever you are viewing any of these three files in
this Pane.</p>
<figure><img src="../fig/clipboard-2238956949.png" class="figure mx-auto d-block"></figure><p>This button will allow you to start your app at any time to check it
out or to test it (something you will want to do <em>constantly</em>,
both during this workshop and when developing a real app!).</p>
<p>There are some other folders and files we should create next:</p>
<ul>
<li>
<p>In the “Files, Plots, Packages, etc.” Pane in your RStudio
window, while viewing your Project Folder, click the
<code>New Folder</code> button. Name the new folder <em>exactly</em>
<code>www</code>. R Shiny will automatically look inside a folder by
this name for many things, including media files (like images), custom
font files, and CSS files referenced by your app.</p>
<ul>
<li><p>Speaking of which: Click <code>File</code>,
<code>New File</code>, then <code>CSS file</code>. Give this new file
the name <code>styles.css</code>, then save it in your new
<code>www</code> folder. This is the file in which we’ll put custom CSS
code to style our app’s aesthetics.</p></li>
<li><p>If you plan to build complex Shiny apps, you <em>may</em> also
want to create a file for custom JavaScript code called
<code>behaviors.js</code> and place this new file in your
<code>www</code> folder as well. We won’t use any such file in this
workshop, but because there is more you can do with JS than R Shiny will
do for you, there are many instances where a <em>little</em> custom JS
code can <em>significantly</em> enhance your app’s behaviors.</p></li>
</ul>
</li>
<li><p>Next, create a second new folder inside your Project Folder. Call
this folder <code>inputs</code>. Use this folder to store input files
your app needs to start up, like data sets, but that <em>aren’t</em>
media like pictures or fonts. We won’t use this sub-folder, but, for
real projects, it useful to organize your files in this way.</p></li>
<li><p>Similarly, create a third new folder inside your Project Folder.
Call it <code>Rcode</code>. As an app’s code base gets larger, if you
ever want to divide your app’s code into smaller chunks (such as by
building custom functions to perform repeated tasks or by dividing your
app into “modules”), you can place R files for each chunk in this
folder, then source those files inside your <code>global.R</code> file.
We won’t use any such sub-folder, but I use one for all my
apps.</p></li>
</ul>
<p>We now have all the files and folders we need, so we can start
placing into each one the code needed to get a Shiny app to start.</p>
<div class="section level3">
<h3 id="starting-our-global-r-file">Starting our global.R file<a class="anchor" aria-label="anchor" href="#starting-our-global-r-file"></a>
</h3>
<p>We’ll start with <code>global.R</code>. R will run this file first
when booting up your app, so it’s job is to load and/or build everything
needed to enable the rest of the app to start up successfully.</p>
<p>When your app gets large and complex, this file will hold many
different things but, at a minimum, it will contain two things to start:
1) <code>library()</code> calls to load required packages and 2)
<code>read*()</code> calls to load required data sets:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Place this code in your global.R file!</span></span>
<span></span>
<span><span class="co">### LOAD PACKAGES &lt;--CREATE HEADERS IN YOUR FILES TO KEEP LIKE CODE TOGETHER AND TO STAY ORGANIZED!</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">shiny</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">plotly</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">DT</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">leaflet</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">sf</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">countrycode</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### LOAD DATA SETS </span></span>
<span><span class="va">gap</span> <span class="op">=</span> <span class="va">gapminder</span></span></code></pre>
</div>
<p>By having a <code>global.R</code> file, we can place things like
<code>library()</code> calls and code for loading data sets in a single
place and have it work for the entire app. Without it, we’d need to
place these commands inside <em>every</em> app file in which they are
needed—what a pain!</p>
</div>
</section><section><h2 class="section-heading" id="starting-our-server-r-file">Starting our server.R file<a class="anchor" aria-label="anchor" href="#starting-our-server.r-file"></a>
<a class="anchor" aria-label="anchor" href="#starting-our-server-r-file"></a>
</h2>
<hr class="half-width">
<p>Setting up <code>server.R</code> is <em>relatively</em> easy because
there’s only one block of code we need to place in it at the start:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Place this code in your server.R file!</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co">#ALL OUR EVENTUAL SERVER-SIDE CODE WILL GO HERE.</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>Notice: <code>server.R</code> will eventually hold just one
<strong>object</strong>: a <strong>function</strong> called
<em>exactly</em> <code>server</code>. This function will have three
<strong>parameters</strong> called <em>exactly</em> <code>input</code>,
<code>output</code>, and <code>session</code>. R Shiny will look for the
function by this name when it starts up an app, and it will create
objects called <code>input</code>, <code>output</code>, and
<code>session</code> to feed to it during the start-up process. Using
these <em>exact</em> names is mandatory!</p>
<p>It makes sense, if you think about it, that our app’s server file
will create a <strong>function</strong> (a verb) because it’s the “half”
of the app that will <em>do stuff</em>. By contrast, the
<strong>UI</strong> of our app just <em>“sits there and looks
pretty”</em> and only changes when directed to do so by the server.</p>
</section><section><h2 class="section-heading" id="starting-our-ui-r-file">Starting our ui.R file<a class="anchor" aria-label="anchor" href="#starting-our-ui.r-file"></a>
<a class="anchor" aria-label="anchor" href="#starting-our-ui-r-file"></a>
</h2>
<hr class="half-width">
<p>Even less code is <em>needed</em> to start with in <code>ui.R</code>
because our app’s UI file does not produce a function but rather just a
single HTML box into which other boxes will eventually be placed:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Place this code in your ui.R file!</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">=</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="co">#ALL OUR EVENTUAL CLIENT-SIDE CODE WILL GO INTO ONE OF THE TWO SECTIONS BELOW.</span></span>
<span>  </span>
<span>  <span class="co">### HEAD SECTION</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="co">### BODY SECTION</span></span>
<span>  </span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>Here, we use an R Shiny HTML box called <code>fluidPage()</code> to
create a stretchy box that will hold the entirety of the website we’ll
build. We’ll soon fill this box with a bunch more boxes to give our app
more structure.</p>
<p>However, first, let’s load our app’s <strong>stylesheet</strong>, the
<code>styles.css</code> file made earlier. Because the UI is the
“visual” part of a website, and because CSS controls a website’s looks,
it makes sense we’d load a CSS file in <code>ui.R</code> instead of in
<code>global.R</code> or somewhere else. It also makes sense we’d put
this linkage in our app’s <code>head</code> HTML box because it’s
instructions, not something a user needs to see.</p>
<p>Here’s how to do this:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="do">##Place this code INSIDE your app's fluidPage container in the HEAD sub-section!</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>tags<span class="sc">$</span><span class="fu">head</span>(</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  </span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  tags<span class="sc">$</span><span class="fu">link</span>(<span class="at">href =</span> <span class="st">"styles.css"</span>, </span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>            <span class="at">rel =</span> <span class="st">"stylesheet"</span>) </span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>), <span class="co">#&lt;--YOU'LL NEED A COMMA TO SEPARATE EVERY NEW ELEMENT IN YOUR UI FROM THE PREVIOUS ONE, SO YOU WILL SOON NEED A COMMA HERE WHETHER YOU ADD IT NOW OR NOT.</span></span></code></pre>
</div>
<p>Here, we’ve told the app there is a specific <em>stylesheet</em>, a
CSS file, by the name of <code>styles.css</code> we want a user’s
browser to be sent so that it can be used when constructing our website.
Note that we <em>link</em> to this file rather than <em>load</em>
it—that’s an HTML thing!</p>
<p><em>By default, the app will look for CSS stylesheets in the
<code>www</code> sub-folder</em>, so as long as that’s where we put it,
we don’t need to provide a more complex file path to the
<code>href</code> parameter.</p>
<p>Now, we can add some additional boxes to our <code>fluidPage()</code>
to start giving our app some structure. In this workshop, we’ll <em>sort
of</em> practice an approach called <strong>mobile-first
design</strong>. This means designing apps with mobile users in mind
first and all other users second.</p>
<p>The logic of this approach is that, if an app looks and feels good on
a narrow-screened, mouseless mobile device, it should feel and look at
least as good on a wider, mouse-enabled device, whereas ensuring things
work as well in the opposite direction is harder.</p>
<p>This means, among other things, we’ll place our UI elements assuming
they will take on a “vertical” or “stacked” layout for all our mobile
users, one in which pretty much every major element gets the screen’s
full width to occupy, and each subsequent element goes below rather than
next to the previous one.</p>
<p>However, we’ll set things up such that, if a user does have a wider
screen, <em>some</em> things will automatically arrange side by side
instead, if there’s room. This arrangement will look better on a
computer monitor, which is generally much wider than it is tall, because
more content will fit on the screen at once and the added spatial
constraints will keep elements from stretching out horizontally too
much.</p>
<p>So, let’s add the following to our app’s UI:</p>
<ol style="list-style-type: decimal">
<li><p>A <strong>header</strong>, built using <code>h1()</code> with the
<code>id</code> of <code>"header"</code> (this is a first-level
header).</p></li>
<li><p>A <strong>footer</strong>, built using <code>div()</code> with
the <code>id</code> of <code>"footer"</code>.</p></li>
<li><p>In between, let’s make a <code>fluidRow()</code> using the R
Shiny function of the same name. Inside it, let’s place two columns
using <code>column()</code> to create two “cells” in a small, 1 row by 2
column “table.”</p></li>
</ol>
<p>The R Shiny function <code>column()</code> has a required input,
<code>width</code>. All <code>width</code> values of
<code>column()</code>s inside a given <code>fluidRow()</code> must be
whole numbers that sum to 12.</p>
<p>So, let’s set the <code>width</code>s of these columns to
<code>4</code> and <code>8</code>, respectively. In practice, this’ll
make the second column twice as wide as the first. As a result, the
second column will take up 2/3rds of the available screen width,
creating the <em>feel</em> of a left-hand “side panel” and a right-hand
“main panel.”</p>
<p>However, as we’ve discussed, <code>fluidRow()</code>s are “smart”—on
narrow screens, elements in the same row will flow vertically if there’s
not enough room for all of them to fit side-by-side. This means that our
“side panel” will actually go <em>above</em> our main panel on a cell
phone screen automatically (because it’s specified <em>first</em>):</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="do">##Place this code INSIDE your app's fluidPage container in the BODY section!</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="fu">h1</span>(<span class="st">"Our amazing Shiny app!"</span>,</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>         <span class="at">id =</span> <span class="st">"header"</span>), <span class="co">#&lt;--EVERY NEW UI ELEMENT IS SEPARATED FROM EVERY OTHER BY COMMAS.</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="fu">fluidRow</span>(</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  <span class="do">###SIDEBAR CELL</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">4</span>),</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>  <span class="do">###MAIN PANEL CELL</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>  <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">8</span>)</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>),</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="fu">div</span>(<span class="at">id =</span> <span class="st">"footer"</span>)</span></code></pre>
</div>
<p>A couple more things to note about R Shiny boxes from this
example:</p>
<ol style="list-style-type: decimal">
<li><p>Most Shiny boxes have a <code>class</code> parameter and an
<code>id</code> parameter. These two parameters are always optional, and
their purpose is to be used as <code>id</code>s in CSS
selectors.</p></li>
<li><p>However, if a box has an <code>inputId</code> or
<code>outputId</code> parameter, those are <em>mandatory</em> because
those serve Shiny-specific purposes (in addition to serving as CSS
<code>id</code>s)—more on these in the next lesson!</p></li>
<li><p>Every Shiny UI element is separated from every other using
commas, much as separate items are distinguished in R code in many other
contexts. Forgetting these commas is a <em>very</em> common mistake for
Shiny beginners!</p></li>
<li><p>Because R Shiny UI code is <em>really</em> just HTML code,
writing it involves <strong>nesting</strong> a lot of function calls
inside other function calls. For many, this can be confusing initially!
Keep your code organized by using lots of comments to divide your UI
into sub-sections if that helps you.</p></li>
</ol>
<div id="discussion1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Discussion<a class="anchor" aria-label="anchor" href="#discussion1"></a>
</h3>
<div class="callout-content">
<p>Start up your app at this point. What do you see? Explain why the app
looks the way it does so far.</p>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>Besides our title, our app will actually look completely empty!</p>
<figure><img src="../fig/firststart.png" alt="The app is not much to look at yet…we have put in a lot of HTML boxes, but haven’t given them any contents yet." class="figure mx-auto d-block"><div class="figcaption">The app is not much to look at yet…we have put
in a lot of HTML boxes, but haven’t given them any contents yet.</div>
</figure><p>This is because we have made several HTML boxes (a footer, a side
panel, a main panel, and a box holding the latter two), but we haven’t
actually put anything in those boxes yet!</p>
<p>That is to say that HTML boxes are empty until we provide them with
contents that <em>aren’t</em> other HTML boxes. That’s what we will do
in the next lesson!</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>By most standards, our app also looks very basic—just a white screen
with a bland-looking title. This is because the default CSS applied to
Shiny apps is <em>very</em> basic! This is why I argued that learning
some CSS is essential to crafting attractive Shiny apps.</p>
<p>Sure, we’ve linked to a separate CSS stylesheet, but we haven’t
actually put any code in it yet. Until we do, the default, bland style
rules will be used.</p>
<div class="exercise">
<p>Let’s make our first attempt to style our app! Since there’s nothing
else to style yet, let’s style our title. In your
<code>styles.css</code> file, write a <strong>rule</strong> that will
make the title of our app green and bold.</p>
<p>The first <strong>property</strong> to set here is called
<code>font-weight</code> and the new value we want for this property is
<code>bold</code>. The second property-value pairing you should already
more or less know! Run your app to make sure your rule is working.</p>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>Here’s what our CSS rule should look like:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">CSS<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode css" tabindex="0"><code class="sourceCode css"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>h1<span class="pp">#header</span> {</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="kw">font-weight</span><span class="ch">:</span> <span class="dv">bold</span><span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="kw">color</span><span class="ch">:</span> <span class="cn">green</span><span class="op">;</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>}</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">/* You could also have simply put #header in the selector. </span></span></code></pre>
</div>
<p>And this is what our app should look like once you apply the
change:</p>
<figure><img src="../fig/postcss.png" alt="We’ve restyled our title to make it a little more snazzy using CSS." class="figure mx-auto d-block"><div class="figcaption">We’ve restyled our title to make it a little
more snazzy using CSS.</div>
</figure>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="meeting-the-developer-tools-dashboard">Meeting the Developer Tools dashboard<a class="anchor" aria-label="anchor" href="#meeting-the-developer-tools-dashboard"></a>
<a class="anchor" aria-label="anchor" href="#meeting-the-developer-tools-dashboard"></a>
</h2>
<hr class="half-width">
<p>Here, we gave our header a specific <code>id</code>, which made it
easier to target with our CSS selector. But, in either case, how could
you have found out the right selector to use, if you weren’t sure?</p>
<p>Good question: Let’s introduce you to the web developer’s secret
weapon—your browser’s <strong>developer tools</strong>.</p>
<p>I use Microsoft Edge as my browser. To access my developer’s tools, I
right-click any element on any website and select the last option in the
resulting menu, which says <code>Inspect</code>.</p>
<figure><img src="../fig/inspect.png" alt="Opening developers tools in Microsoft Edge by right-clicking any element on any website." class="figure mx-auto d-block"><div class="figcaption">Opening developers tools in Microsoft Edge by
right-clicking any element on any website.</div>
</figure><p><a href="https://jeffrey1183.gitbooks.io/intro-to-programming/content/front-end-development/what-is-javascript/4developer-tools-on-different-browsers.html" class="external-link">The
exact option you might need to select might be different</a>.</p>
<p>Once you figure out how to open up your browser’s developer tools,
you’ll see that it’s a frankly intimidating window that shows, among
other things, the HTML of the website you’re on (usually on the top or
left) and the CSS of the element you’re inspecting (usually on the
bottom or right):</p>
<figure><img src="../fig/devtools.png" alt="The developer’s tools dashboard shows an intimidating amount of information. The most important thing to know about it, though, is that it shows the website’s current HTML and CSS, allowing you to see and examine both in real time." class="figure mx-auto d-block"><div class="figcaption">The developer’s tools dashboard shows an
intimidating amount of information. The most important thing to know
about it, though, is that it shows the website’s current HTML and CSS,
allowing you to see and examine both in real time.</div>
</figure><p>If I didn’t know the right selector to use, I could right-click on
our title header element in the HTML (see picture above), go to
<code>Copy</code> in the resulting menu, and then select
<code>Copy selector</code> from the resulting sub-menu:</p>
<figure><img src="../fig/copy%20selector.png" alt="The developer tools dashboard is one of the most powerful tools in a web developer’s toolbox. For example, it can be used to grab the selector for any element you wish to style using CSS." class="figure mx-auto d-block"><div class="figcaption">The developer tools dashboard is one of the most
powerful tools in a web developer’s toolbox. For example, it can be used
to grab the selector for any element you wish to style using CSS.</div>
</figure><p>Doing this would put <code>#header</code> into your clipboard, in
this case.</p>
<p>This is just one of the many ways that the developer tools dashboard
is a useful tool for web development. We won’t cover it any further in
this workshop, but it’s essential you know how to access it, especially
for troubleshooting!</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use the three-file system to organize your app’s code to benefit
from several R Shiny features built into RStudio.</li>
<li>A <code>global.R</code> file is handy for storing all code needed to
fuel your app’s start-up as well as code that needs to run only
once.</li>
<li>A CSS stylesheet for dictating your app’s aesthetics can be linked
to an app inside of <code>ui.R</code>, specifically using
<code>tags$head()</code> to put the linkage into our app’s head
container.</li>
<li>UI elements get nested inside one another and must all be placed
inside the UI’s outermost container (here, a <code>fluidPage()</code>).
Most UI elements can be given <code>id</code>s and <code>class</code>es
for styling with CSS. UI elements must be separated from one another
with commas.</li>
<li>
<code>fluidRow()</code> and <code>column()</code> can be used to
create a “grid,” within which elements could be arranged next to each
other on wide screens but which will automatically flow vertically on
narrow screens, creating a responsive, mobile-first design with little
fuss.</li>
<li>CSS styling requires knowing the right selector to use to target the
right element(s). If you aren’t sure of the right selector to use, you
can retrieve it using your browser’s developer tools dashboard.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-shiny_3"><p>Content from <a href="shiny_3.html">R Shiny--The First Floor (Rendering, Inputs, and Reactivity)</a></p>
<hr>
<p>Last updated on 2024-07-11 |

        <a href="https://github.com/carpentries/r_shiny_workshop/edit/main/episodes/shiny_3.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 50 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I put cool stuff into my app?</li>
<li>How do I give my users meaningful things to do with my app?</li>
<li>How do I code my app to respond to my user’s actions?</li>
<li>How do I give my user greater control over when/how my app responds
to their actions?</li>
<li>How do I give myself greater control over when/how my app responds
to user actions?</li>
<li>How is build R Shiny server code perhaps quite different than any
coding I’ve done before?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Build a table to display in our app’s UI.</li>
<li>Allow our users to adjust how the table appears in real time.</li>
<li>Give the users greater control over when the table’s appearance is
adjusted.</li>
<li>Define the terms reactive context, event, handling, declarative
coding, and imperative coding. Be able to relate them to coding in R
Shiny.</li>
<li>Explain how and why R Shiny server-side code executes differently
than traditional R code.</li>
<li>Use isolation and observers to achieve greater control over event
handling.</li>
<li>Expand our UI’s “real estate” by introducing a set of tabs.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="going-from-nothing-to-something">Going from nothing to something<a class="anchor" aria-label="anchor" href="#going-from-nothing-to-something"></a>
</h3>
<p>As we saw at the end of the previous lesson, if you start your app
now, it won’t look like much—just a title on an otherwise empty page. In
this lesson, we’ll fix that! As we add content, we’ll learn three core
concepts: 1) <strong>rendering</strong> and <strong>outputting</strong>
UI elements, 2) <strong>input widgets</strong>, and 3)
<strong>reactivity</strong>.</p>
<p>We’re going to create an app showcasing the <code>gapminder</code>
data set, which contains population, life expectancy, and economic data
over time for most countries. The goal will be to give users several
interesting ways to interactively engage with those data.</p>
<p>Let’s start by giving them a table with which to view the data. Given
that a table is just several boxes (cells) within larger boxes (rows and
columns), it makes sense that a table structure can be built using HTML,
although it can require a LOT of boxes!</p>
<p>Fortunately, we don’t have to “draw” all those boxes “by hand;” we
can have R do it. To insert an element into our UI that is complex
enough to build that using a programming language like R to build it for
us is appealing, we must:</p>
<ol style="list-style-type: decimal">
<li><p>Make (<em>i.e.</em>, <em>render</em>) that element on the server
side of our app.</p></li>
<li><p>Then pass it to the UI side, where it can be translated into
(<em>i.e.</em>, <em>outputted as</em>) the equivalent HTML
element(s).</p></li>
</ol>
<p>For virtually every such complex element you’d want to build in R
Shiny, there is a pair of functions designed to do those two steps. In
this particular case, that pair with be <code>renderTable({})</code> on
the server side and <code>tableOutput()</code> on the UI side. [Notice
that most Shiny functions follow a camelCase <strong>naming
convention</strong>.]</p>
<p>Let’s use these two functions to add a basic table of the
<code>gapminder</code> data set to our app:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Place this code INSIDE your app's server function INSIDE your server.R file! </span></span>
<span></span>
<span><span class="co">###TABLE</span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">basic_table</span> <span class="op">=</span> <span class="fu">renderTable</span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">gap</span> <span class="co">#&lt;--OR WHATEVER YOU NAMED THIS OBJECT IN GLOBAL.R</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>In the code above, we instruct R to render an “HTML-ready” version of
a table containing the entire gapminder data set. If we wanted to do any
operations on this data set first (such as filtering it or adding
columns to it), we could have done those using “normal” R code inside
<code>renderTable({})</code>’s braces. So long as it’s a table, the last
thing produced or referenced inside the braces is what will be passed
over to the UI. Here, we just want to pass over the raw data set, so
that’s all we put inside the braces.</p>
<p><em>How</em> this table is passed from the server to the UI, though,
is worth highlighting! In the previous lesson, recall that the app
creates an object called <code>output</code> as soon as the app starts
running. The task of passing rendered elements from the server side of
the app to the client side is what <code>output</code> is for. We just
need to give the element a nickname (an <code>outputId</code>) and stick
the element to the <code>output</code> object using that nickname plus
the <code>$</code> operator, and the app will do the “passing” for us!
Here, the nickname I provided was <code>basic_table</code>.</p>
<p>The only other thing the app needs to know now is <em>where</em> it
should put this rendered table in the app’s UI. We can tell it that
using our placement of the <code>tableOutput()</code> call in our UI
code:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="do">##This code should **replace** the "main" fluidRow() contained within the BODY section of your ui.R file!</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="do">##... other UI code...</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="fu">fluidRow</span>(</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">4</span>),</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>  <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>         <span class="fu">tableOutput</span>(<span class="st">"basic_table"</span>)<span class="co">#&lt;--PUTTING OUR RENDERED TABLE INTO OUR "MAIN PANEL" CELL.</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>         )</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>),</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="do">##... other UI code...</span></span></code></pre>
</div>
<p>Here, we’ve placed our outputted table inside the “main panel” of our
central, two-column <code>fluidRow()</code>.</p>
<p>As you can imagine, we could want to display multiple tables in a
single app. How would the app know <em>which</em> table should be
displayed <em>where</em>? Well, <code>tableOutput()</code> takes, as its
first input, the <code>outputId</code> of the table that should be
displayed in that location, so we can use the <code>outputId</code>s we
pick when writing our server code to keep our outputs straight in our UI
code.</p>
<p>If you run your app at this point, you should get something that
looks like this:</p>
<figure><img src="../fig/clipboard-2809425075.png" class="figure mx-auto d-block"></figure><p>Which is cool! But also not <em>terribly</em> exciting…it looks a
little drab, and users can’t actually <strong>do</strong> anything with
this table except look at it. The first problem we’ll fix later by
swapping this table out for a much better one. However, we can fix the
second problem now.</p>
</div>
<div class="section level3">
<h3 id="giving-your-users-input">Giving your users input<a class="anchor" aria-label="anchor" href="#giving-your-users-input"></a>
</h3>
<p>The value of Shiny apps is often measured by much they let users
<em>do</em>. To enable meaningful user interactions, we need to add
<strong>widgets</strong> to our app. A widget is any element a user can
interact with in such a way that the app might be coded to respond to.
In web development, a user action that a webpage can watch for is called
an <strong>event</strong>; responding to an event (or choosing not to
respond!) is called <strong>handling</strong> it.</p>
<p>We’re going to give our users a way to interact meaningfully with our
table by adding an <strong>input widget</strong> to our UI. Then, we’re
going to tell our app how to <strong>handle</strong> any user
interactions with that widget by adding some <em>reactive</em> code to
our <code>server.R</code> file.</p>
<p>Let’s start by adding the input widget: We’ll add a
<code>selectInput()</code> call to our “sidebar” container in our UI.
This call will produce a “drop-down menu” style element that will allow
users to select a single choice from a pre-defined list. Specifically,
we’ll fill that list with the names of the columns in our
<code>gapminder</code> data set:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the "main" fluidRow() contained within the BODY section of your ui.R file!</span></span>
<span></span>
<span><span class="co">##... other UI code...</span></span>
<span></span>
<span><span class="co">###SIDEBAR CELL</span></span>
<span>    <span class="fu">column</span><span class="op">(</span></span>
<span>      width <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      <span class="co">##ADDING A DROP-DOWN MENU WIDGET TO THE SIDEBAR.</span></span>
<span>      <span class="fu">selectInput</span><span class="op">(</span></span>
<span>        inputId <span class="op">=</span> <span class="st">"sorted_column"</span>,</span>
<span>        label <span class="op">=</span> <span class="st">"Select a column to sort the table by."</span>,</span>
<span>        choices <span class="op">=</span> <span class="fu">names</span><span class="op">(</span><span class="va">gap</span><span class="op">)</span> <span class="co">#&lt;--OR WHATEVER YOU NAMED THIS OBJECT IN GLOBAL.R</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span><span class="co">##... other UI code...</span></span></code></pre>
</div>
<p>Notice that we had to provide <code>selectInput()</code> with three
inputs:</p>
<ol style="list-style-type: decimal">
<li><p>An <code>inputId</code> is both an <code>id</code> for the
purposes of CSS and a nickname the app will use for this widget
server-side. We’ll see how that works in a minute.</p></li>
<li><p>The text we provide to <code>label</code> will be the text that
accompanies the widget in the UI and, usually, explains to the user what
the widget does (if it isn’t obvious).</p></li>
<li><p>For <code>choices</code>, we provide a vector of values that will
be the options that appear in our drop-down menu and that users can
choose from.</p></li>
</ol>
<p>While there are a few variations on this theme, most R Shiny input
widgets work a lot like <code>selectInput()</code>, so it’s a good first
example.</p>
<p>Now, our app should look like this:</p>
<figure><img src="../fig/clipboard-2231599893.png" class="figure mx-auto d-block"></figure><p>Very nice!</p>
<p>…Except for two things. First, the choices in the drop-down menu are
a little…ugly. They look <em>exactly</em> like the names of the columns
in our data set, which are not very human readable in the sense that
they are abbreviations that lack spaces between words and also lack
capital letters.</p>
<p>How could we fix this? Well, we <em>could</em> rename the columns in
the data set, but while column names in R <em>can</em> contain spaces,
at best, it’s hard to make that work. Plus, longer and more complex
names require more typing.</p>
<p>Instead, we can provide a <strong>named vector</strong> to
<code>choices</code>. The names we give (those to the left of the
<code>=</code> operator) will be what gets displayed in the drop-down
menu, whereas the original column names (those to the right of the
<code>=</code>) will be what the server side of our app works with:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the "main" fluidRow() contained within the BODY section of your ui.R file!</span></span>
<span></span>
<span><span class="co">##... other UI code...</span></span>
<span></span>
<span><span class="co">###SIDEBAR CELL</span></span>
<span>    <span class="fu">column</span><span class="op">(</span></span>
<span>      width <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      <span class="fu">selectInput</span><span class="op">(</span></span>
<span>        inputId <span class="op">=</span> <span class="st">"sorted_column"</span>,</span>
<span>        label <span class="op">=</span> <span class="st">"Select a column to sort the table by."</span>,</span>
<span>        choices <span class="op">=</span> <span class="fu">c</span><span class="op">(</span></span>
<span>          <span class="co">#BY USING A NAMED VECTOR, WE CAN HAVE HUMAN-READABLE CHOICES AND COMPUTER-READABLE VALUES. TYPE CAREFULLY HERE!</span></span>
<span>          <span class="st">"Country"</span> <span class="op">=</span> <span class="st">"country"</span>,</span>
<span>          <span class="st">"Continent"</span> <span class="op">=</span> <span class="st">"continent"</span>,</span>
<span>          <span class="st">"Year"</span> <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>          <span class="st">"Life expectancy"</span> <span class="op">=</span> <span class="st">"lifeExp"</span>,</span>
<span>          <span class="st">"Population size"</span> <span class="op">=</span> <span class="st">"pop"</span>,</span>
<span>          <span class="st">"GDP per capita"</span> <span class="op">=</span> <span class="st">"gdpPercap"</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span><span class="co">##... other UI code...</span></span></code></pre>
</div>
<p>With that change made, our drop-down menu widget should be looking
much better! Except it doesn’t actually <em>do</em> anything…yet. We’ve
created something a user can interact with, triggering
<strong>events</strong>, but we haven’t told the app how to
<strong>handle</strong> those events yet.</p>
</div>
<div class="section level3">
<h3 id="rll-handle-that">R’ll handle that<a class="anchor" aria-label="anchor" href="#rll-handle-that"></a>
</h3>
<p>Let’s do that next. We’ll give the user the ability to sort the table
by the column they’ve selected by using the <code>dplyr</code> verb
<code>arrange()</code>. You might be surprised to learn that this is
actually quite straightforward in this particular case:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the renderTable({}) call contained within your server.R file!</span></span>
<span></span>
<span><span class="co">###BASIC GAPMINDER TABLE</span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">basic_table</span> <span class="op">=</span> <span class="fu">renderTable</span><span class="op">(</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">gap</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="co">#USE dplyr's arrange() VERB FOR SORTING ACCORDING TO THE PICKED COLUMN.</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span> <span class="co">#!! (PRONOUNCED "BANG-BANG") AND sym() ARE OBSCURE R TRICKS, NOT R SHINY THINGS. LET'S NOT WORRY ABOUT WHAT THEY DO.</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>##This code should **replace** the renderTable({}) call contained
within your server.R file!</p>
<p>Earlier, we met the <code>output</code> object, which exists to pass
rendered entities from the server to the UI where they can be seen by
the user. Here, we meet the <code>input</code> object, which exists to
pass user inputs from the UI to the server where they can be responded
to.</p>
<p>In this instance, <code>input</code> is passing (<em>all the time
forever!</em>) the <strong>current</strong> value of the widget with the
<code>inputId</code> <code>sorted_column</code> (that’s the nickname I
gave our drop-down menu when I created it) over to the server. Our
server code can then use that value to influence how it builds our
table, such as how it sorts it.</p>
<p>But it’s fancier than that! R Shiny knows that, <em>at any
moment</em>, <code>input$sorted_column</code>’s value could
<em>change</em>. Objects with user-changeable values are called
<strong>reactive objects</strong>—at any moment, they might change
<em>in reaction to</em> what a user is doing.</p>
<p>So, because we’ve used <code>input$sorted_column</code> in some of
our server code, and because R knows that
<code>input$sorted_column</code>’s value could change at any time, it
knows to be <em>watching</em> for such changes.</p>
<p>Whenever it sees one, it runs whatever code involves
<code>input$sorted_column</code> <em>again</em>. The logic of this makes
sense, when you think about it: If <code>input$sorted_column</code> has
changed, anything that used its <em>previous</em> value may now be
“outdated,” so it’d be good to <em>re-run</em> <em>all</em> the
associated code and produce more current outputs!</p>
<p>Run the app and try it out. As you select different columns using the
drop-down menu, the table <em>automatically</em> rebuilds, sorted by the
column you’ve picked most recently. Because the code inside
<code>renderTable({})</code> contains <code>input$sorted_column</code>,
all that code reruns every time <code>input$sorted_column</code>
changes, which happens every time the user selects a new column from the
drop-down menu. We’re successfully <em>handling</em> the <em>events</em>
triggered by our user’s interactions with our input widget!</p>
</div>
<div class="section level3">
<h3 id="reactivity">Reactivity<a class="anchor" aria-label="anchor" href="#reactivity"></a>
</h3>
<p>There is just one small and technical but important detail: Our
server code <em>can’t</em> watch for changes in the values of
<strong>reactive objects</strong> just anywhere—it can <em>only</em> do
so within so-called <strong>reactive contexts</strong>.</p>
<p>A reactive context is a code block that R <em>knows</em> it needs to
watch and might need to run over and over (or never!). It makes sense
that we can only put changeable objects inside code blocks that R knows
it needs to be watching for such changes!</p>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge1"></a>
</h3>
<div class="callout-content">
<p><strong>Try it:</strong> Pause here to prove the previous point. Copy
<code>input$sorted_column</code> and paste it anywhere <em>inside</em>
your server function but <em>outside</em> of
<code>renderTable({})</code>. Then, try running your app. It should
<strong>immediately</strong> crash! Notice the R error in your R Console
when this happens and rephrase it in your own words.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>You’ll get an error that looks a lot like this:<br><br>
Error in $: Can’t access reactive value ‘sorted_column’ outside of
reactive consumer. ℹ Do you need to wrap inside reactive() or
observe()?</p>
<p>This error notes that <code>input$sorted_column</code> is a
<strong>reactive object</strong> (to be technical, a sub-type called a
reactive value) and that you’ve tried to reference it outside of a
reactive context, where R would actually be “prepared” to watch it.</p>
</div>
</div>
</div>
</div>
<p>How can we recognize a reactive context so we know where we can and
can’t put entities like <code>input$sorted_column</code>?</p>
<p><em>Generally speaking</em>, when an R Shiny server-side function
takes, as an input, an <em>expression</em> bounded by curly braces (
<code>{}</code> ), everything inside those curly braces becomes a
reactive context.</p>
<p>Maybe you’ve noticed the curly braces in <code>renderTable({})</code>
and wondered what they’re for. <em>The main input to every
<code>render*()</code> function is an <strong>expression</strong> for
creating a <strong>reactive context</strong>!</em></p>
<p>That means R <em>assumes</em> that every complex element we render in
our server might need to be <em>re-rendered</em> because the user
changed or did something. We provided <code>renderTable({})</code> with
a set of instructions that included what to do to <em>handle</em>
changing values of <code>input$sorted_column</code> and
<code>renderTable({})</code> handles (literally) the rest.</p>
</div>
<div class="section level3">
<h3 id="how-r-shiny-differs-from-normal-r">How R Shiny differs from “normal R”<a class="anchor" aria-label="anchor" href="#how-r-shiny-differs-from-normal-r"></a>
</h3>
<p>You’re hopefully realizing how coding in R Shiny is different from
coding in “normal R” in some key ways.</p>
<p>For many regular R users, the “nestedness” of the code in a UI file
probably feels pretty foreign (it should—we’re basically writing HTML
code there!).</p>
<p>Meanwhile, on the server side, having to imagine and design ways a
user might interact with our app and then coding instructions for how
the app should respond, no matter when or under what circumstances, is
probably also foreign-feeling.</p>
<p>It should—R Shiny server code is <em>not</em> like normal R code! In
fact, it’s an entirely different <em>paradigm</em> of programming.</p>
<p>Normal R code is generally executed <strong>imperatively</strong>.
That is, it is run from the first command to the last as fast as
possible as soon as we (the user) hit “run.”</p>
<p>Server-side Shiny code, meanwhile, is generally executed
<strong>declaratively</strong>. That is, it generally runs once when the
app starts up (or not), but, after that, it never runs again
<em>unless</em> and <em>until</em> it is <em>triggered</em> to run by
one or more specific <strong>events</strong>. [This is true when R is
deciding which reactive contexts to run when; however, the normal R code
<em>within</em> those contexts will still run imperatively, once that
reactive context begins running.]</p>
<p>These two different paradigms can be understood better via an
analogy: Imagine you are in a sandwich shop ordering a sandwich. You
probably expect that the employees of the shop will begin making your
sandwich as soon after you place your order as possible, using
instructions and supplies their manager gave them.</p>
<p>In that analogy, the relationship between you and the shop is
<strong>imperative</strong>; you aive a “command” and the sandwich shop
“executed” that command as quickly as it could manage via a pre-defined
set of steps.</p>
<p>Meanwhile, the relationship between the manager and their employees
is <strong>declarative</strong>. The manager can’t know which customers
will come on a given day, when they will show up, or which sandwiches
each will want. So, they can’t give their employees precise
“commands.”</p>
<p>Instead, they have to tell them to “watch for customers” and, when
those customers arrive and place orders (most, if not all, of which are
predictable ahead of time!), they should use a generalized set of
instructions to handle whatever orders have been placed.</p>
<p>As web developers, our relationship with our users is similar. We
can’t know who will show up when and what exactly they might decide to
do. However, we <em>can</em> anticipate common actions they might take,
give them desirable actions to take, and give the app detailed but
generalized enough instructions that it can take care of all those
different requests whenever (or if ever) they occur.</p>
<div id="discussion1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Discussion<a class="anchor" aria-label="anchor" href="#discussion1"></a>
</h3>
<div class="callout-content">
<p>Check for understanding: How does the code we’ve written so far in
our <code>server.R</code> file execute differently than code we’d write
in a traditional R script? How does the code inside of
<code>renderTable({})</code>’s braces differ from traditional R code we
might write?</p>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>Server-side R code is often broken up into many reactive contexts,
each tasked with generating one or more complex UI elements and/or
handling user actions. Unlike traditional R code, much of this
server-side code runs when a user performs a triggering action, not when
an operator hits “enter,” so to speak.</p>
<p>Plus, server-side code is not always run from top to bottom; reactive
contexts will (re)-run based on user actions, not on placement within
the file. Plus, reactive contexts may be trigger to rerun multiple
times, or never, depending upon what actions a user does or does not
take.</p>
<p>Inside a reactive context, things are more traditional in that the
code inside a reactive context will run just once, from top to bottom,
as quickly as possible as soon as that context is triggered to (re)run.
However, these contexts may contain reactive objects (like
<code>input</code> sub-objects), and it’s changes in the values of these
objects that might cause reactive contexts to need to rerun to produce
more current outputs.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="buttoning-this-up">Buttoning this up<a class="anchor" aria-label="anchor" href="#buttoning-this-up"></a>
</h3>
<p>By this point, R now knows that:</p>
<ol style="list-style-type: decimal">
<li><p>Users might select new columns in our input widget
(<strong>events</strong>),</p></li>
<li><p>It should watch out for any such events, and</p></li>
<li><p>If any occur, it should execute the <code>renderTable({})</code>
code again, which will re-generate the table in a way we’ve instructed
given whatever the user has selected.</p></li>
</ol>
<p>In this specific circumstance (a simple table regulated by users
through just one input widget), this setup is <em>probably</em> fine.
However, imagine users had several inputs widgets instead of just one.
If we used this same approach to handle events based on those inputs,
changing any one of the inputs would trigger the table-rendering code to
rerun and the table would be remade.</p>
<p>That may be an undesirable level of reactivity, for several reasons.
Users often expect to have some say in when exactly an app changes
states. Maybe they expect to be able to experiment with the inputs to
find the combination of selections they are most interested in
<em>before</em> the app responds. Maybe the table loads slowly, and the
user would rather not have to wait through the rebuilding process unless
they’re ready. Maybe they just want to be “in control” because they’d
find updating distracting when it doesn’t happen on <em>their</em>
terms.</p>
<p>Whatever the reason, we can easily give our users greater control
over our table by adding another input widget: an
<code>actionButton()</code>.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the "sidebar" content of our fluidRow() contained within the BODY section of your ui.R file!</span></span>
<span></span>
<span><span class="co">##... other UI code...</span></span>
<span></span>
<span><span class="co">###SIDEBAR CELL</span></span>
<span>    <span class="fu">column</span><span class="op">(</span></span>
<span>      width <span class="op">=</span> <span class="fl">4</span>,</span>
<span>      <span class="fu">selectInput</span><span class="op">(</span></span>
<span>        inputId <span class="op">=</span> <span class="st">"sorted_column"</span>,</span>
<span>        label <span class="op">=</span> <span class="st">"Select a column to sort the table by."</span>,</span>
<span>        choices <span class="op">=</span> <span class="fu">c</span><span class="op">(</span></span>
<span>          <span class="st">"Country"</span> <span class="op">=</span> <span class="st">"country"</span>,</span>
<span>          <span class="st">"Continent"</span> <span class="op">=</span> <span class="st">"continent"</span>,</span>
<span>          <span class="st">"Year"</span> <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>          <span class="st">"Life expectancy"</span> <span class="op">=</span> <span class="st">"lifeExp"</span>,</span>
<span>          <span class="st">"Population size"</span> <span class="op">=</span> <span class="st">"pop"</span>,</span>
<span>          <span class="st">"GDP per capita"</span> <span class="op">=</span> <span class="st">"gdpPercap"</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="co">##ADD AN actionButton(). PAY CLOSE ATTENTION TO CHANGES IN COMMAS/PARENTHESES IN THIS REGION!</span></span>
<span>      <span class="fu">actionButton</span><span class="op">(</span>inputId <span class="op">=</span> <span class="st">"go_button"</span>, label <span class="op">=</span> <span class="st">"Go!"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span><span class="co">##... other UI code...</span></span></code></pre>
</div>
<p>This will add a simple, button-style input widget to our app’s
sidebar. It will say <code>Go!</code> on it (<code>label</code>), and
it’s current value (which is a number equal to the number of times it
has been pressed, or <code>NULL</code> if it hasn’t been pressed yet)
will be passed from the UI to the server at all times via
<code>input$go_button</code>.</p>
<p>Now, we need to tell R how to <strong>handle</strong> it when a user
presses our button (until then, pressing it won’t do anything!). In this
case, we want the table to update <em>only</em> whenever the button is
pressed (<em>i.e.</em>, whenever <code>input$go_button</code>
changes.</p>
<p>Here’s where we hit a little snag: <code>renderTable({})</code>’s
reactive context is “indiscriminate;” <em>any</em> change in
<em>any</em> reactive object it contains will trigger ithe reactive
context to rerun. So, simply adding <code>input$go_button</code> to that
reactive context will <em>not</em> prevent changes in
<code>input$sorted_column</code> from triggering a rerun. And we can’t
just remove <code>input$sorted_column</code> from the reactive context
because, then, we couldn’t use its value to decide how to sort the
column when we do remake the table. We’re stuck!</p>
<p>Thankfully, Shiny has a function for sticky situations like these:
<code>isolate()</code>. Wrapping any reactive object in
<code>isolate()</code> allows R to use its current value to do work but
prevents R from watching that object for changes.</p>
<p>So, we can implement our new table-rendering approach like this:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the renderTable({}) call contained within your server.R file!</span></span>
<span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">basic_table</span> <span class="op">=</span> <span class="fu">renderTable</span><span class="op">(</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="co">#BY PLACING input$go_button IN THIS EXPRESSION (EVEN IF WE DON'T USE IT TO DO ANYTHING!), WE MAKE THIS EXPRESSION A REACTIVE CONTEXT. IF IT CHANGES, THIS EXPRESSION WILL RE-RUN. </span></span>
<span>  <span class="va">input</span><span class="op">$</span><span class="va">go_button</span></span>
<span>  </span>
<span>  <span class="co">#USING isolate() PREVENTS input$sorted_column FROM BEING REACTIVE (CHANGES TO IT WON'T BE HANDLED) BUT STILL ALLOWS US TO USE ITS CURRENT VALUE.</span></span>
<span>  <span class="va">gap</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="fu">isolate</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Now, when users fiddle with our drop-down menu, nothing happens to
the table…<em>until</em> we press the button. At that point, iIf our
selection in our drop-down menu has changed since the last time the
button was pressed, the table will re-render.</p>
</div>
<div class="section level3">
<h3 id="being-observant">Being observant<a class="anchor" aria-label="anchor" href="#being-observant"></a>
</h3>
<p>This approach <em>works</em>, but it can get a little unwieldy if you
have <em>many</em> inputs that would need isolating. For situations like
those, where you would want the app to respond a certain way
<em>only</em> when a <em>specific</em> reactive object changes,
especially when that response needs to involve a bunch of other reactive
objects you <em>don’t</em> want being watched, we can make our event
handling considerably more precise using
<code>observeEvent({},{})</code>:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added to** your server.R file, after all other code but inside of your server function!</span></span>
<span></span>
<span><span class="co">#observeEvent({},{}) TAKES TWO EXPRESSIONS AS INPUTS. IT WATCHES THE FIRST AND, WHEN IT CHANGES, IT RESPONDS BY RE-RUNNING THE SECOND. </span></span>
<span><span class="co">#SO, THE FIRST IS REACTIVE, BUT THE SECOND IS NOT. </span></span>
<span><span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">go_button</span>, <span class="op">{</span> </span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_table</span> <span class="op">=</span> <span class="fu">renderTable</span><span class="op">(</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="co">#WE DON'T NEED isolate() ANY MORE--THIS SECOND EXPRESSION IS NOT REACTIVE, SO CHANGES TO input$sorted_column WILL NOT TRIGGER THIS CODE BLOCK TO RUN.</span></span>
<span>  <span class="va">gap</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Notice that I’m writing <code>observeEvent({},{})</code> using
<em>two</em> sets of braces. That’s because we give it, as inputs,
<em>two</em> expressions. However, interestingly, these have a specific
relationship:</p>
<ol style="list-style-type: decimal">
<li><p>R <em>watches</em> <em>only</em> the <em>first</em> of these
expressions for changes (it’s the only <strong>reactive</strong>
<strong>expression</strong>).</p></li>
<li><p>R will only ever actually <em>execute</em> the <em>second</em> of
these expressions, and <em>only</em> in response to changes in the
<em>first</em> expression (changes to <code>input$sorted_column</code>
<em>aren’t</em> being watched because it’s in the second expression, not
the first). It’s as if the <em>entire</em> second expression is wrapped
in <code>isolate()</code>!</p></li>
</ol>
<p>So, <code>observeEvent({},{})</code> is the equivalent of telling R
“if <em>exactly</em> [first expression] changes, do <em>exactly</em>
[second expression],” which is often the level of precision we’ll want
when handling events in a Shiny app! It’s for this reason that I use
<code>observeEvent({},{}</code>s in large volumes in my own apps.</p>
</div>
<div class="section level3">
<h3 id="totally-tabular">Totally tabular<a class="anchor" aria-label="anchor" href="#totally-tabular"></a>
</h3>
<p>We now have all the conceptual tools we need to build a cool app! In
the last lesson, we’ll replace this table will a cooler one, and we’ll
add a map and graph. To keep all this organized, though, let’s add
<strong>tabs</strong> to our main content area, one for each of these
features.</p>
<p>We can do this using the R Shiny functions
<code>tabsetPanel()</code>, which is the container that holds all the
tabs, and <code>tabPanel()</code>, which holds the contents of a single
tab:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the "main panel" content of our fluidRow() contained within the BODY section of your ui.R file!</span></span>
<span></span>
<span><span class="co">##... other UI code...</span></span>
<span></span>
<span><span class="co">###MAIN PANEL CELL</span></span>
<span><span class="co">##NEST YOUR UI ELEMENTS HERE **CAREFULLY**!</span></span>
<span>    <span class="fu">column</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">8</span>, <span class="fu">tabsetPanel</span><span class="op">(</span></span>
<span>      <span class="co">###TABLE TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Table"</span>, </span>
<span>               <span class="fu">tableOutput</span><span class="op">(</span><span class="st">"basic_table"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="co">###MAP TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map"</span>,</span>
<span>      <span class="co">###GRAPH TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Graph"</span>,</span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>   <span class="op">)</span></span>
<span></span>
<span><span class="co">##... other UI code...</span></span></code></pre>
</div>
<p>Now, if we look at our app, we’ll see that we have three tabs in our
main panel area with the <code>title</code>s we specified in our code.
We can swap between the tabs using each tab panel’s tab (yes, that is
awkward to say!) at the top, just like in a browser. The second and
third tab panels are empty for now, but we’ll soon fix that!</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Complex UI elements, like tables and graphs, will first need to be
rendered in our server code and then placed within our UI’s structure
using an <code>*Output()</code> function of some kind.</li>
<li>Rendered entities that are ready for display are passed from the
server to the UI via the <code>output</code> object and the
<code>outputId</code>’s we give these objects when we render them.</li>
<li>Input widgets are UI elements that allow users to interact with our
app. The current values of these widgets are being constantly passed
from the UI to the server via the <code>input</code> object and the
<code>inputId</code>’s we give these widgets when we create them.</li>
<li>R knows to be watching reactive objects like those attached to
<code>input</code> for changes. Any such changes are called events.
Event handling is the process by which specific responses are coded to
specific events.</li>
<li>The primary way R Shiny handles events is by re-running any reactive
contexts that contain the reactive object that has changed, unless that
object is wrapped in <code>isolate()</code>.</li>
<li>In our server code, reactive contexts are triggered to run
directively (in response to user actions), not imperatively (triggered
to run by a coder hitting “run”). They might run in any order, or never,
depending upon what a user does. However, once a reactive context begins
running, it’s contents are run imperatively through to completion (even
if they take a long time!), during which time the app will be
unresponsive.</li>
<li>Observers (like <code>observeEvent({},{})</code>) build additional
reactive constructs within which we can handle events. In particular,
<code>observeEvent({},{})</code> allows for very precise event-handling
in that only changes to reactive objects provided to its first
expression trigger only the second expression to re-run.</li>
<li>
<code>tabPanel()</code> and <code>tabsetPanel()</code> allow you to
create a “tabular layout,” allowing you to divide up one space in your
UI into several, only one of which can be seen at one time.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div></section><section id="aio-shiny_4"><p>Content from <a href="shiny_4.html">DTs and Leaflets and Plotlys, Oh my!</a></p>
<hr>
<p>Last updated on 2024-07-11 |

        <a href="https://github.com/carpentries/r_shiny_workshop/edit/main/episodes/shiny_4.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 70 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I add an interactive map, table, or graph to my app?</li>
<li>What types of interactivity will these widgets come with?</li>
<li>How do I adjust the look and feel of these widgets?</li>
<li>How can I modify these widgets in response to user actions without
completely “starting over?”</li>
<li>What event types related to these widgets can I watch for, and how
would I handle them?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Name the essential components of the <code>DT</code>,
<code>leaflet</code> and <code>plotly</code> packages.</li>
<li>Experiment with the interactive features that come baked into the
plots, tables, and maps produced by these packages.</li>
<li>Customize the look and feel of these complex interactive
graphics.</li>
<li>Favor updating complex interactive graphics instead of remaking them
whenever possible.</li>
<li>Use <strong>proxies</strong> to update only those aspects of a
complex interactive graphic that <em>need</em> updating.</li>
<li>Recognize the event types a user might trigger with respec to these
complex interactive graphics and the systems for watching for and
handling them.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="disclaimer">Disclaimer<a class="anchor" aria-label="anchor" href="#disclaimer"></a>
<a class="anchor" aria-label="anchor" href="#disclaimer"></a>
</h2>
<hr class="half-width">
<p>At two points in this lesson, the example code will produce
<strong>warnings</strong> (not <strong>errors</strong>!) when executed.
These can be ignored; the code works as intended!</p>
</section><section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>While <strong>input widgets</strong> such as sliders, drop-down
menus, checkboxes, and buttons are powerful ways to give our users
control, they aren’t always interesting or useful <em>by
themselves</em>. There are <em>much</em> more powerful widgets!</p>
<p>And, since we’re building our apps using R—a programming language
<em>designed for</em> working with data—it make senses we’d specifically
want to include some widgets that put <em>data</em> at our users’
fingertips in interesting and useful ways.</p>
<p>Of all data-centered widgets, few are more familiar than
<strong>tables</strong>, <strong>maps</strong>, and
<strong>graphs</strong>. Because these are <em>so</em> ubiquitous, it
probably won’t be surprising to learn there are JavaScript-native
packages for creating web-enabled, interactive versions of these
graphics. While there are other such packages, here we’ll explore
<code>DT</code> (for tables), <code>leaflet</code> (for maps), and
<code>plotly</code> (for graphs), since each has been ported into R + R
Shiny via packages of the same names.</p>
<p>Each of these packages could <em>easily</em> be a course unto itself!
As such, we’ll look <em>only</em> at the basics—greater depth can be
found elsewhere once you have learned the ropes.</p>
<p>Learning <code>leaflet</code> and <code>plotly</code>, specifically,
come with particular challenges we’ll skirt around:</p>
<ul>
<li><p><code>leaflet</code> is for maps, which depend on <strong>spatial
data</strong>. These and the packages that work with them
(<em>e.g.</em>, <code>sf</code>), are <em>complicated</em>! I’ll gloss
over all the details to focus just on <code>leaflet</code>, but we’ll
need to borrow tools from <code>sf</code> and others to accomplish
anything at all.</p></li>
<li><p>If you are familiar with <code>ggplot2</code> (or another data
viz package), you already know that learning to make graphs
programmatically demands a new “vocabulary.” <code>plotly</code> has the
same learning curve (perhaps steeper for R users, since it’s
<em>very</em> JavaScript-like whereas <code>ggplot2</code> is more
R-like). We’ll engage with just the minimum of <code>plotly</code>, but
even that may be a lot for many learners.</p></li>
</ul>
<p>Let’s start simple—let’s upgrade the table we already have by
swapping it for a <code>DT</code> table. Of the packages we’re learning
here, <code>DT</code> is easiest, and it introduces all the key concepts
we’ll need for <code>leaflet</code> and <code>plotly</code>.</p>
<div class="section level3">
<h3 id="turning-the-tables">Turning the tables<a class="anchor" aria-label="anchor" href="#turning-the-tables"></a>
</h3>
<div class="section level4">
<h4 id="basic-table">Basic table<a class="anchor" aria-label="anchor" href="#basic-table"></a>
</h4>
<p>Let’s start by simply swapping our <code>renderTable({})</code> and
<code>tableOutput()</code> calls with the equivalent
<code>renderDT({})</code> and <code>dataTableOutput()</code> calls,
which work identically but yield a <code>DT</code>-style table
instead:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the renderTable({}) call contained within your server.R file!</span></span>
<span></span>
<span><span class="co">###TABLE</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_table</span> <span class="op">=</span> <span class="fu">renderDT</span><span class="op">(</span><span class="op">{</span> <span class="co">#&lt;--CHANGE FUNCTION NAME HERE.</span></span>
<span></span>
<span>    <span class="va">input</span><span class="op">$</span><span class="va">go_button</span></span>
<span>    </span>
<span>    <span class="va">gap</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="fu">isolate</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the "main panel" cell's content within the BODY section of your ui.R file!</span></span>
<span></span>
<span><span class="co">##... other UI code...</span></span>
<span></span>
<span><span class="co">###MAIN PANEL CELL</span></span>
<span>    <span class="fu">column</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">8</span>, <span class="fu">tabsetPanel</span><span class="op">(</span></span>
<span>      <span class="co">###TABLE TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Table"</span>, </span>
<span>               <span class="fu">dataTableOutput</span><span class="op">(</span><span class="st">"basic_table"</span><span class="op">)</span><span class="op">)</span>, <span class="co">#&lt;--CHANGE FUNCTION NAME HERE.</span></span>
<span>      <span class="co">###MAP TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map"</span>,</span>
<span>      <span class="co">###GRAPH TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Graph"</span>,</span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>   <span class="op">)</span></span>
<span></span>
<span><span class="co">##... other UI code...</span></span></code></pre>
</div>
<p>Once you’ve made those swaps, restart your app.</p>
<p>You’ll <em>immediately</em> notice our table looks <em>very</em>
different:</p>
<ul>
<li><p>It’s <strong>paginated</strong>, <em>i.e.</em>,“divided into
pages.” Users flip pages using buttons in the bottom-right. Users also
change the page length using a drop-down menu in the top-left. These
features allow users to limit the data shown at one time, and they also
keeps the table from being long vertically if there are many rows’ worth
of data.</p></li>
<li><p>It’s <strong>searchable</strong>—users can type
<strong>strings</strong> (chunks of letters, numbers, and/or symbols)
into the search box in the upper-right; the table will filter to only
rows containing that string anywhere.</p></li>
<li><p>It’s <strong>sortable</strong>—users can click the up/down arrows
next to column names to sort the table. You’ll note that this
functionality makes our drop-down menu widget obsolete (for
now)!</p></li>
<li><p>It’s (modestly) styled—it’s snazzier-looking than our previous
Shiny table because it comes with some CSS automatically applied (bold
column names and “zebra striping” of rows, as two examples).</p></li>
<li><p>It’s <strong>selectable</strong>—users can click to highlight
(“select”) rows. This doesn’t actually do anything server-side by
default, but it could.</p></li>
</ul>
<p>Now that we have a <code>DT</code> table, there are four things we’ll
<em>very</em> commonly want to do with one (or any similarly complex
interactive graphic): 1) simplify it, 2) restyle it, 3) watch it for
<strong>events</strong>, and 4) update it to <strong>handle</strong>
those events.</p>
<p>Let’s start with the first two of these desires.</p>
</div>
<div class="section level4">
<h4 id="more-or-less-basic-dt">More (or less) basic DT<a class="anchor" aria-label="anchor" href="#more-or-less-basic-dt"></a>
</h4>
<p>As we just saw, <code>DT</code> tables come standard with many
interactive features! However, “more” is not always “better” from a
<strong>UX</strong> (user experience) standpoint. Some might find
certain features confusing, especially if they aren’t necessary, are
poorly explained, or don’t do anything obvious. Others may find having a
lot of features overwhelming, even if they understand them all.</p>
<p>The <code>datatable()</code> function’s <code>options</code> input
allows us to reel in the features included:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the renderTable({}) call contained within your server.R file!</span></span>
<span></span>
<span><span class="co">###TABLE</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_table</span> <span class="op">=</span> <span class="fu">renderDT</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">input</span><span class="op">$</span><span class="va">go_button</span></span>
<span>    </span>
<span>    <span class="va">gap</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="fu">isolate</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">datatable</span><span class="op">(</span></span>
<span>        selection <span class="op">=</span> <span class="st">"none"</span>, <span class="co">#&lt;--TURNS OFF ROW HIGHLIGHTING</span></span>
<span>        options <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>          info <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#&lt;--NO BOTTOM-LEFT INFO</span></span>
<span>          ordering <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#&lt;--NO SORTING</span></span>
<span>          searching <span class="op">=</span> <span class="cn">FALSE</span> <span class="co">#&lt;--NO SEARCH BAR</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>That’s better! This version should be more digestible and intuitive
(and easier to explain and program!).</p>
<p>More broadly, <em>if a <code>DT</code> table or any other complex
interactive graphic has a feature, you should assume there’s a way to
turn that feature off (you may just have to Google for the specific
input needed to do it).</em></p>
<p>Next, let’s boost our table’s aesthetics a little. Let’s make three
changes:</p>
<ol style="list-style-type: decimal">
<li><p>Round the GDP per capita data.</p></li>
<li><p>Make the <code>continent</code> column center-aligned.</p></li>
<li><p>Highlight in pink all rows with <code>lifeExp</code> values &gt;
<code>70</code>.</p></li>
</ol>
<p>We’ll use a functions from the <code>format*()</code> and
<code>style*()</code> families to accomplish these goals, specifically
<code>formatRound()</code>, <code>formatStyle()</code>, and
<code>styleEqual()</code>:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the renderTable({}) call contained within your server.R file!</span></span>
<span></span>
<span><span class="co">###TABLE</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_table</span> <span class="op">=</span> <span class="fu">renderDT</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">input</span><span class="op">$</span><span class="va">go_button</span></span>
<span>    </span>
<span>    <span class="va">gap</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="fu">isolate</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">datatable</span><span class="op">(</span></span>
<span>        selection <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>        options <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>          info <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          ordering <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          searching <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="co">#HERE, WE WRITE 'R-LIKE' CSS. WE USE camelCase FOR PROPERTIES, TEXT STRINGS FOR VALUES, AND = INSTEAD OF : TO SEPARATE THEM (COMPARE TO [text-align: center;]).</span></span>
<span>      <span class="fu">formatRound</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"gdpPercap"</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">formatStyle</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"continent"</span>, textAlign <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">formatStyle</span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="st">"lifeExp"</span>,</span>
<span>        target <span class="op">=</span> <span class="st">"row"</span>,</span>
<span>        backgroundColor <span class="op">=</span> <span class="fu">styleEqual</span><span class="op">(</span></span>
<span>          levels <span class="op">=</span> <span class="va">gap</span><span class="op">$</span><span class="va">lifeExp</span>,</span>
<span>          values <span class="op">=</span> <span class="fu">ifelse</span><span class="op">(</span><span class="va">gap</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="fl">70</span>, <span class="st">"lightpink"</span>, <span class="st">"white"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p><code>format*()</code> functions ask us to pick 1+ columns to
restyle. Then, we provide <strong>property</strong> and
<strong>value</strong> pairings, just as in CSS, but using an “R-like”
syntax instead, <em>e.g.</em>, <code>textAlign = center</code> in R
Shiny versus <code>text-align: center;</code> in CSS.</p>
<p>If we want to format a column <strong>conditionally</strong>,
<em>i.e.</em>, formatting only some rows according to a rule, we use the
<code>style*()</code> functions. In the example above, we used
<code>styleEqual()</code> to apply a light pink background to only rows
with life expectancy greater than <code>70</code>.</p>
</div>
<div class="section level4">
<h4 id="update-dont-remake">Update, don’t remake!<a class="anchor" aria-label="anchor" href="#update-dont-remake"></a>
</h4>
<p>So far, when user actions have dictated a change to the data in our
table (<em>e.g.</em>, how it’s sorted), we’ve re-rendered the
<em>entire</em> table to <strong>handle</strong> those
<strong>events</strong>.</p>
<p>While this works, it’s undesirable for (at least) three reasons:</p>
<ol style="list-style-type: decimal">
<li><p>With large data sets, it could be slow!</p></li>
<li>
<p>To the user, the table may appear to “flicker” out and in again
as it’s remade, if the process is fast.</p>
<ol style="list-style-type: decimal">
<li>If the process is slow, the table will instead “gray out” and the
whole app will freeze while the code needed to remake the table
completes.</li>
</ol>
</li>
<li><p>If the user had customized the table in any way (they’ve
navigated to a specific page, <em>e.g.</em>), those customizations will
be lost if we rebuild the table from scratch.</p></li>
</ol>
<p>If you think about it, if <em>all</em> we’re doing is changing the
data in our table, there’s no need to remake the <em>whole</em> table—we
could just repopulate the contents of its cells, right? <em>Whenever
possible,</em> <em>we should update a complex element rather than wholly
remake it.</em></p>
<p>To update widgets “on the fly,” we use something called a
<strong>proxy</strong>, which is like a telephone that lets R (on the
server side) and JavaScript (on the client side) talk directly to adjust
a widget’s <em>contents</em> without redrawing any aspects of the widget
other than just those that need to be redrawn.</p>
<p><code>DT</code>’s function <code>dataTableProxy()</code> takes as
input the <code>outputId</code> of the table we’re updating. We then
pipe that call into the helper function <code>replaceData()</code>,
which specifically allows us to swap out the data being shown in a
table’s cells (and adjusting the number of these as needed).</p>
<p>Before we can use these tools, though, we should create a reason we’d
need to swap one data set for another! Earlier, I mentioned that
<code>DT</code> tables have a <code>selection</code> feature, which
allows users to select rows/columns/cells. Doing so is an
<strong>event</strong> that R Shiny can watch for, and although these
events are not handled by default, we can change that!</p>
<p>So, let’s set up a system in which a user can click any cell in our
table to select it. When they do, we’ll filter the table to only rows
sharing that same value in that same column (e.g., clicking a cell
containing <code>Asia</code> will filter to only other rows containing
data from <code>Asia</code>). Meanwhile, when no cell is selected, the
table isn’t filtered.</p>
<p>Sounds complicated? It’s actually not too bad! Below, we’ll take this
step by step. For each step, implement the coding change, run the app,
and make sure you understand any changes you observe in how the app
behaves.</p>
<p>First, let’s use <code>renderTable({})</code> and
<code>DTOutput()</code> to make the “base” version of our table, just as
we have been. This time, though, the “bones” of the table made in this
way will <em>never</em> change:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the renderTable({}) call contained within your server.R file!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">###TABLE</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_table</span> <span class="op">=</span> <span class="fu">renderDT</span><span class="op">(</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="co">##STEP 1: WE SIMPLIFY OUR renderDT({}) CALL SO IT CONTAINS NO REACTIVE OBJECTS. THIS WILL RUN ONLY ONCE, AS THE APP STARTS. </span></span>
<span>    <span class="va">gap</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">datatable</span><span class="op">(</span></span>
<span>        selection <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>        options <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>          info <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          ordering <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          searching <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">formatRound</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"gdpPercap"</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">formatStyle</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"continent"</span>, textAlign <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">formatStyle</span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="st">"lifeExp"</span>,</span>
<span>        target <span class="op">=</span> <span class="st">"row"</span>,</span>
<span>        backgroundColor <span class="op">=</span> <span class="fu">styleEqual</span><span class="op">(</span></span>
<span>          levels <span class="op">=</span> <span class="va">gap</span><span class="op">$</span><span class="va">lifeExp</span>,</span>
<span>          values <span class="op">=</span> <span class="fu">ifelse</span><span class="op">(</span><span class="va">gap</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="fl">70</span>, <span class="st">"lightpink"</span>, <span class="st">"white"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Next, let’s turn on <code>selection</code> inside
<code>datatable()</code> by changing the input from <code>"none"</code>
to <code>list(mode = "single", target = "cell")</code>, such that users
can select single cells at a time:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the renderTable({}) call contained within your server.R file!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">###TABLE</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_table</span> <span class="op">=</span> <span class="fu">renderDT</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">gap</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">datatable</span><span class="op">(</span></span>
<span>        selection <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"single"</span>, target <span class="op">=</span> <span class="st">"cell"</span><span class="op">)</span>, <span class="co">#&lt;--STEP 2: WE CHANGE SELECTION FROM NONE (NO SELECTION) TO ESSENTIALLY "SELECT UP TO ONE CELL AT A TIME."</span></span>
<span>        options <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>          info <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          ordering <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          searching <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">formatRound</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"gdpPercap"</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">formatStyle</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"continent"</span>, textAlign <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">formatStyle</span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="st">"lifeExp"</span>,</span>
<span>        target <span class="op">=</span> <span class="st">"row"</span>,</span>
<span>        backgroundColor <span class="op">=</span> <span class="fu">styleEqual</span><span class="op">(</span></span>
<span>          levels <span class="op">=</span> <span class="va">gap</span><span class="op">$</span><span class="va">lifeExp</span>,</span>
<span>          values <span class="op">=</span> <span class="fu">ifelse</span><span class="op">(</span><span class="va">gap</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="fl">70</span>, <span class="st">"lightpink"</span>, <span class="st">"white"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>At this point, our table no longer responds to our drop-down menu or
button because we’re removed the corresponding <code>input</code>
subobjects from the <code>renderDT({})</code> code block.</p>
<p>It also doesn’t yet respond to cell selection. Let’s fix that by
introducing an ’<code>observeEvent({},{})</code> that watches for the
“Go!” button and arranges the data according to our selection in our
drop-down menu. This time, though, we’ll use
<code>dataTableProxy()</code> and <code>replaceData()</code> to update,
rather than remake, the table:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added to** your server.R file inside your server function and preferrably below your renderTable({}) call!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">###TABLE OBSERVER (CELL SELECTION)</span></span>
<span><span class="co">##STEP 3: ADD AN OBSERVER WATCHING OUR BUTTON. WHEN IT'S PRESSED, SORT OUR DATA. </span></span>
<span><span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">go_button</span>, <span class="op">{</span></span>
<span></span>
<span>   <span class="va">gap_sorted</span> <span class="op">=</span> <span class="va">gap</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>   <span class="co">#FEED THE SORTED DATA INTO A PROXY TO UPDATE JUST THE CONTENTS OF OUR TABLE'S CELLS. </span></span>
<span>    <span class="fu">dataTableProxy</span><span class="op">(</span><span class="st">"basic_table"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">replaceData</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gap_sorted</span>, </span>
<span>                clearSelection <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co">#&lt;-BUT KEEP ANY NEWLY SELECTED CELLS SELECTED!</span></span>
<span> <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>This observer restores the original functionality of our button and
drop-down menu, but it <em>doesn’t</em> yet handle cell selection. We
need this observer to also watch for changes in cell selections too. But
how?</p>
<p>Like others widget, <em><code>DT</code> tables pass information from
the UI to the server constantly using the <code>input</code>
object.</em> We can access that information server-side using
<code>input$outputId_*</code> format.</p>
<p>In this case, the <code>*</code> here will be
<code>cells_selected</code> because that’s the event type we’re
interested in. By making our first expression to
<code>observeEvent({},{})</code> into a list, we can have our observer
watch more than one input for changes:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the observeEvent({},{}) we introduced in the previous example!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">###TABLE OBSERVER (CELL SELECTION)</span></span>
<span><span class="co">##STEP 4: EXTEND THE FIRST EXPRESSION IN OUR OBSERVE TO A LIST INCLUDING BOTH THE GO BUTTON AND THE REACTIVE OBJECT FOR TABLE CELL CLICKS.</span></span>
<span><span class="fu">observeEvent</span><span class="op">(</span><span class="fu">list</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">go_button</span>,</span>
<span>                  <span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span><span class="op">)</span>, <span class="op">{</span></span>
<span>                    </span>
<span>  <span class="co">##THIS LINE WILL PRINT TO THE R CONSOLE THE INFO SENT TO THE SERVER WHEN A CELL IS CLICKED. YOU'LL SEE IT'S A MATRIX WITH 1 ROW AND 2 COLUMNS CONTAINING THE ROW AND COLUMN NUMBERS OF THE CELL SELECTED.</span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span><span class="op">)</span></span>
<span></span>
<span>   <span class="va">gap_sorted</span> <span class="op">=</span> <span class="va">gap</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span></span>
<span>   </span>
<span>    <span class="fu">dataTableProxy</span><span class="op">(</span><span class="st">"basic_table"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">replaceData</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gap_sorted</span>, </span>
<span>                clearSelection <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span> <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>If you run the app now and start selecting cells, you’ll observe that
<code>input$basic_table_cells_selected</code> returns a matrix when
accessed. Either this matrix has no rows (when no cell is selected) or
one row with two values: a row number and a column number for the cell
selected.</p>
<p>We’ll use that info to find the value in the cell selected as well as
the name of the corresponding column. We can then filter our data set
accordingly (all this requires some good-old “R” data wrangling!):</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the observeEvent({},{}) we introduced in the previous example!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span>  <span class="co">###TABLE OBSERVER (CELL SELECTION)</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="fu">list</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">go_button</span>, <span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span><span class="op">)</span>, <span class="op">{</span></span>
<span></span>
<span>    <span class="co">##STEP 5: WE GET THE VALUE IN THE CELL SELECTED...</span></span>
<span>      <span class="va">val2match</span> <span class="op">=</span> <span class="va">gap</span><span class="op">[</span><span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, drop <span class="op">=</span> <span class="cn">T</span><span class="op">]</span></span>
<span>      </span>
<span>    <span class="co">#...AND THE NAME OF THE COLUMN SELECTED...</span></span>
<span>      <span class="va">col2match</span> <span class="op">=</span> <span class="fu">names</span><span class="op">(</span><span class="va">gap</span><span class="op">)</span><span class="op">[</span><span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>      </span>
<span>    <span class="co">#...AND FILTER TO ONLY ROWS MATCHING THAT VALUE.</span></span>
<span>      <span class="va">gap_filtered</span> <span class="op">=</span> <span class="va">gap</span><span class="op">[</span><span class="va">gap</span><span class="op">[</span>, <span class="va">col2match</span><span class="op">]</span> <span class="op">==</span> <span class="va">val2match</span>, <span class="op">]</span></span>
<span>      </span>
<span>      <span class="co">#WE ARRANGE AS NORMAL...</span></span>
<span>      <span class="va">gap_sorted</span> <span class="op">=</span> <span class="va">gap_filtered</span> <span class="op">%&gt;%</span> <span class="co">#&lt;-BUT UPDATE TO gap_filtered here.</span></span>
<span>        <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="fu">dataTableProxy</span><span class="op">(</span><span class="st">"basic_table"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">replaceData</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gap_sorted</span>,</span>
<span>                    clearSelection <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>      </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>If the “normal R” code in this example looks stressful, don’t worry
about the specifics—just read my comments to know what we’re trying to
accomplish.</p>
<p>Our observer now works great! Try it and see for yourself.</p>
<p>…Except there’s no “undo.” Once we select a cell, we filter out all
rows that don’t match, and those rows are “lost” to the user because
there’s no way to restore them. And further clicks only cause loss of
more rows!</p>
<p>This is because we didn’t <strong>handle</strong> the <em>other</em>
possibility: that the user has not selected any cell (or that they’ve
de-selected the cell they just had selected, which is functionally the
same).</p>
<p>Whenever no cell is selected, we need to “return” to the original
<code>gapminder</code> data set, albeit sorted appropriately. We can
handle this scenario using <code>if()/else</code>:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the observeEvent({},{}) we introduced in the previous example!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span>  <span class="co">###TABLE OBSERVER (CELL SELECTION)</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="fu">list</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">go_button</span>, <span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span><span class="op">)</span>, <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co">##STEP 6: WE ADD IN AN IF/ELSE PAIR. WE RESPOND ACCORDINGLY WHETHER THERE IS A CELL SELECTED OR NOT.</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu">nrow</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      </span>
<span>      <span class="va">val2match</span> <span class="op">=</span> <span class="va">gap</span><span class="op">[</span><span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, drop <span class="op">=</span> <span class="cn">T</span><span class="op">]</span></span>
<span>      </span>
<span>      <span class="va">col2match</span> <span class="op">=</span> <span class="fu">names</span><span class="op">(</span><span class="va">gap</span><span class="op">)</span><span class="op">[</span><span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>      </span>
<span>      <span class="va">gap_filtered</span> <span class="op">=</span> <span class="va">gap</span><span class="op">[</span><span class="va">gap</span><span class="op">[</span>, <span class="va">col2match</span><span class="op">]</span> <span class="op">==</span> <span class="va">val2match</span>, <span class="op">]</span></span>
<span>      </span>
<span>      <span class="va">gap_sorted</span> <span class="op">=</span> <span class="va">gap_filtered</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="fu">dataTableProxy</span><span class="op">(</span><span class="st">"basic_table"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">replaceData</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gap_sorted</span>, clearSelection <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>      </span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="co">#OTHERWISE, WE SIMPLY SORT THE ORIGINAL GAPMINDER DATA SET AS WE HAVE PREVIOUSLY. </span></span>
<span>      <span class="va">gap_sorted</span> <span class="op">=</span> <span class="va">gap</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="fu">dataTableProxy</span><span class="op">(</span><span class="st">"basic_table"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">replaceData</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gap_sorted</span>, clearSelection <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>      </span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Now, we can filter and unfilter our table with just a click! This
functionality could empower a variety of dynamic, engaging workflows for
your users.</p>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge1"></a>
</h3>
<div class="callout-content">
<p>Using if/else to handle “undoing” previous actions works really well,
but some users could find it unintuitive. They might not even realize
it’s something they can do!</p>
<p>A more conventional, “expected” approach might be a “reset” button
that restores the original table when pressed.</p>
<p>See if you can figure out how to build such a button <em>without</em>
losing <em>any</em> of the app’s current functionality.</p>
<p>If you succeed, consider whether you, as a user, would prefer the
“select nothing to undo” functionality or the “reset button”
functionality, or if you’d prefer having both.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>First, we add the reset button to our UI, just below the current
“Go!” button:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="do">##This code should **be added to** the "sidebar" content of the Table tabPanel in the BODY section of your ui.R file!</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="do">##... other UI code...</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="fu">actionButton</span>(<span class="at">inputId =</span> <span class="st">"go_button"</span>,</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>                        <span class="at">label =</span> <span class="st">"Go!"</span>)<span class="er">)</span>,</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="fu">actionButton</span>(<span class="at">inputId =</span> <span class="st">"reset_button"</span>,</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>                        <span class="at">label =</span> <span class="st">"Reset!"</span>)<span class="er">)</span>,</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>  <span class="do">##... other UI code...</span></span></code></pre>
</div>
<p>Then, in our server file, we add a new observer to watch that button
and handle when a user presses it. This is pretty simple here: we use
our proxy to restore the original <code>gapminder</code> data set:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added to** your server.R file, underneath all other contents inside of your server function!</span></span>
<span></span>
<span><span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">reset_button</span>, <span class="op">{</span></span>
<span>              </span>
<span>  <span class="co">##WE REWIND ALL THE WAY BACK TO THE ORIGINAL GAPMINDER DATA AND CLEAR ANY SELECTIONS THE USER MAY ALREADY HAVE MADE.</span></span>
<span>    <span class="fu">dataTableProxy</span><span class="op">(</span><span class="st">"basic_table"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">replaceData</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gap</span>, </span>
<span>                clearSelection <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span>     </span>
<span> <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>As for what I prefer, I think I’d rather have both functionalities.
Together, they make our app more accessible because, while the “click to
undo” approach is easy and precise as an undo mechanism, not every user
may discover or understand it (unless they’re trained well!).</p>
<p>A reset button, meanwhile, is something nearly everyone understands
intuitively. The way we’ve coded it here is pretty “aggressive” in that
it undoes <em>everything</em>, but that will at least match with the
expectations of most users.</p>
<p>And, on the plus side, the reset button enables undoing any sorting,
functionality that didn’t previously exist in any previous version we’ve
had!</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="putting-us-on-the-map">Putting us on the map<a class="anchor" aria-label="anchor" href="#putting-us-on-the-map"></a>
</h3>
<div class="section level4">
<h4 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h4>
<p>Before we go any further, we need to “massage” our data set to make
it ready for mapping (spatial data are complicated!). Add the following
to your <code>global.R</code> file at the end <em>verbatim</em>. Don’t
worry about what it does, though!</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">###MASSAGE DATA SET FOR MAKING MAPS</span></span>
<span><span class="va">gap</span><span class="op">$</span><span class="va">country</span> <span class="op">=</span> <span class="fu">as.character</span><span class="op">(</span><span class="va">gap</span><span class="op">$</span><span class="va">country</span><span class="op">)</span></span>
<span><span class="va">gap</span><span class="op">$</span><span class="va">continent</span> <span class="op">=</span> <span class="fu">as.character</span><span class="op">(</span><span class="va">gap</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gap</span><span class="op">$</span><span class="va">ID</span> <span class="op">=</span> <span class="fu">countrycode</span><span class="op">(</span><span class="va">gap</span><span class="op">$</span><span class="va">country</span>, <span class="st">"country.name"</span>, <span class="st">"iso3c"</span><span class="op">)</span></span>
<span><span class="va">world</span> <span class="op">=</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"TM_WORLD_BORDERS_SIMPL-0.3.shp"</span><span class="op">)</span> <span class="co">#&lt;--THIS FILE CAN BE DOWNLOADED VIA &lt;https://drive.google.com/file/d/1Ta0GSnoJPyEMFjjbpzE3Z8RD0Mq18RL7/view?usp=sharing&gt;. MAKE SURE TO UNZIP IT AND MOVE IT AND ALL ITS COMPANION FILES INTO YOUR R PROJECT FOLDER!</span></span>
<span></span>
<span><span class="va">world2</span> <span class="op">=</span> <span class="va">world</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">ISO3</span>, <span class="va">geometry</span><span class="op">)</span></span>
<span><span class="va">gap_map</span> <span class="op">=</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">gap</span>, <span class="va">world2</span>, by <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"ID"</span> <span class="op">=</span> <span class="st">"ISO3"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">gap_map</span> <span class="op">=</span> <span class="fu">st_as_sf</span><span class="op">(</span><span class="va">gap_map</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level4">
<h4 id="preface">Preface<a class="anchor" aria-label="anchor" href="#preface"></a>
</h4>
<p><code>DT</code> has shown us how more complex widgets operate in R
Shiny, so we can switch to making map widgets using
<code>leaflet</code>. We’ll follow the same roadmap we just used for
<code>DT</code>:</p>
<ol style="list-style-type: decimal">
<li><p>We’ll start with a basic map.</p></li>
<li><p>Then, we’ll adjust some features and dress up its
aesthetics.</p></li>
<li><p>Lastly, we’ll learn about map-specific events and how to handle
those events <em>without</em> redrawing the entire map.</p></li>
</ol>
<p>The specifics will be different, but all the concepts here we’ve
already been introduced to, so we can get another round of practice with
them.</p>
</div>
<div class="section level4">
<h4 id="basic-map">Basic map<a class="anchor" aria-label="anchor" href="#basic-map"></a>
</h4>
<p>Let’s make a <code>leaflet</code> map showing the countries in our
data set colored by their 2007 life expectancy data. We’ll place the
result in our UI’s “Map” tab panel.</p>
<p>Every <code>leaflet</code> map has three building blocks:</p>
<ol style="list-style-type: decimal">
<li><p>A <code>leaflet()</code> call. This function is like
<code>ggplot()</code> from the <code>ggplot2</code> package—it “sets the
stage” for the rest of the graphic, and you can specify some settings
here that’ll apply to all subsequent components.</p></li>
<li><p>A <code>addTiles()</code> call. This function place’s a “tile,”
or background, on your map. This is that thing indicating where lakes
and roads and boundaries are! We’ll use the default tile here, but there
are many others to choose from.</p></li>
<li>
<p>At least one <code>add*()</code> function call for adding
<strong>spatial data</strong> to our map. There are others, but the
three most commonly used ones are:</p>
<ol style="list-style-type: decimal">
<li><p><code>addMarkers()</code> adds <strong>spatial point</strong>
(0-dimensional) <strong>data</strong> (like the locations of
restaurants).</p></li>
<li><p><code>addLines()</code> adds <strong>spatial line/curve</strong>
(1-dimensional) <strong>data</strong> (like roads or rivers).</p></li>
<li><p><code>addPolygons()</code> adds <strong>spatial polygon</strong>
(2-dimensional) <strong>data</strong> (like country
boundaries).</p></li>
</ol>
</li>
</ol>
<p>Here, we’ll use <code>addPolygons()</code>:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **swapped** for the the "main panel" content in the BODY section of your ui.R file!</span></span>
<span></span>
<span><span class="co">##... other UI code...</span></span>
<span></span>
<span><span class="co">###MAIN PANEL CELL</span></span>
<span>    <span class="fu">column</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">8</span>, <span class="fu">tabsetPanel</span><span class="op">(</span></span>
<span>      <span class="co">###TABLE TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Table"</span>, <span class="fu">dataTableOutput</span><span class="op">(</span><span class="st">"basic_table"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="co">###MAP TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map"</span>, <span class="fu">leafletOutput</span><span class="op">(</span><span class="st">"basic_map"</span><span class="op">)</span><span class="op">)</span>, <span class="co">#&lt;--ADD OUR NEW MAP.</span></span>
<span>      <span class="co">###GRAPH TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Graph"</span>,</span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co">##... other UI code...</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added to** your server.R file, underneath all other contents inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="co">##FILTER TO ONLY 2007 DATA.</span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu">leaflet</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--GETS THINGS STARTED</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--ADDS A BACKGROUND </span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>, <span class="co">#SPECIFY OUR SPATIAL DATA (geometry IS AN sf PACKAGE CONSTRUCTION)</span></span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>, <span class="co">#&lt;-BLACK OUTLINE</span></span>
<span>        weight <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co">#THICKER-THAN-DEFAULT OUTLINE.</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>The code above creates a nice, if somewhat basic, interactive map
showing the countries for which we have data, outlined in black. Notice
that you can <strong>pan</strong> the map by clicking anywhere, holding
the click, and moving the mouse.</p>
<p>Notice that you can also <strong>zoom</strong> the map in or out
using your mouse wheel (if you have one), or by using the plus/minus
buttons in the top-left corner. Double-clicking on the map also zooms
in.</p>
<p>If you zoom in a lot, you’ll see the tile change to show greater
detail. If you zoom out, you’ll see the world actually repeat several
times left-to-right, if your screen is wide enough…pretty weird!</p>
</div>
<div class="section level4">
<h4 id="more-or-less-basic-map">More (or less) basic map<a class="anchor" aria-label="anchor" href="#more-or-less-basic-map"></a>
</h4>
<p>As we just saw, it often doesn’t make sense to allow users to
<strong>pan</strong> and <strong>zoom</strong> without any
guardrails—they can get lost or produce unhelpful visual quirks to
arise. As I noted earlier, <code>leaflet()</code> contains many global
settings we can apply to our map. For example, we can set min and max
zoom levels like so:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co">##THE leaflet() FUNCTION HAS A LIST OF OPTIONS WE CAN ADJUST, SUCH AS THE MIN AND MAX ZOOM LEVELS.</span></span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>        weight <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>A <code>minZoom</code> of 2 is one in which <em>almost</em> the
entire world is visible at once (on my laptop, anyway!). A
<code>maxZoom</code> of 6 allows users to zoom into specific continental
regions but no further. This keeps users from zooming in or out to a
degree that doesn’t really make sense given our data.</p>
<p>We can also set <strong>maximum bounds</strong>—users can’t
<strong>pan</strong> the map past these:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">#THE SF PACKAGE'S st_bbox() FUNCTION GETS THE FOUR POINTS THAT WOULD CREATE A BOX FULLY BOUNDING ALL SPATIAL DATA WE GIVE IT AS INPUTS.</span></span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>        weight <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>  </span>
<span>      <span class="co">##setMaxBounds() TAKES, AS INPUTS, THOSE EXACT SAME FOUR POINTS.</span></span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>When a user tries to pan past the bounds, the map will “snap back” to
a focus point within the bounds.</p>
<p>While there are other features we could adjust or disable, setting
bounds and a minimum and maximum zoom are two things you’ll generally
want to do to every map you make.</p>
<div class="section level5">
<h5 id="adding-some-pizzazz">Adding some pizzazz<a class="anchor" aria-label="anchor" href="#adding-some-pizzazz"></a>
</h5>
<p>Our map is still rather basic-looking. In fact, it doesn’t even
fulfill the minimum specifications we’d set—it doesn’t show the life
expectancy data yet.</p>
<p>To fix that, we need to set up a <strong>color palette</strong> so
<code>leaflet</code> knows <em>how</em> to fill our country polygons
(it’s a <em>little</em> fussy!). We can build a color palette using
<code>leaflet</code>’s <code>colorNumeric()</code> function.</p>
<p>This function has two required inputs: a <code>palette</code>, the
name of the R color palette we’d like to use, and a <code>domain</code>,
the set of values we’ll need colors for in our final palette:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">#ESTABLISH A COLOR SCHEME TO USE FOR OUR FILLS.</span></span>
<span>    <span class="va">map_palette</span> <span class="op">=</span> <span class="fu">colorNumeric</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Blues"</span>, domain <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>        weight <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>  </span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Once <code>leaflet</code> knows every value it’ll need a color for
(<code>domain</code>) and every color it should use
(<code>palette</code>), we can add coloring instructions to
<code>addPolygons()</code>:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">map_palette</span> <span class="op">=</span> <span class="fu">colorNumeric</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Blues"</span>, domain <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>, <span class="co">#&lt;--NOTICE THAT THE OUTLINE ("STROKE") HAS A DIFFERENT COLOR PARAMETER THAN THE FILL.</span></span>
<span>        weight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        fillColor <span class="op">=</span> <span class="fu">map_palette</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span>, <span class="co">#&lt;--WE USE OUR NEW COLOR PALETTE LIKE A FUNCTION, SPECIFYING OUR DATA AS INPUTS.</span></span>
<span>        fillOpacity <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co">#&lt;--THE DEFAULT, 0.5, WASHES OUT THE COLORS TOO MUCH.</span></span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>This is already a <em>much</em> cooler map!</p>
<p>But shouldn’t there be a <strong>legend</strong> that clarifies what
colors go with what values? We can add one using
<code>addLegend()</code>:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>   <span class="va">map_palette</span> <span class="op">=</span> <span class="fu">colorNumeric</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Blues"</span>, domain <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        weight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        fillColor <span class="op">=</span> <span class="fu">map_palette</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>        fillOpacity <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="co">#ADD A LEGEND TO THE MAP</span></span>
<span>      <span class="fu">addLegend</span><span class="op">(</span></span>
<span>        position <span class="op">=</span> <span class="st">"bottomleft"</span>, <span class="co">#&lt;--WHERE TO PUT IT.</span></span>
<span>        pal <span class="op">=</span> <span class="va">map_palette</span>, <span class="co">#&lt;--COLOR SCHEME TO USE.</span></span>
<span>        values <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span>, <span class="co">#WHAT SCALE ANCHORS ("BREAKS") TO USE.</span></span>
<span>        opacity <span class="op">=</span> <span class="fl">0.75</span>, <span class="co">#LEGEND TRANSPARENCY.</span></span>
<span>        bins <span class="op">=</span> <span class="fl">5</span>, <span class="co">#NUMBER OF BREAKS TO HAVE.</span></span>
<span>        title <span class="op">=</span> <span class="st">"Life&lt;br&gt;expectancy ('07)"</span> <span class="co">#LEGEND TITLE.</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>This is a nice looking map!</p>
<p>…But what if our users don’t know much geography, so they don’t know
which countries are which? Or what if they wanted to know the
<em>exact</em> life expectancy value for a country? This map couldn’t
easily address either issue.</p>
<p>Adding <strong>tooltips</strong> would help address both. A tooltip
is a small pop-up that might appear on mouse hover (in
<code>leaflet</code>, those are called “labels”), on mouse click
(leaflet calls these “popups”), or after some other action.</p>
<p>Using the <code>popup</code> parameter inside
<code>addPolygons()</code>, we can add tooltips that appear and
disappear on mouse click. Inside these, we’ll put the name of the
country being clicked on, in case users don’t know their countries
well:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">map_palette</span> <span class="op">=</span> <span class="fu">colorNumeric</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Blues"</span>, domain <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        weight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        fillColor <span class="op">=</span> <span class="fu">map_palette</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>        fillOpacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        popup <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">country</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--MAKE A TOOLTIP HOLDING THE RELEVANT COUNTRY APPEAR/DISAPPEAR ON MOUSE CLICK. </span></span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addLegend</span><span class="op">(</span></span>
<span>        position <span class="op">=</span> <span class="st">"bottomleft"</span>,</span>
<span>        pal <span class="op">=</span> <span class="va">map_palette</span>,</span>
<span>        values <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span>,</span>
<span>        opacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        bins <span class="op">=</span> <span class="fl">5</span>,</span>
<span>        title <span class="op">=</span> <span class="st">"Life&lt;br&gt;expectancy ('07)"</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>This is a nice addition, but what if we wanted to add life expectancy
values too? And keep the result human-readable? There are many
approaches we could take, but one using “Normal R’s” versatile
<code>paste0()</code> function plus the HTML line break element
(<code>&lt;br&gt;</code>) is straightforward:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">map_palette</span> <span class="op">=</span> <span class="fu">colorNumeric</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Blues"</span>, domain <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        weight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        fillColor <span class="op">=</span> <span class="fu">map_palette</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>        fillOpacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        popup <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span><span class="st">"County: "</span>, <span class="co">#&lt;--WE USE R'S paste0() FUNCTION AND THE HTML LINE BREAK ELEMENT &lt;br&gt; TO MAKE THE TOOLTIP TEXT VERY READABLE AND INFO-RICH.</span></span>
<span>                       <span class="va">gap_map2007</span><span class="op">$</span><span class="va">country</span>,</span>
<span>                       <span class="st">"&lt;br&gt;Life Expectancy: "</span>,</span>
<span>                       <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addLegend</span><span class="op">(</span></span>
<span>        position <span class="op">=</span> <span class="st">"bottomleft"</span>,</span>
<span>        pal <span class="op">=</span> <span class="va">map_palette</span>,</span>
<span>        values <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span>,</span>
<span>        opacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        bins <span class="op">=</span> <span class="fl">5</span>,</span>
<span>        title <span class="op">=</span> <span class="st">"Life&lt;br&gt;expectancy ('07)"</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Now, our map is both snazzy and informative!</p>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge2"></a>
</h3>
<div class="callout-content">
<p>In the previous example, we used <code>popup</code> to build our
tooltips. Try using the <code>label</code> parameter instead. For
whatever reason, this requires more “normal R” data wrangling, so here’s
the <em>exact</em> code you’ll need (feel free to copy and paste
it!):</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">label</span> <span class="op">=</span> <span class="fu">lapply</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu">nrow</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span> </span>
<span>                    <span class="fu">HTML</span><span class="op">(</span><span class="fu">paste0</span><span class="op">(</span><span class="st">"County: "</span>,</span>
<span>                                 <span class="va">gap_map2007</span><span class="op">$</span><span class="va">country</span><span class="op">[</span><span class="va">x</span><span class="op">]</span>, </span>
<span>                                 <span class="st">"&lt;br&gt;Life Expectancy: "</span>, </span>
<span>                                <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>What changes? Which do you prefer? Which would be better if a lot of
your users will use mobile devices, do you think?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>If we use <code>label</code>, we get tooltips that appears on mouse
hover instead of on mouse click. Actually, this is <em>probably</em>
more intuitive for most users; many will not expect a click to do
anything and may only discover our on-click-style tooltips by
accident!</p>
<p>On the other hand, tooltips that appear on hover can be annoying if a
user is trying to, <em>e.g.</em>, trace a path with their mouse and
irrelevant tooltips keep getting in the way or providing
distractions.</p>
<p>Also, an advantage of on-click tooltips is that they <em>don’t</em>
disappear until a user is ready for them to do so, whereas tooltips that
disappear when the mouse is moved can prevent users from consulting a
tooltip while also using their mouse somewhere else on the page.</p>
<p>However, the biggest potential disadvantage of “on-hover” tooltips is
that, while there is an equivalent to a mouse click on touchscreen
devices (a finger press), there is no <em>universal</em> equivalent to a
mouse hover (some browsers and platforms use a “long press” for this,
but not all, and many users are not accustomed to taking that action
anyway!).</p>
<p>So, mobile users won’t generally see tooltips if they appear
<em>only</em> on hover. If we’re aiming for “mobile-first” design, the
<code>popup</code> option is better (which is why I picked it)!</p>
<p>However, note that by using <code>labelOptions</code>, we can adjust
which events cause tooltips to appear, <em>e.g.</em>, we can make them
appear on both hover and on touch.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="update-dont-remake-leaflet-edition">Update, don’t remake, <code>leaflet</code> edition!<a class="anchor" aria-label="anchor" href="#update-dont-remake-leaflet-edition"></a>
</h3>
<p>At this stage, our users have <em>no</em> control over <em>which</em>
data are shown in our map. Let’s give them that control by adding a
<strong>slider input widget</strong> that will let them select which
year’s data is plotted:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="do">##This code should **replace** the "sidebar panel" cell's content within the BODY section of your ui.R file!</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a><span class="do">##... other UI code...</span></span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a><span class="do">###SIDEBAR CELL</span></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>    <span class="fu">column</span>(</span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a>      <span class="fu">selectInput</span>(</span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a>        <span class="at">inputId =</span> <span class="st">"sorted_column"</span>,</span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"Select a column to sort the table by."</span>,</span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a>        <span class="at">choices =</span> <span class="fu">c</span>(</span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a>          <span class="st">"Country"</span> <span class="ot">=</span> <span class="st">"country"</span>,</span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a>          <span class="st">"Continent"</span> <span class="ot">=</span> <span class="st">"continent"</span>,</span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a>          <span class="st">"Year"</span> <span class="ot">=</span> <span class="st">"year"</span>,</span>
<span id="cb24-15"><a href="#cb24-15" tabindex="-1"></a>          <span class="st">"Life expectancy"</span> <span class="ot">=</span> <span class="st">"lifeExp"</span>,</span>
<span id="cb24-16"><a href="#cb24-16" tabindex="-1"></a>          <span class="st">"Population size"</span> <span class="ot">=</span> <span class="st">"pop"</span>,</span>
<span id="cb24-17"><a href="#cb24-17" tabindex="-1"></a>          <span class="st">"GDP per capita"</span> <span class="ot">=</span> <span class="st">"gdpPercap"</span></span>
<span id="cb24-18"><a href="#cb24-18" tabindex="-1"></a>        )</span>
<span id="cb24-19"><a href="#cb24-19" tabindex="-1"></a>      ),</span>
<span id="cb24-20"><a href="#cb24-20" tabindex="-1"></a>      <span class="fu">actionButton</span>(<span class="at">inputId =</span> <span class="st">"go_button"</span>, <span class="at">label =</span> <span class="st">"Go!"</span>),</span>
<span id="cb24-21"><a href="#cb24-21" tabindex="-1"></a>      <span class="co"># actionButton(inputId = "reset_button",</span></span>
<span id="cb24-22"><a href="#cb24-22" tabindex="-1"></a>      <span class="co">#                   label = "Reset!"),</span></span>
<span id="cb24-23"><a href="#cb24-23" tabindex="-1"></a>      <span class="co">#ADD OUR NEWEST SLIDER WIDGET</span></span>
<span id="cb24-24"><a href="#cb24-24" tabindex="-1"></a>      <span class="fu">sliderInput</span>(</span>
<span id="cb24-25"><a href="#cb24-25" tabindex="-1"></a>        <span class="at">inputId =</span> <span class="st">"year_slider"</span>,</span>
<span id="cb24-26"><a href="#cb24-26" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"Pick what year's data are shown in the map."</span>,</span>
<span id="cb24-27"><a href="#cb24-27" tabindex="-1"></a>        <span class="at">value =</span> <span class="dv">2007</span>, <span class="co">#&lt;--SET THE DEFAULT CHOICE</span></span>
<span id="cb24-28"><a href="#cb24-28" tabindex="-1"></a>        <span class="at">min =</span> <span class="fu">min</span>(gap<span class="sc">$</span>year), <span class="co">#&lt;--MIN AND MAX POSSIBLE SELECTIONS</span></span>
<span id="cb24-29"><a href="#cb24-29" tabindex="-1"></a>        <span class="at">max =</span> <span class="fu">max</span>(gap<span class="sc">$</span>year),</span>
<span id="cb24-30"><a href="#cb24-30" tabindex="-1"></a>        <span class="at">step =</span> <span class="dv">5</span>, <span class="co">#&lt;--HOW FAR APART CAN CHOICES BE?</span></span>
<span id="cb24-31"><a href="#cb24-31" tabindex="-1"></a>        <span class="at">sep =</span> <span class="st">""</span> <span class="co">#&lt;--DON'T USE COMMAS TO SEPARATE THE THOUSANDS PLACE.</span></span>
<span id="cb24-32"><a href="#cb24-32" tabindex="-1"></a>      )),</span>
<span id="cb24-33"><a href="#cb24-33" tabindex="-1"></a>  <span class="do">##... other UI code...</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="co">##WE'LL KEEP THIS DATASET NAMED AFTER YEAR 2007. WE'LL SEE WHY A BIT LATER.</span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">year_slider</span><span class="op">)</span><span class="op">)</span> <span class="co">#&lt;--INTRODUCE THE  SLIDER'S CURRENT VALUE. EVERY CHANGE TO THIS WILL TRIGGER'S OUR renderLeaflet({}) CODE TO RERUN.</span></span>
<span>    </span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">map_palette</span> <span class="op">=</span> <span class="fu">colorNumeric</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Blues"</span>, domain <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        weight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        fillColor <span class="op">=</span> <span class="fu">map_palette</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>        fillOpacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        popup <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span><span class="st">"County: "</span>,</span>
<span>                       <span class="va">gap_map2007</span><span class="op">$</span><span class="va">country</span>,</span>
<span>                       <span class="st">"&lt;br&gt;Life Expectancy: "</span>,</span>
<span>                       <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span></span>
<span>        <span class="co"># label = lapply(1:nrow(gap_map2007), function(x) {</span></span>
<span>        <span class="co">#   HTML(</span></span>
<span>        <span class="co">#     paste0(</span></span>
<span>        <span class="co">#       "County: ",</span></span>
<span>        <span class="co">#       gap_map2007$country[x],</span></span>
<span>        <span class="co">#       "&lt;br&gt;Life Expectancy: ",</span></span>
<span>        <span class="co">#       gap_map2007$lifeExp[x]</span></span>
<span>        <span class="co">#     )</span></span>
<span>        <span class="co">#   )</span></span>
<span>        <span class="co"># })</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addLegend</span><span class="op">(</span></span>
<span>        position <span class="op">=</span> <span class="st">"bottomleft"</span>,</span>
<span>        pal <span class="op">=</span> <span class="va">map_palette</span>,</span>
<span>        values <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span>,</span>
<span>        opacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        bins <span class="op">=</span> <span class="fl">5</span>,</span>
<span>        title <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span><span class="st">"Life&lt;br&gt;expectancy ("</span>, <span class="va">gap_map2007</span><span class="op">$</span><span class="va">year</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">")"</span><span class="op">)</span> <span class="co">#&lt;-HERE, WE GET FANCY USING R's paste0() FUNCTION TO MAKE SURE THE "RIGHT" YEAR IS ALWAYS THE ONE IN THE LEGEND TITLE.</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>This new functionality gives users a new and exciting way to explore
the data!</p>
<p>…However, the way we handle events involving this new input is
<em>not</em> ideal. Each time a user adjusts the slider, the map is
<em>entirely</em> rebuilt. With maps, this can be <em>especially</em>
problematic because spatial data can be <em>very</em> voluminous, so
re-rendering a map from scratch can cause long loading times.</p>
<p>Just as with <code>DT</code>, <code>leaflet</code> features a
<strong>proxy system</strong> that will let us update a map, only
changing features that <em>need</em> to change.</p>
<p>Let’s switch to using that proxy system. The approach will be the
same as with <code>DT</code>:</p>
<ol style="list-style-type: decimal">
<li><p>We use <code>renderLeaflet({})</code> to produce <em>just</em>
the “starting” version of the map that the user sees upon
startup.</p></li>
<li><p>We use a new <code>observeEvent({},{})</code> to watch for
relevant events.</p></li>
<li><p>Inside the observer, we use a proxy built using
<code>leafletProxy()</code>, which is analogous to
<code>dataTableProxy()</code>, to update our map:</p></li>
</ol>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">###MAP</span></span>
<span><span class="co">#renderLeaflet({}) ONLY BUILDS THE FIRST VERSION OF THE MAP. NO REACTIVE OBJECTS HERE, SO IT'LL NEVER RERUN.</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span> <span class="co">#&lt;--RESTORE THIS TO 2007 (OUR DEFAULT YEAR).</span></span>
<span>    </span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>     <span class="co">#WE MOVE THE CODE MAKING map_palette TO GLOBAL.R SO IT ONLY RUNS ONCE EVER.</span></span>
<span>    </span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        weight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        fillColor <span class="op">=</span> <span class="fu">map_palette</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>        fillOpacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        popup <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span><span class="st">"County: "</span>,</span>
<span>                       <span class="va">gap_map2007</span><span class="op">$</span><span class="va">country</span>,</span>
<span>                       <span class="st">"&lt;br&gt;Life Expectancy: "</span>,</span>
<span>                       <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span></span>
<span>        <span class="co"># label = lapply(1:nrow(gap_map2007), function(x) {</span></span>
<span>        <span class="co">#   HTML(</span></span>
<span>        <span class="co">#     paste0(</span></span>
<span>        <span class="co">#       "County: ",</span></span>
<span>        <span class="co">#       gap_map2007$country[x],</span></span>
<span>        <span class="co">#       "&lt;br&gt;Life Expectancy: ",</span></span>
<span>        <span class="co">#       gap_map2007$lifeExp[x]</span></span>
<span>        <span class="co">#     )</span></span>
<span>        <span class="co">#   )</span></span>
<span>        <span class="co"># })</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addLegend</span><span class="op">(</span></span>
<span>        position <span class="op">=</span> <span class="st">"bottomleft"</span>,</span>
<span>        pal <span class="op">=</span> <span class="va">map_palette</span>,</span>
<span>        values <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span>,</span>
<span>        opacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        bins <span class="op">=</span> <span class="fl">5</span>,</span>
<span>        title <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span><span class="st">"Life&lt;br&gt;expectancy ("</span>, <span class="va">gap_map2007</span><span class="op">$</span><span class="va">year</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">")"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">###MAP OBSERVER (SLIDER)</span></span>
<span>  <span class="co">#A NEW OBSERVER WATCHES FOR EVENTS INVOLVING OUR NEW SLIDER.</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">year_slider</span>, <span class="op">{</span></span>
<span>    <span class="va">gap_map</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--NOTE THE NAME CHANGE OF THE PRODUCT HERE.</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">year_slider</span><span class="op">)</span><span class="op">)</span> <span class="co">#&lt;--SLOT THAT SLIDER'S INPUT OBJECT HERE.</span></span>
<span>    </span>
<span>  <span class="co">#WE USE leafletProxy({}) TO UPDATE OUR MAP INSTEAD OF RE-RENDERING IT. </span></span>
<span>    <span class="fu">leafletProxy</span><span class="op">(</span><span class="st">"basic_map"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="co">#WE DON'T HAVE TO MESS WITH THE ZOOM, BOUNDS, OR TILES BECAUSE THOSE ASPECTS AREN'T CHANGING. </span></span>
<span>      <span class="fu">clearMarkers</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--WE DO NEED TO REMOVE THE OLD MARKERS THOUGH BECAUSE THEIR COLORS WILL CHANGE.</span></span>
<span>      <span class="fu">clearControls</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--SAME WITH THE LEGEND ("CONTROL") FOR THE SAME REASON.</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span> <span class="co">#&lt;--WE RE-BUILD OUR POLYGONS EXACTLY THE SAME AS ALWAYS...</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map</span><span class="op">$</span><span class="va">geometry</span>, <span class="co">#&lt;--EXCEPT WE REFERENCE gap_map THROUGHOUT.</span></span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        weight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        fillColor <span class="op">=</span> <span class="fu">map_palette</span><span class="op">(</span><span class="va">gap_map</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>        fillOpacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        popup <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span><span class="st">"County: "</span>,</span>
<span>                       <span class="va">gap_map</span><span class="op">$</span><span class="va">country</span>,</span>
<span>                       <span class="st">"&lt;br&gt;Life Expectancy: "</span>,</span>
<span>                       <span class="va">gap_map</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span></span>
<span>        <span class="co"># label = lapply(1:nrow(gap_map), function(x) {</span></span>
<span>        <span class="co">#   HTML(</span></span>
<span>        <span class="co">#     paste0(</span></span>
<span>        <span class="co">#       "County: ",</span></span>
<span>        <span class="co">#       gap_map$country[x],</span></span>
<span>        <span class="co">#       "&lt;br&gt;Life Expectancy: ",</span></span>
<span>        <span class="co">#       gap_map$lifeExp[x]</span></span>
<span>        <span class="co">#     )</span></span>
<span>        <span class="co">#   )</span></span>
<span>        <span class="co"># })</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addLegend</span><span class="op">(</span> <span class="co">#&lt;--WE RE-BUILD OUR LEGEND EXACTLY THE SAME WAY TOO. </span></span>
<span>        position <span class="op">=</span> <span class="st">"bottomleft"</span>,</span>
<span>        pal <span class="op">=</span> <span class="va">map_palette</span>,</span>
<span>        values <span class="op">=</span> <span class="va">gap_map</span><span class="op">$</span><span class="va">lifeExp</span>,</span>
<span>        opacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        bins <span class="op">=</span> <span class="fl">5</span>,</span>
<span>        title <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span><span class="st">"Life&lt;br&gt;expectancy ("</span>, <span class="va">gap_map</span><span class="op">$</span><span class="va">year</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">")"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added** to the bottom of your global.R file, after gap_map is made!</span></span>
<span></span>
<span><span class="co">###MAP COLOR PALETTE</span></span>
<span><span class="co">#WE MOVE THIS CODE TO GLOBAL.R SO IT NEED ONLY EVER RUN ONCE.</span></span>
<span><span class="va">map_palette</span> <span class="op">=</span> <span class="fu">colorNumeric</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Blues"</span>, domain <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gap_map</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Since this overhaul was a little involved, let’s break down the key
pieces:</p>
<ol style="list-style-type: decimal">
<li>
<p>First, for simplicity, we removed the code producing our
<code>map_palette</code> from <code>renderLeaflet({})</code>. Why? Now
that we will use this palette in two places, it’s more efficient to have
this code in <code>global.R</code> where it can run just once ever and
be reused whenever needed.</p>
<ul>
<li>This has the added benefit of ensuring every version of our map will
always use the exact same color-value mapping! Otherwise, our
<code>domain</code>s would shift, depending upon which year’s data are
being shown, making it harder to see patterns over time.</li>
</ul>
</li>
<li><p>We “strip back” the code in <code>renderLeaflet({})</code> such
that it contains no reactive objects (<em>e.g.</em>,
<code>input$year_slider</code>). As such, it’ll run once when the app
starts up but never again.</p></li>
<li><p>We create a new <code>observeEvent({},{})</code> watching our
slider. When it’s value changes, <code>leafletProxy()</code> will
dictate what happens.</p></li>
<li>
<p>We feed our proxy <em>only</em> commands affecting aspects that
<em>need</em> to change—in this case, we reference just our polygons and
legend (because their colors need to change).</p>
<ul>
<li><p>We first remove the old versions using <code>clear*()</code>
functions.</p></li>
<li><p>Then, we rebuild each exactly as we built them originally but
based on new data selected by the user.</p></li>
</ul>
</li>
</ol>
<p>Once you’ve made these changes, start the app and observe what
happens when you adjust the slider. You’ll hopefully notice that doing
so results in “smoother” updates than before.</p>
</div>
<div class="section level3">
<h3 id="watch-and-learn">Watch and learn<a class="anchor" aria-label="anchor" href="#watch-and-learn"></a>
</h3>
<p><code>leaflet</code> maps are <strong>widgets</strong> just like all
the rest we’ve seen, so information about user interactions with them
are being <em>constantly</em> passed from the UI to the server by
<code>input</code>. These data can be accessed using
<code>input$outputId_*</code> format.</p>
<p>For example, whenever a user <strong>double-clicks</strong> a
location, this is registered as a “double click event,” and we can
access information about that location using
<code>input$outputId_dblclick</code> format server-side. [There is
“single-click event tracking” too, but because our popups respond to
single clicks already, let’s consider double-clicks here.]</p>
<p>A cool feature of <code>leaflet</code> maps is <code>flyTo()</code>,
which will pan and zoom a map to center on a specific location.</p>
<p>Let’s combine these two features (<code>flyTo</code> plus
double-click event tracking)! Let’s create a new observer that watches
for double-clicks, and, when one happens, a <code>leafletProxy()</code>
centers the map on that location:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added** to the bottom of your server.R file, but still within your server function!</span></span>
<span></span>
<span><span class="co">###MAP OBSERVER (DOUBLE CLICKS)</span></span>
<span><span class="co">#WE TRACK CHANGES IN THE DOUBLE-CLICK STATUS OF OUR MAP AND USE THAT INFO TO FLY TO THE LOCATION OF THE DOUBLE-CLICK.</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">basic_map_dblclick</span>, <span class="op">{</span></span>
<span>    <span class="fu">leafletProxy</span><span class="op">(</span><span class="st">"basic_map"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">flyTo</span><span class="op">(</span></span>
<span>        lat <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">basic_map_dblclick</span><span class="op">$</span><span class="va">lat</span>,</span>
<span>        lng <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">basic_map_dblclick</span><span class="op">$</span><span class="va">lng</span>,</span>
<span>        zoom <span class="op">=</span> <span class="fl">5</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
</div>
</section><section><h2 class="section-heading" id="getting-graphic">Getting graphic<a class="anchor" aria-label="anchor" href="#getting-graphic"></a>
<a class="anchor" aria-label="anchor" href="#getting-graphic"></a>
</h2>
<hr class="half-width">
<p>We’ll now turn to <code>plotly</code>, a package for producing
graphs, similar to <code>ggplot2</code>, but that are
<em>interactive</em> <em>by design</em>.</p>
<p>Regular R users who know <code>ggplot2</code> know that learning a
graphics package is like learning a new language! The learning curve is
<em>significant</em>; these packages give users <em>all</em> the tools
needed to design an entire, complex graph piece by piece. That’s a lot
of tools to learn and to keep straight!</p>
<p><code>plotly</code> is no different—you can create ultra-detailed,
publication-quality graphics with <code>plotly</code> too, but you’ll
need to learn a new vernacular to do it, one that may feel similar to
<code>ggplot2</code> but probably not ultra-similar.</p>
<p>As such, covering <code>plotly</code> in depth is outside our scope
here. Thankfully, we actually don’t <em>need</em> to learn it;
<code>plotly</code> comes with an <em>incredible</em> “cheat code” that,
while imperfect, will work fine here: the <code>ggplotly()</code>
function.</p>
<p><code>ggplotly()</code> takes a fully realized <code>ggplot</code>,
breaks it down into pieces, and rebuilds it piece by piece in
<code>plotly</code>’s system (as best as it can). Because the two
systems are ultimately similar, you’ll get a similar-looking graph out
the end, but it’ll now have all the interactive features a scratch-built
<code>plotly</code> graph would have.</p>
<p>However, the two systems <em>don’t</em> map 1-to-1, so the result
will never look <em>exactly</em> the same as the input graph. In
particular, complex customizations using <code>ggplot</code>’s
<code>theme()</code>, text-related components, advanced or new features,
and so on don’t make the transition well.</p>
<p>So, it’s probably correct to say that <code>ggplotly</code> produces
a <code>plotly</code> graph in the spirit of the <code>ggplot2</code>
graph we put in, not an exact replica.</p>
<p>Still, that means we don’t need to learn how to produce a
<code>plotly</code> graph to explore the associated features and use
cases, so that’s a pretty good deal!</p>
<p>To get started, let’s build the <code>ggplot2</code> graph we’ll use
as an input. Let’s make it a scatterplot of GDP vs. population for a
given year (we’ll start by looking at 2007), with each continent getting
a different color. Additionally, we’ll plot a best-fit regression line
for each continent:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added** to the bottom of your global.R file!</span></span>
<span></span>
<span><span class="co">###FILTERED DATA SET FOR MAP</span></span>
<span><span class="va">gap2007</span> <span class="op">=</span> <span class="va">gap</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span></span>
<span><span class="co">###BASE GGPLOT FOR CONVERSION TO PLOTLY</span></span>
<span><span class="co">#IF GGPLOT IS FAMILIAR TO YOU, STUDY THE SPECIFICS HERE TO GET A SENSE OF THE GRAPH WE'RE BUILDING. IF NOT, DON'T WORRY ABOUT THE DETAILS! JUST COPY-PASTE THIS CODE INTO PLACE.</span></span>
<span><span class="va">p1</span> <span class="op">=</span> <span class="fu">ggplot</span><span class="op">(</span></span>
<span>  <span class="va">gap2007</span>,</span>
<span>  <span class="fu">aes</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu">log</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="va">gdpPercap</span>,</span>
<span>    color <span class="op">=</span> <span class="va">continent</span>,</span>
<span>    group <span class="op">=</span> <span class="va">continent</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      size <span class="op">=</span> <span class="fl">16</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"bold"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,</span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.line <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span><span class="st">"GDP per capita\n"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span><span class="st">"\nPopulation size (log)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_discrete</span><span class="op">(</span><span class="st">"Continent\n"</span><span class="op">)</span></span></code></pre>
</div>
<p>If you don’t know <code>ggplot2</code>, the above code will probably
look terrifying! No worries—just copy-paste the code and don’t worry too
much about what each piece does.</p>
<p>For those who <em>do</em> know <code>ggplot2</code>, you’ll hopefully
agree that, although this graph is not terrible remarkable, it looks
pretty good. More importantly, it’s just complex enough that it’ll be a
good test of how well <code>ggplotly()</code> does:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added** to the bottom of your global.R file!</span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu">ggplotly</span><span class="op">(</span><span class="va">p1</span><span class="op">)</span></span></code></pre>
</div>
<p>Now that we have our <code>plotly</code>-ized version of our graph,
it hopefully won’t surprise you to learn there are
<code>renderPlotly({})</code> and <code>plotlyOutput()</code> functions
we can use to add this graph to our app:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **swapped** for the the "main panel" content in the BODY section of your ui.R file!</span></span>
<span></span>
<span><span class="co">##... other UI code...</span></span>
<span><span class="co">###MAIN PANEL CELL</span></span>
<span>    <span class="fu">column</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">8</span>, <span class="fu">tabsetPanel</span><span class="op">(</span></span>
<span>      <span class="co">###TABLE TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Table"</span>, <span class="fu">dataTableOutput</span><span class="op">(</span><span class="st">"basic_table"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="co">###MAP TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map"</span>, <span class="fu">leafletOutput</span><span class="op">(</span><span class="st">"basic_map"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="co">###GRAPH TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Graph"</span>,</span>
<span>        <span class="fu">plotlyOutput</span><span class="op">(</span><span class="st">"basic_graph"</span><span class="op">)</span> <span class="co">#&lt;--ADD THE GRAPH HERE.</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##... other UI code...</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added to** your server.R file, underneath all other contents inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">basic_graph</span> <span class="op">=</span> <span class="fu">renderPlotly</span><span class="op">(</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">p2</span> <span class="co">#Put our pre-built ggplotly() output here.</span></span>
<span>    </span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>If we launch our app, we should see our new <code>plotly</code> graph
on the Graph tab panel. It looks quite similar to our
<code>ggplot</code> graph!</p>
<p>The only difference I really notice is in the placement of the
legend; while <code>ggplot</code>s center their legends vertically in
the available space by default, <code>plotly</code> graphs top-align
them instead.</p>
<p>We’ll adjust that in a moment! Meanwhile, let’s focus on the new
interactive features this graph comes with out of the box (it’s a
lot!):</p>
<ul>
<li><p><strong>Tooltips</strong>: If you hover over a point, you’ll get
a <strong>tooltip</strong> showing the data point’s associated
<code>x</code>, <code>y</code>, and <code>group</code> (continent)
values. These tooltips don’t look “pretty” in a human-readability sense,
but that too is something we’ll soon change.</p></li>
<li><p><strong>Click+drag to zoom</strong>: If you click anywhere, drag
your cursor to highlight a region, and let go, you will zoom the graph
to only the highlighted region. Double-clicking will restore the
original zoom level.</p></li>
<li><p><strong>Interactive “modebar:”</strong> <code>plotly</code>
graphs come with a toolbar (called a “modebar”) in the top-right (when
hovering over the graph) featuring several buttons. These allow you to
download an image of the graph, zoom and pan, select specific data in
various ways, reset the graph in various ways, and change how the
tooltips work. In particular, click the “compare data on hover” button
and see how this changes the behavior of the tooltips!</p></li>
<li><p><strong>Legend group (de)selection</strong>: If you click any of
the legend keys (such as “Asia”), all the data points from that group
will be redacted, and the axes will readjust as though those data
weren’t present. Double-clicking a legend key will reduce the data shown
to <em>only</em> those from that group. This functionality might allow a
user to exclude data extraneous to them personally and to focus of data
that <em>are</em> of interest.</p></li>
</ul>
<p>That’s a lot of interactivity for minimal effort on our part!</p>
<div class="section level3">
<h3 id="more-or-less-basic-graph">More (or less) basic graph<a class="anchor" aria-label="anchor" href="#more-or-less-basic-graph"></a>
</h3>
<p>…which means it’s time to discuss how to disable features if we want.
Unfortunately, disabling features in <code>plotly</code> is not
<em>as</em> easy as in <code>DT</code> or <code>leaflet</code>; to do
so, we must engage with two of the core functions involved in assembly
of a scratch-made <code>plotly</code> graph: <code>layout()</code> and
<code>config()</code>.</p>
<p><code>layout()</code> is <em>sort of</em> equivalent to
<code>ggplot2</code>’s <code>theme()</code> in that it controls many of
the specifics of how the plot looks. Inside <code>layout()</code> are
<code>xaxis</code> and <code>yaxis</code> parameters, which we can
provide with specific instructions.</p>
<p>If we give both of these parameters a list containing the instruction
<code>fixedrange = TRUE</code>, this will prohibit zooming:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the renderPlotly({}) code in your server.R file, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###GRAPH</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_graph</span> <span class="op">=</span> <span class="fu">renderPlotly</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">p2</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">layout</span><span class="op">(</span> <span class="co">#&lt;--layout() ADJUSTS PLOTLY GRAPH AESTHETICS.</span></span>
<span>        <span class="co">#PLOTLY CODE LOOKS "JAVASCRIPT-LIKE" RATHER THAN "R-LIKE," HENCE LISTS!</span></span>
<span>        xaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        yaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>In my experience, most (but not all!) graphs don’t benefit from
zooming, and some users find it hard to figure out how to reverse an
accidental zoom.</p>
<p>We can also use <code>layout()</code> to adjust how the legend
responds to clicks. For example, if we want to turn off the
functionality that redacts a group when its legend key is clicked on, we
can set the <code>itemclick</code> instruction for the
<code>legend</code> parameter to <code>FALSE</code>:</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the renderPlotly({}) code in your server.R file, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###GRAPH</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_graph</span> <span class="op">=</span> <span class="fu">renderPlotly</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">p2</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">layout</span><span class="op">(</span></span>
<span>        xaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        yaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        legend <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>          itemclick <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co">#&lt;--THE ONLY ADDITION--TURN OFF GROUP REDACTION UPON CLICKING ON LEGEND KEYS.</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">basic_graph</span> <span class="op">=</span> <span class="fu">renderPlotly</span><span class="op">(</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">p2</span> <span class="op">%&gt;%</span> </span>
<span>     <span class="fu">layout</span><span class="op">(</span>xaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            yaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            legend <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>itemclick <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="co">#&lt;-THE ONLY ADDITION HERE.</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>The <code>config()</code> function, meanwhile, can remove buttons
from the modebar, although you may need Google’s help to find the names
of the buttons you want to remove:</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the renderPlotly({}) code in your server.R file, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server </span></span>
<span><span class="co">###GRAPH</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_graph</span> <span class="op">=</span> <span class="fu">renderPlotly</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">p2</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">layout</span><span class="op">(</span></span>
<span>        xaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        yaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        legend <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>          itemclick <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">config</span><span class="op">(</span>modeBarButtonsToRemove <span class="op">=</span> <span class="fu">list</span><span class="op">(</span><span class="st">"lasso2d"</span><span class="op">)</span><span class="op">)</span> <span class="co">#&lt;--REMOVING THE "LASSO" SELECTION BUTTON.</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>As noted earlier, when considering UX, “less” can be “more.” If your
user might not understand it or won’t use it, remove it!</p>
<div class="section level4">
<h4 id="making-some-adjustments">Making some adjustments<a class="anchor" aria-label="anchor" href="#making-some-adjustments"></a>
</h4>
<p>Earlier, we identified two dissatisfying aspects of our graph. First,
the legend isn’t centered vertically, like in our original. Second, the
tooltip text could look nicer.</p>
<p>The first issue is easily solved using the <code>legend</code>
parameter inside of <code>layout()</code>, which we’ve already dabbled
with:</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the renderPlotly({}) code in your server.R file, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###GRAPH</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_graph</span> <span class="op">=</span> <span class="fu">renderPlotly</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">p2</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">layout</span><span class="op">(</span></span>
<span>        xaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        yaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        legend <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>          itemclick <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          y <span class="op">=</span> <span class="fl">0.5</span>, <span class="co">#&lt;--PUT THE LEGEND HALFWAY DOWN.</span></span>
<span>          yanchor <span class="op">=</span> <span class="st">"middle"</span> <span class="co">#&lt;--SPECIFICALLY, PUT THE **CENTER** HALFWAY DOWN.</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">config</span><span class="op">(</span>modeBarButtonsToRemove <span class="op">=</span> <span class="fu">list</span><span class="op">(</span><span class="st">"lasso2d"</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>As for the second issue, the best way to beautify our tooltip
contents will be to use the <code>style()</code> function.</p>
<p>This is a multi-step process:</p>
<ol style="list-style-type: decimal">
<li><p>First, let’s “pre-generate” the text we want to use in each
tooltip, (using the <code>dplyr</code> verb
<code>mutate()</code>).</p></li>
<li><p>Second, let’s pass this text through our <code>ggplot</code> call
so it gets packaged up with everything else being passed to
<code>ggplotly()</code>.</p></li>
<li><p>Lastly, let’s use <code>style()</code> to make the contents of
our tooltips <em>only</em> the custom text we’ve cooked up:</p></li>
</ol>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the previous plotly-related code in your global.R file!</span></span>
<span></span>
<span> <span class="co">##... other global code...</span></span>
<span><span class="co">###FILTERED DATA SET FOR MAP</span></span>
<span><span class="va">gap2007</span> <span class="op">=</span> <span class="va">gap</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>tooltip_text <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span> <span class="co">#&lt;--HERE, WE GENERATE A NEW COLUMN CALLED tooltip_text USING paste0() THAT CONTAINS THE GDP AND POPULATION DATA IN A MORE READABLE FORMAT. </span></span>
<span>    <span class="st">"GDP: "</span>,</span>
<span>    <span class="fu">round</span><span class="op">(</span><span class="va">gdpPercap</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="st">"&lt;br&gt;"</span>,</span>
<span>    <span class="st">"Population: "</span>,</span>
<span>    <span class="fu">round</span><span class="op">(</span><span class="va">pop</span>, <span class="op">-</span><span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">###BASE GGPLOT FOR CONVERSION TO PLOTLY</span></span>
<span><span class="va">p1</span> <span class="op">=</span> <span class="fu">ggplot</span><span class="op">(</span></span>
<span>  <span class="va">gap2007</span>,</span>
<span>  <span class="fu">aes</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu">log</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="va">gdpPercap</span>,</span>
<span>    color <span class="op">=</span> <span class="va">continent</span>,</span>
<span>    group <span class="op">=</span> <span class="va">continent</span>,</span>
<span>    text <span class="op">=</span> <span class="va">tooltip_text</span> <span class="co">#&lt;--HERE, WE PASS OUR CUSTOM TOOLTIP TEXT IN AS AN AESTHETIC. EVEN THOUGH OUR GGPLOT NEVER USES THIS INFO, IT'LL BE PASSED ALONG TO OUR PLOTLY GRAPH BY ggplotly(). </span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      size <span class="op">=</span> <span class="fl">16</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"bold"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,</span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.line <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span><span class="st">"GDP per capita\n"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span><span class="st">"\nPopulation size (log)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_discrete</span><span class="op">(</span><span class="st">"Continent\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">###PLOTLY CONVERSION</span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu">ggplotly</span><span class="op">(</span><span class="va">p1</span>, </span>
<span>              tooltip <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--HERE, WE TELL GGPLOTLY() TO POPULATE TOOLTIPS WITH OUR CUSTOM TEXT AESTHETICS. </span></span>
<span>  <span class="fu">style</span><span class="op">(</span>hoverinfo <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span> <span class="co">#&lt;--HERE, WE USE style() TO ASK THAT TOOLTIPS CONTAIN ONLY THE CUSTOM TEXT PROVIDED--OTHERWISE, WE'LL GET OURS PLUS THE DEFAULT ONES!</span></span></code></pre>
</div>
<p>Now those tooltips are looking great!</p>
<p>Between <code>layout()</code>, <code>style()</code>, and
<code>config()</code>, you can adjust virtually any aspect of a
<code>plotly</code> graph to meet your desires, much as you can use
various <code>ggplot2</code> functions to customize your
<code>ggplot</code>s. It just may require some Googling and
experimentation to figure out <em>exactly</em> how to do it.</p>
</div>
</div>
<div class="section level3">
<h3 id="update-dont-remake-plotly-edition">Update, don’t remake, <code>plotly</code> edition!<a class="anchor" aria-label="anchor" href="#update-dont-remake-plotly-edition"></a>
</h3>
<p>Once again, it’s time to see how to update a <code>plotly</code>
graph “on the fly” in response to user actions without re-rendering the
whole thing!</p>
<p>That means first giving users a means of affecting the graph beyond
what the graph itself already provides. Let’s create a drop-down
selector that lets users pick a new color scheme:</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="do">##This code should **replace** the "sidebar panel" cell's content within the BODY section of your ui.R file!</span></span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a><span class="do">##... other UI code...</span></span>
<span id="cb38-4"><a href="#cb38-4" tabindex="-1"></a><span class="do">###SIDEBAR CELL</span></span>
<span id="cb38-5"><a href="#cb38-5" tabindex="-1"></a>    <span class="fu">column</span>(</span>
<span id="cb38-6"><a href="#cb38-6" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb38-7"><a href="#cb38-7" tabindex="-1"></a>      <span class="fu">selectInput</span>(</span>
<span id="cb38-8"><a href="#cb38-8" tabindex="-1"></a>        <span class="at">inputId =</span> <span class="st">"sorted_column"</span>,</span>
<span id="cb38-9"><a href="#cb38-9" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"Select a column to sort the table by."</span>,</span>
<span id="cb38-10"><a href="#cb38-10" tabindex="-1"></a>        <span class="at">choices =</span> <span class="fu">c</span>(</span>
<span id="cb38-11"><a href="#cb38-11" tabindex="-1"></a>          <span class="st">"Country"</span> <span class="ot">=</span> <span class="st">"country"</span>,</span>
<span id="cb38-12"><a href="#cb38-12" tabindex="-1"></a>          <span class="st">"Continent"</span> <span class="ot">=</span> <span class="st">"continent"</span>,</span>
<span id="cb38-13"><a href="#cb38-13" tabindex="-1"></a>          <span class="st">"Year"</span> <span class="ot">=</span> <span class="st">"year"</span>,</span>
<span id="cb38-14"><a href="#cb38-14" tabindex="-1"></a>          <span class="st">"Life expectancy"</span> <span class="ot">=</span> <span class="st">"lifeExp"</span>,</span>
<span id="cb38-15"><a href="#cb38-15" tabindex="-1"></a>          <span class="st">"Population size"</span> <span class="ot">=</span> <span class="st">"pop"</span>,</span>
<span id="cb38-16"><a href="#cb38-16" tabindex="-1"></a>          <span class="st">"GDP per capita"</span> <span class="ot">=</span> <span class="st">"gdpPercap"</span></span>
<span id="cb38-17"><a href="#cb38-17" tabindex="-1"></a>        )</span>
<span id="cb38-18"><a href="#cb38-18" tabindex="-1"></a>      ),</span>
<span id="cb38-19"><a href="#cb38-19" tabindex="-1"></a>      <span class="fu">actionButton</span>(<span class="at">inputId =</span> <span class="st">"go_button"</span>, <span class="at">label =</span> <span class="st">"Go!"</span>),</span>
<span id="cb38-20"><a href="#cb38-20" tabindex="-1"></a>    <span class="co"># actionButton(inputId = "reset_button",</span></span>
<span id="cb38-21"><a href="#cb38-21" tabindex="-1"></a>      <span class="co">#                   label = "Reset!"),</span></span>
<span id="cb38-22"><a href="#cb38-22" tabindex="-1"></a>      <span class="fu">sliderInput</span>(</span>
<span id="cb38-23"><a href="#cb38-23" tabindex="-1"></a>        <span class="at">inputId =</span> <span class="st">"year_slider"</span>,</span>
<span id="cb38-24"><a href="#cb38-24" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"Pick what year's data are shown in the map."</span>,</span>
<span id="cb38-25"><a href="#cb38-25" tabindex="-1"></a>        <span class="at">value =</span> <span class="dv">2007</span>,</span>
<span id="cb38-26"><a href="#cb38-26" tabindex="-1"></a>        <span class="at">min =</span> <span class="fu">min</span>(gap<span class="sc">$</span>year),</span>
<span id="cb38-27"><a href="#cb38-27" tabindex="-1"></a>        <span class="at">max =</span> <span class="fu">max</span>(gap<span class="sc">$</span>year),</span>
<span id="cb38-28"><a href="#cb38-28" tabindex="-1"></a>        <span class="at">step =</span> <span class="dv">5</span>,</span>
<span id="cb38-29"><a href="#cb38-29" tabindex="-1"></a>        <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb38-30"><a href="#cb38-30" tabindex="-1"></a>      ),</span>
<span id="cb38-31"><a href="#cb38-31" tabindex="-1"></a>      <span class="fu">selectInput</span>(  <span class="co">#&lt;--ADD IN A COLOR SCHEME SELECTOR</span></span>
<span id="cb38-32"><a href="#cb38-32" tabindex="-1"></a>        <span class="at">inputId =</span> <span class="st">"color_scheme"</span>,</span>
<span id="cb38-33"><a href="#cb38-33" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"Pick a color scheme for the graph."</span>,</span>
<span id="cb38-34"><a href="#cb38-34" tabindex="-1"></a>        <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"viridis"</span>, <span class="st">"plasma"</span>, <span class="st">"magma"</span>)</span>
<span id="cb38-35"><a href="#cb38-35" tabindex="-1"></a>      )</span>
<span id="cb38-36"><a href="#cb38-36" tabindex="-1"></a>    ),</span>
<span id="cb38-37"><a href="#cb38-37" tabindex="-1"></a><span class="do">##... other UI code...</span></span></code></pre>
</div>
<p>In <code>plotly</code>, the color scheme is generally specified
inside the <code>plot_ly()</code> call (the equivalent of
<code>ggplot()</code>) or inside an <code>add_*()</code> function call
(the equivalents of <code>geom</code>s in <code>ggplot2</code>).
However, one can be specified or modified using <code>style()</code>
too.</p>
<p>To update rather than remake our graph, we’ll use the
<code>plotly</code> functions <code>plotlyProxy()</code> and
<code>plotlyProxyInvoke()</code>, which are a like
<code>dataTableProxy()</code> and its helper functions like
<code>replaceData()</code> in that they are a “package deal;” both are
needed to accomplish the task. Specifically, we’ll use the
<code>"restyle"</code> method inside <code>plotProxyInvoke()</code> to
trigger a re-styling of the graph.</p>
<p>As in previous examples, we’ll also need to separate the
<code>renderPlotly({})</code> call that makes our original, default
graph from a new observer that watches <code>input$color_scheme</code>
and triggers restyling using <code>plotlyProxy()</code>. Let’s see all
these pieces in action:</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** all your plotly-related code to date in your server.R file!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">##ALL OUR renderPlotly({}) call will now do is make a "base" version of the graph.</span></span>
<span><span class="co">###GRAPH</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_graph</span> <span class="op">=</span> <span class="fu">renderPlotly</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">p2</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">layout</span><span class="op">(</span></span>
<span>        xaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        yaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        legend <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>          itemclick <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          y <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>          yanchor <span class="op">=</span> <span class="st">"middle"</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">config</span><span class="op">(</span>modeBarButtonsToRemove <span class="op">=</span> <span class="fu">list</span><span class="op">(</span><span class="st">"lasso2d"</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">###GRAPH OBSERVER (COLOR SCHEME SELECTOR)</span></span>
<span><span class="co">#A NEW OBSERVER WILL WATCH FOR CHANGES TO OUR INPUT WIDGET.</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">color_scheme</span>, <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co">#WE "BORROW" LEAFLET'S colorFactor() TO DESIGN AN APPROPRIATE COLOR SCHEME GIVEN THE USER'S SELECTION.</span></span>
<span>    <span class="va">new_pal</span> <span class="op">=</span> <span class="fu">colorFactor</span><span class="op">(</span>palette <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">color_scheme</span>,</span>
<span>                          domain <span class="op">=</span> <span class="va">gap2007</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">plotlyProxy</span><span class="op">(</span><span class="st">"basic_graph"</span>, <span class="va">session</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--plotlyProxy() JUST NEEDS WHICH GRAPH (OF POTENTIALLY MANY) TO UPDATE.</span></span>
<span>      <span class="fu">plotlyProxyInvoke</span><span class="op">(</span><span class="st">"restyle"</span>, <span class="fu">list</span><span class="op">(</span>marker <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>        color <span class="op">=</span> <span class="fu">new_pal</span><span class="op">(</span><span class="va">gap2007</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">11.3</span></span>
<span>      <span class="op">)</span><span class="op">)</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="co">#&lt;--INPUTS TO plotProxyInvoke() INCLUDE A METHOD (HERE, "RESTYLE"), A LIST OF LISTS (WHAT STUFF TO CHANGING AND HOW), AND A LIST OF TRACES BEING CHANGED (HERE, ALL FIVE WE HAD BEFORE).</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>The first input to <code>plotlyProxyInvoke()</code> is a method name.
Here, we’re using <code>"restyle"</code> to adjust things the
<code>style()</code> function would regulate, such as the graph’s color
scheme. There’s also a <code>"relayout"</code> method for adjusting
things that <code>layout()</code> controls, such as the legend.</p>
<p>The second input is a list of lists—this is another place where we’re
<em>very nearly</em> writing JavaScript code, because if there’s one
thing JS loves, it’s lists! Each aspect we want to restyle gets named
(here, <code>marker</code>s are the only thing we want to restyle.</p>
<p>Then, we give each named aspect a list of inputs—what features do we
want to change about that aspect of the graph? Here, we’re changing the
<code>color</code>s, setting them equal to the new colors we’ve
generated using <code>colorFactor()</code> from
<code>leaflet</code>.</p>
<p>However, we also specify <code>size</code>s for these points. Why?
Because, if <code>plotlyProxy()</code> redraws our graph’s markers, it
will do so “from scratch,” using defaults for any properties we don’t
specify. Since our original graph featured custom-sized points, we need
to “override the default” size to arrive at the same size of points as
though we have before the restyle.</p>
<p>The last input to <code>plotlyProxyInvoke()</code> is a list of
<strong>trace numbers</strong>. A <code>plotly</code>
<strong>trace</strong> is one “set” of data being graphed. In our case,
we have five traces, one for each continent, and we’re modifying all
five, so you’d think we’d put <code>1:5</code> here.</p>
<p>However, JS starts counting all things at 0, not 1 (it’s a
“zero-indexed language,” whereas R is a “one-indexed language”), so we
specify <code>0:4</code> for this last input instead.</p>
<p>You’ll notice that, with this new proxy in place, our points change
colors as we adjust our new selector. However, our lines don’t, and our
legend keys also change to the wrong colors. These are fixable problems,
but not without <em>some</em> grief in our case—the TL:DR version is
that the graph conversion performed by <code>ggplotly()</code> comes
with baggage we’re running up against here. If we want to go further
down this route, we’d be better off rebuilding our graph in
<code>plotly</code>.</p>
</div>
<div class="section level3">
<h3 id="point-and-click">
<strong>Point and click</strong><a class="anchor" aria-label="anchor" href="#point-and-click"></a>
</h3>
<p>As with all other widgets we’ve seen, user interactions with
<code>plotly</code> graphs can constitute events we can handle
server-side.</p>
<p>However, <code>plotly</code> is unusual in that info about these
events is <em>not</em> being passed automatically and constantly from
the UI to the server via <code>input</code>. Instead,
<code>plotly</code> has an alternative passing system that uses the
functions <code>event_register()</code> to specify which events to track
and <code>event_data()</code> to pass the relevant event data from the
UI to the server. This <em>sounds</em> a more complicated than what
we’re used to, but it’s really the same idea, just with more parts:</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the "main panel" cell's content within the BODY section of your ui.R file!</span></span>
<span></span>
<span><span class="co">##... other UI code...</span></span>
<span><span class="co">###MAIN PANEL CELL</span></span>
<span>    <span class="fu">column</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">8</span>, <span class="fu">tabsetPanel</span><span class="op">(</span></span>
<span>      <span class="co">###TABLE TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Table"</span>, <span class="fu">dataTableOutput</span><span class="op">(</span><span class="st">"basic_table"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="co">###MAP TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map"</span>, <span class="fu">leafletOutput</span><span class="op">(</span><span class="st">"basic_map"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="co">###GRAPH TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Graph"</span>,</span>
<span>        <span class="fu">plotlyOutput</span><span class="op">(</span><span class="st">"basic_graph"</span><span class="op">)</span>,</span>
<span>        <span class="fu">textOutput</span><span class="op">(</span><span class="st">"point_clicked"</span><span class="op">)</span> <span class="co">#&lt;--ADD AN OUTPUT REPORTING DATA ON WHAT'S BEEN CLICKED.</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##... other UI code...</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the ggplotly() call within your global.R file!</span></span>
<span></span>
<span><span class="co">##... other global code...</span></span>
<span><span class="co">###PLOTLY CONVERSION</span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu">ggplotly</span><span class="op">(</span><span class="va">p1</span>, tooltip <span class="op">=</span> <span class="st">"text"</span>, </span>
<span>              source <span class="op">=</span> <span class="st">"our_graph"</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co">#&lt;--PLOTLY EVENT TRACKING USES A SPECIAL ATTRIBUTE CALLED "SOURCE."</span></span>
<span>  <span class="fu">event_register</span><span class="op">(</span><span class="st">"plotly_click"</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co">##&lt;--WATCH THIS GRAPH FOR USER CLICKS, SPECIFICALLY.</span></span>
<span>  <span class="fu">style</span><span class="op">(</span>hoverinfo <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **added to** the bottom of your server.R file, within the server function!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">#WE USE EVENT_DATA() LIKE input HERE, SPECIFYING WHICH GRAPH AND EVENT TO WATCH FOR.</span></span>
<span><span class="fu">observeEvent</span><span class="op">(</span><span class="fu">event_data</span><span class="op">(</span>event <span class="op">=</span> <span class="st">"plotly_click"</span>, source <span class="op">=</span> <span class="st">"our_graph"</span><span class="op">)</span>, <span class="op">{</span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">point_clicked</span> <span class="op">=</span> <span class="fu">renderText</span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="fu">paste0</span><span class="op">(</span></span>
<span>        <span class="st">"The exact GDP per capita value for this point is: "</span>,</span>
<span>        <span class="fu">event_data</span><span class="op">(</span>event <span class="op">=</span> <span class="st">"plotly_click"</span>, source <span class="op">=</span> <span class="st">"our_graph"</span><span class="op">)</span><span class="op">$</span><span class="va">y</span> <span class="co">#&lt;--WE ACCESS THE EXACT Y VALUE OF THE POINT CLICKED LIKE THIS.</span></span>
<span>      <span class="op">)</span></span>
<span>      </span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>In this setup, we are creating something equivalent to
<code>input</code>—but the values being passed by this new thing are
related only to our graph and only to specific events we’ve
designated.</p>
<p>We’ve also had to give our graph a new “nickname” for use in just
this system: a <code>source</code> attribute, which we set to
<code>our_graph</code>. This really is not much different from how we
specify and use <code>inputId</code>s as nicknames when interfacing with
<code>input</code>, except that <code>source</code> values don’t double
as CSS <code>id</code>s.</p>
<p>We also had to specify what type of event we want to watch:
<code>plotly_clicks</code>. For whatever reason, <code>plotly</code>
graphs don’t watch for all possible events, just those we specify.</p>
<p>Lastly, we watch our <code>event_data()</code> call, just like we
would watch <code>input$widget_name</code>, with our new observer.
Whenever an event triggers, we use <code>renderText({})</code> and
<code>textOutput()</code> to print into the UI some specific information
about the point clicked. This is not a very exciting use of this
functionality, but it hopefully shows what’s possible.</p>
<p>So, ultimately, this system of event watching and handling is not
<em>much</em> harder the one used elsewhere in R Shiny apps involving
<code>input</code>; it’s more difficult only in that it’s different.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>The <code>DT</code>, <code>leaflet</code>, and <code>plotly</code>
packages can be used to produce web-ready, interactive tables, maps, and
graphs, respectively, for incorporation into Shiny apps.</li>
<li>Each of the graphics created by these packages come with tons of
interactive functionality out of the box. Because some of this
functionality might be confusing or unnecessary for all users, it’s
valuable to know you can adjust or disable any or all of these
features.</li>
<li>Any aesthetic component of these graphics can be adjusted or
customized, but the specifics of how to do this (and how easy or
intuitive it will be) will vary quite widely between packages and
aesthetics.</li>
<li>We should strive to update graphics, changing only the aspects that
need changing, rather than remaking graphics from scratch wherever
possible. This often means handling events using observers and proxies
rather than using <code>render*({})</code> functions.</li>
<li>Like with other widgets, user interactions with these graphics can
be tracked by the UI and passed to the server for handling. This passing
happens with the <code>input</code> object for <code>DT</code> and
<code>leaflet</code>, but an equivalent system must be used for
<code>plotly</code>.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/carpentries/r_shiny_workshop/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/carpentries/r_shiny_workshop/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/carpentries/r_shiny_workshop/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries/r_shiny_workshop/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.5" class="external-link">sandpaper (0.16.5)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.6" class="external-link">pegboard (0.7.6)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.3" class="external-link">varnish (1.0.3)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries.github.io/r_shiny_workshop/instructor/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, r, The Carpentries",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://carpentries.github.io/r_shiny_workshop/instructor/aio.html",
  "identifier": "https://carpentries.github.io/r_shiny_workshop/instructor/aio.html",
  "dateCreated": "2024-07-10",
  "dateModified": "2024-07-15",
  "datePublished": "2024-07-15"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

