<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>R Shiny: Shiny Showstoppers: DTs and Leaflets and Plotlys, Oh My!</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/shiny_4.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      R Shiny
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            R Shiny
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  R Shiny
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 63%" class="percentage">
    63%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 63%" aria-valuenow="63" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/shiny_4.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="shiny_1.html">1. Welcome to the Web! Web Development with Shiny 101</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="shiny_2.html">2. Building the Ground Floor of a Shiny App</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="shiny_3.html">3. R Shiny's Core Concepts: Rendering and Outputting, Input Widgets, and Reactivity</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        4. Shiny Showstoppers: DTs and Leaflets and Plotlys, Oh My!
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#turning-the-tables">Turning the tables</a></li>
<li><a href="#update-dont-remake-dt-edition">Update, don’t remake, <em>DT</em> edition!</a></li>
<li><a href="#putting-us-on-the-map">Putting us on the map</a></li>
<li><a href="#getting-graphic">Getting graphic</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="shiny_3.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="index.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="shiny_3.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: R Shiny's Core
        </a>
        <a class="chapter-link float-end" href="index.html" rel="next">
          Home
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Shiny Showstoppers: DTs and Leaflets and Plotlys, Oh My!</h1>
        <p>Last updated on 2024-10-10 |

        <a href="https://github.com/umn-dash/r-shiny/edit/main/episodes/shiny_4.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How do I add an interactive map/table/graph to my app?</li>
<li>What features do these widgets have?</li>
<li>How do I adjust their appearance?</li>
<li>How can I modify these widgets to handle events without simply
rebuilding them each time?</li>
<li>What events related to these widgets can I watch for?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Name the essential functions of the <code>DT</code>,
<code>leaflet</code> and <code>plotly</code> packages.</li>
<li>Experiment with the standard interactive features of the
plots/tables/maps produced by these packages, and recognize how to
disable them.</li>
<li>Customize the look and feel of these graphics.</li>
<li>Update complex interactive graphics instead of remaking them using
<strong>proxies</strong>.</li>
<li>Recognize some events a user might trigger on these complex
interactive graphics and how to watch for them.</li>
</ul></div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="disclaimer">Disclaimer<a class="anchor" aria-label="anchor" href="#disclaimer"></a></h3>
<p><em>At a few point, this lesson’s code may produce
<strong>warnings</strong> when executed. Ignore these—the code works as
intended!</em></p>
</div>
<div class="section level3">
<h3 id="catching-up">Catching up<a class="anchor" aria-label="anchor" href="#catching-up"></a></h3>
<p>In case you need it, here is the complete <code>ui.R</code>,
<code>global.R</code>, and <code>server.R</code> code up to this
point:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#ui.r</span></span>
<span><span class="va">ui</span> <span class="op">=</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span></span>
<span>  <span class="va">tags</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span></span>
<span>    <span class="va">tags</span><span class="op">$</span><span class="fu">link</span><span class="op">(</span>href <span class="op">=</span> <span class="st">"styles.css"</span>,</span>
<span>              rel <span class="op">=</span> <span class="st">"stylesheet"</span><span class="op">)</span>,</span>
<span>    <span class="va">tags</span><span class="op">$</span><span class="fu">title</span><span class="op">(</span><span class="st">"Check this out!"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span></span>
<span>  <span class="fu">h1</span><span class="op">(</span><span class="st">"Our amazing Shiny app!"</span>,</span>
<span>     id <span class="op">=</span> <span class="st">"header"</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="fu">fluidRow</span><span class="op">(</span></span>
<span>    <span class="fu">column</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">4</span>,</span>
<span>           <span class="fu">selectInput</span><span class="op">(</span></span>
<span>             inputId <span class="op">=</span> <span class="st">"sorted_column"</span>,</span>
<span>             label <span class="op">=</span> <span class="st">"Select a column to sort the table by."</span>,</span>
<span>             choices <span class="op">=</span> <span class="fu">names</span><span class="op">(</span><span class="va">gap</span><span class="op">)</span></span>
<span>           <span class="op">)</span>,</span>
<span>           <span class="fu">actionButton</span><span class="op">(</span></span>
<span>             inputId <span class="op">=</span> <span class="st">"go_button"</span>,</span>
<span>             label <span class="op">=</span> <span class="st">"Go!"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">column</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">8</span>, <span class="fu">tabsetPanel</span><span class="op">(</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Table"</span>, <span class="fu">tableOutput</span><span class="op">(</span><span class="st">"table1"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map"</span><span class="op">)</span>,</span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Graph"</span><span class="op">)</span> </span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span></span>
<span>  <span class="va">tags</span><span class="op">$</span><span class="fu">footer</span><span class="op">(</span><span class="st">"This is my app"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#global.R</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">shiny</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">plotly</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">DT</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">leaflet</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">sf</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gap</span> <span class="op">=</span> <span class="fu">as.data.frame</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#server.R</span></span>
<span><span class="va">server</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co">#INITIAL TABLE</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">table1</span> <span class="op">=</span> <span class="fu">renderTable</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">gap</span> </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">#UPDATE UPON BUTTON PRESS USING PROXY</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">go_button</span>,</span>
<span>               ignoreInit <span class="op">=</span> <span class="cn">FALSE</span>, <span class="op">{</span></span>
<span></span>
<span>      <span class="va">output</span><span class="op">$</span><span class="va">table1</span> <span class="op">=</span> <span class="fu">renderTable</span><span class="op">(</span><span class="op">{</span></span>
<span>      </span>
<span>        <span class="va">gap</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span> </span>
<span>    </span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a></h3>
<p>While <strong>input widgets</strong> like drop-down menus and buttons
are powerful ways to give users control of your app and enable many
powerful forms of interactive engagement, they aren’t always
transformative <em>by themselves</em>. There are <em>much</em> more
powerful widgets!</p>
<p>And, since our app’s server is powered by R—a programming language
<em>built for</em> data work—it make senses we’d be able to include
widgets that put <em>data</em> at our users’ fingertips in cool ways. Of
all the data-centered widgets, few are more familiar and enlightening
than <strong>tables</strong>, <strong>maps</strong>, and
<strong>graphs</strong>. Because these graphics are <em>so</em>
ubiquitous, it probably won’t surprise you that there are JavaScript
packages for creating web-enabled, interactive versions of these graphic
types.</p>
<p>While there are others, in this lesson we’ll use the <code>DT</code>
(tables), <code>leaflet</code> (maps), and <code>plotly</code> (graphs)
packages to produce these graphics; each has been ported into R + R
Shiny via packages of the same names. Each package could <em>easily</em>
be a course unto itself! As such, we’ll look <em>only</em> at the basic
idea that cut across them all—greater depth can be found elsewhere.</p>
<p>Learning <code>leaflet</code> and <code>plotly</code>, specifically,
come with challenges we’ll have to negotiate:</p>
<ul><li><p><code>leaflet</code> builds maps, which represent <strong>spatial
data</strong>. These, and the packages that work with them
(<em>e.g.</em>, <code>sf</code>), are <em>complicated</em>! I’ll gloss
over the details, but we’ll need to occasionally borrow tools from
<code>sf</code> to accomplish anything.</p></li>
<li><p>If you’re familiar with <code>ggplot2</code> (or a comparable
data visualization suite), you already know that learning programmatic
graph-making can have a steep learning curve. <code>plotly</code> has
the same curve (perhaps a steeper one for R users, since it’s
<em>very</em> JavaScript-like). Again, I’ll gloss over the details, but
even the basics may be a lift.</p></li>
</ul><p>Let’s start simple, then, with <code>DT</code>, which will feature
constructs most like those we’re already familiar with. Let’s swap out
our functional but drab table for a better, <code>DT</code> table. Along
the way, we can learn all the key concepts we’ll need to tackle
<code>leaflet</code> and <code>plotly</code> too.</p>
</div>
<section><h2 class="section-heading" id="turning-the-tables">Turning the tables<a class="anchor" aria-label="anchor" href="#turning-the-tables"></a></h2>
<hr class="half-width"><div class="section level3">
<h3 id="basic-table">Basic table<a class="anchor" aria-label="anchor" href="#basic-table"></a></h3>
<p>All we must do to swap out our old table for a new one (besides
loading <code>DT</code> by executing <code><a href="https://github.com/rstudio/DT" class="external-link">library(DT)</a></code>, if you
haven’t done so!) is to change our <code>renderTable({})</code> and
<code>tableOutput()</code> calls to <code>renderDT({})</code> and
<code>dataTableOutput()</code> calls:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** ALL table-related code contained within your server.R file!</span></span>
<span></span>
<span><span class="co">#INITIAL TABLE</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">table1</span> <span class="op">=</span> <span class="fu">renderDT</span><span class="op">(</span><span class="op">{</span> <span class="co">#&lt;--CHANGE FUNCTION</span></span>
<span>    <span class="va">gap</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">#UPDATE UPON BUTTON PRESS</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="op">{</span><span class="va">input</span><span class="op">$</span><span class="va">go_button</span><span class="op">}</span>,</span>
<span>               ignoreInit <span class="op">=</span> <span class="cn">FALSE</span>, <span class="op">{</span></span>
<span></span>
<span>   <span class="va">output</span><span class="op">$</span><span class="va">table1</span> <span class="op">=</span> <span class="fu">renderDT</span><span class="op">(</span><span class="op">{</span> <span class="co">#&lt;--CHANGE FUNCTION</span></span>
<span>      <span class="va">gap</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>   <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the content of the "main panel" cell within the BODY section of your ui.R file!</span></span>
<span></span>
<span><span class="co">##... other UI code...</span></span>
<span></span>
<span><span class="co">###MAIN PANEL CELL</span></span>
<span>    <span class="fu">column</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">8</span>, <span class="fu">tabsetPanel</span><span class="op">(</span></span>
<span>      <span class="co">###TABLE TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Table"</span>, </span>
<span>        <span class="fu">dataTableOutput</span><span class="op">(</span>outputId <span class="op">=</span> <span class="st">"table1"</span><span class="op">)</span><span class="op">)</span>, <span class="co">#&lt;--CHANGE FUNCTION</span></span>
<span>      <span class="co">###MAP TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map"</span><span class="op">)</span>,</span>
<span>      <span class="co">###GRAPH TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Graph"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>   <span class="op">)</span></span>
<span></span>
<span><span class="co">##... other UI code...</span></span></code></pre>
</div>
<p>Once you’ve made the changes represented above, restart your app.
When you do, you’ll notice our new table looks <em>very</em>
different:</p>
<figure><img src="fig/DT%20table%20features.png" alt="DT tables come with several interactive features, including pagination, searching, row selection, and column sorting (indicated by red arrows)." class="figure mx-auto d-block"><div class="figcaption">
<em>DT</em> tables come with several interactive
features, including pagination, searching, row selection, and column
sorting (indicated by red arrows).</div>
</figure><ul><li><p>Our table is now <strong>paginated</strong>, <em>i.e.</em>,
<em>divided into pages</em>. Users can flip between pages using numbered
buttons as well as “Next” and “Previous” buttons in the bottom-right.
Users can also change page length in the upper-left. These features
limit how much data is shown at once when a data set has many rows, and
they also keep the table a more consistent height in your UI.</p></li>
<li><p>It’s <strong>searchable</strong>—users can type
<strong>strings</strong> (chunks of letters/numbers/symbols) into the
search box in the upper-right; the table will filter to only rows
containing that string anywhere.</p></li>
<li><p>It’s <strong>sortable</strong>—users can click the up/down arrows
next to each column’s name to sort the table by that column. [You’ll
note this functionality makes our drop-down menu widget
redundant!]</p></li>
<li><p>It’s (modestly) styled—it’s visually more appealing than our
previous table because it comes with <em>some</em> automatic CSS (bold
column names and “zebra striping,” <em>e.g.</em>).<br><br>
[Side-note: Web developers call elements with pre-set CSS rules
<strong>opinionated</strong>. Opinionated elements are nice in that they
require less styling, but if you <em>do</em> choose to restyle them, it
can be hard to overcome their “opinions.”]</p></li>
<li><p>It’s <strong>selectable</strong>—users can click to highlight
rows. This <strong>event</strong> doesn’t actually do anything by
default besides change the table’s appearance, but it could be
<strong>handled</strong> in some clever way.</p></li>
</ul><p>Now that we have a <code>DT</code> table (or any complex interactive
graphic), there are four things we’ll <em>very</em> commonly want to do
to it:</p>
<ol style="list-style-type: decimal"><li><p>Simplify its functionality.</p></li>
<li><p>Customize its style.</p></li>
<li><p>Watch for relevant <strong>events</strong>.</p></li>
<li><p>Update it to <strong>handle</strong> those events.</p></li>
</ol><p>Let’s tackle the first two items first.</p>
</div>
<div class="section level3">
<h3 id="more-or-less-basic-dt">More (or less) basic DT<a class="anchor" aria-label="anchor" href="#more-or-less-basic-dt"></a></h3>
<p>As we saw, <code>DT</code> tables come with many interactive
features! However, “more” is not always “better” from a
<strong>UX</strong> (<strong>user experience</strong>) standpoint. Some
users might find certain features confusing, especially if they aren’t
necessary, are poorly explained, or don’t result in obvious reactions.
Others may find having a lot of features overwhelming, even if they do
understand them all.</p>
<p>The <code>datatable()</code> function’s <code>options</code>
parameter allows us to reduce the features our table:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** ALL table-related code contained within your server.R file!</span></span>
<span></span>
<span><span class="co">#INITIAL TABLE</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">table1</span> <span class="op">=</span> <span class="fu">renderDT</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">gap</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">datatable</span><span class="op">(</span></span>
<span>        selection <span class="op">=</span> <span class="st">"none"</span>, <span class="co">#&lt;--TURNS OFF ROW SELECTION</span></span>
<span>        options <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>          info <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#&lt;--NO BOTTOM-LEFT INFO</span></span>
<span>          ordering <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#&lt;--NO SORTING</span></span>
<span>          searching <span class="op">=</span> <span class="cn">FALSE</span> <span class="co">#&lt;--NO SEARCH BAR</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#UPDATE UPON BUTTON PRESS</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">go_button</span>, <span class="op">{</span> </span>
<span>    </span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">table1</span> <span class="op">=</span> <span class="fu">renderDT</span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="va">gap</span> <span class="op">%&gt;%</span> </span>
<span>        <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>        <span class="co">#SAME AS ABOVE</span></span>
<span>        <span class="fu">datatable</span><span class="op">(</span></span>
<span>          selection <span class="op">=</span> <span class="st">"none"</span>, </span>
<span>          options <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>            info <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>            ordering <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            searching <span class="op">=</span> <span class="cn">FALSE</span> </span>
<span>          <span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>That’s better! Potentially, this version is more digestible and
intuitive for our users (and could be easier for us to explain and
handle too!):</p>
<figure><img src="fig/disabled%20DT.png" alt="Notice that, in this DT, there are no sorting arrows, and there is no search bar or current page info in the bottom-left. Row selection is also disabled." class="figure mx-auto d-block"><div class="figcaption">Notice that, in this DT, there are no sorting
arrows, and there is no search bar or current page info in the
bottom-left. Row selection is also disabled.</div>
</figure><p>More broadly, <em>if a <code>DT</code> table (or any other complex
interactive graphic) has a feature, you should assume you can turn it
off (you may simply have to Google for the way to do it).</em></p>
<p>Next, let’s tinker with our table’s aesthetics. Let’s make three
changes that demonstrate what’s possible:</p>
<ol style="list-style-type: decimal"><li><p>Let’s round the <code>gdpPercap</code> column.</p></li>
<li><p>Let’s make the <code>continent</code> column
center-aligned.</p></li>
<li><p>Let’s highlight all rows with <code>lifeExp</code> values &gt;
<code>70</code> in pink.</p></li>
</ol><p>We’ll use functions from the <code>format*()</code> and
<code>style*()</code> families—specifically, <code>formatRound()</code>,
<code>formatStyle()</code>, and <code>styleEqual()</code>:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** ALL table-related code contained within your server.R file!</span></span>
<span></span>
<span><span class="co">#INITIAL TABLE</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">table1</span> <span class="op">=</span> <span class="fu">renderDT</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">gap</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">datatable</span><span class="op">(</span></span>
<span>        selection <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>        options <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>          info <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          ordering <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          searching <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="co">#IN THE SECOND ARGUMENTS OF THESE FUNCTIONS, WE WRITE 'R-LIKE' CSS. WE USE camelCase FOR PROPERTIES, QUOTED STRINGS FOR VALUES, AND = INSTEAD OF : AND ;.</span></span>
<span>      <span class="fu">formatRound</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"gdpPercap"</span>, </span>
<span>                  digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">formatStyle</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"continent"</span>, </span>
<span>                  textAlign <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--COMPARE WITH text-align: center; FORMAT</span></span>
<span>      <span class="fu">formatStyle</span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="st">"lifeExp"</span>, <span class="co">#&lt;--wHAT COLUMN WILL WE CONDITIONALLY FORMAT BY?</span></span>
<span>        target <span class="op">=</span> <span class="st">"row"</span>, <span class="co">#&lt;--WILL WE STYLE THE WHOLE ROWS OR JUST INDIVIDUAL CELLS?</span></span>
<span>        backgroundColor <span class="op">=</span> <span class="fu">styleEqual</span><span class="op">(</span></span>
<span>          levels <span class="op">=</span> <span class="va">gap</span><span class="op">$</span><span class="va">lifeExp</span>, </span>
<span>          values <span class="op">=</span> <span class="fu">ifelse</span><span class="op">(</span><span class="va">gap</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="fl">70</span>, <span class="st">"lightpink"</span>, <span class="st">"white"</span><span class="op">)</span> <span class="co">#WHAT RULE WILL WE USE, AND WHAT NEW CSS VALUES WILL WE SET FOR EACH POSSIBILITY?</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">#UPDATE UPON BUTTON PRESS</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="op">{</span><span class="va">input</span><span class="op">$</span><span class="va">go_button</span><span class="op">}</span>,</span>
<span>               ignoreInit <span class="op">=</span> <span class="cn">FALSE</span>, <span class="op">{</span></span>
<span></span>
<span>                 <span class="va">output</span><span class="op">$</span><span class="va">table1</span> <span class="op">=</span> <span class="fu">renderDT</span><span class="op">(</span><span class="op">{</span></span>
<span>                   <span class="va">gap</span> <span class="op">%&gt;%</span></span>
<span>                     <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>                     <span class="fu">datatable</span><span class="op">(</span></span>
<span>                       selection <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>                       options <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>                         info <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                         ordering <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                         searching <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>                       <span class="op">)</span></span>
<span>                     <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="co">#SAME AS ABOVE</span></span>
<span>      <span class="fu">formatRound</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"gdpPercap"</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">formatStyle</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"continent"</span>, textAlign <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">formatStyle</span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="st">"lifeExp"</span>,</span>
<span>        target <span class="op">=</span> <span class="st">"row"</span>,</span>
<span>        backgroundColor <span class="op">=</span> <span class="fu">styleEqual</span><span class="op">(</span></span>
<span>          levels <span class="op">=</span> <span class="va">gap</span><span class="op">$</span><span class="va">lifeExp</span>, </span>
<span>          values <span class="op">=</span> <span class="fu">ifelse</span><span class="op">(</span><span class="va">gap</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="fl">70</span>, <span class="st">"lightpink"</span>, <span class="st">"white"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/SPIFFY%20dt.png" alt="Note that, now, our continent column values are center-aligned, our GDP data have been rounded, and any row with a life expectancy value greater than 70 is now in light pink, perhaps helping these rows stand out for our users." class="figure mx-auto d-block"><div class="figcaption">Note that, now, our continent column values are
center-aligned, our GDP data have been rounded, and any row with a life
expectancy value greater than 70 is now in light pink, perhaps helping
these rows stand out for our users.</div>
</figure><p><code>format*()</code> functions ask us to pick one or more columns
to restyle. Then, we provide <strong>property</strong> and
<strong>value</strong> pairings as inputs, just as we would in CSS, but
using “R-like” syntax, <em>e.g.</em>, <code>textAlign = center</code>
versus <code>text-align: center;</code>.</p>
<p>If we want to format columns, rows, or cells
<strong>conditionally</strong>, <em>i.e.</em>, formatting only
<em>some</em> rows according to a rule, we use the <code>style*()</code>
functions. In the example above, we used <code>styleEqual()</code> to
apply a light pink background to only rows with life expectancy values
greater than <code>70</code>. These rows might then stand out better to
users, enabling new workflows.</p>
</div>
</section><section><h2 class="section-heading" id="update-dont-remake-dt-edition">Update, don’t remake, <em>DT</em> edition!<a class="anchor" aria-label="anchor" href="#update-dont-remake-dt-edition"></a></h2>
<hr class="half-width"><p>So far, when user actions have spurred a change to our table
(<em>e.g.</em>, how it’s sorted), we’ve re-rendered the <em>entire</em>
table to <strong>handle</strong> those <strong>events</strong>.</p>
<p>This approach works, but it’s undesirable for (at least) four
reasons:</p>
<ol style="list-style-type: decimal"><li><p>With large data sets, it could be <em>slow</em>! Remember that,
as R code executes server-side, the app must remain unresponsive until
that execution finishes, so users will have to wait in the
meantime.</p></li>
<li>
<p>To the user, the table may “flicker” out and in again as it’s
remade (if the process is fast), which might look “glitch-y.”</p>
<ol style="list-style-type: decimal"><li>If the process is slow, however, the table will instead “gray out”
and the whole app will appear to “freeze” while the underlying code
executes.</li>
</ol></li>
<li><p>If the user has customized the table in any way (they’ve
navigated to a specific page, <em>e.g.</em>), those customizations are
lost (unless we store that information and re-apply it, which is
possible but tedious).</p></li>
<li><p>As we’ve seen, rebuilding the table often necessitates repeating
the same table-building code in multiple places—first when we build the
initial table and again when we <em>re-build</em> it. This “code bloat”
makes your code harder to manage and makes it more likely you will
introduce inconsistencies.</p></li>
</ol><p>If you think about it, if <em>all</em> we’re doing is changing the
<em>data</em> our table is displaying, there’s no need to remake the
<em>whole</em> table—why rebuild all rows, columns, and cells when we
just need to change their <em>contents</em>?</p>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p><em>Whenever possible,</em> <em>we should update a complex
interactive graphic rather than remake it.</em></p>
</div>
</div>
</div>
<p>To update complex interactive graphics “on the fly,” we can use a
construct called a <strong>proxy.</strong> A proxy is a connection that
our app’s server makes with the client’s UI with respect to a specific
element—it’s like a phone call between a specific reactive context and
the element the user is currently seeing.</p>
<p>Through the proxy, our server code can describe what
<em>specific</em> changes need to be made, and the user’s browser can
make <em>just</em> those changes without redrawing the table, requesting
all the data again, or disabling the user’s control over the app. Such a
“direct line of communication” enables cleaner and snappier adjustment
of complex elements than using a <code>render*({})</code> function.</p>
<p><code>DT</code>’s proxy function, <code>dataTableProxy()</code>,
takes as input the <code>outputId</code> of the table to update. We then
pipe that proxy into a helper function to specify which specific changes
we’re requesting. For example, we’ll use the helper function
<code>replaceData()</code> to targetedly swap out some (or all) of the
data contained with the table’s cells, leaving all else unchanged.</p>
<p>Up until now, we handled column re-sorting using
<code>renderDT({})</code>. Let’s switch to using
<code>dataTableProxy()</code> to handle these events instead:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** ALL table-related code contained within your server.R file!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">#INITIAL TABLE</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">table1</span> <span class="op">=</span> <span class="fu">renderDT</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">gap</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">datatable</span><span class="op">(</span></span>
<span>        selection <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>        options <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>          info <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          ordering <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          searching <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">formatRound</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"gdpPercap"</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">formatStyle</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"continent"</span>, textAlign <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">formatStyle</span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="st">"lifeExp"</span>,</span>
<span>        target <span class="op">=</span> <span class="st">"row"</span>,</span>
<span>        backgroundColor <span class="op">=</span> <span class="fu">styleEqual</span><span class="op">(</span></span>
<span>          levels <span class="op">=</span> <span class="va">gap</span><span class="op">$</span><span class="va">lifeExp</span>,</span>
<span>          values <span class="op">=</span> <span class="fu">ifelse</span><span class="op">(</span><span class="va">gap</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="fl">70</span>, <span class="st">"lightpink"</span>, <span class="st">"white"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">#UPDATE UPON BUTTON PRESS USING PROXY</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="op">{</span><span class="va">input</span><span class="op">$</span><span class="va">go_button</span><span class="op">}</span>,</span>
<span>               ignoreInit <span class="op">=</span> <span class="cn">FALSE</span>, <span class="op">{</span></span>
<span>      </span>
<span>  <span class="co">#MAKE THE NEW, SORTED VERSION OF OUR DATA SET.           </span></span>
<span>  <span class="va">sorted_gap</span> <span class="op">=</span> <span class="va">gap</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#THEN, USE OUR PROXY TO SWAP OUT THE DATA.</span></span>
<span>  <span class="fu">dataTableProxy</span><span class="op">(</span>outputId <span class="op">=</span> <span class="st">"table1"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">replaceData</span><span class="op">(</span>data <span class="op">=</span> <span class="va">sorted_gap</span>, </span>
<span>                resetPaging <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co">#&lt;--OPTIONAL, BUT NICE.</span></span>
<span>  <span class="co">#NO OTHER CODE IS NEEDED--EVERYTHING ABOUT THE ORIGINAL TABLE IS MAINTAINED EXCEPT FOR JUST THE PART(S) WE WANT TO ALTER.</span></span>
<span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">##... other server code...</span></span></code></pre>
</div>
<p>If you try the app with the changes outlined above made, it won’t
look or behave all that different. However, that’s only because this
particular table is so quick to rebuild! With a more complex table and a
larger data set, this approach would be cleaner, faster, and less
disruptive for the user. Their page choice and row selection could be
maintained between updates, and they could continue to use the app while
the table updated if they wanted to (it wouldn’t freeze). And,
importantly, this approach requires <em>far</em> less code overall and
eliminates the duplicate code we’ve had so far!</p>
<div class="section level3">
<h3 id="watch-and-learn">Watch and learn<a class="anchor" aria-label="anchor" href="#watch-and-learn"></a></h3>
<p>Interactive graphics like our <code>DT</code> table aren’t just a
cool way to show data—they’re <strong>widgets</strong> in their own
right, and user interactions with them can trigger events we could
handle, just as with any other widget.</p>
<p>Let’s see an example. First, recall that row selection doesn’t
trigger events by default. Let’s turn selection back on by changing the
<code>selection</code> parameter inside <code>datatable()</code> from
<code>"none"</code> to
<code>list(mode = "single", target = "cell")</code>, which’ll enable
users to select one cell at a time:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the code that creates your initial table within your server.R file!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span>  <span class="co">#INITIAL TABLE</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">table1</span> <span class="op">=</span> <span class="fu">renderDT</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">gap</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">datatable</span><span class="op">(</span></span>
<span>        selection <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"single"</span>, target <span class="op">=</span> <span class="st">"cell"</span><span class="op">)</span>, <span class="co">#&lt;--TURN SELECTION ON, TARGETING INDIVIDUAL CELLS.</span></span>
<span>        options <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>          info <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          ordering <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          searching <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">formatRound</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"gdpPercap"</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">formatStyle</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"continent"</span>, textAlign <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">formatStyle</span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="st">"lifeExp"</span>,</span>
<span>        target <span class="op">=</span> <span class="st">"row"</span>,</span>
<span>        backgroundColor <span class="op">=</span> <span class="fu">styleEqual</span><span class="op">(</span></span>
<span>          levels <span class="op">=</span> <span class="va">gap</span><span class="op">$</span><span class="va">lifeExp</span>,</span>
<span>          values <span class="op">=</span> <span class="fu">ifelse</span><span class="op">(</span><span class="va">gap</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="fl">70</span>, <span class="st">"lightpink"</span>, <span class="st">"white"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co">##... other server code...</span></span></code></pre>
</div>
<p>Next, let’s create a new observer that will watch for cell selection.
Event information regarding cell selection will be passed from the UI to
the server via the <code>input</code> object using
<code>input$[outputId]_cells_selected</code> format, so
<code>input$table1_cells_selected</code> is the reactive object our
observer will watch. For now, we’ll make this observer’s only operation
to print the value of <code>input$table1_cells_selected</code> to the R
Console every time a new cell is clicked so we can see what this object
looks like:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added to** your server.R file within the server function!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">#WATCH FOR CELL SELECTIONS</span></span>
<span><span class="fu">observeEvent</span><span class="op">(</span><span class="op">{</span><span class="va">input</span><span class="op">$</span><span class="va">table1_cells_selected</span><span class="op">}</span>, <span class="op">{</span></span>
<span></span>
<span>  <span class="fu">print</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">table1_cells_selected</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span></code></pre>
</div>
<p>If you run the app now and select some cells, you’ll observe that
<code>input$table1_cells_selected</code> returns a matrix. Either this
matrix has no rows (when no cell is selected, such as at app start-up)
or one row with two values: row and column numbers for the selected
cell.</p>
<figure><img src="fig/cell%20selection.gif" alt="By using print(), we can see that our cell selection reactive object is a matrix holding the row and column numbers of the cell selected by the user." class="figure mx-auto d-block"><div class="figcaption">By using print(), we can see that our cell
selection reactive object is a matrix holding the row and column numbers
of the cell selected by the user.</div>
</figure><p>Of course, we aren’t <strong>handling</strong> these cell selection
events right now; the app doesn’t yet respond in any new way.</p>
<p>Let’s change that. First, let’s add a <code>renderText({})</code>
call inside our new observer and a <code>textOutput()</code> call to our
UI, beneath our table:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the observeEvent that watches for cell selections in your server.R file!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">#WATCH FOR CELL SELECTIONS</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="op">{</span><span class="va">input</span><span class="op">$</span><span class="va">table1_cells_selected</span><span class="op">}</span>, <span class="op">{</span></span>
<span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">selection_text</span> <span class="op">=</span> <span class="fu">renderText</span><span class="op">(</span><span class="op">{</span></span>
<span>      </span>
<span>      <span class="co">###WE'LL PUT CODE HERE IN A MOMENT.</span></span>
<span>      </span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">##... other server code...</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the content of the "main panel" cell within the BODY section of your ui.R file!</span></span>
<span></span>
<span><span class="co">##... other UI code...</span></span>
<span></span>
<span><span class="co">###MAIN PANEL CELL</span></span>
<span>    <span class="fu">column</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">8</span>, <span class="fu">tabsetPanel</span><span class="op">(</span></span>
<span>      <span class="co">###TABLE TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Table"</span>, </span>
<span>        <span class="fu">dataTableOutput</span><span class="op">(</span>outputId <span class="op">=</span> <span class="st">"table1"</span><span class="op">)</span>,</span>
<span>        <span class="fu">textOutput</span><span class="op">(</span><span class="st">"selection_text"</span><span class="op">)</span><span class="op">)</span>, <span class="co">#&lt;--ADD textOutput HERE. </span></span>
<span>      <span class="co">###MAP TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map"</span><span class="op">)</span>,</span>
<span>      <span class="co">###GRAPH TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Graph"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>   <span class="op">)</span></span>
<span></span>
<span><span class="co">##... other UI code...</span></span></code></pre>
</div>
<p><code>renderText({})</code> and <code>textOutput()</code> create and
display text blocks, as you might guess from their names! We can use
them to programmatically generate text and display it to users. Let’s
use these functions to generate text whenever a life expectancy, GDP per
capita, or population value is selected. Let’s have that text reference
the selected value as well as the associated country and year. This will
require a <em>little</em> “R elbow grease,” but no new Shiny code:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the observeEvent that watches for cell selections in your server.R file!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">#WATCH FOR CELL SELECTIONS</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="op">{</span><span class="va">input</span><span class="op">$</span><span class="va">table1_cells_selected</span><span class="op">}</span>, <span class="op">{</span></span>
<span></span>
<span>    <span class="co">#MAKE SURE A CELL HAS BEEN SELECTED AT ALL--OTHERWISE, ABORT.</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu">length</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">table1_cells_selected</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      </span>
<span>    <span class="co">#CREATE CONVENIENCE OBJECTS THAT ARE SHORTER TO TYPE.</span></span>
<span>    <span class="va">row_num</span> <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">table1_cells_selected</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">col_num</span> <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">table1_cells_selected</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>      </span>
<span>    <span class="co">#MAKE SURE THE SELECTED CELL WAS IN COLUMNS 4-6--OTHERWISE, ABORT.</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">col_num</span> <span class="op">&gt;=</span> <span class="fl">4</span> <span class="op">&amp;</span> <span class="va">col_num</span> <span class="op">&lt;=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="co">#GET THE YEAR AND COUNTRY OF THE ROW SELECTED.</span></span>
<span>    <span class="va">country</span> <span class="op">=</span> <span class="va">gap</span><span class="op">$</span><span class="va">country</span><span class="op">[</span><span class="va">row_num</span><span class="op">]</span></span>
<span>    <span class="va">year</span> <span class="op">=</span> <span class="va">gap</span><span class="op">$</span><span class="va">year</span><span class="op">[</span><span class="va">row_num</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="co">#GET THE VALUE IN THE SELECTED CELL.</span></span>
<span>    <span class="va">datum</span> <span class="op">=</span> <span class="va">gap</span><span class="op">[</span><span class="va">row_num</span>, <span class="va">col_num</span><span class="op">]</span></span>
<span></span>
<span>    <span class="co">#DETERMINE THE RIGHT TEXT STRING TO USE DEPENDING ON THE COLUMN SELECTED.</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="va">col_num</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">col_string</span> <span class="op">=</span> <span class="st">"life expectancy"</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="va">col_num</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">col_string</span> <span class="op">=</span> <span class="st">"population"</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="va">col_num</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">col_string</span> <span class="op">=</span> <span class="st">"GDP per capita"</span></span>
<span>      <span class="op">}</span></span>
<span></span>
<span>      <span class="co">#RENDER OUR TEXT MESSAGE.</span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">selection_text</span> <span class="op">=</span> <span class="fu">renderText</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>      <span class="co">#PASTE TOGETHER ALL THE CONTENT ASSEMBLED ABOVE!</span></span>
<span>      <span class="fu">paste0</span><span class="op">(</span><span class="st">"In "</span>, <span class="va">year</span>, <span class="st">", "</span>, <span class="va">country</span>, <span class="st">" had a "</span>,</span>
<span>             <span class="va">col_string</span>, <span class="st">" of "</span>, <span class="va">datum</span>, <span class="st">"."</span><span class="op">)</span></span>
<span>     <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>   <span class="op">}</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in observeEvent({: could not find function "observeEvent"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co">##... other server code...</span></span></code></pre>
</div>
<p>If you make all the changes outlined above, you should see something
like this when you run the app and select cells:</p>
<figure><img src="fig/rendertext.gif" alt="Whenever we click a value in the last three columns, some procedurally generated text appears on screen beneath our table." class="figure mx-auto d-block"><div class="figcaption">Whenever we click a value in the last three
columns, some procedurally generated text appears on screen beneath our
table.</div>
</figure><p>By using <code>renderText({})</code> and <code>textOutput()</code> to
handle these events, we generate dynamic text that a user might feel is
personal to them and their actions, even though it’s procedurally
generated!</p>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>If you’ve been <em>extra</em> observant, you might realize there are
two issues with our new cell selection observer.</p>
<p>First, if you watch the end of the clip above, you’ll notice that,
while selecting a cell will cause the rendered text message to appear or
change, <em>de-selecting</em> a selected cell does <em>not</em> cause
the rendered text to disappear, as the user might expect.</p>
<p>How would you adjust the code to remove the message when a user
de-selects a cell (or selects an inappropriate cell, such as one in the
first three columns)? <em>Hint: If you leave a <code>render*({})</code>
function’s expression blank, an empty box will get rendered.</em></p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>Our current code uses <code>if()</code>s to determine if a user has
selected a cell at all and, if so, if that cell is appropriate. We can
pair these two <code>if()</code>s with <code>else</code>s that eliminate
the rendered text whenever no (appropriate) cell has been selected:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the observeEvent that watches for cell selections in your server.R file!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="op">{</span><span class="va">input</span><span class="op">$</span><span class="va">table1_cells_selected</span><span class="op">}</span>, <span class="op">{</span></span>
<span></span>
<span>    <span class="va">else_condition</span> <span class="op">=</span> <span class="fu">renderText</span><span class="op">(</span><span class="op">{</span><span class="op">}</span><span class="op">)</span> <span class="co">#OUR ELSE CONDITION WILL BE TO RENDER NOTHING.</span></span>
<span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu">length</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">table1_cells_selected</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>      <span class="va">row_num</span> <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">table1_cells_selected</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>      <span class="va">col_num</span> <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">table1_cells_selected</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="va">col_num</span> <span class="op">&gt;=</span> <span class="fl">4</span> <span class="op">&amp;</span> <span class="va">col_num</span> <span class="op">&lt;=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>        <span class="va">country</span> <span class="op">=</span> <span class="va">gap</span><span class="op">$</span><span class="va">country</span><span class="op">[</span><span class="va">row_num</span><span class="op">]</span></span>
<span>        <span class="va">year</span> <span class="op">=</span> <span class="va">gap</span><span class="op">$</span><span class="va">year</span><span class="op">[</span><span class="va">row_num</span><span class="op">]</span></span>
<span>        </span>
<span>        <span class="va">datum</span> <span class="op">=</span> <span class="va">gap</span><span class="op">[</span><span class="va">row_num</span>, <span class="va">col_num</span><span class="op">]</span></span>
<span></span>
<span>        <span class="kw">if</span><span class="op">(</span><span class="va">col_num</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">col_string</span> <span class="op">=</span> <span class="st">"life expectancy"</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="kw">if</span><span class="op">(</span><span class="va">col_num</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">col_string</span> <span class="op">=</span> <span class="st">"population"</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="kw">if</span><span class="op">(</span><span class="va">col_num</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">col_string</span> <span class="op">=</span> <span class="st">"GDP per capita"</span></span>
<span>        <span class="op">}</span></span>
<span></span>
<span>        <span class="va">output</span><span class="op">$</span><span class="va">selection_text</span> <span class="op">=</span> <span class="fu">renderText</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>          <span class="fu">paste0</span><span class="op">(</span><span class="st">"In "</span>, <span class="va">year</span>, <span class="st">", "</span>, <span class="va">country</span>, <span class="st">" had a "</span>,</span>
<span>                 <span class="va">col_string</span>, <span class="st">" of "</span>, <span class="va">datum</span>, <span class="st">"."</span><span class="op">)</span></span>
<span>        <span class="op">}</span><span class="op">)</span></span>
<span>        <span class="co">#ADD IN OUR ELSE CONDITIONS</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">output</span><span class="op">$</span><span class="va">selection_text</span> <span class="op">=</span> <span class="va">else_condition</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">output</span><span class="op">$</span><span class="va">selection_text</span> <span class="op">=</span> <span class="va">else_condition</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">##... other server code...</span></span></code></pre>
</div>
<p>Now, if you start your app and select a cell that yields our
procedurally generated text, then click that cell again to de-select it,
the text will also disappear.</p>
</div>
</div>
</div>
</div>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p><strong>EXTRA CREDIT–THIS QUESTION IS CHALLENGING!</strong></p>
<p>Second, our current code does not acknowledge the possibility that
the table the user is clicking on may have been sorted by a column other
than <code>country</code> (the default).</p>
<p>If it has been otherwise sorted, a user will click cells based on the
<em>sorted</em> data set they see, but our code currently assumes the
row and column numbers are to be used for the <em>unsorted</em> data
set. As such, it’ll most likely grab values from the wrong row if the
table has been re-sorted!</p>
<p>How could you adjust the code to <em>first</em> determine if the
table is sorted differently than the raw data set is and, if so,
reference the <em>sorted</em> data set instead?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>This question is a purposeful trap; it doesn’t actually have a simple
solution you’re intended to know yet!</p>
<p>Allow me to explain: By default, the app doesn’t track <em>if</em>
the table is sorted and, if so, <em>how</em>. We can’t simply ask “Hey
Shiny, what column is the table sorted by, and is that different than
what we started with?” At best, we’d need to use context clues and logic
to figure out how the table the user can currently see is sorted and
proceed accordingly.</p>
<p>The first solution that came to mind for me was to take the row and
column numbers of the cell the user has selected and get the value in
that cell in both the original data set and in a version of the data set
sorted according to the current selection in our drop-down menu widget.
If these two values <em>don’t</em> match, then the table is
<em>probably</em> sorted by a different column than the original data
set was:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the observeEvent that watches for cell selections in your server.R file!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="op">{</span><span class="va">input</span><span class="op">$</span><span class="va">table1_cells_selected</span><span class="op">}</span>, <span class="op">{</span></span>
<span></span>
<span>    <span class="va">else_condition</span> <span class="op">=</span> <span class="fu">renderText</span><span class="op">(</span><span class="op">{</span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu">length</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">table1_cells_selected</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>      <span class="va">row_num</span> <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">table1_cells_selected</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>      <span class="va">col_num</span> <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">table1_cells_selected</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span></span>
<span>      <span class="kw">if</span><span class="op">(</span><span class="va">col_num</span> <span class="op">&gt;=</span> <span class="fl">4</span> <span class="op">&amp;</span> <span class="va">col_num</span> <span class="op">&lt;=</span> <span class="fl">6</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>        <span class="co">#GET BASELINE DATUM FIRST</span></span>
<span>        <span class="va">datum</span> <span class="op">=</span> <span class="va">gap</span><span class="op">[</span><span class="va">row_num</span>, <span class="va">col_num</span><span class="op">]</span></span>
<span></span>
<span>        <span class="co">#GENERATE A SORTED VERSION OF THE DATA SET, BASED ON THE CURRENT SELECTION</span></span>
<span>        <span class="va">sorted_gap</span> <span class="op">=</span> <span class="va">gap</span> <span class="op">%&gt;%</span></span>
<span>          <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>        <span class="co">#GET THAT VERSION'S DATUM TOO.</span></span>
<span>        <span class="va">sorted_datum</span> <span class="op">=</span> <span class="va">sorted_gap</span><span class="op">[</span><span class="va">row_num</span>, <span class="va">col_num</span><span class="op">]</span></span>
<span></span>
<span>        <span class="co">#COMPARE THEM. IF THEY'RE THE SAME, THE TABLE *PROBABLY* ISN'T SORTED.</span></span>
<span>        <span class="kw">if</span><span class="op">(</span><span class="va">sorted_datum</span> <span class="op">==</span> <span class="va">datum</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">datum</span> <span class="op">=</span> <span class="va">datum</span></span>
<span>          <span class="va">country</span> <span class="op">=</span> <span class="va">gap</span><span class="op">$</span><span class="va">country</span><span class="op">[</span><span class="va">row_num</span><span class="op">]</span></span>
<span>          <span class="va">year</span> <span class="op">=</span> <span class="va">gap</span><span class="op">$</span><span class="va">year</span><span class="op">[</span><span class="va">row_num</span><span class="op">]</span></span>
<span>          <span class="co">#IF THEY'RE DIFFERENT, THE TABLE *PROBABLY* HAS BEEN SORTED, AND WE SHOULD USE THE SORTED VERSION.</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>          <span class="va">datum</span> <span class="op">=</span> <span class="va">sorted_datum</span></span>
<span>          <span class="va">country</span> <span class="op">=</span> <span class="va">sorted_gap</span><span class="op">$</span><span class="va">country</span><span class="op">[</span><span class="va">row_num</span><span class="op">]</span></span>
<span>          <span class="va">year</span> <span class="op">=</span> <span class="va">sorted_gap</span><span class="op">$</span><span class="va">year</span><span class="op">[</span><span class="va">row_num</span><span class="op">]</span></span>
<span>        <span class="op">}</span></span>
<span></span>
<span>        <span class="kw">if</span><span class="op">(</span><span class="va">col_num</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">col_string</span> <span class="op">=</span> <span class="st">"life expectancy"</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="kw">if</span><span class="op">(</span><span class="va">col_num</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">col_string</span> <span class="op">=</span> <span class="st">"population"</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="kw">if</span><span class="op">(</span><span class="va">col_num</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">col_string</span> <span class="op">=</span> <span class="st">"GDP per capita"</span></span>
<span>        <span class="op">}</span></span>
<span></span>
<span>        <span class="va">output</span><span class="op">$</span><span class="va">selection_text</span> <span class="op">=</span> <span class="fu">renderText</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>          <span class="fu">paste0</span><span class="op">(</span><span class="st">"In "</span>, <span class="va">year</span>, <span class="st">", "</span>, <span class="va">country</span>, <span class="st">" had a "</span>,</span>
<span>                 <span class="va">col_string</span>, <span class="st">" of "</span>, <span class="va">datum</span>, <span class="st">"."</span><span class="op">)</span></span>
<span>        <span class="op">}</span><span class="op">)</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">output</span><span class="op">$</span><span class="va">selection_text</span> <span class="op">=</span> <span class="va">else_condition</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">output</span><span class="op">$</span><span class="va">selection_text</span> <span class="op">=</span> <span class="va">else_condition</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">##... other server code...</span></span></code></pre>
</div>
<p>Now, this solution certainly works <em>better</em> than what we had
before—the app seems to successfully acknowledge when the table has been
sorted versus when it hasn’t:</p>
<figure><img src="fig/fixingresort.gif" alt="With the two adjustments outlined above, our app now successfully removes our text when a user de-selects a cell. The table also seems to successfully acknowledge when the table has been sorted versus when it hasn’t when rendering our procedural text." class="figure mx-auto d-block"><div class="figcaption">With the two adjustments outlined above, our app
now successfully removes our text when a user de-selects a cell. The
table also seems to successfully acknowledge when the table has been
sorted versus when it hasn’t when rendering our procedural text.</div>
</figure><p>This solution <em>seems</em> to work—when the table is sorted by a
new column, such as by year, our procedural text references the right
row when procedurally generating text.</p>
<p>However, there’s a <em>very</em> likely scenario in which this
“solution” would fail! Consider that a user can select a new column to
sort by at any time, but they must hit “go” before the sorting actually
happens. If they ever select a new column and then select a cell
<em>before</em> hitting “go,” they will “trick” our code into thinking
the table has been re-sorted when, in fact, it hasn’t:</p>
<figure><img src="fig/failedsolution.gif" alt="This clip shows that our “solution” is easy to trick. If a user selects a new column in the drop-down menu but doesn’t trigger the table to re-sort before selecting a cell, our code will think the table has been re-sorted when it hasn’t and will reference the wrong row’s data in our procedural text." class="figure mx-auto d-block"><div class="figcaption">This clip shows that our “solution” is easy to
trick. If a user selects a new column in the drop-down menu but
<em>doesn’t</em> trigger the table to re-sort <em>before</em> selecting
a cell, our code will think the table has been re-sorted when it hasn’t
and will reference the wrong row’s data in our procedural text.</div>
</figure><p>There’s another problem with our “solution:” What about duplicate
values? If the table has been sorted, but the two values we compare just
so happen to be equal, our code will assume the table has not been
sorted when perhaps it has!</p>
<p>Yikes! This is a challenging problem. Luckily, there is at least one
solution, but it’s outside the scope of this lesson (to use
<code>reactive({})</code> to create a new reactive object that serves as
a tracker for what column the table has been sorted by most recently
that we can update and access whenever we want).</p>
<p>However, we can nonetheless learn a valuable lesson from this
example:</p>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p><em>Every time</em> you give users a new way to interact with your
app, you <em>vastly</em> increase the number of permutations of actions
users could perform. Will they do <em>this</em>, and then <em>that</em>?
Or the reverse?</p>
<p>That means <em>far</em> more potential circumstances to anticipate
and then handle with your code. This is why designing your app ahead of
time and adding interactivity judiciously is essential.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="putting-us-on-the-map">Putting us on the map<a class="anchor" aria-label="anchor" href="#putting-us-on-the-map"></a></h2>
<hr class="half-width"><div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a></h3>
<p><code>leaflet</code> is a JS (and now R) package for creating
web-enabled, interactive maps of <strong>spatial data</strong>, such as
latitude-longitude coordinates. So, we need some spatial data! In the
setup instructions, we asked you to download a version of the
<code>gapminder</code> data set we’ve prepared containing spatial data
using this link: <a href="https://drive.google.com/uc?export=download&amp;id=1YePuKxTlBgW1hQ2uwXHi8b9UJEPUCoDh" class="external-link">Link
to the gapminder data set with attached spatial data.</a> If you haven’t
downloaded that yet, do so now.</p>
<p>Once you’ve downloaded it, move it to your R Project folder and then
load it into R using the following command:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Add this code in your global.R file!</span></span>
<span></span>
<span><span class="co">##... other global code...</span></span>
<span><span class="va">gap_map</span> <span class="op">=</span> <span class="fu">readRDS</span><span class="op">(</span><span class="st">"gapminder_spatial.rds"</span><span class="op">)</span></span></code></pre>
</div>
<p>The rest of this lesson assumes you have <code>gap_map</code>; the
code shown will <em>not</em> work without it!</p>
<div class="section level4">
<h4 id="preface">Preface<a class="anchor" aria-label="anchor" href="#preface"></a></h4>
<p>In this section we switch from making tables to making maps, but
we’ll use the same workflow we followed for <code>DT</code> in the last
section:</p>
<ol style="list-style-type: decimal"><li><p>We’ll start by making a basic map.</p></li>
<li><p>Then, we’ll adjust some of the map’s interactive features and
dress up its aesthetics a bit.</p></li>
<li><p>Lastly, we’ll learn about map-specific events and how to handle
them <em>without</em> redrawing the entire map.</p></li>
</ol><p>The specifics will be different, but we’ve already seen all the
concepts, so this section will hopefully feel like a chance to practice
of familiar concepts rather than an introduction to entirely new
ones.</p>
</div>
</div>
<div class="section level3">
<h3 id="basic-map">Basic map<a class="anchor" aria-label="anchor" href="#basic-map"></a></h3>
<p>Let’s make a <code>leaflet</code> map showing the countries in our
data set marked by a colored outline.</p>
<p>Every <code>leaflet</code> map has three building blocks:</p>
<ol style="list-style-type: decimal"><li><p>A <code>leaflet()</code> call. This is like <code>ggplot()</code>
from the <code>ggplot2</code> package—it “sets the stage” for the rest
of the graphic, and you can specify some settings here that’ll apply to
all subsequent components.</p></li>
<li><p>An <code>addTiles()</code> call. This places a
<strong>tile</strong>, or background image, into your map. This is the
familiar component that indicates where all the lakes and roads and
country boundaries and such are! We’ll use the default tile, but there
are many other free ones available.</p></li>
<li>
<p>At least one <code>add*()</code> function call for adding our
<strong>spatial data</strong>. There are several others, but the three
most commonly used <code>add*()</code> functions are:</p>
<ol style="list-style-type: decimal"><li><p><code>addMarkers()</code> for adding <strong>point</strong>
(0-dimensional) <strong>spatial</strong> <strong>data</strong> (like
restaurant locations).</p></li>
<li><p><code>addPolylines()</code> for adding
<strong>line/curve</strong> (1-dimensional) <strong>spatial</strong>
<strong>data</strong> (like roads or rivers).</p></li>
<li><p><code>addPolygons()</code> for adding <strong>polygonal</strong>
(2-dimensional) <strong>spatial</strong> <strong>data</strong> (like
country boundaries).</p></li>
</ol></li>
</ol><p>Here, we’ll use <code>addPolygons()</code>:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="do">##This code should **swapped** for the the "main panel" content in the BODY section of your ui.R file!</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="do">##... other UI code...</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="do">###MAIN PANEL CELL</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>    <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">8</span>, <span class="fu">tabsetPanel</span>(</span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>      <span class="do">###TABLE TAB</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>      <span class="fu">tabPanel</span>(<span class="at">title =</span> <span class="st">"Table"</span>, <span class="fu">dataTableOutput</span>(<span class="st">"table1"</span>)),</span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>      <span class="do">###MAP TAB</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>      <span class="fu">tabPanel</span>(<span class="at">title =</span> <span class="st">"Map"</span>, <span class="fu">leafletOutput</span>(<span class="st">"basic_map"</span>)), <span class="co">#&lt;--OUTPUT NEW MAP.</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>      <span class="do">###GRAPH TAB</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>      <span class="fu">tabPanel</span>(<span class="at">title =</span> <span class="st">"Graph"</span>)</span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a>    )),</span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a>  <span class="do">##... other UI code...</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added to** your server.R file, below all other contents but inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="co">##FILTER TO ONLY 2007 DATA.</span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu">leaflet</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--GET THINGS STARTED</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--ADD BACKGROUND TILE</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span> <span class="co">#SPECIFY OUR SPATIAL DATA (geometry IS AN sf PACKAGE WAY OF STORING SUCH DATA)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>This code creates a nice, if somewhat fuzzy-looking, interactive map
showing the countries for which we have data outlined in blue:</p>
<figure><img src="fig/leaflet_basic.png" alt="A default leaflet map showing the countries in our data set using fuzzy blue outlines." class="figure mx-auto d-block"><div class="figcaption">A default leaflet map showing the countries in
our data set using fuzzy blue outlines.</div>
</figure><p>Note that you can <strong>pan</strong> the map by clicking anywhere
on it, holding the click, and moving your mouse. Note you can also
<strong>zoom</strong> the map using your mouse wheel (if you have one),
or by using the plus/minus buttons in the upper-left. Double-clicking
the map also zooms in.</p>
<p>If you zoom in, you’ll see the tile automatically change to show
greater detail. If you zoom in really far, you can actually lose any
sense of where you are and, if you zoom way out, you’ll see the world
repeat several times left-to-right, which looks pretty weird!</p>
</div>
<div class="section level3">
<h3 id="more-or-less-basic-map">More (or less) basic map<a class="anchor" aria-label="anchor" href="#more-or-less-basic-map"></a></h3>
<p>As we just saw, it often doesn’t make sense to allow users to
<strong>pan</strong> and <strong>zoom</strong> a map with no
guardrails—they can get lost by zooming in or out too far or panning the
map around too much, and they can create weird visual quirks, such as
making the world repeat.</p>
<p>The <code>leaflet()</code> function can be used to set min and max
zoom levels like so:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co">##THE leaflet() FUNCTION HAS MANY OPTIONS, SUCH AS THE MIN AND MAX ZOOM LEVELS.</span></span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>A <code>minZoom</code> of <code>2</code> makes it so <em>almost</em>
the entire world is visible at once (on my laptop screen, anyway!).
Meanwhile, a <code>maxZoom</code> of <code>6</code> allows users to zoom
into continental regions but no further. These adjustments should keep
users from zooming in or out more than makes sense for our data.</p>
<p>We can also set <strong>maximum bounds</strong>—these are an
invisible box that users cannot pan the map beyond. If they try, the map
will snap the focus (center of the map) back inside the bounds:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">#sf'S st_bbox() FUNCTION RETRIEVES THE FOUR POINTS THAT WOULD CREATE A BOX THAT WOULD FULLY SURROUND THE SPATIAL DATA GIVEN AS INPUTS.</span></span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span> <span class="op">%&gt;%</span>  </span>
<span>      <span class="co">##CONVENIENTLY, setMaxBounds() TAKES THOSE EXACT FOUR POINTS IN THE SAME ORDER.</span></span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>When a user tries to pan past the bounds we’ve set, the map now
“snaps back” to within them:</p>
<figure><img src="fig/zoomandbounds.gif" alt="We can see that the map is now zoomed in a little more than before on start-up, and can’t zoom out any further. When we try to pan the map outside of its bounds, it snaps our focus back within those bounds. Lastly, we’re unable to zoom the map in beyond a certain level." class="figure mx-auto d-block"><div class="figcaption">We can see that the map is now zoomed in a
little more than before on start-up, and can’t zoom out any further.
When we try to pan the map outside of its bounds, it snaps our focus
back within those bounds. Lastly, we’re unable to zoom the map in beyond
a certain level.</div>
</figure><p>While there are other features we could adjust or disable, setting
bounds and minimum and maximum zoom levels are two things you’ll often
want to do to every <code>leaflet</code> map.</p>
</div>
<div class="section level3">
<h3 id="adding-some-pizzazz">Adding some pizzazz<a class="anchor" aria-label="anchor" href="#adding-some-pizzazz"></a></h3>
<p>Our map’s aesthetics leave something to be desired right now. In
particular, the default, fuzzy-blue <strong>strokes</strong> (outlines)
are hard to look at.</p>
<p>Let’s start by cleaning those up. A lot of basic aesthetics related
to your spatial data can be controlled with parameters of the specific
<code>add*()</code> function you’re using. Here, we need to set new
values for <code>color</code>, <code>weight</code>, and
<code>opacity</code> inside <code>addPolygons()</code> to change the
color, thickness, and transparency of the strokes:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span></span>
<span>  <span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>, <span class="co">#CHANGE STROKE COLOR TO BLACK</span></span>
<span>        weight <span class="op">=</span> <span class="fl">2</span>, <span class="co">#INCREASE STROKE THICKNESS</span></span>
<span>        opacity <span class="op">=</span> <span class="fl">1</span> <span class="co">#MAKE FULLY OPAQUE</span></span>
<span>        <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>   <span class="co">##... other server code...</span></span></code></pre>
</div>
<p>These couple of changes make the graph <em>much</em> cleaner:</p>
<figure><img src="fig/bettermap.png" alt="Amazing what adjusting a few stroke (outline) parameters can do!" class="figure mx-auto d-block"><div class="figcaption">Amazing what adjusting a few stroke (outline)
parameters can do!</div>
</figure><p>But the map still won’t engage our users very much because it’s not
showing any <em>data</em>. Let’s have it show our life expectancy data
by mapping those values to the fill color of each country’s polygon.</p>
<p>This’ll be a two-step process. First, we need to set up a
<strong>color palette</strong> function, which <code>leaflet</code> can
use to determine which colors go with which values (it can’t do this
itself). We can build this color palette function using the
<code>colorNumeric()</code> function, which needs two inputs: a
<code>palette</code>, the name of an R color palette we’d like to use,
and a <code>domain</code>, the entire set of values we’ll need to assign
colors to:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">#ESTABLISH A COLOR SCHEME TO USE FOR OUR FILL COLORS.</span></span>
<span>    <span class="va">map_palette</span> <span class="op">=</span> <span class="fu">colorNumeric</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Blues"</span>, </span>
<span>                               domain <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>        weight <span class="op">=</span> <span class="fl">2</span>, </span>
<span>        opacity <span class="op">=</span> <span class="fl">1</span></span>
<span>        <span class="op">)</span> <span class="op">%&gt;%</span>  </span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Then, we can add the polygon-coloring instructions and the life
expectancy data to <code>addPolygons()</code>:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">map_palette</span> <span class="op">=</span> <span class="fu">colorNumeric</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Blues"</span>, domain <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>        weight <span class="op">=</span> <span class="fl">2</span>, </span>
<span>        opacity <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        fillColor <span class="op">=</span> <span class="fu">map_palette</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span>, <span class="co">#&lt;--WE USE OUR NEW COLOR PALETTE FUNCTION, SPECIFYING OUR DATA AS ITS INPUTS.</span></span>
<span>        fillOpacity <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co">#&lt;--THE DEFAULT HERE, 0.5, WOULD WASH OUT THE COLORS TOO MUCH.</span></span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>This is already a <em>much</em> cooler and more engaging map:</p>
<figure><img src="fig/coolmap.png" alt="We’ve successfully mapped each country’s 2007 life expectancy value to the fill color of that country’s polygon." class="figure mx-auto d-block"><div class="figcaption">We’ve successfully mapped each country’s 2007
life expectancy value to the fill color of that country’s polygon.</div>
</figure><p>…But shouldn’t there be a <strong>legend</strong> that clarifies what
colors go with what values? We can add one using
<code>addLegend()</code>:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>   <span class="va">map_palette</span> <span class="op">=</span> <span class="fu">colorNumeric</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Blues"</span>, domain <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>        weight <span class="op">=</span> <span class="fl">2</span>, </span>
<span>        opacity <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        fillColor <span class="op">=</span> <span class="fu">map_palette</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span>, </span>
<span>        fillOpacity <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="co">#ADD LEGEND</span></span>
<span>      <span class="fu">addLegend</span><span class="op">(</span></span>
<span>        position <span class="op">=</span> <span class="st">"bottomleft"</span>, <span class="co">#&lt;--WHERE TO PUT IT.</span></span>
<span>        pal <span class="op">=</span> <span class="va">map_palette</span>, <span class="co">#&lt;--COLOR PALETTE FUNCTION TO USE (AGAIN).</span></span>
<span>        values <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span>, <span class="co">#WHAT SCALE BREAKS TO USE.</span></span>
<span>        opacity <span class="op">=</span> <span class="fl">0.75</span>, <span class="co">#TRANSPARENCY.</span></span>
<span>        bins <span class="op">=</span> <span class="fl">5</span>, <span class="co">#NUMBER OF BREAKS.</span></span>
<span>        title <span class="op">=</span> <span class="st">"Life&lt;br&gt;expectancy ('07)"</span> <span class="co">#TITLE.</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Now that’s a nice map!</p>
<figure><img src="fig/addlegend.png" alt="We’ve added a legend so that users can easily associate different fill colors with different life expectancy values." class="figure mx-auto d-block"><div class="figcaption">We’ve added a legend so that users can easily
associate different fill colors with different life expectancy
values.</div>
</figure><p>…But what if our users don’t know much geography, so they don’t know
which countries are which? Or what if they want to know the
<em>exact</em> life expectancy value for a given country? Can we somehow
add even more data to this map cleanly?</p>
<p>Yes! Adding <strong>tooltips</strong> would address both aims. A
<strong>tooltip</strong> is a small pop-up container that appears on
mouse hover (in <code>leaflet</code>, these variants are called
“labels”), on mouse click (<code>leaflet</code> calls these “popups”),
or some other action.</p>
<p>Using the <code>popup</code> parameter of <code>addPolygons()</code>,
we can add tooltips that appear and disappear on mouse click. Inside
them, we’ll put the name of the country being clicked:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">map_palette</span> <span class="op">=</span> <span class="fu">colorNumeric</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Blues"</span>, domain <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        weight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        opacity <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        fillColor <span class="op">=</span> <span class="fu">map_palette</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>        fillOpacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        popup <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">country</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--MAKE A TOOLTIP HOLDING THE COUNTRY NAME THAT APPEARS/DISAPPEARS ON MOUSE CLICK. </span></span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addLegend</span><span class="op">(</span></span>
<span>        position <span class="op">=</span> <span class="st">"bottomleft"</span>,</span>
<span>        pal <span class="op">=</span> <span class="va">map_palette</span>,</span>
<span>        values <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span>,</span>
<span>        opacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        bins <span class="op">=</span> <span class="fl">5</span>,</span>
<span>        title <span class="op">=</span> <span class="st">"Life&lt;br&gt;expectancy ('07)"</span></span>
<span>      <span class="op">)</span></span>
<span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/countryname.png" alt="Simple tooltips (pop-ups) that appear and disappear on mouse click, showing each country’s name." class="figure mx-auto d-block"><div class="figcaption">Simple tooltips (pop-ups) that appear and
disappear on mouse click, showing each country’s name.</div>
</figure><p>This is a nice addition, but what if we wanted to add life expectancy
values too and also keep the result human-readable? There are many
approaches we could take, but using R’s versatile <code>paste0()</code>
function plus the HTML line break element (<code>&lt;br&gt;</code>)
works pretty well:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">map_palette</span> <span class="op">=</span> <span class="fu">colorNumeric</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Blues"</span>, domain <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        weight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        opacity <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        fillColor <span class="op">=</span> <span class="fu">map_palette</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>        fillOpacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        <span class="co">#EXPANDING THE INFO PRESENTED IN THE TOOLTIPS.</span></span>
<span>        popup <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span><span class="st">"Country: "</span>,</span>
<span>                       <span class="va">gap_map2007</span><span class="op">$</span><span class="va">country</span>,</span>
<span>                       <span class="st">"&lt;br&gt;Life expectancy: "</span>,</span>
<span>                       <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addLegend</span><span class="op">(</span></span>
<span>        position <span class="op">=</span> <span class="st">"bottomleft"</span>,</span>
<span>        pal <span class="op">=</span> <span class="va">map_palette</span>,</span>
<span>        values <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span>,</span>
<span>        opacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        bins <span class="op">=</span> <span class="fl">5</span>,</span>
<span>        title <span class="op">=</span> <span class="st">"Life&lt;br&gt;expectancy ('07)"</span></span>
<span>      <span class="op">)</span></span>
<span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Now, our map is both snazzy <em>and</em> extra informative:</p>
<figure><img src="fig/expandedtooltip.png" alt="Now, the tooltips also contain the exact life expectancy value of each country. Raw HTML line breaks are used to make the result more human-readable." class="figure mx-auto d-block"><div class="figcaption">Now, the tooltips also contain the exact life
expectancy value of each country. Raw HTML line breaks are used to make
the result more human-readable.</div>
</figure><div id="challenge3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>In the previous example, we used <code>popup</code> to build our
tooltips. Try using the <code>label</code> parameter instead. For
whatever reason, this requires more wrangling, so here’s the
<em>exact</em> code you’ll need:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">label</span> <span class="op">=</span> <span class="fu">lapply</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu">nrow</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span> </span>
<span>                    <span class="fu">HTML</span><span class="op">(</span><span class="fu">paste0</span><span class="op">(</span><span class="st">"Country: "</span>,</span>
<span>                                 <span class="va">gap_map2007</span><span class="op">$</span><span class="va">country</span><span class="op">[</span><span class="va">x</span><span class="op">]</span>, </span>
<span>                                 <span class="st">"&lt;br&gt;Life Expectancy: "</span>, </span>
<span>                                <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>What changes? Which do you prefer? Which option would be better if a
lot of users will use mobile devices, do you think?</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>If we use <code>label</code>, we get tooltips that appears on mouse
hover instead of on mouse click.</p>
<p>This behavior is <em>probably</em> more intuitive for most users;
many will not expect a click to do anything cool and so they may only
discover our on-click tooltips by accident!</p>
<p>On the other hand, tooltips that appear on hover can be annoying if a
user is trying to, <em>e.g.</em>, trace a path with their mouse, and
irrelevant tooltips keep getting in the way.</p>
<p>Another advantage of on-click tooltips is that they <em>don’t</em>
disappear until a user is ready for them to do so, whereas tooltips that
appear on hover also disappear when the mouse is moved, which can
prevent users from consulting a tooltip while also using their mouse
somewhere else on the page.</p>
<p>However, the biggest disadvantage of on-hover tooltips is that, while
there <em>is</em> an equivalent event to a mouse click on touchscreen
devices (a finger press), there is no <em>universal</em> equivalent to a
mouse hover (some mobile device browsers and platforms use a “long
press” for this, but not all, and many users are not accustomed to
performing long presses!).</p>
<p>So, mobile users won’t generally see tooltips if they appear
<em>only</em> on hover. If we’re aiming for “mobile-first” design, the
<code>popup</code> option is better (which is why I picked it)!</p>
<p>This hypothetical also demonstrates why <strong>there is no
substitute for asking your users for input when building your
app</strong>; without it, you’ll just be guessing as to what their
needs, expectations, and workflows will be!</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="update-dont-remake-leaflet-edition">Update, don’t remake, <code>leaflet</code> edition!<a class="anchor" aria-label="anchor" href="#update-dont-remake-leaflet-edition"></a></h3>
<p>At this stage, our users have <em>no</em> control over our map. Let’s
adds a <strong>slider input widget</strong> that will let users select
which year’s data get plotted:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the "sidebar" cell's content within the BODY section of your ui.R file!</span></span>
<span></span>
<span><span class="co">##... other UI code...</span></span>
<span></span>
<span><span class="co">###SIDEBAR CELL</span></span>
<span>    <span class="fu">column</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">4</span>,</span>
<span>           <span class="fu">selectInput</span><span class="op">(</span></span>
<span>             inputId <span class="op">=</span> <span class="st">"sorted_column"</span>,</span>
<span>             label <span class="op">=</span> <span class="st">"Select a column to sort the table by."</span>,</span>
<span>             choices <span class="op">=</span> <span class="fu">names</span><span class="op">(</span><span class="va">gap</span><span class="op">)</span></span>
<span>            <span class="op">)</span>,</span>
<span>           <span class="fu">actionButton</span><span class="op">(</span></span>
<span>             inputId <span class="op">=</span> <span class="st">"go_button"</span>,</span>
<span>             label <span class="op">=</span> <span class="st">"Go!"</span><span class="op">)</span>,</span>
<span>           <span class="fu">sliderInput</span><span class="op">(</span></span>
<span>             inputId <span class="op">=</span> <span class="st">"year_slider"</span>,</span>
<span>             label <span class="op">=</span> <span class="st">"Pick what year's data are shown in the map."</span>,</span>
<span>             value <span class="op">=</span> <span class="fl">2007</span>, <span class="co">#&lt;--THE DEFAULT CHOICE</span></span>
<span>             min <span class="op">=</span> <span class="fu">min</span><span class="op">(</span><span class="va">gap</span><span class="op">$</span><span class="va">year</span><span class="op">)</span>, <span class="co">#&lt;--MIN AND MAX CHOICES</span></span>
<span>             max <span class="op">=</span> <span class="fu">max</span><span class="op">(</span><span class="va">gap</span><span class="op">$</span><span class="va">year</span><span class="op">)</span>,</span>
<span>             step <span class="op">=</span> <span class="fl">5</span>, <span class="co">#&lt;--HOW FAR APART ARE CHOICES?</span></span>
<span>             sep <span class="op">=</span> <span class="st">""</span> <span class="co">#&lt;--DON'T USE COMMAS AS SEPARATORS)</span></span>
<span>           <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="co">##... other UI code...</span></span></code></pre>
</div>
<p>This adds the UI component of our input widget to our app’s sidebar
cell:</p>
<figure><img src="fig/sliderinput.png" alt="A slider input widget allowing users to select which year’s data to show in the map." class="figure mx-auto d-block"><div class="figcaption">A slider input widget allowing users to select
which year’s data to show in the map.</div>
</figure><p>But, as we now appreciate, adding the widget to the UI isn’t
enough—we also need to incorporate its <strong>reactive object</strong>
(<code>input$year_slider</code>) into a <strong>reactive
context</strong> in our server code somehow if we want to
<strong>handle</strong> this widget’s <strong>events</strong>.</p>
<p>In this case, that isn’t actually too hard; we already have code that
filters the data set down to the year 2007; we can modify this code so
it filters the data by whichever year has been chosen instead:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="co">##KEEP THE PRODUCT NAMED AFTER 2007 FOR NOW.</span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">year_slider</span><span class="op">)</span><span class="op">)</span> <span class="co">#&lt;--INTRODUCE THE SLIDER'S CURRENT VALUE TO FILTER BY WHATEVER YEAR IS CHOSEN.</span></span>
<span></span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">map_palette</span> <span class="op">=</span> <span class="fu">colorNumeric</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Blues"</span>, domain <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        weight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        opacity <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        fillColor <span class="op">=</span> <span class="fu">map_palette</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>        fillOpacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        popup <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span><span class="st">"Country: "</span>,</span>
<span>                       <span class="va">gap_map2007</span><span class="op">$</span><span class="va">country</span>,</span>
<span>                       <span class="st">"&lt;br&gt;Life expectancy: "</span>,</span>
<span>                       <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addLegend</span><span class="op">(</span></span>
<span>        position <span class="op">=</span> <span class="st">"bottomleft"</span>,</span>
<span>        pal <span class="op">=</span> <span class="va">map_palette</span>,</span>
<span>        values <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span>,</span>
<span>        opacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        bins <span class="op">=</span> <span class="fl">5</span>,</span>
<span>        <span class="co">#HERE, A LITTLE TRICK TO ENSURE THE LEGEND'S TITLE IS ALWAYS ACCURATE. </span></span>
<span>        title <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span><span class="st">"Life&lt;br&gt;expectancy ('"</span>,</span>
<span>                       <span class="fu">substr</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">year_slider</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>                       <span class="st">")"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Above, notice I made a change to the map’s legend title to make it
more “generic” and less specific to any one year. There’s another,
similar change we should make: We should make our
<code>map_palette</code> function more generic so that just one version
of it is used no matter which year is picked. Since the code to produce
this function will then need to run only once ever, this is a good
opportunity to relocate that code to <code>global.R</code>:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added to** your global.R file, below all other code!</span></span>
<span></span>
<span> <span class="co">##... other global code...</span></span>
<span></span>
<span><span class="va">map_palette</span> <span class="op">=</span> <span class="fu">colorNumeric</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Blues"</span>, </span>
<span>                           domain <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gap_map</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="co">#&lt;--CHANGE TO REFERENCE THE WHOLE DATA SET INSTEAD OF JUST THOSE FROM ONE YEAR.</span></span></code></pre>
</div>
<p>This new functionality gives users a new and exciting way to explore
the data:</p>
<figure><img src="fig/sliderchanges.gif" alt="The map rebuilds each time a new year is chosen in the slider widget to show data from that year (and the legend title changes too). Within-country shifts in life expectancy over time are more noticeable because a single palette is used for all years rather than a new one being built for each year’s data." class="figure mx-auto d-block"><div class="figcaption">The map rebuilds each time a new year is chosen
in the slider widget to show data from that year (and the legend title
changes too). Within-country shifts in life expectancy over time are
more noticeable because a single palette is used for all years rather
than a new one being built for each year’s data.</div>
</figure><p>If you watch the video above closely, you’ll notice the “freeze” that
occurs every time a user selects a new year. As we saw with
<code>DT</code>, handling events by rebuilding our graphic is
<em>not</em> ideal. With maps, it can be <em>especially</em> problematic
because spatial data tend be voluminous, so re-rendering maps can cause
long loading times for our users and make the app look “buggy.”</p>
<p>Fortunately, just as with <code>DT</code>, <code>leaflet</code>
features a <strong>proxy</strong> that lets us update our rendered map
in real time, changing only those features that <em>need</em>
changing.</p>
<p>Let’s switch to that system the same way we did with
<code>DT</code>:</p>
<ol style="list-style-type: decimal"><li><p>We’ll now use <code>renderLeaflet({})</code> to produce
<em>just</em> the version of the map that users sees at
start-up.</p></li>
<li><p>We use a new <code>observeEvent({},{})</code> to watch for
relevant events (here, our slider changing).</p></li>
<li><p>Inside the observer, we use a proxy, built using
<code>leafletProxy()</code>, to make only the updates that need
making:</p></li>
</ol><div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="co">#RENDERLEAFLET GOES BACK TO MAKING JUST THE BASE, 2007 VERSION.</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span> <span class="co">#&lt;--CHANGE</span></span>
<span></span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        weight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        opacity <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        fillColor <span class="op">=</span> <span class="fu">map_palette</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>        fillOpacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        popup <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span><span class="st">"Country: "</span>,</span>
<span>                       <span class="va">gap_map2007</span><span class="op">$</span><span class="va">country</span>,</span>
<span>                       <span class="st">"&lt;br&gt;Life expectancy: "</span>,</span>
<span>                       <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addLegend</span><span class="op">(</span></span>
<span>        position <span class="op">=</span> <span class="st">"bottomleft"</span>,</span>
<span>        pal <span class="op">=</span> <span class="va">map_palette</span>,</span>
<span>        values <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span>,</span>
<span>        opacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        bins <span class="op">=</span> <span class="fl">5</span>,</span>
<span>        title <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span><span class="st">"Life&lt;br&gt;expectancy ('07)"</span><span class="op">)</span> <span class="co">#&lt;--CHANGE</span></span>
<span>      <span class="op">)</span></span>
<span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">#A NEW OBSERVER WATCHES FOR EVENTS INVOLVING OUR SLIDER.</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="op">{</span><span class="va">input</span><span class="op">$</span><span class="va">year_slider</span><span class="op">}</span>, <span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">year_slider</span><span class="op">)</span><span class="op">)</span> <span class="co">#FILTER BY SELECTED YEAR</span></span>
<span></span>
<span>    <span class="co">#WE USE leafletProxy({}) TO UPDATE OUR MAP INSTEAD OF RE-RENDERING IT.</span></span>
<span>    <span class="fu">leafletProxy</span><span class="op">(</span><span class="st">"basic_map"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">clearMarkers</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#REMOVE THE OLD POLYGONS ("MARKERS")--THEIR FILLS MUST CHANGE.</span></span>
<span>      <span class="fu">clearControls</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#REMOVE THE LEGEND ("CONTROL")--ITS TITLE MUST CHANGE.</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span> <span class="co">#REBUILD THE POLYGONS EXACTLY AS BEFORE.</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        weight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        opacity <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        fillColor <span class="op">=</span> <span class="fu">map_palette</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>        fillOpacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        popup <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span><span class="st">"Country: "</span>,</span>
<span>                       <span class="va">gap_map2007</span><span class="op">$</span><span class="va">country</span>,</span>
<span>                       <span class="st">"&lt;br&gt;Life expectancy: "</span>,</span>
<span>                       <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addLegend</span><span class="op">(</span> <span class="co">#REBUILD THE LEGEND EXACTLY AS BEFORE.</span></span>
<span>        position <span class="op">=</span> <span class="st">"bottomleft"</span>,</span>
<span>        pal <span class="op">=</span> <span class="va">map_palette</span>,</span>
<span>        values <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span>,</span>
<span>        opacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        bins <span class="op">=</span> <span class="fl">5</span>,</span>
<span>        title <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span><span class="st">"Life&lt;br&gt;expectancy ('"</span>,</span>
<span>                       <span class="fu">substr</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">year_slider</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>                       <span class="st">")"</span><span class="op">)</span> <span class="co">#&lt;-RETAIN OUR TRICK HERE.</span></span>
<span>      <span class="op">)</span></span>
<span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>In the code above, we still need to repeat quite a lot of code to
handle these particular events, so the updating process isn’t
<em>much</em> faster than before. However, we at least don’t need to
touch the map window itself, its zoom behavior, or bounds because those
aspects don’t need to change. The result is a cleaner, less
buggy-looking transition between map versions:</p>
<figure><img src="fig/cleanerupdates.gif" alt="By using the proxy system, key components of the map needn’t be rebuilt each time, and the app needn’t freeze while the updates occur, resulting in a faster and subtler transition between map versions." class="figure mx-auto d-block"><div class="figcaption">By using the proxy system, key components of the
map needn’t be rebuilt each time, and the app needn’t freeze while the
updates occur, resulting in a faster and subtler transition between map
versions.</div>
</figure><p>There are ways we could have made these updates even more efficient,
such as:</p>
<ul><li><p>Pre-building all possible filtered versions of the data set in
<code>global.R</code> so we didn’t need to (re-)make them on the fly
during each update.</p></li>
<li><p>Making the legend title generic enough that it doesn’t need
rebuilding each time.</p></li>
<li><p>Considering whether the user should be able to view and change
the entire world’s data at once. Perhaps they should only be able to
view and control a single continent’s data at a time.</p></li>
<li><p>Using a discrete rather than continuous color palette
(<em>e.g.</em>, only six possible colors), assigning every country’s
polygon to a group (using the <code>group</code> parameter inside
<code>addPolygons()</code>) according to the “bin” their data falls
into, determining whether a country’s “bin” should change during an
update, and redrawing only those polygons whose “bins” do need to
change.</p></li>
</ul><p>However, you may deem the current solution “good enough” for your
users—I would!</p>
</div>
<div class="section level3">
<h3 id="watch-and-learn-1">Watch and learn<a class="anchor" aria-label="anchor" href="#watch-and-learn-1"></a></h3>
<p><code>leaflet</code> maps are <strong>widgets</strong> like any
other, so information about user interactions with them are passed from
the UI to the server by <code>input</code> where they can be watched and
<strong>handled</strong>.</p>
<p>For example, whenever a user <strong>clicks</strong> a country’s
polygon, this could trigger a “click event,” and we can access
information about that event using
<code>input$[outputId]_shape_click</code> format server-side.</p>
<p>We can combine that functionality with another cool feature of
<code>leaflet</code> maps: <code>flyTo()</code>. This function will
<strong>pan</strong> and <strong>zoom</strong> the map to center on a
specific location, such as where the user clicked.</p>
<p>So, let’s create a new observer that watches for clicks, and, when
one happens, a <code>leafletProxy()</code> will fly our map to that
location:</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added** to the bottom of your server.R file, but still within your server function!</span></span>
<span></span>
<span><span class="co">###MAP OBSERVER (POLYGON CLICKS)</span></span>
<span><span class="co">#WHEN A POLYGON CLICK EVENT OCCURS, WE USE A PROXY AND flyTo() TO ZOOM AND PAN THE MAP TO CENTER ON THE CLICKED LOCATION.</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">basic_map_shape_click</span>, <span class="op">{</span></span>
<span></span>
<span>    <span class="fu">leafletProxy</span><span class="op">(</span><span class="st">"basic_map"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">flyTo</span><span class="op">(</span></span>
<span>        lat <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">basic_map_shape_click</span><span class="op">$</span><span class="va">lat</span>, <span class="co">#LAT AND LONG DATA ON THE CLICKED LOCATION ARE ACCESSED THUSLY.</span></span>
<span>        lng <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">basic_map_shape_click</span><span class="op">$</span><span class="va">lng</span>,</span>
<span>        zoom <span class="op">=</span> <span class="fl">5</span></span>
<span>      <span class="op">)</span></span>
<span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Now, when users click specific countries, they don’t just get
additional info via a tooltip, they get an animation that zooms them in
on that particular country:</p>
<figure><img src="fig/flyto.gif" alt="A proxy is used to update a map’s focus point; we “fly to” a location clicked on by the user." class="figure mx-auto d-block"><div class="figcaption">A proxy is used to update a map’s focus point;
we “fly to” a location clicked on by the user.</div>
</figure><p>Obviously, we should only add features like this if they enhance our
<strong>UX</strong>, which this one arguably doesn’t, but this example
demonstrates what’s possible.</p>
</div>
</section><section><h2 class="section-heading" id="getting-graphic">Getting graphic<a class="anchor" aria-label="anchor" href="#getting-graphic"></a></h2>
<hr class="half-width"><p>We’ll close out this lesson by considering <code>plotly</code>, a
package for producing interactive, web-enabled <strong>graphs</strong>,
similar in quality and complexity to the (static) ones produced by
<code>ggplot2</code>.</p>
<p>R users who know <code>ggplot2</code> understand that learning
graphics packages is like learning a new language! The learning curve is
<em>significant</em>; because these packages give users <em>all</em> the
tools needed to design a complex graph piece by piece, there are lots of
functions and parameters and jargon to keep straight!</p>
<p><code>plotly</code> is no different—you can create ultra-detailed,
publication-quality graphics with it, but you’ll need to learn a new
vernacular to do so, one that may only sometimes feel similar to
<code>ggplot2</code>’s.</p>
<p>As such, covering <code>plotly</code> in any depth is outside the
scope of this lesson. Thankfully, we don’t actually <em>need</em> to
learn <code>plotly</code> to appreciate what it can offer our users; it
comes with an <em>incredible</em> “cheat code” that, while imperfect,
will work suit our needs here wonderfully: the <code>ggplotly()</code>
function.</p>
<p><code>ggplotly()</code> takes a complete <code>ggplot</code>, breaks
it down into its components, and rebuilds those components using
<code>plotly</code>’s system instead (as best it can). Because the two
systems are similar in many ways, you’ll get a <em>similar</em> graph as
a product, but one with all the interactive features of a
<code>plotly</code> graph.</p>
<p>However, because the two systems don’t map 1-to-1, the result will
rarely look <em>exactly</em> the same as the <code>ggplot</code> you put
in. In particular, complex customizations using <code>ggplot</code>’s
<code>theme()</code>, text-related components, advanced or new features
in <code>ggplot</code>’s dialect, and so on don’t generally transition
well.</p>
<p>So, it’s probably more correct to say that <code>ggplotly()</code>
produces a <code>plotly</code> graph <em>in the spirit of</em> the
<code>ggplot2</code> graph used. Still, that means we <em>don’t</em>
need to learn how to produce a <code>plotly</code> graph using
<code>plotly</code>’s own system to be able to explore the package’s
features and use cases.</p>
<p>To start, let’s build a <code>ggplot2</code> graph to use as an
input. Let’s make it a scatterplot of GDP vs. log(population) for 2007,
with each continent getting a different color too. Additionally, we’ll
plot a best-fit line for each continent’s data. And, to top it off,
we’ll customize the appearance of the graph in several ways.</p>
<p>This <em>probably</em> sounds like it’ll be a complicated graph, and
that’s because it will be! I want you to see how <code>ggplotly()</code>
performs on a graph with many components:</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added** to the bottom of your global.R file!</span></span>
<span></span>
<span><span class="co">###FILTERED DATA SET FOR GRAPH</span></span>
<span><span class="va">gap2007</span> <span class="op">=</span> <span class="va">gap</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span></span>
<span><span class="co">###BASE GGPLOT FOR CONVERSION TO PLOTLY</span></span>
<span><span class="co">#IF GGPLOT IS FAMILIAR TO YOU, STUDY THE SPECIFICS HERE TO GET A SENSE OF THE GRAPH WE'RE BUILDING. IF NOT, DON'T WORRY ABOUT THE DETAILS! JUST COPY-PASTE THIS CODE INTO PLACE.</span></span>
<span><span class="va">p1</span> <span class="op">=</span> <span class="fu">ggplot</span><span class="op">(</span></span>
<span>  <span class="va">gap2007</span>,</span>
<span>  <span class="fu">aes</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu">log</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="va">gdpPercap</span>,</span>
<span>    color <span class="op">=</span> <span class="va">continent</span>,</span>
<span>    group <span class="op">=</span> <span class="va">continent</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      size <span class="op">=</span> <span class="fl">16</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"bold"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,</span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.line <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span><span class="st">"GDP per capita\n"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span><span class="st">"\nPopulation size (log)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_discrete</span><span class="op">(</span><span class="st">"Continent\n"</span><span class="op">)</span></span></code></pre>
</div>
<p>If you don’t know <code>ggplot2</code>, the above code will probably
look daunting! If so, don’t worry; you <em>don’t</em> need to know what
it’s doing at all! Just copy-paste it into your app’s
<code>global.R</code> file.</p>
<p>For those who <em>do</em> know <code>ggplot2</code>, you’ll hopefully
agree that this graph looks halfway decent:</p>
<figure><img src="fig/baseggplot.png" alt="The ggplot graph produced by the code above." class="figure mx-auto d-block"><div class="figcaption">The ggplot graph produced by the code
above.</div>
</figure><p>More importantly, though, it’s complex enough to be a good test for
<code>ggplotly()</code>. Let’s see how it does at converting it to a
<code>plotly</code> graph:</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added** to the bottom of your global.R file!</span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu">ggplotly</span><span class="op">(</span><span class="va">p1</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/baseplotly.png" alt="The same graph as before (more or less) but now rendered using plotly’s system via ggplotly()." class="figure mx-auto d-block"><div class="figcaption">The same graph as before (more or less) but now
rendered using <em>plotly</em>’s system via ggplotly().</div>
</figure><p>Now that we have our <code>plotly</code> version, I hope you’ll agree
it looks pretty similar to our original <code>ggplot</code>, although
there are some differences—we’ll talk about those in a moment.</p>
<p>First, though, let’s insert this graph into our app. For this, it
hopefully won’t surprise you that there are
<code>renderPlotly({})</code> and <code>plotlyOutput()</code> functions
we can use:</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="do">##This code should **swapped** for the the "main panel" content in the BODY section of your ui.R file!</span></span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a><span class="do">##... other UI code...</span></span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a><span class="do">###MAIN PANEL CELL</span></span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a><span class="fu">column</span>(<span class="at">width =</span> <span class="dv">8</span>, <span class="fu">tabsetPanel</span>(</span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a>      <span class="fu">tabPanel</span>(<span class="at">title =</span> <span class="st">"Table"</span>, <span class="fu">dataTableOutput</span>(<span class="st">"table1"</span>)),</span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a>      <span class="fu">tabPanel</span>(<span class="at">title =</span> <span class="st">"Map"</span>, <span class="fu">leafletOutput</span>(<span class="st">"basic_map"</span>)),</span>
<span id="cb37-8"><a href="#cb37-8" tabindex="-1"></a>      <span class="fu">tabPanel</span>(<span class="at">title =</span> <span class="st">"Graph"</span>, </span>
<span id="cb37-9"><a href="#cb37-9" tabindex="-1"></a>               <span class="fu">plotlyOutput</span>(<span class="st">"basic_graph"</span>)) <span class="co">#&lt;--ADD THE RENDERED GRAPH HERE.</span></span>
<span id="cb37-10"><a href="#cb37-10" tabindex="-1"></a>    )),</span>
<span id="cb37-11"><a href="#cb37-11" tabindex="-1"></a><span class="do">##... other UI code...</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added to** your server.R file, underneath all other contents but inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###GRAPH</span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">basic_graph</span> <span class="op">=</span> <span class="fu">renderPlotly</span><span class="op">(</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">p2</span> <span class="co">#&lt;--PUT PRE-GENERATED PLOTLY GRAPH HERE.</span></span>
<span>    </span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>If we launch our app, we should see our new <code>plotly</code> graph
on the Graph tab panel:</p>
<figure><img src="fig/plotlyfeatures.gif" alt="In this clip, we see many of plotly’s interactive features, including tooltips, legend key filtering, and the modebar of buttons." class="figure mx-auto d-block"><div class="figcaption">In this clip, we see many of plotly’s
interactive features, including tooltips, legend key filtering, and the
modebar of buttons.</div>
</figure><p>The only aesthetic difference between our original
<code>ggplot</code> and our new <code>plotly</code> graph that stands
out to me is the legend’s placement; while <code>ggplot</code>s
vertically center their legends by default, <code>plotly</code> graphs
top-align them instead.</p>
<p>We’ll fix that in a moment! Beforehand, let’s focus on all the new
interactive features this graph comes with that the old one lacks (it’s
a lot!):</p>
<ul><li><p><strong>Tooltips</strong>: If you hover over a point, you’ll get
a <strong>tooltip</strong> showing the point’s associated
<code>x</code>, <code>y</code>, and <code>group</code> (continent)
values. These tooltips aren’t super human-readable by default, but that
too we’ll soon change.</p></li>
<li><p><strong>Click+drag to zoom</strong>: If you click anywhere, drag
your cursor to highlight a region, and let go, you will zoom the graph
to show <em>only</em> the highlighted region and data. Double-clicking
will restore the original zoom level.</p></li>
<li><p><strong>Interactive “modebar:”</strong> <code>plotly</code>
graphs come with a toolbar in the upper-right that features several
buttons. These allow you to download an image of the graph, zoom and
pan, select specific data, reset the graph, and change how tooltips
work.</p></li>
<li><p><strong>Legend group filtering</strong>: If you click any of the
legend keys (such as “Asia”), all data points from that group will be
redacted, and the axes will readjust as though those data weren’t
present. Double-clicking a legend key, meanwhile, will exclude all data
<em>but</em> those from that group.</p></li>
</ul><p>That’s a <em>lot</em> of interactivity!</p>
<div class="section level3">
<h3 id="more-or-less-basic-graph">More (or less) basic graph<a class="anchor" aria-label="anchor" href="#more-or-less-basic-graph"></a></h3>
<p>…which means we should discuss how to disable some of these features.
Unfortunately, disabling features in <code>plotly</code> is not
<em>as</em> easy as in <code>DT</code> or <code>leaflet</code>; to do
so, we must engage with two of the core functions used to build
<code>plotly</code> graphs from scratch: <code>layout()</code> and
<code>config()</code>.</p>
<p><code>layout()</code> is <em>sort of</em> like <code>ggplot2</code>’s
<code>scale_*()</code> functions in that it controls how much of the
plot’s mapped aesthetics work. Inside <code>layout()</code> are
<code>xaxis</code> and <code>yaxis</code> parameters; if we give both a
list containing the instruction <code>fixedrange = TRUE</code>, this
will disable zooming functionality:</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the renderPlotly({}) code in your server.R file, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###GRAPH</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_graph</span> <span class="op">=</span> <span class="fu">renderPlotly</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">p2</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">layout</span><span class="op">(</span> </span>
<span>        <span class="co">#PLOTLY CODE LOOKS VERY JS-Y, HENCE LOTSA LISTS!</span></span>
<span>        xaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        yaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>In my experience, zooming isn’t a useful feature in most contexts,
and some users find it hard to figure out how to reverse an accidental
zoom, so it’s one of the first features I tend to disable.</p>
<p>We can also use <code>layout()</code> to adjust how the legend
responds to clicks. For example, if we want to turn off the
functionality that redacts a group when its legend key is clicked, we
can set the <code>itemclick</code> instruction for the
<code>legend</code> parameter to <code>FALSE</code>:</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the renderPlotly({}) code in your server.R file, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###GRAPH</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_graph</span> <span class="op">=</span> <span class="fu">renderPlotly</span><span class="op">(</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">p2</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">layout</span><span class="op">(</span></span>
<span>        xaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        yaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        legend <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>itemclick <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co">#&lt;--TURN OFF GROUP REDACTION UPON CLICKING LEGEND KEYS.</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>The double-click functionality can be similarly disabled. In my
experience, though it seems useful, I’ve struggled to adequately explain
the legend key filtering functionality to my users, so it’s another
feature I regularly disable.</p>
<p>The <code>config()</code> function, meanwhile, can remove buttons
from the modebar, although you may need to Google for the names of the
specific buttons you want to remove:</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the renderPlotly({}) code in your server.R file, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server </span></span>
<span><span class="co">###GRAPH</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_graph</span> <span class="op">=</span> <span class="fu">renderPlotly</span><span class="op">(</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">p2</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">layout</span><span class="op">(</span></span>
<span>        xaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        yaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        legend <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>itemclick <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">config</span><span class="op">(</span>modeBarButtonsToRemove <span class="op">=</span> <span class="fu">list</span><span class="op">(</span><span class="st">"lasso2d"</span><span class="op">)</span><span class="op">)</span> <span class="co">#&lt;--REMOVING THE "LASSO" SELECTION BUTTON.</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<div id="callout3" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>I’ll stress here again that, when considering <strong>UX</strong>,
“less” is often “more.” If your users might not understand it or won’t
use it, consider removing or disabling it.</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="making-some-adjustments">Making some adjustments<a class="anchor" aria-label="anchor" href="#making-some-adjustments"></a></h3>
<p>Earlier, I identified two dissatisfying aspects about our graph.
First, the legend isn’t centered vertically, like in our original graph
and, second, the tooltip text could be easier to read.</p>
<p>The first issue is solved using the <code>legend</code> parameter
inside of <code>layout()</code>, which we’ve already dabbled with:</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the renderPlotly({}) code in your server.R file, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###GRAPH</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_graph</span> <span class="op">=</span> <span class="fu">renderPlotly</span><span class="op">(</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">p2</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">layout</span><span class="op">(</span></span>
<span>        xaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        yaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        legend <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>itemclick <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                      y <span class="op">=</span> <span class="fl">0.5</span>, <span class="co">#&lt;--PUT THE LEGEND HALFWAY DOWN.</span></span>
<span>                      yanchor <span class="op">=</span> <span class="st">"middle"</span> <span class="co">#&lt;--SPECIFICALLY, PUT THE *CENTER* OF IT HALFWAY DOWN.</span></span>
<span>                      <span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">config</span><span class="op">(</span>modeBarButtonsToRemove <span class="op">=</span> <span class="fu">list</span><span class="op">(</span><span class="st">"lasso2d"</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>The best way to beautify our tooltips’ contents, meanwhile, will be
to use a third core <code>plotly</code> function:
<code>style()</code>.</p>
<p>This’ll be a multi-step process:</p>
<ol style="list-style-type: decimal"><li><p>First, let’s “pre-generate” the text we want each tooltip to
contain (using <code>dplyr</code>’s <code>mutate()</code>).</p></li>
<li><p>Second, let’s pass this text into our original
<code>ggplot</code> call so it gets packaged up with everything else
passed to <code>ggplotly()</code>.</p></li>
<li><p>Lastly, let’s use <code>style()</code> to make the contents of
our tooltips <em>only</em> the custom text we’ve cooked up:</p></li>
</ol><div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the previous plotly-related code in your global.R file!</span></span>
<span></span>
<span> <span class="co">##... other global code...</span></span>
<span><span class="co">###FILTERED DATA SET FOR GRAPH</span></span>
<span><span class="va">gap2007</span> <span class="op">=</span> <span class="va">gap</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>tooltip_text <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span> <span class="co">#&lt;--HERE, GENERATE A NEW COLUMN CALLED tooltip_text USING paste0() TO MAKE A TEXT STRING CONTAINING THE GDP AND POPULATION DATA IN A MORE READABLE FORMAT. </span></span>
<span>    <span class="st">"GDP: "</span>,</span>
<span>    <span class="fu">round</span><span class="op">(</span><span class="va">gdpPercap</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="st">"&lt;br&gt;"</span>,</span>
<span>    <span class="st">"Log population: "</span>,</span>
<span>    <span class="fu">round</span><span class="op">(</span><span class="fu">log</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">###BASE GGPLOT FOR CONVERSION TO PLOTLY</span></span>
<span><span class="va">p1</span> <span class="op">=</span> <span class="fu">ggplot</span><span class="op">(</span></span>
<span>  <span class="va">gap2007</span>,</span>
<span>  <span class="fu">aes</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu">log</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="va">gdpPercap</span>,</span>
<span>    color <span class="op">=</span> <span class="va">continent</span>,</span>
<span>    group <span class="op">=</span> <span class="va">continent</span>,</span>
<span>    text <span class="op">=</span> <span class="va">tooltip_text</span> <span class="co">#&lt;--HERE, PASS OUR CUSTOM TOOLTIP TEXT TO THE TEXT AESTHETIC. EVEN THOUGH OUR GGPLOT NEVER USES THIS AESTHETIC, IT'LL PASS IT TO OUR PLOTLY GRAPH ANYHOW. </span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      size <span class="op">=</span> <span class="fl">16</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"bold"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,</span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.line <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span><span class="st">"GDP per capita\n"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span><span class="st">"\nPopulation size (log)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_discrete</span><span class="op">(</span><span class="st">"Continent\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">###PLOTLY CONVERSION</span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu">ggplotly</span><span class="op">(</span><span class="va">p1</span>, </span>
<span>              tooltip <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--HERE, TELL GGPLOTLY() TO POPULATE TOOLTIPS WITH ONLY TEXT DATA, NOT ALSO X/Y/GROUP DATA </span></span>
<span>  <span class="fu">style</span><span class="op">(</span>hoverinfo <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span> <span class="co">#&lt;--HERE, USE style() TO REQUEST THAT ONLY OUR CUSTOM TOOLTIPS BE SHOWN, OR ELSE WE'D GET PLOTLY'S DEFAULTS ALSO!</span></span></code></pre>
</div>
<p>Now our tooltips are looking great:</p>
<figure><img src="fig/legendandtooltips.png" alt="Our plotly graph now has a centered legend, like the source graph did, and tooltips that are more human-readable." class="figure mx-auto d-block"><div class="figcaption">Our <em>plotly</em> graph now has a centered
legend, like the source graph did, and tooltips that are more
human-readable.</div>
</figure><p>The morale of the story is that, between <code>layout()</code>,
<code>style()</code>, and <code>config()</code>, you can adjust
virtually any aspect of a <code>plotly</code> graph, much as in
<code>ggplot2</code> using <code>theme()</code> and the
<code>scale_*()</code> functions. However, it may require some Googling
and experimentation to figure out <em>exactly</em> how to do any
specific thing!</p>
</div>
<div class="section level3">
<h3 id="update-dont-remake-plotly-edition">Update, don’t remake, <code>plotly</code> edition!<a class="anchor" aria-label="anchor" href="#update-dont-remake-plotly-edition"></a></h3>
<p>Once again, it’s time to see how to update a <code>plotly</code>
graph “on the fly” in response to user actions without re-rendering
it!</p>
<p>That again first means giving users a fun way to affect the graph.
Let’s create a drop-down widget that lets users pick a new color palette
for the graph:</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="do">##This code should **replace** the "sidebar panel" cell's content within the BODY section of your ui.R file!</span></span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" tabindex="-1"></a><span class="do">##... other UI code...</span></span>
<span id="cb44-4"><a href="#cb44-4" tabindex="-1"></a><span class="do">###SIDEBAR CELL</span></span>
<span id="cb44-5"><a href="#cb44-5" tabindex="-1"></a>    <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb44-6"><a href="#cb44-6" tabindex="-1"></a>           <span class="fu">selectInput</span>(</span>
<span id="cb44-7"><a href="#cb44-7" tabindex="-1"></a>             <span class="at">inputId =</span> <span class="st">"sorted_column"</span>,</span>
<span id="cb44-8"><a href="#cb44-8" tabindex="-1"></a>             <span class="at">label =</span> <span class="st">"Select a column to sort the table by."</span>,</span>
<span id="cb44-9"><a href="#cb44-9" tabindex="-1"></a>             <span class="at">choices =</span> <span class="fu">names</span>(gap)</span>
<span id="cb44-10"><a href="#cb44-10" tabindex="-1"></a>           ),</span>
<span id="cb44-11"><a href="#cb44-11" tabindex="-1"></a>           <span class="fu">actionButton</span>(</span>
<span id="cb44-12"><a href="#cb44-12" tabindex="-1"></a>             <span class="at">inputId =</span> <span class="st">"go_button"</span>,</span>
<span id="cb44-13"><a href="#cb44-13" tabindex="-1"></a>             <span class="at">label =</span> <span class="st">"Go!"</span>),</span>
<span id="cb44-14"><a href="#cb44-14" tabindex="-1"></a>           <span class="fu">sliderInput</span>(</span>
<span id="cb44-15"><a href="#cb44-15" tabindex="-1"></a>             <span class="at">inputId =</span> <span class="st">"year_slider"</span>,</span>
<span id="cb44-16"><a href="#cb44-16" tabindex="-1"></a>             <span class="at">label =</span> <span class="st">"Pick what year's data are shown in the map."</span>,</span>
<span id="cb44-17"><a href="#cb44-17" tabindex="-1"></a>             <span class="at">value =</span> <span class="dv">2007</span>,</span>
<span id="cb44-18"><a href="#cb44-18" tabindex="-1"></a>             <span class="at">min =</span> <span class="fu">min</span>(gap<span class="sc">$</span>year),</span>
<span id="cb44-19"><a href="#cb44-19" tabindex="-1"></a>             <span class="at">max =</span> <span class="fu">max</span>(gap<span class="sc">$</span>year),</span>
<span id="cb44-20"><a href="#cb44-20" tabindex="-1"></a>             <span class="at">step =</span> <span class="dv">5</span>,</span>
<span id="cb44-21"><a href="#cb44-21" tabindex="-1"></a>             <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb44-22"><a href="#cb44-22" tabindex="-1"></a>           ),</span>
<span id="cb44-23"><a href="#cb44-23" tabindex="-1"></a>           <span class="fu">selectInput</span>( <span class="co">#ADD A COLOR PALETTE SELECTOR</span></span>
<span id="cb44-24"><a href="#cb44-24" tabindex="-1"></a>             <span class="at">inputId =</span> <span class="st">"color_scheme"</span>,</span>
<span id="cb44-25"><a href="#cb44-25" tabindex="-1"></a>             <span class="at">label =</span> <span class="st">"Pick a color palette for the graph."</span>,</span>
<span id="cb44-26"><a href="#cb44-26" tabindex="-1"></a>             <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"viridis"</span>, <span class="st">"plasma"</span>, <span class="st">"Spectral"</span>, <span class="st">"Dark2"</span>)</span>
<span id="cb44-27"><a href="#cb44-27" tabindex="-1"></a>           )</span>
<span id="cb44-28"><a href="#cb44-28" tabindex="-1"></a>    ),</span>
<span id="cb44-29"><a href="#cb44-29" tabindex="-1"></a><span class="do">##... other UI code...</span></span></code></pre>
</div>
<p>In <code>plotly</code>, color scheme is generally specified inside
the <code>plot_ly()</code> call (the equivalent of <code>ggplot()</code>
in <code>ggplot2</code>) or inside an <code>add_*()</code> function call
(the equivalent of a <code>geom_*</code> call in <code>ggplot2</code>).
However, one can be specified or modified using <code>style()</code>
too.</p>
<p>To update rather than remake our graph, we’ll use the
<code>plotly</code> functions <code>plotlyProxy()</code> and
<code>plotlyProxyInvoke()</code>, which are like
<code>dataTableProxy()</code> and its helper functions like
<code>replaceData()</code>. They are a “package deal;” both are needed
to accomplish the task. Specifically, we’ll use the
<code>"restyle"</code> method inside <code>plotProxyInvoke()</code> to
trigger a re-styling of the graph.</p>
<p>As before, we make a new observer that watches
<code>input$color_scheme</code> and triggers restyling using
<code>plotlyProxy()</code>, leaving <code>renderPlotly({})</code> to
produce only the version of the graph we see on start-up:</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** all your plotly-related code to date in your server.R file!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">###GRAPH OBSERVER (COLOR SCHEME SELECTOR)</span></span>
<span>  <span class="co">#THIS OBSERVER UPDATES THE GRAPH WHEN EVENTS ARE TRIGGERED.</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">color_scheme</span>, <span class="op">{</span></span>
<span></span>
<span>    <span class="co">#WE FIRST DESIGN AN APPROPRIATE COLOR PALETTE FOR THE DATA, GIVEN THE USER'S COLOR SCHEME CHOICE</span></span>
<span>    <span class="va">new_pal</span> <span class="op">=</span> <span class="fu">colorFactor</span><span class="op">(</span>palette <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">color_scheme</span>,</span>
<span>                          domain <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gap2007</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu">plotlyProxy</span><span class="op">(</span><span class="st">"basic_graph"</span>, <span class="va">session</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--WE HAVE TO INCLUDE session HERE TOO.</span></span>
<span>      <span class="fu">plotlyProxyInvoke</span><span class="op">(</span><span class="st">"restyle"</span>, <span class="co">#&lt;-THE TYPE OF CHANGE WE WANT</span></span>
<span>                        <span class="fu">list</span><span class="op">(</span>marker <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>                          color <span class="op">=</span> <span class="fu">new_pal</span><span class="op">(</span><span class="va">gap2007</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span>, <span class="co">#FOR OUR MARKERS, USE THESE NEW COLORS.</span></span>
<span>                          size <span class="op">=</span> <span class="fl">11.3</span> <span class="co">#AND THIS POINT SIZE.</span></span>
<span>      <span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fl">0</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="co">#APPLY THIS CHANGE TO ALL 5 GROUPS OF MARKERS WE HAVE.</span></span>
<span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>The inputs to <code>plotlyProxyInvoke()</code> are a little
complicated, so let’s go over them. The first is the name of a
<strong>method</strong> the proxy should use. Here, we use the
<code>"restyle"</code> method because we want to adjust things the
<code>style()</code> function regulates, such as the graph’s color
scheme. There’s also a <code>"relayout"</code> method for adjusting
things that <code>layout()</code> controls, such as the legend.</p>
<p>The second input is a list of lists—this is where we’re <em>very
nearly</em> writing JavaScript code; if there’s one thing JS loves, it’s
lists! The outermost list contains the aspects of the graph we want to
re-style (here, <code>marker</code>s are the only such thing).</p>
<p>Then, we provide a list to each such aspect—what <em>specific</em>
features do we want to change about that aspect? Here, we’re changing
the <code>color</code>s of our markers, setting them equal to the new
colors we’ve generated using <code>colorFactor()</code> from
<code>leaflet</code>.</p>
<p>However, we also specify point <code>size</code>s. Why? If
<code>plotlyProxy()</code> is asked to redraw our graph’s markers, it’ll
do so “from scratch,” using <code>plotly</code> default values for any
properties we don’t specifically specify. Since our original graph
featured custom-sized points, we need to “override the defaults” to get
the same point sizes after the redraw as we had before it.</p>
<p>The last input to <code>plotlyProxyInvoke()</code> is a set of
<strong>trace numbers</strong>. A <code>plotly</code>
<strong>trace</strong> is one “set” of data being graphed. In our case,
we have five traces, one for each continent, and we’re modifying all
five, so you’d <em>think</em> we’d need to put <code>1:5</code> here.
However, JS starts counting things at 0, not 1 (it’s a “zero-indexed
language,” whereas R is a “one-indexed language”), so we actually need
<code>0:4</code> instead.</p>
<p>You’ll notice that, with this new proxy in place, our points change
colors as we adjust our new selector. However, our lines don’t, and our
legend keys do change but to the wrong colors:</p>
<figure><img src="fig/recoloring.gif" alt="We’ve added a drop-down menu widget that allows users to select a new color palette for our graph. However, not all aspects of the graph change colors like we might expect. For example, the legend keys do change colors, but incorrectly." class="figure mx-auto d-block"><div class="figcaption">We’ve added a drop-down menu widget that allows
users to select a new color palette for our graph. However, not all
aspects of the graph change colors like we might expect. For example,
the legend keys do change colors, but incorrectly.</div>
</figure><p>These <em>are</em> fixable problems, but not without <em>some</em>
grief—in simple terms, the graph conversion performed by
<code>ggplotly()</code> comes with baggage that we’re running into here.
If we really want to allow users to choose our graph’s color palette,
we’d have an easier time if we rebuilt our graph in
<code>plotly</code>.</p>
</div>
<div class="section level3">
<h3 id="point-and-click"><strong>Point and click</strong><a class="anchor" aria-label="anchor" href="#point-and-click"></a></h3>
<p>As with all other widgets, user interactions with <code>plotly</code>
graphs can trigger events.</p>
<p>However, <code>plotly</code> is unusual in that info about events is
<em>not</em> passed from the UI to the server via <code>input</code>.
Instead, <code>plotly</code> has an alternative (but equivalent) system
that uses the functions <code>event_register()</code> to specify which
events to track and <code>event_data()</code> to pass the relevant event
data to the server as a <strong>reactive object</strong>. This
<em>sounds</em> more complicated than what we’re used to, but it’s
really the same idea with differently named parts.</p>
<p>First, let’s create a <code>textOutput()</code> in our UI, beneath
our graph. We will report a message to the user there abiut the point
they’ve clicked that we will build server-side:</p>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the "main panel" cell's content within the BODY section of your ui.R file!</span></span>
<span></span>
<span><span class="co">##... other UI code...</span></span>
<span><span class="co">###MAIN PANEL CELL</span></span>
<span>    <span class="fu">column</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">8</span>, <span class="fu">tabsetPanel</span><span class="op">(</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Table"</span>, <span class="fu">dataTableOutput</span><span class="op">(</span><span class="st">"table1"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map"</span>, <span class="fu">leafletOutput</span><span class="op">(</span><span class="st">"basic_map"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Graph"</span>, </span>
<span>               <span class="fu">plotlyOutput</span><span class="op">(</span><span class="st">"basic_graph"</span><span class="op">)</span>,</span>
<span>               <span class="fu">textOutput</span><span class="op">(</span><span class="st">"point_clicked"</span><span class="op">)</span><span class="op">)</span> <span class="co">#&lt;--ADD TEXTOUTPUT TO UI.</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##... other UI code...</span></span></code></pre>
</div>
<p>Next, let’s “register” with our graph that we want to watch for mouse
click events. At the same time, we’ll give our graph a special attribute
(a <code>source</code>) that is used just to make this system work, sort
of how an <code>inputId</code> is used for tracking event data
normally:</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the ggplotly() call within your global.R file!</span></span>
<span></span>
<span><span class="co">##... other global code...</span></span>
<span><span class="co">###PLOTLY CONVERSION</span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu">ggplotly</span><span class="op">(</span><span class="va">p1</span>,</span>
<span>              tooltip <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>              source <span class="op">=</span> <span class="st">"our_graph"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--A SPECIAL ID JUST FOR THIS SYSTEM.</span></span>
<span>  <span class="fu">style</span><span class="op">(</span>hoverinfo <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">event_register</span><span class="op">(</span><span class="st">"plotly_click"</span><span class="op">)</span> <span class="co">#&lt;--WATCH FOR USER CLICK EVENTS</span></span></code></pre>
</div>
<p>Lastly, let’s create a new observer in our <code>server.R</code> file
to watch for clicks, referencing the <code>source</code> and event type
data we just established. When a user clicks a point in our graph, a
text message will appear telling them the raw population count for that
point, which might be helpful given that we are currently
log-transforming those data:</p>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **added to** the bottom of your server.R file, within the server function!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span>  <span class="co">#WE USE THE event_data() CALL LIKE ANY OTHER REACTIVE OBJECT.</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="fu">event_data</span><span class="op">(</span>event <span class="op">=</span> <span class="st">"plotly_click"</span>,</span>
<span>                          source <span class="op">=</span> <span class="st">"our_graph"</span><span class="op">)</span>, <span class="op">{</span></span>
<span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">point_clicked</span> <span class="op">=</span> <span class="fu">renderText</span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="fu">paste0</span><span class="op">(</span></span>
<span>        <span class="st">"The exact population for this point was: "</span>,</span>
<span>        <span class="fu">prettyNum</span><span class="op">(</span><span class="fu">round</span><span class="op">(</span><span class="fu">exp</span><span class="op">(</span></span>
<span>          <span class="fu">event_data</span><span class="op">(</span>event <span class="op">=</span> <span class="st">"plotly_click"</span>, source <span class="op">=</span> <span class="st">"our_graph"</span><span class="op">)</span><span class="op">$</span><span class="va">x</span></span>
<span>          <span class="op">)</span><span class="op">)</span>, big.mark <span class="op">=</span> <span class="st">","</span><span class="op">)</span> <span class="co">#&lt;--WE CAN ACCESS THE X VALUE OF THE POINT CLICKED THIS WAY.</span></span>
<span>      <span class="op">)</span></span>
<span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>If you run the app at this point and click on any of the points, you
should see something like this:</p>
<figure><img src="fig/textpoints.gif" alt="When users click on specific points, a message appears to give them more detailed population data information." class="figure mx-auto d-block"><div class="figcaption">When users click on specific points, a message
appears to give them more detailed population data information.</div>
</figure><p>In this setup, we aren’t using <code>input</code> like we have
before, but we are creating something equivalent—a single reactive
object that passes one type of event data for one UI component to the
server for use in event handling.</p>
<p>Whenever an event triggers, we use <code>renderText({})</code> and
<code>textOutput()</code> to show the population datum of the point
clicked. This is admittedly not a thrilling use of this functionality,
but it hopefully shows what’s possible, and it could be of value to some
users.</p>
<p>Ultimately, this system of event watching and handling is not
<em>much</em> harder to learn and use than the typical one involving
<code>input</code>; it’s more difficult only in that it’s
<em>different</em>.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>The <code>DT</code>, <code>leaflet</code>, and <code>plotly</code>
packages can be used to produce web-enabled, interactive tables, maps,
and graphs for incorporation into Shiny apps.</li>
<li>Each of the graphics these packages create come with tons of
interactive features. Because some of this functionality might be
confusing or unnecessary for some users or contexts, it’s valuable to
know how to adjust or disable them. It’s better to have only as many
features as are needed and that your users can handle.</li>
<li>The aesthetics of these graphics can be adjusted or customized, but
the specifics of how to do this (and how easy or intuitive it will be)
varies widely.</li>
<li>We should strive to update graphics, changing only the aspects that
need changing, rather than remaking graphics from scratch. This
generally means handling events using observers and proxies rather than
using <code>render*({})</code> functions.</li>
<li>Like with other widgets, user interactions with these graphics can
be tracked by the UI and passed to the server for handling. This passing
happens with the <code>input</code> object for <code>DT</code> and
<code>leaflet</code>, but an equivalent system must be used for
<code>plotly</code>.</li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="shiny_3.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="index.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="shiny_3.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: R Shiny's Core
        </a>
        <a class="chapter-link float-end" href="index.html" rel="next">
          Home
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/umn-dash/r-shiny/edit/main/episodes/shiny_4.Rmd" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/umn-dash/r-shiny/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/umn-dash/r-shiny/" class="external-link">Source</a></p>
				<p><a href="https://github.com/umn-dash/r-shiny/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.7" class="external-link">sandpaper (0.16.7)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.6" class="external-link">pegboard (0.7.6)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.4" class="external-link">varnish (1.0.4)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://umn-dash.github.io/r-shiny/shiny_4.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, r, The Carpentries",
  "name": "Shiny Showstoppers: DTs and Leaflets and Plotlys, Oh My!",
  "creativeWorkStatus": "active",
  "url": "https://umn-dash.github.io/r-shiny/shiny_4.html",
  "identifier": "https://umn-dash.github.io/r-shiny/shiny_4.html",
  "dateCreated": "2024-07-10",
  "dateModified": "2024-10-10",
  "datePublished": "2024-10-10"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

