<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>R Shiny: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css">
<script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="manifest" href="site.webmanifest">
<link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/aio.html';">Instructor View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      R Shiny
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            R Shiny
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  R Shiny
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/aio.html">Instructor View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="shiny_1.html">1. Welcome to the Web!</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="shiny_2.html">2. Building the Ground Floor of a Shiny App</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="shiny_3.html">3. R Shiny's Core Concepts: Rendering, Inputs, and Reactivity</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="shiny_4.html">4. DTs and Leaflets and Plotlys, Oh my!</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-shiny_1"><p>Content from <a href="shiny_1.html">Welcome to the Web!</a></p>
<hr>
<p>Last updated on 2024-08-26 |

        <a href="https://github.com/carpentries/r_shiny_workshop/edit/main/episodes/shiny_1.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How is a website built?</li>
<li>How is building a website using R Shiny similar to/different from
the “usual” way?</li>
<li>What does a website “look like,” under the hood?</li>
<li>What are the most common website “building blocks?”</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Meet the web development languages.</li>
<li>Describe how R Shiny relates to other web development
frameworks.</li>
<li>Picture a typical website’s underlying structure.</li>
<li>List several typical website components.</li>
<li>Establish a working familiarity with HTML and CSS.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p><strong>Important</strong>: This course assumes you have working
knowledge of the R programming language and of the RStudio Integrated
Development Environment (IDE). If either is unfamiliar, you could
struggle with this lesson (although the “normal R code” used is
<em>relatively</em> basic). By contrast, this course assumes
<strong>no</strong> web development experience. If you have some, this
course may be too introductory/simplified to hold your attention, though
you may still find it useful as an overview of the R Shiny
framework.</p>
<section><h2 class="section-heading" id="the-webs-languages">The web’s languages<a class="anchor" aria-label="anchor" href="#the-webs-languages"></a>
</h2>
<hr class="half-width">
<p>R is a <strong>programming language,</strong> <em>a system with which
we direct a computer to do things for us</em>.</p>
<p>Just like a human language, R possesses:</p>
<ul>
<li><p>“Nouns” (<strong>objects</strong> or
<strong>variables</strong>),</p></li>
<li><p>“Verbs” (<strong>functions</strong>),</p></li>
<li><p>“Punctuation” (<strong>operators</strong> like <code>&lt;-</code>
and <code>%&gt;%</code>),</p></li>
<li><p>“Questions” (<strong>logical tests</strong> like
<code>x == 1</code>),</p></li>
<li><p>“Adjectives” (the <strong>types</strong> and
<strong>classes</strong> possessed by <strong>objects</strong>) and
“adverbs” (optional <strong>parameters</strong> of
<strong>functions</strong>), and</p></li>
<li><p>“Grammar/syntax” (<strong>rules</strong> like <code>1a</code>
being an unacceptable <strong>object</strong> name but <code>a1</code>
being valid).</p></li>
</ul>
<p>To have a successful “R conversation,” we must form valid “sentences”
(<strong>commands</strong>) in which we create and manipulate nouns,
subject them to verbs, and follow all the rules, just as we would with a
human language.</p>
<p>R Shiny, meanwhile, is <em>not</em> a programming
language<strong>.</strong> Instead, it (in combination with R) is what a
web developer would call a <strong>framework</strong>: <em>a suite of
tools for building a website</em>. Specifically, it leverages R and its
conventions/grammar/syntax to accomplish that task as opposed to using
other, comparable tools.</p>
<p>To appreciate how R Shiny is distinct from other frameworks, and to
understand how to use it <em>well</em>, we need to understand a few
basic things about “normal” web development:</p>
<ol style="list-style-type: decimal">
<li><p>The <em>languages</em> typically used to build websites, what
each is for, and how each basically works.</p></li>
<li><p>The <em>structure</em> of a typical website (the
“wheres”).</p></li>
<li><p>The typical <em>components</em> (the “whats”) of a
website.</p></li>
</ol>
<p>These will be this lesson’s first set of topics.</p>
</section><section><h2 class="section-heading" id="how-to-weave-the-web">How to weave the web<a class="anchor" aria-label="anchor" href="#how-to-weave-the-web"></a>
</h2>
<hr class="half-width">
<p>To generalize, a website is typically constructed using several
languages, each specializing in a particular role. The most notable of
these are <strong>HTML</strong>, <strong>CSS</strong>, and
<strong>JavaScript</strong> (<strong>JS</strong> for short):</p>
<ul>
<li><p><strong>HTML</strong> <em>structures</em> a website. It’s how web
developers specify <strong>what</strong> elements a user can see and
<strong>where</strong> these go on a page.</p></li>
<li><p><strong>CSS</strong> <em>styles</em> a website. It’s how web
developers specify <strong>how</strong> each element should
<strong>look</strong> (colors, size, borders, fonts,
<em>etc.</em>).</p></li>
<li>
<p><strong>JavaScript</strong> codes a website’s <em>behaviors</em>.
We’ll dissect this further later, but a website is in many ways an
application that runs inside your <strong>browser</strong>
(<em>e.g.</em>, Edge or Safari). Any changes to the website while its
open are likely coded in JS.</p>
<ul>
<li>For example, if a webpage contains a button, and if the button
disappears when pressed (a shift in the site’s HTML), the page turns
green (a shift in the site’s CSS), and some data you provided are sent
to a database (a shift in the app’s relationship with the wider
internet), JS is likely orchestrating all three shifts.</li>
</ul>
</li>
</ul>
<p>Together, HTML, CSS, and JS are the languages most commonly used to
assemble the “<em>front end</em>,” “<em>user interface</em>,” or
“<em>client side</em>” half of a website. A website’s <strong>user
interface</strong> (UI for short) is what a user sees and interacts
with. As far as most users are concerned, the UI <em>is</em> the
website. Most assume a website is just that “one thing” and that the
website lives somewhere “out there,” on the internet, and we just use
our browsers to visit that “other place.”</p>
<p>However, the truth is a <em>bit</em> more complicated! First, yes,
there is <em>always</em> a second “half” to a website, and, in defense
of the average person’s intuition, it is “somewhere else.” Somewhere in
the world, a <em>server</em> (a computer, basically, but more automated
than a personal computer) acts as a website’s <strong>host</strong>,
receiving requests for information and sending that information out to
users. A server might also store private data, such as passwords, or do
complex operations that’d be awkward to have a user’s computer do. It
also may perform security checks to ensure users aren’t trafficking
malware or spam.</p>
<p>For all these purposes and more, websites have “back ends” or “server
sides” that run on a server. Here, the SQL language might be used to
carefully store or read data from large databases, and a whole host of
other programming languages might be used to perform complex operations
and other tasks. These include JS but also PHP, Python, Ruby, and C#,
just to name a few!</p>
<p>When a web developer talks about a framework, they are referring to
the <em>entire</em> set of languages/constructs needed to build both
halves of a website. So, for example, HTML + CSS + JS (front end) + PHP
+ SQL (back end) is a framework.</p>
<p>Now that we know of the two “halves” of a website, we can consider
how a website <em>actually</em> works:</p>
<ol style="list-style-type: decimal">
<li><p>When you “visit” a website by typing its URL into your browser,
your browser sends a request out to a server for permission to “see the
website.”</p></li>
<li><p>The server responds by sending your browser a packet of files (a
bunch of HTML, CSS, and JS files, perhaps).</p></li>
<li><p>These are opened by your browser and deciphered (it’s fluent in
these languages).</p></li>
<li><p>Your browser then builds the website you then see and interact
with per the instructions provided in the files the server sent. The
website is not “out there somewhere;” it’s “alive” and running on
<em>your</em> computer!</p></li>
<li><p>When the website needs “further instructions” for how to behave
in response to your actions or what content to show you next, the
dialogue with the server continues—new requests are sent, and new files
are received and deciphered.</p></li>
</ol>
<div id="discussion1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Discussion</h3>
<div class="callout-content">
<p>Have you ever had to clear your browser’s <strong>cache</strong>?
What do you think gets deleted when you do that?</p>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>A good portion of your cache (in terms of numbers of files, anyway)
will be HTML, CSS, and JS files sent to you by servers to build websites
you’ve visited! However, there will also be image and video files (which
can be <em>very</em> bulky), files for special fonts that website wanted
you to use (perhaps because their logo uses them), and JSON files (text
files that can store data), among others.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level4">
<h4 id="where-r-shiny-sits">Where R Shiny sits<a class="anchor" aria-label="anchor" href="#where-r-shiny-sits"></a>
</h4>
<p>When you build a website using R Shiny, you’ll write (primarily) two
styles of code:</p>
<ul>
<li><p>“Normal” R code, and</p></li>
<li><p>What I’ll call “R-like,” or “R Shiny” code.</p></li>
</ul>
<p>The latter will <em>look</em> a lot like R code (that’s the point!).
However, it won’t <em>remain</em> R code. When a Shiny app is compiled,
its R Shiny code is translated into the equivalent HTML, CSS, and JS
code so a browser can decipher it. This means we can use R Shiny and
it’s “R-like” code to build the <em>entire</em> UI side of a website
<em>without</em> needing to know much, if any*, HTML, CSS, or JS (*sort
of)!</p>
<p>The “normal” R code you’ll write, meanwhile, will largely sit within
your website’s “back end’ (or”server side”), where it may manipulate
data sets, perform operations, generate graphs, etc. You know—typical R
stuff! This means we use R+R Shiny to build the <em>entire</em> server
side of a website <em>without</em> needing to know much, if any, JS,
PHP, Ruby, Python, SQL, etc!</p>
<p>So, the R + R Shiny framework enables us to build both halves of a
fully interactive, complex website without necessarily knowing
<em>any</em> other web development languages or frameworks! In
particular, R admirably takes the place of other, general programming
languages typically used for handling server-side tasks, such as Python
or PHP, <em>especially</em> when those tasks revolve around data
manipulation, management, or display—R excels at all things “data!”</p>
<div id="discussion2" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Discussion</h3>
<div class="callout-content">
<p>Hopefully, you now recognize that websites can be built both with and
without R Shiny. What is <em>different</em> about building a website
using R Shiny, then?</p>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>A few things are different about building a website using R Shiny,
but I think the two most important are:</p>
<ol style="list-style-type: decimal">
<li><p>Whereas writing HTML, CSS, and JS code is often necessary to
build a website’s UI, (deep) knowledge of these languages is
<strong>not</strong> required to build a website using R Shiny. Instead,
you will write R code + R Shiny code, and these get “translated” into
the equivalent HTML, CSS, and JS code for you.<br><br>
Granted, this means you <em>still</em> need to learn how to write “R
Shiny code,” and you may or may not find this code all that
familiar-feeling even though it “looks like” R code. More on that in a
sec…</p></li>
<li><p>Normally, to construct the “back end” of a website, a general
programming language like PHP or Python is used. These languages are
quite different from JS, so designing a conventional website often
requires programming in (at least) two <em>different</em> general
programming languages (<em>e.g.</em>, JS and PHP), at least one of which
you may not have encountered before (JS and PHP are not widely used for
other purposes).<br><br>
With R Shiny, you can code <em>both</em> the front and back ends of a
website using the “look and feel,” at least, of just <em>one</em>
general programming language.</p></li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="lets-meet-html-and-css">Let’s meet HTML and CSS<a class="anchor" aria-label="anchor" href="#lets-meet-html-and-css"></a>
</h2>
<hr class="half-width">
<p>I said above that R Shiny ensures you don’t <em>need</em> to learn
HTML and CSS to build a website. That statement is no lie!</p>
<p>…However, because your R Shiny code must be <em>translated into</em>
HTML/CSS code for a browser to understand it, there is a forced
similarity between the two systems—much of the time, you’ll
<em>really</em> be writing just thinly veiled HTML/CSS code when you’re
writing “Shiny code.” The latter may <em>look</em> “R-like,” but it
won’t always <em>feel</em> “R-like” because of all the ways it will be
beholden to these other two languages.</p>
<p>As such, to build a <em>really</em> nice Shiny app, and to feel like
you know not just <em>what</em> your code is doing but <em>why</em> it
looks the way it does, it’s helpful to understand the basics of HTML and
CSS.</p>
<p>If the prospect of learning <em>two more</em> languages is daunting,
<em>don’t panic</em>! Compared to learning R, learning the basics of
HTML and CSS is <em>much</em> easier; these aren’t <em>general</em>
<em>programming</em> languages like R. They have much narrower purposes,
so they need a lot fewer “words” and “rules” to do their jobs than R
does. Knowing even a <em>little</em> about these two languages goes a
<em>long</em> way, I promise!</p>
<div class="section level3">
<h3 id="html-101">HTML 101<a class="anchor" aria-label="anchor" href="#html-101"></a>
</h3>
<p>We’ll start with HTML, since it’s a website’s foundation. Pretty much
everything an R Shiny developer <strong>really</strong> needs to
understand about HTML falls under four key concepts:</p>
<div class="section level4">
<h4 id="key-concept-1-all-websites-are-boxes-within-boxes">Key concept #1: All websites are “boxes within boxes”<a class="anchor" aria-label="anchor" href="#key-concept-1-all-websites-are-boxes-within-boxes"></a>
</h4>
<p>At its core, every website is just a box containing one or more
additional boxes, each of which might contain <em>yet more</em> boxes,
and so on all the way down. By “box” here, I mean “a container that
holds stuff,” not “a rectangle” (though a <em>lot</em> of website boxes
<em>are</em> rectangles!). <em>All</em> HTML does is tell your browser
which boxes go inside which other boxes and what every box contains.
Besides other boxes, HTML boxes can hold text, pictures, links, menus,
lists, and much more.</p>
<p>In terms of code, every HTML box looks <em>something</em> like
this:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">HTML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode html" tabindex="0"><code class="sourceCode html"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id </span><span class="op">=</span> <span class="st">"my_box"</span><span class="dt">&gt;</span>My box's contents<span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code></pre>
</div>
<p>Thus, (almost) every HTML box has:</p>
<ul>
<li><p>An <strong>opening tag</strong> (<em>e.g.</em>,
<code>&lt;div...&gt;</code>), which tells the browser where the box
“starts.”</p></li>
<li><p>A <strong>closing tag</strong> (<em>e.g.</em>,
<code>&lt;/div&gt;</code>), which tells the browser where a box
“ends.”</p></li>
<li><p>Space for <em>contents</em> (here, that’s the text
<code>My box's contents</code>), found between the opening tag’s
<code>&gt;</code> and the closing tag’s <code>&lt;</code>.</p></li>
<li>
<p>Space inside the opening tag for <em>attributes</em>, which are
<strong>adjectives</strong> that make a box “special.”</p>
<ul>
<li>Here, we gave our box a unique <code>id</code>,
<code>"my_box"</code>, using <code>attribute = "value"</code>
format.</li>
</ul>
</li>
</ul>
<p>In R Shiny, you can build the exact same box using its “R-like
code:”</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">div</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"my box"</span>,</span>
<span>    <span class="st">"My box's contents"</span><span class="op">)</span></span></code></pre>
</div>
<p>Here, we’ve replaced HTML’s <strong>tag notation</strong> involving
<code>&lt;&gt;</code>s with R’s <strong>function notation</strong> and
its <code>( )</code>s, and we specify attributes and box contents using
R’s traditional <strong>function arguments</strong> instead.</p>
<p>Importantly, as I said above, one thing every HTML box can contain is
one or more additional HTML boxes. In fact, most websites contain nested
layers of boxes, each with their own unique properties, that go many,
many layers deep:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">div</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"my box"</span>,</span>
<span>    <span class="fu">div</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"layer2"</span>, </span>
<span>        <span class="fu">div</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"layer3"</span>, <span class="va">...</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>It’s through this nesting of boxes that the complex visual structure
of a typical website is born.</p>
<div class="exercise">
<p>Below is some HTML code containing some (nested) HTML boxes. Rewrite
the code below in R Shiny UI code instead using the <code>div()</code>
function:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">HTML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode html" tabindex="0"><code class="sourceCode html"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> id</span><span class="op">=</span><span class="st">"main-container"</span><span class="ot"> class</span><span class="op">=</span><span class="st">"container"</span><span class="dt">&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">"content"</span><span class="dt">&gt;</span>Welcome to our app!<span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code></pre>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>The above code contains one outer HTML box with both an
<code>id</code> attribute and a <code>class</code> attribute. R Shiny
has equivalent <strong>function parameters</strong> for those two
attributes in its <code>div()</code> function:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">div</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"main-container"</span>,</span>
<span>    class <span class="op">=</span> <span class="st">"container"</span>,</span>
<span>    <span class="co">#...contents go here.</span></span>
<span>    <span class="op">)</span></span></code></pre>
</div>
<p>In this example, this outer <code>div</code>’s contents are another
<code>div</code>, which itself has a class and some text contents:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">div</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"main-container"</span>,</span>
<span>    class <span class="op">=</span> <span class="st">"container"</span>,</span>
<span>    <span class="fu">div</span><span class="op">(</span>class <span class="op">=</span> <span class="st">"content"</span>,</span>
<span>        <span class="st">"Welcome to our app!"</span><span class="op">)</span> <span class="co">#Text strings need to be quoted in R even though they don't in HTML.</span></span>
<span>    <span class="op">)</span></span></code></pre>
</div>
<p>While nesting many function calls inside one another is not an
uncommon practice among everyday R users, it’s certainly not universal,
but it’s essential to coding in HTML, so some find the amount of nesting
found in R Shiny UI code to be unfamiliar.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level4">
<h4 id="key-concept-2-websites-have-heads-and-bodies">Key concept #2: Websites have heads and bodies<a class="anchor" aria-label="anchor" href="#key-concept-2-websites-have-heads-and-bodies"></a>
</h4>
<p>To oversimplify, every website is an HTML box
(<code>&lt;HTML&gt;...&lt;/HTML&gt;</code>) containing two smaller
boxes: a “head” (<code>&lt;head&gt;...&lt;/head&gt;</code>) and a “body”
(<code>&lt;body&gt;...&lt;/body&gt;</code>).</p>
<p>The head’s contents are (mostly) invisible to users; the head
contains instructions for <em>how</em> the browser should construct the
website. The body box, meanwhile, contains everything the user can see
and interact with.</p>
<p>In R Shiny, we don’t need to build the HTML, head, or body
boxes—those are made for us. Instead, we’d spend most of our time
specifying only the stuff that goes inside the body box.</p>
<p>However, we can (and sometimes need to) put things in the head box to
provide our users’ browsers with more guidance. This is done using the R
Shiny <code>tags$head()</code> function:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>tags<span class="sc">$</span><span class="fu">head</span>(<span class="co">#Instructions for the user's browser go here...)</span></span></code></pre>
</div>
</div>
<div class="section level4">
<h4 id="key-concept-3-html-boxes-are-either-inline-or-block">Key concept #3: HTML boxes are either inline or block<a class="anchor" aria-label="anchor" href="#key-concept-3-html-boxes-are-either-inline-or-block"></a>
</h4>
<p>Broadly, there are two kinds of HTML boxes: <strong>inline</strong>
and <strong>block</strong>. The difference is how each is displayed when
a website is built.</p>
<p>A <strong>block element</strong> takes up the <em>entire</em>
horizontal “row” it is placed on. In other words, it’ll occupy the
<em>entire</em> width of the browser window (if allowed), and it’ll
force the next item to go <em>below</em> rather than <em>next</em> to
it, as though the browser was forced to hit the “Enter” key.</p>
<p>For example, the <code>&lt;p&gt;...&lt;/p&gt;</code> element (created
in Shiny using the <code>p()</code> R Shiny function) creates
“paragraph” boxes (or, more accurately, boxes for text blocks, which can
any amount of text). If you put several consecutive paragraph boxes
inside your body box, they would display in a column, with the first at
the top and the last at the bottom, and each would occupy the full width
of the box that contains them:</p>
<figure><img src="fig/clipboard-3243983914.png" class="figure mx-auto d-block"></figure><p><strong>Inline elements</strong>, meanwhile, only take up as much
horizontal space as they have to (by default) to accommodate their
contents’ size, and thus they go next to each other on the same line (if
there’s room); they don’t <em>force</em> new lines.</p>
<p>For example, the <code>&lt;a&gt;...&lt;/a&gt;</code> element (made in
R using the <code>a()</code> R Shiny function) is a box that holds a
link to a URL or file. You could use several such boxes within a single
paragraph box <em>without</em> spawning a new line after each one.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">HTML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode html" tabindex="0"><code class="sourceCode html"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co">&lt;!-- HERE'S HOW YOU'D RECREATE THE IMAGE ABOVE IN HTML --&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">h1</span><span class="dt">&gt;</span>Block-level<span class="dt">&lt;/</span><span class="kw">h1</span><span class="dt">&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;</span>This is a paragraph.<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;</span>This is another paragraph.<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;</span>Paragraphs are block elements, so they stack vertically.<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">h1</span><span class="dt">&gt;</span>Inline<span class="dt">&lt;/</span><span class="kw">h1</span><span class="dt">&gt;</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">a</span><span class="dt">&gt;</span>Links are<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">a</span><span class="dt">&gt;</span>Inline elements,<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">a</span><span class="dt">&gt;</span>so they fit side-by-side.<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#And here's the exact same code, only written in R Shiny code instead:</span></span>
<span><span class="fu">div</span><span class="op">(</span></span>
<span>  <span class="fu">h1</span><span class="op">(</span><span class="st">"Block-level"</span><span class="op">)</span>,</span>
<span>  <span class="fu">p</span><span class="op">(</span><span class="st">"This is a paragraph."</span><span class="op">)</span>,</span>
<span>  <span class="fu">p</span><span class="op">(</span><span class="st">"This is another paragraph."</span><span class="op">)</span>,</span>
<span>  <span class="fu">p</span><span class="op">(</span><span class="st">"Paragraphs are block elements, so they stack vertically."</span><span class="op">)</span>,</span>
<span>  <span class="fu">h1</span><span class="op">(</span><span class="st">"Inline"</span><span class="op">)</span>,</span>
<span>  <span class="fu">a</span><span class="op">(</span><span class="st">"Links are"</span><span class="op">)</span>,</span>
<span>  <span class="fu">a</span><span class="op">(</span><span class="st">"Inline elements,"</span><span class="op">)</span>,</span>
<span>  <span class="fu">a</span><span class="op">(</span><span class="st">"so they fit side-by-side"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Note that text contents are quoted. Note also that commas separate every UI element from the next. </span></span>
<span></span>
<span><span class="co">#Lastly, note that the line breaks between elements here (and in the HTML code above) are irrelevant with respect to the code's effects--paragraph and heading boxes would still stack vertically without them, and links still will fit side-by-side with them.</span></span></code></pre>
</div>
<p>This dichotomy means every element of every website falls into one of
two aesthetic camps. Certain elements tend to “stand alone” or “stand
apart” from others visually and logically, such as headings and
navigation bars. These are generally block elements. Other elements “fit
together” and “co-mingle,” such as links and images. These are generally
inline elements.</p>
</div>
<div class="section level4">
<h4 id="key-concept-4-the-flow">Key concept #4: The Flow<a class="anchor" aria-label="anchor" href="#key-concept-4-the-flow"></a>
</h4>
<p>These days, a user might view your website on a very <em>wide</em>
screen (like that of a projector) or a very <em>narrow</em> screen (like
that of a cell phone in portrait mode, or even the screen of a smart
watch!).</p>
<p>If your website has, say, five elements, it may not make sense to
<em>arrange</em> those elements the same way on a narrow screen as on a
wide screen, just as you probably wouldn’t arrange the same furniture in
a tiny room the same as you would in a huge room.</p>
<p>Careless arrangement of elements is often <em>obvious</em> to even
casual web surfers. On narrow screens, elements that are too big might
“spill” out of the containers meant to hold them, and when too many
elements are stacked side by side, tedious scroll bars may be the only
way to see elements that are otherwise obviously extending
“off-screen.”</p>
<p>On wide screens, meanwhile, small elements (especially small block
elements) may look silly without constraints, such as when a single
sentence spans the entire width of the screen. As another example, font
sizes that feel appropriate on a small screen might be far too big or
small when viewed on a computer monitor.</p>
<p>It’s hard <em>enough</em> to craft <em>one</em> great website—it’d be
a <em>nightmare</em> to design a different-looking website for
<em>every</em> <em>possible</em> screen size your users might have!</p>
<p>Thankfully, then, most websites are designed to follow some paradigm
of “flow.” This means they’ll semi-automatically reorganize their
contents according to the size of the user’s screen. For example:</p>
<ul>
<li><p>Elements that sit side by side on a wide screen shift to stack
vertically.</p></li>
<li><p>Elements (such as images) that might be permitted to stay large
for wide screens may shrink to fit comfortably inside their boxes on
narrow screens.</p></li>
<li><p>Some elements may “teleport” to new locations on the page as a
screen narrows such that, if all elements are arranged vertically, their
order is more logical to a user encountering them in that way.</p></li>
</ul>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Try it: Go to <a href="www.dictionary.com" title='A link to dictionary.com, a good site for demonstrating the HTML concept of the "flow."'>dictionary.com</a>
and vary the width of your browser window by pulling its edges inward.
How does this website “flow?”</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>For me, I saw a number of changes as I shrunk my browser screen: The
menu at the top became a collapsed “hamburger” menu (a button with three
lines that opens to reveal options), the links section slid below the
search bar, the word of the day box shrank to take up less room, and the
games sidebar teleported to much further down on the page. You may have
noticed many other changes!</p>
</div>
</div>
</div>
</div>
<p>In line with this, R Shiny comes with custom boxes that are “fluid,”
meaning their size is flexible and changes automatically to fit the size
of their contents. Like inline elements, these boxes will only take up
as much space as necessary. However, their contents will also
automatically stack vertically if the screen becomes too narrow, sort of
like block elements. Additionally, these boxes includes ones that will
divide a space into a table of “rows” and “columns” so that elements can
be arranged in a grid-like fashion whenever the screen is wide enough to
accommodate it:</p>
<figure><img src="fig/clipboard-3147076736.png" class="figure mx-auto d-block"></figure><p>The first step of building a great Shiny app is to plot out your
app’s <em>layout</em>. What elements should exist, and where should they
go? How big does each need to be? What kinds of devices will your users
be on? How will elements be nested to achieve a pleasing “flow” of
elements, no matter the device your user is using? It’s important to
remember that your app may not be able to look the exact same for every
user and to design it with that in mind!</p>
</div>
</div>
<div class="section level3">
<h3 id="css-101">CSS 101<a class="anchor" aria-label="anchor" href="#css-101"></a>
</h3>
<p>If HTML tells a browser <strong>what</strong> to display and
<strong>where</strong> to display it, then CSS tells a browser
<strong>how</strong> to display things.</p>
<p>Compared to HTML, CSS is even easier to learn (at least, that’s my
opinion!). CSS code consists of functional units called
<strong>rules</strong>. Each rule consists of a
<strong>selector</strong> and a list of one or more
<strong>property-value</strong> pairs:</p>
<ul>
<li><p>The <strong>selector</strong> tells the browser which box(es) to
adjust the appearance of.</p></li>
<li><p>The <strong>properties</strong> tell the browser which
characteristics of those boxes to change.</p></li>
<li><p>The <strong>values</strong> tell the browser the new values to
set for each of those characteristics.</p></li>
</ul>
<p>Here is an example <strong>CSS rule</strong>:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">CSS<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode css" tabindex="0"><code class="sourceCode css"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>p<span class="fu">.intro</span><span class="op">,</span> div<span class="pp">#firstintro</span> {</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="kw">font-style</span><span class="ch">:</span> <span class="dv">italic</span><span class="op">;</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="kw">font-size</span><span class="ch">:</span> <span class="dv">large</span><span class="op">;</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>} </span></code></pre>
</div>
<p>On the first line prior to the opening brace, <code>{</code>, we have
our <strong>selector</strong>, which here is targeting two different
groups of boxes simultaneously, with those two targets separated with a
comma:</p>
<ol style="list-style-type: decimal">
<li><p>The first target is paragraph boxes (<code>p()</code>s), but
<em>only</em> those with the <code>intro</code> <strong>class</strong>
<strong>attribute</strong>. A <strong>class</strong> is actually an HTML
<strong><em>attribute</em></strong> that allows many boxes to be
controlled and styled as one group. A period connects an HTML element
type with a <strong>class</strong> name in a CSS selector
(<em>e.g.</em>, <code>p.intro</code>).</p></li>
<li>
<p>Our second target is <code>div</code>s (a highly generic HTML
box), but <em>only</em> the one with the <strong>id</strong>
<strong>attribute</strong> of <code>firstintro</code>. <code>id</code>s
allow us to control or style just a specific element. A hashtag connects
an HTML element type with an <code>id</code> name in a CSS selector
(<em>e.g.</em>, <code>div#firstintro</code>).</p>
<ul>
<li><p>To target <em>all</em> elements of a type (<em>e.g.</em>, all
<code>div()</code>s), write only the element name without any periods or
hashtags (<em>e.g.</em>, <code>div</code>)</p></li>
<li><p>If multiple different element types (such as <code>div</code>s
and <code>p</code>s) have the same class, you can omit an element type
and just specify the class to target all those elements with the same
CSS rule (<em>e.g.</em>, <code>.intro</code>).</p></li>
</ul>
</li>
</ol>
<p>Inside of our rule’s braces, meanwhile, we have a list. Each list
item is a <strong>property name</strong> (<em>e.g.</em>,
<code>font-style</code>) and a new <strong>value</strong>
(<em>e.g.</em>, <code>italic</code>) to set for that property. These are
separated with a colon and end with a semi-colon. If you get the
punctuation or spelling of a CSS rule wrong (easy to do!), it won’t do
anything, so mind the rules carefully!</p>
<p>CSS rules get more complex than this one, but they can be simpler
than this one too, so if this rule makes sense to you, you’re in great
shape!</p>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Try it: W3Schools is a <em>fantastic</em> resource for learning HTML
and CSS. <a href="https://www.w3schools.com/css/default.asp" title="W3Schools is a great resource for learning HTML and CSS; check out their CSS tutorial" class="external-link">Go
to their CSS page and check out some of the tutorial pages on the
left-hand side.</a></p>
<p>Using the “CSS Text” tutorial, write a CSS rule that would change the
font color of all paragraph boxes to red and make all their text be
center-aligned.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<p>Here’s how you’d write this rule:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">CSS<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode css" tabindex="0"><code class="sourceCode css"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>p {</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="kw">color</span><span class="ch">:</span> <span class="cn">red</span><span class="op">;</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="kw">text-align</span><span class="ch">:</span> <span class="dv">center</span><span class="op">;</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>}</span></code></pre>
</div>
<p>Notice that we can target <em>all</em> <code>p</code> elements by not
appending any classes or ids. Don’t forget your colons, braces, commas
(if needed), or semi-colons! Also, notice that, unlike in R, text values
in CSS (like “red” and “center”) <em>aren’t</em>
<strong>quoted</strong>.</p>
</div>
</div>
</div>
</div>
<p>If you’re thinking “This sounds complicated/tedious/off-topic! Why
are we bothering to learn any CSS, when R is going to translate my Shiny
code to CSS for me??”</p>
<p>That’s a good and fair question! The truth is that, unfortunately,
understanding CSS to some degree is still <strong>essential</strong> for
crafting an <em>attractive</em> R Shiny app. Without specifying your own
CSS, you’ll need to:</p>
<ol style="list-style-type: decimal">
<li><p>Accept the <em>very</em> basic styling employed by R Shiny by
default, or</p></li>
<li><p>Use generic-looking themes available from packages like
<code>bslib</code> that might leave your app looking like “every other
website” in ways that can be difficult to customize.</p></li>
</ol>
<p>Don’t get me wrong—these are perfectly acceptable options <em>if</em>
your apps are simple or have limited user bases that may be indifferent
to looks. However, in my experience, even in those instances, neither
option is <em>nearly</em> as satisfying as learning to style your app
yourself, even if you’re not a design whiz!</p>
<p>So, while we won’t pause to style our app much in this series of
lessons, we will do so occasionally so that you can see the difference
it makes.</p>
</div>
</section><section><h2 class="section-heading" id="nothing-is-new-on-the-web">Nothing is new on the web<a class="anchor" aria-label="anchor" href="#nothing-is-new-on-the-web"></a>
</h2>
<hr class="half-width">
<p>We’ve talked about how a website is built, and we’ve looked at the
specific roles played by HTML and CSS in that process. In particular,
we’ve discussed the concept of HTML boxes and how a website is just a
series of these boxes, stacked next to, below, and inside each other.
Then, we’ve seen that the style of those boxes and their contents can be
customized using CSS.</p>
<p>But what typically goes <strong><em>inside</em></strong> all those
boxes, besides other boxes?!</p>
<p>With the internet now over 30 years old, most people have been
interacting with the web a <em>long time</em>! We’ve developed
collective expectations for how websites should look and feel as a
result and, as such, most websites contain a set of
immediately-recognizable components, including:</p>
<ul>
<li><p>A <strong>header</strong> (a box permanently hooked to the top of
the screen/page or to the top of a page section). This could contain
other elements like a title, a logo, a navigation menu,
<em>etc.</em></p></li>
<li><p>A <strong>footer</strong> (similar to a header but at the bottom
of a screen/page/section). This might contain elements such as text
boxes for contact info or legal information, links, disclaimers, version
information, <em>etc.</em></p></li>
<li><p>A “main content area,” which might be a single rectangle or
multiple rectangles of (un)equal size (such as a smaller “sidebar” and a
larger “main panel”). This area may contain blocks of text, media such
as videos, articles, graphics, <em>etc.</em></p></li>
<li><p>Text blocks, which might themselves contain paragraph blocks,
links, quotes, code, articles, lists, headings, etc.</p></li>
<li><p><strong>Forms</strong> containing information-gathering
<strong>widgets</strong>—elements users interact with to provide the
page with information or direction, such as drop-down menus or
sliders.</p></li>
<li><p><strong>Modals</strong> (which you may know as “pop-ups”), which
partially or wholly obscure the webpage and may contain additional
information, options, or alerts.</p></li>
<li><p>Background tiles, which may hold images or instead be solid
colors, gradients, or patterns.</p></li>
<li><p>Navigation systems, such as buttons, scroll bars, or drop-down
menus, that allow users to move around a site.</p></li>
</ul>
<p>All these elements (and more!) can be added to the websites designed
using R Shiny. As such, some of the first, and most important, decisions
you’ll make when building a Shiny app are deciding:</p>
<ol style="list-style-type: decimal">
<li><p><em>What</em> elements your app will contain,</p></li>
<li><p><em>Where</em> they will go, and</p></li>
<li><p>What they’ll enable a user to <em>do</em>.</p></li>
</ol>
<p>While the list above is not exhaustive, it should help you begin to
make those decisions.</p>
<div id="challenge3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Consider the webpage below:</p>
<figure><img src="fig/clipboard-1560346890.png" class="figure mx-auto d-block"></figure><p>Like all webpages, this one is just a series of “boxes inside of
other boxes.” Draw an abstracted version of this site as only a set of
nested boxes. Label each box based on what it seems designed to hold
(don’t bother drawing <em>every</em> box, just the “major” ones).</p>
<p>As you do, list the different components housed in these boxes you
recognize (buttons, text blocks, etc.).</p>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6"> Show me the solution </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" aria-labelledby="headingSolution6" data-bs-parent="#accordionSolution6">
<div class="accordion-body">
<p>Here’s what I noticed and identified:</p>
<figure><img src="fig/clipboard-2886539574.png" class="figure mx-auto d-block"></figure><p>You may have noticed more, fewer, or different things—that’s ok!</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Classically, websites are built using HTML, CSS, and JavaScript to
construct the “client side” of the site, which runs in a user’s browser
on their local computer, and by using SQL plus a general programming
language like Python to construct the “server side” of the website,
which runs remotely on a server that communicates back and forth with
the user’s browser to ensure the site is constructed and displayed to
the user as intended.</li>
<li>R Shiny allows you to build a website using just R + R Shiny code,
such that deep understanding of other web development languages like PHP
and JavaScript is not required.</li>
<li>However, some familiarity with HTML and CSS is practically essential
to build a great app and to really understand what you are doing when
writing “R Shiny” code.</li>
<li>That’s ok—HTML and CSS are very approachable languages compared to
general programming languages like R.</li>
<li>HTML tells a browser what to put where when building a website.
Websites are just “HTML boxes holding stuff and/or other boxes.” Some
boxes force new lines after them; others don’t. How boxes will “flow” on
wide versus narrow screens is an important design consideration.</li>
<li>CSS tells a browser how to display each element on a website. It
consists of <strong>rules</strong> targeting specific HTML boxes that
specify new <strong>values</strong> for those boxes’ aesthetic
<strong>properties</strong>.</li>
<li>Website design has matured such that most websites look and feel
broadly similar and share many elements, such as buttons, links,
<strong>widgets</strong>, articles, media, and so on. R Shiny lets us
add these same elements to our apps.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-shiny_2"><p>Content from <a href="shiny_2.html">Building the Ground Floor of a Shiny App</a></p>
<hr>
<p>Last updated on 2024-08-20 |

        <a href="https://github.com/carpentries/r_shiny_workshop/edit/main/episodes/shiny_2.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How should I start building a Shiny app?</li>
<li>What code’s required to get a Shiny app to start?</li>
<li>What goes in my <code>server.R</code> file? My <code>ui.R</code>
file? My <code>global.R</code> file?</li>
<li>How do I design an app that’ll look nice on any device?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Build the files and folders needed to house a Shiny app and name
them according to Shiny’s conventions.</li>
<li>Value the convenience afforded by a <code>global.R</code> file.</li>
<li>Link a <strong>stylesheet</strong> to your app.</li>
<li>Structure your app’s UI in its <code>ui.R</code> file by nesting
(Shiny) HTML boxes, as you might more or less do using HTML code.</li>
<li>Use your browser’s <strong>developer tools</strong> to examine and
troubleshoot your app’s HTML and CSS.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="preface">Preface<a class="anchor" aria-label="anchor" href="#preface"></a>
</h3>
<p>In the next lesson, we’ll start building a Shiny app together. In
this lesson, we’ll tackle several important steps that’ll set us up for
success in that endeavor.</p>
</div>
<div class="section level3">
<h3 id="installing-packages">Installing packages<a class="anchor" aria-label="anchor" href="#installing-packages"></a>
</h3>
<p>In this lesson, we’ll begin to use some of R’s
<strong>packages</strong>. If you haven’t already, install those now
using the following command:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##RUN THIS CODE IN YOUR CONSOLE PANE--**DON'T** INCLUDE IT INSIDE YOUR SHINY FILES. YOU ONLY NEED TO INSTALL PACKAGES **ONCE**.</span></span>
<span><span class="fu">install.packages</span><span class="op">(</span><span class="st">"shiny"</span>, <span class="st">"dplyr"</span>, <span class="st">"ggplot2"</span>, <span class="st">"leaflet"</span>, <span class="st">"DT"</span>, <span class="st">"plotly"</span>, <span class="st">"gapminder"</span>, <span class="st">"countrycode"</span>, <span class="st">"sf"</span><span class="op">)</span></span></code></pre>
</div>
<p><code>dplyr</code> and <code>ggplot2</code> are part of the
<code>tidyverse</code>, which can be installed using
<code>install.packages('tidyverse')</code>. However, that installation
takes awhile, and we won’t use other <code>tidyverse</code> packages in
these lessons, so it’s faster to install just these two packages for now
if you’re in a hurry.</p>
<p>Of course, to access their features, we need to turn all these
packages on too, but there are some other things we must do first.</p>
</div>
<section><h2 class="section-heading" id="establishing-our-shiny-apps-project-folder">Establishing our Shiny app’s Project Folder<a class="anchor" aria-label="anchor" href="#establishing-our-shiny-apps-project-folder"></a>
</h2>
<hr class="half-width">
<p>It’s useful to make a single folder (our “<strong>root
directory,</strong>” or <strong>root</strong> for short) to house all
our app’s files and then make that folder an <strong>R Project
folder</strong>. You don’t need to know what all that means if you don’t
already—just know it’s valuable.</p>
<p>Here’s how to do it:</p>
<ol style="list-style-type: decimal">
<li><p>In RStudio, go to <code>File</code>, then select the second
option, <code>New Project</code>.</p></li>
<li><p>In the pop-up that appears, select the first option,
<code>New Directory</code>.</p></li>
<li><p>Next, we’ll select the type of project we’re creating. One of the
options you’ll be presented is <code>Shiny application</code>, <em>but
don’t pick that one</em>! Instead, select the <em>first</em> option,
<code>New Project</code>.</p></li>
<li>
<p>On the next screen, use the <code>Browse</code> button to find a
location on your computer to place your project folder. Then, give the
project a name related to your app.</p>
<ul>
<li>There are other options on this screen that, if you’re familiar with
Git or <code>renv</code>, you might consider as well (both are
recommended but outside the scope of these lessons).</li>
</ul>
</li>
<li><p>Once you’re satisfied, click
<code>Create Project</code>.</p></li>
</ol>
<p><strong>Important</strong>: Once you’ve created your Project, you
should see a <code>.Rproj</code> file appear inside that folder. From
now on, to work on your Shiny app, launch this file to start an RStudio
session connected to your Project. Doing so will save you time and
energy!</p>
</section><section><h2 class="section-heading" id="creating-the-necessary-files">Creating the necessary files<a class="anchor" aria-label="anchor" href="#creating-the-necessary-files"></a>
</h2>
<hr class="half-width">
<p>I recommend building Shiny apps using the so-called
<strong>three-file system</strong>:</p>
<ul>
<li><p>Go to <code>File</code>, select <code>New File</code>, then
select <code>R Script</code>. Repeat this process two more times to
create three <strong>scripts</strong> in total.</p></li>
<li>
<p>Then, give them these <em>exact</em> names (in all
lowercase):</p>
<ul>
<li><p><code>ui.R</code></p></li>
<li><p><code>server.R</code></p></li>
<li><p><code>global.R</code></p></li>
</ul>
</li>
</ul>
<p>These files will hold our app’s client side (<strong>user
interface</strong>) code, back-end (<strong>server</strong>) code, and
setup code, respectively.</p>
<p>R Shiny will recognize these exact names as “special,” so using them
enables handy features. One of these is that, in the top-right corner of
the Script Pane, you should see a “Run App” button with a green play
arrow whenever you are viewing any of these three files in the Script
Pane.</p>
<figure><img src="fig/clipboard-2238956949.png" class="figure mx-auto d-block"></figure><p>This button will allow you to start your app at any time to check it
out or test it (something you should do <em>constantly</em>, both during
these lessons and when developing your real apps!).</p>
<p>We need to start populating these three files with essential code,
but before we do, let’s first create some more folders and files every R
Shiny project should have:</p>
<ul>
<li>
<p>In the “Files, Plots, Packages, etc.” Pane in your RStudio
window, while viewing your Project Folder, click the
<code>New Folder</code> button. Name it <em>exactly</em>
<code>www</code>. R Shiny will automatically look inside a folder by
this name in your root directory for many things, including media files
(like images), custom font files, and CSS files referenced by your
app.</p>
<ul>
<li><p>Speaking of which: Click <code>File</code>,
<code>New File</code>, then <code>CSS file</code>. Give this new file
the name <code>styles.css</code> and save it in your <code>www</code>
folder. We’ll put custom CSS code in this file to style our app’s
aesthetics.</p></li>
<li><p>If you plan to build complex Shiny apps, you <em>may</em> also
want to create a file for custom JavaScript code called
<code>behaviors.js</code> and place this file in <code>www</code> as
well. We won’t use such a file in these lessons, but because there is
more you can do using JS than R Shiny will easily do for you, there are
many instances where a <em>little</em> custom JS code can
<em>significantly</em> enhance your app’s behaviors, and having a
specific file in which to put that code is tidy.</p></li>
</ul>
</li>
<li><p>Next, create a second new folder inside your Project Folder. Call
it <code>inputs</code>. Use this folder to store input files your app
needs to start up, like data sets, that <em>aren’t</em> media like
pictures or fonts. We won’t use such a sub-folder in these lessons, but,
for real projects, it useful to have such a folder to stay
organized.</p></li>
<li><p>Similarly, create a third new folder inside your Project Folder.
Call it <code>Rcode</code>. As an app’s code base gets larger, you may
want to divide your app’s code into smaller, more managable chunks (such
as by building custom functions to perform repeated tasks or by dividing
your app’s code into “modules”). At that stage, you can place R files
for each chunk in this folder, then source those files in your
<code>global.R</code> file. We won’t use any such sub-folder, but I use
one for all my apps.</p></li>
</ul>
<p>We now have all the files and folders we’ll need, so let’s work on
getting our app to where it’ll actually start up.</p>
<div class="section level3">
<h3 id="starting-our-global-r-file">Starting our global.R file<a class="anchor" aria-label="anchor" href="#starting-our-global-r-file"></a>
</h3>
<p>We’ll start with <code>global.R</code>. R will run this file
<em>first</em> when booting your app, so it’s job is to load and/or
build everything needed to enable the rest of the app to boot
successfully.</p>
<p>When your app gets large and complex, this file will hold many
different things. To start, though, at a minimum, it’ll likely contain
two: 1) <code>library()</code> calls to load required add-on packages
and 2) <code>read*()</code> calls to load required data sets:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Place this code in your global.R file!</span></span>
<span></span>
<span><span class="co">### LOAD PACKAGES &lt;--CREATE HEADERS IN YOUR FILES TO KEEP LIKE CODE TOGETHER AND TO STAY ORGANIZED!</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">shiny</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">plotly</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">DT</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">leaflet</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">gapminder</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">sf</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">countrycode</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### LOAD DATA SETS </span></span>
<span><span class="va">gap</span> <span class="op">=</span> <span class="va">gapminder</span></span>
<span><span class="co">#THESE LINES WILL HELP US MUCH LATER.</span></span>
<span><span class="va">gap</span><span class="op">$</span><span class="va">country</span> <span class="op">=</span> <span class="fu">as.character</span><span class="op">(</span><span class="va">gap</span><span class="op">$</span><span class="va">country</span><span class="op">)</span></span>
<span><span class="va">gap</span><span class="op">$</span><span class="va">continent</span> <span class="op">=</span> <span class="fu">as.character</span><span class="op">(</span><span class="va">gap</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span></span></code></pre>
</div>
<p>By having a <code>global.R</code> file, we can place things like
<code>library()</code> calls and code for loading data sets in a single
place for the entire app. Without it, we’d need to place these commands
inside <em>every</em> app file in which they are needed—what a pain!</p>
</div>
</section><section><h2 class="section-heading" id="starting-our-server-r-file">Starting our server.R file<a class="anchor" aria-label="anchor" href="#starting-our-server-r-file"></a>
</h2>
<hr class="half-width">
<p>Setting up <code>server.R</code> is <em>relatively</em> easy because
there’s only one block of code needed there to start:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Place this code in your server.R file!</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co">#ALL OUR EVENTUAL SERVER-SIDE CODE WILL GO INSIDE HERE.</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre>
</div>
<p><strong>Notice:</strong> <code>server.R</code> will hold just one
<strong>object</strong>: a <strong>function</strong> called
<em>exactly</em> <code>server</code>. This function will have three
<strong>parameters</strong> called <em>exactly</em> <code>input</code>,
<code>output</code>, and <code>session</code>. R Shiny will look for the
function by this name when it starts an app, and it’ll create objects
called <code>input</code>, <code>output</code>, and <code>session</code>
to feed to that function as inputs during the start-up process. Using
these <em>exact</em> names is <em>mandatory</em>!</p>
<p>It makes sense, if you think about it, that our app’s server file
creates a <strong>function</strong> (a verb) because it’s the “half” of
the app that <em>does stuff</em>. By contrast, the <strong>UI</strong>
of our app mostly <em>“sits there and looks pretty”</em> for the user,
only changing in really profound ways when directed by the server.</p>
</section><section><h2 class="section-heading" id="starting-our-ui-r-file">Starting our ui.R file<a class="anchor" aria-label="anchor" href="#starting-our-ui-r-file"></a>
</h2>
<hr class="half-width">
<p>Even less code is <em>needed</em> in <code>ui.R</code> to start
with—we need to place just a single HTML box into it, into which we’ll
eventually place all other such boxes we’ll build:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Place this code in your ui.R file!</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">=</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="co">#ALL OUR EVENTUAL CLIENT-SIDE CODE WILL GO INTO ONE OF THE TWO SECTIONS BELOW INSIDE OF THIS OUTERMOST SHINY HTML BOX.</span></span>
<span>  </span>
<span>  <span class="co">### HEAD SECTION</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="co">### BODY SECTION</span></span>
<span>  </span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>Here, we use an R Shiny HTML box called <code>fluidPage()</code> to
create a stretchy box that will hold the entirety of the webpage we’ll
build. We’ll soon fill this box with a bunch more boxes to give our app
it’s ultimate structure.</p>
<p>However, first, let’s link up our app’s <strong>stylesheet</strong>,
the <code>styles.css</code> file we made earlier. Because the UI is the
“visual” part of a website, and because CSS controls a website’s looks,
it makes sense we’d load a CSS file in <code>ui.R</code> instead of in
<code>global.R</code> or somewhere else. It also makes sense we’d put
this linkage in our app’s <code>head</code> HTML box because it’s
instructions for a user’s browser to consider, not something a user
themselves needs to see.</p>
<p>Here’s how to do this:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="do">##Place this code INSIDE your app's fluidPage container in the HEAD sub-section!</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>tags<span class="sc">$</span><span class="fu">head</span>(</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  </span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  tags<span class="sc">$</span><span class="fu">link</span>(<span class="at">href =</span> <span class="st">"styles.css"</span>, </span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>            <span class="at">rel =</span> <span class="st">"stylesheet"</span>) </span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>), <span class="co">#&lt;--YOU'LL NEED A COMMA TO SEPARATE EVERY NEW ELEMENT IN YOUR UI FROM THE PREVIOUS/NEXT ONE, SO YOU WILL SOON NEED A COMMA HERE, WHETHER YOU ADD IT NOW OR NOT.</span></span></code></pre>
</div>
<p>Here, we’ve told the app there is a specific <em>stylesheet</em>, a
CSS file, by the name of <code>styles.css</code> we want a user’s
browser to use when constructing our website. Note that we <em>link</em>
to this file rather than <em>load</em> it—that’s an HTML thing!</p>
<p><em>By default, the app will look for CSS stylesheets in the
<code>www</code> sub-folder</em>, so as long as that’s where we put it,
we don’t need to provide more details than this to the <code>href</code>
parameter.</p>
<div class="section level3">
<h3 id="jumpstarting-our-ui">Jumpstarting our UI<a class="anchor" aria-label="anchor" href="#jumpstarting-our-ui"></a>
</h3>
<p>Now, we can add some additional boxes to our <code>fluidPage()</code>
to start giving our app structure. In this series of lessons, we’ll
<em>sort of</em> practice a UI design approach called
<strong>mobile-first design</strong>. This means designing apps with
mobile users in mind <em>first</em> and all other users
<em>second</em>.</p>
<p>The logic of this approach is that, if an app looks and feels good on
a narrow-screened, mouseless device, it should look and feel just as
good, if not better, on a wider, mouse-enabled device more or less
automatically. By contrast, ensuring that a website designed for a
computer also works well on mobile devices tends to be harder.</p>
<p>This approach means, among other things, placing our UI elements with
the assumption that they will need to adopt a “vertical” or “stacked”
layout for mobile users. Pretty much every major element will get to use
the screen’s full available width if it needs to, and each subsequent
element will flow below rather than next to the previous one.</p>
<p>However, we’ll also set up our UI such that, if a user <em>does</em>
have a wide enough screen, <em>some</em> things will arrange side by
side <em>instead</em>. A wider layout will tend to look less quirky on a
wider screen than a strictly vertical layout would because more content
will fit on the screen at once and the added spatial constraints will
keep elements from stretching too much horizontally.</p>
<p>So, with all that in mind, let’s add the following boxes to our app’s
UI:</p>
<ol style="list-style-type: decimal">
<li><p>A <strong>header</strong>, built using <code>h1()</code>, with
the <code>id</code> attribute of <code>"header"</code> (<code>h1</code>s
are top-level headings in HTML).</p></li>
<li><p>A <strong>footer</strong>, built using <code>div()</code>, with
the <code>id</code> attribute of <code>"footer"</code>.</p></li>
<li>
<p>In between, a <code>fluidRow()</code>.</p>
<ul>
<li>Inside it, we’ll place two <code>column()</code>s, which will act as
“cells” in this 1 row by 2 column “table.”</li>
</ul>
</li>
</ol>
<p>The R Shiny function <code>column()</code> has a required input,
<code>width</code>; all <code>width</code> values of
<code>column()</code>s inside a <code>fluidRow()</code> must be whole
numbers that sum to exactly 12. So, let’s set the <code>width</code>s of
these columns to <code>4</code> and <code>8</code>, respectively. In
practice, this’ll make the second column twice as wide as the first. As
a result, the second column will take up 2/3rds of the available screen
width, creating the <em>feel</em> of a left-hand “side panel” and a
right-hand “main panel,” a standard layout found across the web.</p>
<p>However, as we’ve discussed, <code>fluidRow()</code>s are “smart”—on
narrow screens, elements in the same row will flow vertically if there
isn’t enough room for them to fit side-by-side. This means that our
“side panel” will actually go <em>above</em> our main panel on a narrow
screen automatically (because it’s specified <em>first</em>), which will
be more intuitive for users encountering our elements vertically:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="do">##Place this code INSIDE your app's fluidPage container in the BODY section!</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="fu">h1</span>(<span class="st">"Our amazing Shiny app!"</span>,</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>         <span class="at">id =</span> <span class="st">"header"</span>), <span class="co">#&lt;--EVERY NEW UI ELEMENT IS SEPARATED FROM EVERY OTHER BY COMMAS.</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="fu">fluidRow</span>(</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  <span class="do">###SIDEBAR CELL</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">4</span>),</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>  <span class="do">###MAIN PANEL CELL</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>  <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">8</span>)</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>),</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="fu">div</span>(<span class="at">id =</span> <span class="st">"footer"</span>)</span></code></pre>
</div>
<p>A couple more things to note about R Shiny boxes at this point:</p>
<ol style="list-style-type: decimal">
<li><p>Most Shiny boxes have a <code>class</code> parameter and an
<code>id</code> parameter, just like their HTML analogs. These two
parameters are <em>always</em> <em>optional</em>, and their purpose is
to be targets in CSS <strong>selectors</strong>.</p></li>
<li><p>However, if a Shiny box has an <code>inputId</code> or
<code>outputId</code> parameter (and we’ll meet <em>many</em> that do!),
those are <em>mandatory</em>; those serve Shiny-specific purposes
(<em>in addition to</em> serving as CSS targets)—more on those
attributes in the next lesson!</p></li>
<li><p>Every Shiny UI element is separated from every other using
commas, just like inputs inside a function call are. Forgetting these
commas is a <em>very</em> common mistake for Shiny beginners!</p></li>
<li><p>Because R Shiny UI code is <em>really</em> just thinly-veiled
HTML code, writing it involves <strong>nesting</strong> a <em>lot</em>
of function calls inside other calls. For many, this can be confusing!
Keeping your code organized using comments to create sub-sections can
help you keep things straight.</p></li>
</ol>
<div id="discussion1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Discussion</h3>
<div class="callout-content">
<p>Start up your app at this point. What do you see? Explain why the app
looks the way it does so far.</p>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>Besides our title we placed as contents inside our header, our app
will actually look completely empty!</p>
<figure><img src="fig/firststart.png" alt="The app is not much to look at yet…we have added a lot of HTML boxes to give it more underlying structure, but haven’t given these new boxes any non-HTML contents yet." class="figure mx-auto d-block"><div class="figcaption">The app is not much to look at yet…we have added
a lot of HTML boxes to give it more <em>underlying</em> structure, but
haven’t given these new boxes any non-HTML <em>contents</em> yet.</div>
</figure><p>This is because we have introduced several HTML boxes (a footer, a
side panel, a main panel, and a box holding the latter two), but we
haven’t actually put anything in those boxes that isn’t just other
boxes!</p>
<p>That is to say that HTML boxes are empty until we provide them with
<strong>contents</strong> that <em>aren’t</em> other boxes. That’s what
we will do in the next lesson!</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>By most standards, our app also looks <em>very</em> basic—just a
white screen with a generic-looking title. This is because the default
CSS applied to Shiny apps is <em>very</em> basic, as I warned in the
previous lesson! This is why I argued that learning some CSS is
essential to craft attractive apps.</p>
<p>What about our CSS file we linked in, though? Sure, we’ve linked to
our CSS stylesheet, but we haven’t actually put any code in it yet.
Until we do, Shiny’s default, bland rules will be used.</p>
<div class="exercise">
<p>Let’s make our first style rules! Since there’s nothing else to style
yet, though, let’s style our title. In your <code>styles.css</code> file
(which you can open in RStudio), write a <strong>rule</strong> that will
make the title of our app <em>green</em> and <em>bold</em>.</p>
<p>The first <strong>property</strong> to set here is called
<code>font-weight</code>, and the new value for this property should be
<code>bold</code>. I’ll leave you to figure out what the second
property-value pairing should be! Run your app to make sure your rule is
working.</p>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>Here’s what our CSS rule should look like:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">CSS<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode css" tabindex="0"><code class="sourceCode css"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>h1<span class="pp">#header</span> {</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="kw">font-weight</span><span class="ch">:</span> <span class="dv">bold</span><span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="kw">color</span><span class="ch">:</span> <span class="cn">green</span><span class="op">;</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>}</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">/* You could also have simply put #header in the selector, as no two HTML containers are allowed to have the same id anyhow! </span></span></code></pre>
</div>
<p>And this is what our app should look like once you apply the
change:</p>
<figure><img src="fig/postcss.png" alt="We’ve restyled our title to make it a little more snazzy using CSS." class="figure mx-auto d-block"><div class="figcaption">We’ve restyled our title to make it a
<em>little</em> more snazzy using CSS.</div>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>If your app doesn’t look like this, there are two things you should
try:</p>
<ul>
<li><p>Perform a hard refresh on your browser. In Edge, this can be done
using Control + F5. This will refresh the page and clear your browser’s
cache for your app. This is sometimes necessary to clear out old CSS
your browser may be using and apply new CSS.</p></li>
<li><p>Ensure that your CSS file is properly linked to your app (see
earlier in this lesson).</p></li>
</ul>
<p>If neither of these suggestions resolves your issue, read on to learn
about another tool you might be able to use to troubleshoot CSS issues
like this!</p>
</div>
</section><section><h2 class="section-heading" id="meeting-the-developers-tools-dashboard">Meeting the Developers Tools dashboard<a class="anchor" aria-label="anchor" href="#meeting-the-developers-tools-dashboard"></a>
</h2>
<hr class="half-width">
<p>In this lesson, we gave our header an <code>id</code>, which made it
easier to target it with a CSS <strong>selector</strong>. What happens
if you want to target a specific element of your app, but you
<em>aren’t</em> sure what selector to use to do that?</p>
<p>Good question: Let’s introduce you to every web developer’s secret
weapon—your browser’s <strong>developers tools</strong>.</p>
<p>Every browser has a slightly different way of launching its
developers tools. Personally, I use Microsoft Edge as my browser. To
access developers tools in Edge, right-click any element on any website
and select the last option in the resulting menu,
<code>Inspect</code>.</p>
<figure><img src="fig/inspect.png" alt="Open developers tools in Microsoft Edge by right-clicking any element on any website." class="figure mx-auto d-block"><div class="figcaption">Open developers tools in Microsoft Edge by
right-clicking any element on any website.</div>
</figure><p><a href="https://jeffrey1183.gitbooks.io/intro-to-programming/content/front-end-development/what-is-javascript/4developer-tools-on-different-browsers.html" class="external-link">The
workflow you might need to use for your browser of choice might be
different</a>.</p>
<p>Once you figure out how to open up your browser’s developer tools,
you’ll see that it’s a frankly intimidating window showing, among other
things, the HTML of the website you’re on (usually on the top or left)
and the CSS of the element you’re inspecting (usually on the bottom or
right):</p>
<figure><img src="fig/devtools.png" alt="The developer’s tools dashboard shows an intimidating amount of information. The most important thing to know is that it shows the website’s current HTML and CSS, allowing you to see and examine both in real time." class="figure mx-auto d-block"><div class="figcaption">The developer’s tools dashboard shows an
intimidating amount of information. The most important thing to know is
that it shows the website’s current HTML and CSS, allowing you to see
and examine both in real time.</div>
</figure><p>If I didn’t know the right selector to use to target an element, I
could right-click on that element in the HTML (see picture above), go to
<code>Copy</code> in the resulting menu, and then select
<code>Copy selector</code> from the resulting sub-menu:</p>
<figure><img src="fig/copy%20selector.png" alt="The developer tools dashboard is one of the most powerful tools in a web developer’s toolbox. For example, it can be used to grab the selector for any element you wish to style using CSS." class="figure mx-auto d-block"><div class="figcaption">The developer tools dashboard is one of the most
powerful tools in a web developer’s toolbox. For example, it can be used
to grab the selector for any element you wish to style using CSS.</div>
</figure><p>Doing this would put <code>#header</code> into your clipboard, in
this case, which could then be used in a CSS rule as a selector moving
forward.</p>
<p>The CSS section of the developers tools will also list all the rules
that are currently affecting a given element, which properties are being
modified, and which new values are being set. If your CSS code isn’t
working as intended, you can check here to ensure your code is being
recognized and applied correctly.</p>
<p>These are just two of the many ways that developer tools is a useful
web development tool. I won’t mention it again in these lessons, but
it’s <em>essential</em> you know how to access it!</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Use the three-file system to organize your app’s code to benefit
from several R Shiny features within RStudio.</li>
<li>A <code>global.R</code> file is handy for storing all the code
needed to fuel your app’s start-up and any other code your app needs
that only needs to run once.</li>
<li>A CSS stylesheet holds CSS code for dictating your app’s aesthetics.
One can be linked to an app inside of <code>ui.R</code> using
<code>tags$head()</code>.</li>
<li>UI elements get nested inside one another and must all be placed
inside our UI object’s outermost container (here, a
<code>fluidPage()</code>).</li>
<li>Most UI elements can be given <code>id</code> and <code>class</code>
attributes use in CSS selectors. UI elements must be separated from one
another in the UI with commas.</li>
<li>
<code>fluidRow()</code> and <code>column()</code> can be used to
create a “grid,” within which elements may arrange next to each other on
wide screens but vertically on narrow screens, creating a responsive,
mobile-first design with little fuss.</li>
<li>CSS styling requires using the right selector to target the right
element(s). If you aren’t sure of the right selector to use, you can
retrieve it using your browser’s developer tools.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-shiny_3"><p>Content from <a href="shiny_3.html">R Shiny's Core Concepts: Rendering, Inputs, and Reactivity</a></p>
<hr>
<p>Last updated on 2024-08-26 |

        <a href="https://github.com/carpentries/r_shiny_workshop/edit/main/episodes/shiny_3.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I add cool features to my app?</li>
<li>How do I give my users meaningful things to do on my app?</li>
<li>How do I get my app to respond meaningfully to users’ actions?</li>
<li>How do I give users greater control over when/how my app
responds?</li>
<li>How do I give <em>myself</em> greater control over when/how my app
responds?</li>
<li>How is R Shiny server code different than code I may have written
before?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Add a table to your app’s UI to present data to the user.</li>
<li>Allow users to adjust how the table looks, and give them control
over when its looks change.</li>
<li>Define <strong>reactive context</strong>, <strong>event</strong>,
<strong>event handling</strong>, <strong>declarative coding</strong>,
and <strong>imperative coding</strong>.</li>
<li>Explain how and why R Shiny server code executes differently than
“traditional” R code.</li>
<li>Use <strong>isolation</strong> and <strong>observers</strong> to
more tightly control event handling.</li>
<li>Expand your UI’s “real estate” by introducing a tab set panel.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="going-from-nothing-to-something">Going from nothing to something<a class="anchor" aria-label="anchor" href="#going-from-nothing-to-something"></a>
</h2>
<hr class="half-width">
<p>As we saw at the end of the last lesson, our app doesn’t look like
much…yet! It is just a title on an otherwise empty page. In this lesson,
we’ll fix that! As we add content, we’ll learn three core concepts of
building a website using Shiny: 1) <strong>rendering</strong> and
<strong>outputting</strong> complex UI elements, 2) <strong>input
widgets</strong>, and 3) <strong>reactivity</strong>.</p>
<p>Our app will showcase the <code>gapminder</code> data set, which
contains population, life expectancy, and economic data over time for
most of the world’s countries. Our goal is give users interesting ways
to engage with these data. As we go, imagine how you might do the same
for your own data sets!</p>
<p>Let’s start by giving users a table with which to view the raw data.
If you think about it, a table is just a bunch of boxes (cells) within
larger boxes (rows and columns) within one outermost box (the table
“holder”).</p>
<p>So, it makes sense that a table should be build-able in HTML, a
language all about building nested boxes! However, depending on the
number of cells, it would require typing out a LOT of boxes…Fortunately,
we don’t have to “code” all those boxes “by hand;” we can have R do
it!</p>
<p>To build an element (like a table for a data set) complex enough that
building it programmatically instead of by hand is appealing, and then
to insert that complex element into our UI where a user can see it, we
must:</p>
<ol style="list-style-type: decimal">
<li>
<p>Make (<em>i.e.</em>, <em>render</em>) that element on the server
half of our app.</p>
<ul>
<li><p>This first involves doing whatever “heavy lifting” is needed to
assemble the underlying R object. For a table, <em>e.g.</em>, R might
need to do some data manipulation, like joining two smaller tables
together.</p></li>
<li><p>Then, we convert (behind the scenes) that R object into its
functional equivalent in HTML, a process called <em>rendering</em> in
Shiny.</p></li>
</ul>
</li>
<li><p>Then, we pass te rendered version over to the UI side of our app,
indicating <em>where</em> in our UI we’d like the finished element to
display for a user, a process called <em>outputting</em> in
Shiny.</p></li>
</ol>
<p>For virtually every complex element you’d want to build in Shiny,
there is a pair of functions designed to do those two steps. In this
particular case, that pair is <code>renderTable({})</code> on the server
side and <code>tableOutput()</code> on the UI side. [Notice that most
Shiny functions use a camelCase <strong>naming convention</strong>.]</p>
<p>Let’s use these two functions to add a basic table of the
<code>gapminder</code> data set to our app’s UI:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##Place this code INSIDE your app's server function INSIDE your server.R file! </span></span>
<span></span>
<span><span class="co">###TABLE</span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">basic_table</span> <span class="op">=</span> <span class="fu">renderTable</span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">gap</span> <span class="co">#&lt;--OR WHATEVER YOU NAMED THIS DATA SET OBJECT IN YOUR GLOBAL.R</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Above, we instructed R to render an “HTML-ized” version of a data
frame of the entire raw gapminder data set. Here, because we wanted to
render the entire data set, that’s all we put inside the braces. If we
had wanted to do any operations on this data set first (such as
filtering it or adding columns to it), though, we could have done so
using “normal R code” inside <code>renderTable({})</code>’s braces. So
long as it’s a data frame-like object, the last thing produced inside
the braces is what will be rendered (anything else being last will
trigger an error).</p>
<p>So, we now have a rendered, HTML-ized table of our data set on the
server side of our app. How do we get it from the server to the UI?
Remember that users can only see what the server instructs a user’s
browser to build into a UI, so we must tell R to “pass” this rendered
table over to the UI <em>somehow</em>…</p>
<p>Last lesson, recall that the app creates an object called
<code>output</code> as soon as the app boots. <u>Passing rendered
elements from the server to the client is <code>output</code>’s job</u>.
If an app is a restaurant, and rendering is the process of “cooking”
elements back in the kitchen area, then <code>output</code> is the
waiter that brings those finished elements out to the dining area where
users/customers can experience them.</p>
<p>For this process to happen, we first give the element a nickname (an
<code>outputId</code>) it adopts once it has been rendered. Then, we use
that <code>outputId</code> to “stick” the rendered element to the
<code>output</code> object using the <code>$</code> operator.</p>
<p>Here, the nickname we provided was <code>basic_table</code>. In our
restautant analogy, think of the <code>outputId</code> as the order
ticket the waiter filled out when a table ordered food.
<code>output</code> (our “waiter”) uses that code later to figure out
which prepared food belongs to which order.</p>
<p>Now, we just need to code the equivalent of “dropping this element
off at the appropriate table.” We tell the app where to place the
element through placement of a <code>tableOutput()</code> call in our
UI:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="do">##This code should **replace** the "main" fluidRow() contained within the BODY section of your ui.R file!</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="do">##... other UI code...</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="fu">fluidRow</span>(</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  <span class="do">###SIDEBAR CELL</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>  <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">4</span>),</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>  <span class="do">###MAIN PANEL CELL</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>  <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>         <span class="fu">tableOutput</span>(<span class="st">"basic_table"</span>)<span class="co">#&lt;--PUTTING OUR RENDERED TABLE INTO OUR "MAIN PANEL" CELL USING tableOutput AND THE outputId OF THE RENDERED PRODUCT AS ITS INPUT.</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>         )</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>),</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="do">##... other UI code...</span></span></code></pre>
</div>
<p>Here, we’ve placed our outputted table inside the “main panel” cell
of our central, two-column <code>fluidRow()</code>.</p>
<p>Why do we need to use our <code>outputId</code> in this way? Wouldn’t
it be enough to just place an empty <code>tableOutput()</code> call
here? Well, a single app might render and display multiple different
tables. How would the app know <em>which</em> table should be displayed
<em>where</em>? This ambiguity is cleared up by specifying the
<code>outputId</code> of the specific table we want displayed in a
specific location in the UI.</p>
<p>If you run your app at this point, you should get something that
looks like this:</p>
<figure><img src="fig/basic%20table.png" alt="Our Shiny app with our basic HTML table of the gapminder data set displayed in the UI." class="figure mx-auto d-block"><div class="figcaption">Our Shiny app with our basic HTML table of the
gapminder data set displayed in the UI.</div>
</figure><p>Our table is cool! But not <em>terribly</em> exciting…it looks a
little drab, and users can’t actually <strong>do</strong> anything with
it except look at it. The first problem we’ll start to fix later when we
swap it out for a <em>much</em> better one. However, we can fix the
second problem now.</p>
</section><section><h2 class="section-heading" id="giving-your-users-input">Giving your users input<a class="anchor" aria-label="anchor" href="#giving-your-users-input"></a>
</h2>
<hr class="half-width">
<p>In my opinion, the value of a Shiny app can be measured by how much
it lets users <em>do</em>. To enable meaningful user interactions, we
can add <strong>widgets</strong>. A widget is any element users can
interact with and thus provide data to the app it could (maybe) use to
respond. In web development, user actions a webpage can watch for are
called <strong>events</strong>; responding to an event (or choosing to
not respond!) is called <strong>event</strong>
<strong>handling</strong>.</p>
<p>Let’s start by adding an <strong>input widget</strong> to our UI so
that new <strong>events</strong> are possible. Specifically, let’s add a
<code>selectInput()</code> to our “sidebar” UI container. This will
produce a “drop-down menu” style element that allows users to select a
single choice from a pre-defined list. We’ll populate the list with the
column names from the <code>gapminder</code> data set:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="do">##This code should **replace** the "sidebar" cell contained within the main fluidRow() of your ui.R file!</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="do">##... other UI code...</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="do">###SIDEBAR CELL</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    <span class="fu">column</span>(</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>      <span class="do">##ADDING A DROP-DOWN MENU WIDGET TO THE SIDEBAR.</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>      <span class="fu">selectInput</span>(</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>        <span class="at">inputId =</span> <span class="st">"sorted_column"</span>,</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"Select a column to sort the table by."</span>,</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>        <span class="at">choices =</span> <span class="fu">names</span>(gap) <span class="co">#&lt;--OR WHATEVER YOU NAMED THIS OBJECT IN GLOBAL.R</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>      )</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>    ),</span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a>  </span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="do">##... other UI code...</span></span></code></pre>
</div>
<p>Notice we provided <code>selectInput()</code> three inputs:</p>
<ol style="list-style-type: decimal">
<li><p>An <code>inputId</code> is both an <code>id</code> for CSS
purposes as well as a nickname the app will use for this widget
server-side. We’ll see how that works in a minute.</p></li>
<li><p>The text we provide to <code>label</code> will be the text that
accompanies the widget in the UI and, usually, explains to the user what
the widget does (in case it isn’t obvious).</p></li>
<li><p>For <code>choices</code>, we provide a vector of values that will
be the options that appear in our drop-down menu.</p></li>
</ol>
<p>While there are a few variations, most Shiny input widgets work a lot
like <code>selectInput()</code>, so it’s a good first example.</p>
<p>Now, our app should look like this:</p>
<figure><img src="fig/select%20input.png" alt="Our new select input widget." class="figure mx-auto d-block"><div class="figcaption">Our new select input widget.</div>
</figure><p>Very nice!</p>
<p>…<em>Except</em> for two things. First, the choices in the drop-down
menu are…ugly. Some are abbreviations that lack spaces between words and
some also lack capital letters.</p>
<p>How could we fix this? Well, we <em>could</em> rename the columns in
the data set, but while column names in R <em>can</em> contain spaces,
at best, it’s annoying. Plus, longer and more complex names require more
typing.</p>
<p>Instead, we can provide a <strong>named vector</strong> to
<code>choices</code>. The names we give (left of the <code>=</code>)
will be displayed in the drop-down menu, whereas the original column
names (right of the <code>=</code>) will be sent to the server side to
work with:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="do">##This code should **replace** the "sidebar" cell contained within the main fluidRow() of your ui.R file!</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="do">##... other UI code...</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="do">###SIDEBAR CELL</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>    <span class="fu">column</span>(</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>      <span class="fu">selectInput</span>(</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>        <span class="at">inputId =</span> <span class="st">"sorted_column"</span>,</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"Select a column to sort the table by."</span>,</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a>        <span class="at">choices =</span> <span class="fu">c</span>(</span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>          <span class="co">#BY USING A NAMED VECTOR, WE CAN HAVE HUMAN-READABLE CHOICES AND COMPUTER-READABLE VALUES. TYPE CAREFULLY HERE!</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>          <span class="st">"Country"</span> <span class="ot">=</span> <span class="st">"country"</span>,</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>          <span class="st">"Continent"</span> <span class="ot">=</span> <span class="st">"continent"</span>,</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>          <span class="st">"Year"</span> <span class="ot">=</span> <span class="st">"year"</span>,</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>          <span class="st">"Life expectancy"</span> <span class="ot">=</span> <span class="st">"lifeExp"</span>,</span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>          <span class="st">"Population size"</span> <span class="ot">=</span> <span class="st">"pop"</span>,</span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a>          <span class="st">"GDP per capita"</span> <span class="ot">=</span> <span class="st">"gdpPercap"</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a>        )</span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a>      )</span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a>    ),</span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a>  </span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a><span class="do">##... other UI code...</span></span></code></pre>
</div>
<p>With that change made, our drop-down menu widget should be looking
much better!</p>
<figure><img src="fig/prettier%20choices.png" alt="Now our choices look much more human-readable for our users, but the original column names are preserved for work behind the scenes too." class="figure mx-auto d-block"><div class="figcaption">Now our choices look much more human-readable
for our users, but the original column names are preserved for work
behind the scenes too.</div>
</figure><p>…Except that fiddling with the drop-down still doesn’t <em>do</em>
anything…<em>yet</em>. We’ve created something a user can interact with,
triggering <strong>events</strong>, but we haven’t told the app how to
<strong>handle</strong> those yet.</p>
<div class="section level3">
<h3 id="rll-handle-that">R’ll handle that<a class="anchor" aria-label="anchor" href="#rll-handle-that"></a>
</h3>
<p>Let’s do that next. We’ll give the user the ability to re-sort the
table by the column they’ve selected using the drop-down widget. You
might be surprised to learn this is actually quite straightforward—it
just requires one adjustment to our server-side code:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the renderTable({}) call in your server.R file!</span></span>
<span></span>
<span><span class="co">###BASIC GAPMINDER TABLE</span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">basic_table</span> <span class="op">=</span> <span class="fu">renderTable</span><span class="op">(</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">gap</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="co">#USE dplyr's arrange() VERB FOR SORTING BY THE PICKED COLUMN.</span></span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span> <span class="co">#!! (PRONOUNCED "BANG-BANG") AND sym() ARE dplyr TRICKS, NOT R SHINY THINGS. LET'S NOT WORRY ABOUT WHAT THEY DO.</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Run the app and try it out. As you select different columns using the
drop-down menu, the table <em>automatically</em> rebuilds, sorted by the
column you’ve picked:</p>
<figure><img src="fig/sorting%20by%20column.gif" alt="Now, when a user selects a new column using our drop-down widget, the table re-sorts by that column." class="figure mx-auto d-block"><div class="figcaption">Now, when a user selects a new column using our
drop-down widget, the table re-sorts by that column.</div>
</figure><p>Earlier, we met the <code>output</code> object, which passes rendered
elements from the server to the UI where they can be seen. Here, we
finally meet <code>input</code>, which passes <strong>event
data</strong> from the UI to the server where responses can be
crafted.</p>
<p>Here, <code>input</code> is passing the <em>current</em> value of the
widget with the <code>inputId</code> of <code>sorted_column</code>
(that’s the nickname we gave our drop-down menu when we created it) over
to the server when the app starts up and every time that value changes
thereafter. At any time, our server code can use that value in
operations, such as to decide how to sort the data in our table.</p>
<p>But, more importantly, Shiny knows that, <em>at any moment</em>,
<code>input$sorted_column</code>’s value could <em>change</em>. Objects
with values that could change as a result of events are <strong>reactive
objects</strong>—at any moment, they might change <em>in reaction
to</em> something.</p>
<p>Because we’ve used <code>input$sorted_column</code> in some of our
server code, and because R knows that <code>input$sorted_column</code>’s
value could change at any time, it knows to be <em>watching</em> for
such changes. Whenever it sees one, it’ll run code including
<code>input$sorted_column</code> <em>again</em>. The logic makes sense,
when you think about it: If <code>input$sorted_column</code> has
changed, anything that used its <em>previous</em> value to produce
outputs may now be “outdated,” so re-running the associated code and
producing more current outputs makes sense!</p>
<p>Because the code inside <code>renderTable({})</code> contains
<code>input$sorted_column</code>, all that code reruns every time
<code>input$sorted_column</code> changes, which happens every time the
user selects a new column from the drop-down menu. We’re successfully
<strong>handling</strong> the <strong>events</strong> triggered by our
user’s interactions with our input widget!</p>
</div>
<div class="section level3">
<h3 id="reactivity">Reactivity<a class="anchor" aria-label="anchor" href="#reactivity"></a>
</h3>
<p>There is just one small but important technical detail: Shiny
<em>can’t</em> watch for changes in <strong>reactive objects</strong>
<em>everywhere</em> in our server code—it can <em>only</em> do so within
<strong>reactive contexts</strong>.</p>
<p>A <strong>reactive context</strong> is a code block that R
<em>knows</em> it needs to watch for changes in reactive objects and
thus it might need to re-run over and over again. It makes sense that we
can only put “changeable” objects inside code blocks that R knows it
needs to watch for such changes in!</p>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p><strong>Try it:</strong> Pause here to prove the previous point. Copy
<code>input$sorted_column</code> and paste it anywhere <em>inside</em>
your server function but <em>outside</em> of
<code>renderTable({})</code>. Then, try running your app. It should
<strong>immediately</strong> crash! Note the R error in your R Console
when this happens; rephrase it in your own words.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>You’ll get an error that looks a lot like this:<br><br><code>Error in $: Can't access reactive value 'sorted_column' outside of reactive consumer. ℹ Do you need to wrap inside reactive() or observe()?</code></p>
<p>This error notes that <code>input$sorted_column</code> is a
<strong>reactive object</strong> (to be technical, a sub-type called a
reactive value) and that you’ve tried to reference it outside of a
reactive context, where R would actually be “prepared” to watch it.</p>
</div>
</div>
</div>
</div>
<p>How do we recognize reactive contexts so we know where we can and
can’t put entities like <code>input$sorted_column</code>?</p>
<p><em>Generally speaking</em>, when an R Shiny server-side function
takes, as an input, an <strong>expression</strong> bounded by braces (
<code>{}</code> ), that expression becomes a reactive context.</p>
<p>Maybe you’ve noticed the curly braces in <code>renderTable({})</code>
and wondered what they’re for? <em>The main input to every
<code>render*()</code> function is an <strong>expression</strong> for
creating a <strong>reactive context</strong>!</em></p>
<p>That means R <em>assumes</em> that every complex element we render
server-side might need to be <em>re-rendered</em> because the user
changed or did something. We provided <code>renderTable({})</code> with
a set of general instructions that told it how to <em>handle</em>
changing values of <code>input$sorted_column</code>, no matter what
value gets picked or when.</p>
</div>
</section><section><h2 class="section-heading" id="how-r-shiny-differs-from-normal-r">How R Shiny differs from “normal R”<a class="anchor" aria-label="anchor" href="#how-r-shiny-differs-from-normal-r"></a>
</h2>
<hr class="half-width">
<p>You’re hopefully realizing that coding in R Shiny (on both the UI and
server sides) is different from coding in “normal R” in some key
ways.</p>
<p>For many regular R users, the “nestedness” of UI code probably feels
strange (it <em>should</em>—we’re writing thinly veiled HTML code in our
UI file!).</p>
<p>Meanwhile, server-side, having to imagine/design ways users
<em>might</em> interact with our app and then code generalized
instructions for how the app should respond, no matter when or under
what circumstances, probably also feels strange.</p>
<p>It <em>should</em>—<em>R Shiny server code is not like normal R code!
In fact, it’s an entirely different paradigm of programming than the one
you might know.</em></p>
<p>Normal R code is generally executed <strong>imperatively</strong>.
That is, it is run from the first command to the last as fast as
possible as soon as we (the user) hit “run.”</p>
<p>Server-side Shiny code, meanwhile, is generally executed
<strong>declaratively</strong>. That is, it generally runs once when the
app starts up (or not), but, after that, it never runs again
<em>unless</em> and <em>until</em> it is <em>triggered</em> to run by
one or more specific <strong>events</strong>.</p>
<p>[Caveat: The above is true when R is deciding which reactive contexts
to run when; however, the R code <em>within</em> those contexts will
still run imperatively, once that reactive context begins running.]</p>
<p>These two different paradigms can be understood better via an
analogy: Imagine you are in a sandwich shop ordering a sandwich. You
probably expect the employees to begin making your sandwich as soon
after you place your order as possible, using instructions and supplies
their manager gave them.</p>
<p>In that analogy, the relationship between you and the shop is
<strong>imperative</strong>; you gave a “command” and the sandwich shop
“executed” that command as quickly as it could via a pre-defined set of
instructions.</p>
<p>Meanwhile, the relationship between the manager and their employees
is <strong>declarative</strong>. The manager can’t know which customers
will come in on a given day, when those customers will show up, or which
sandwiches will get ordered. So, they can’t give their employees precise
“commands” and specific instructions of when to execute them or in what
order.</p>
<p>Instead, they have to tell their employees to “watch for customers”
and, when those customers arrive and place orders, they should use a
generalized set of instructions to handle whatever orders have been
placed.</p>
<p>As web developers, our relationship with our users is similar. We
can’t know who will show up and what <em>exactly</em> they might decide
to do and when. However, we totally <em>can</em> anticipate common
actions they might take and give the app detailed but generalized enough
instructions that it can take care of all those different requests
whenever (or if ever) they occur.</p>
<div id="discussion1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Discussion</h3>
<div class="callout-content">
<p><strong>Check for understanding:</strong> How does the code we’ve
written so far in our <code>server.R</code> file execute differently
than code we’d write in a traditional R script? How does the code inside
of <code>renderTable({})</code>’s braces differ from traditional R code
we might write?</p>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>Server-side R code is mostly broken up into many reactive contexts,
each tasked with generating one or more complex UI elements and/or
handling user actions. Unlike traditional R code, these reactive
contexts run when a user performs a triggering action, not when an
operator hits “enter,” so to speak, so they might run many times, or
once and then never again.</p>
<p>Plus, reactive contexts will (re)-run based on user actions,
<em>not</em> on placement within the file. So, your server-side will
often run in an “order” very different than the “top-down” order we
usually expect R code to run in.</p>
<p><em>Inside</em> a reactive context, meanwhile, things are more
traditional in that code inside a reactive context will run just once,
from top to bottom, as quickly as possible as soon as that context is
triggered to (re)run.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="buttoning-this-up">Buttoning this up<a class="anchor" aria-label="anchor" href="#buttoning-this-up"></a>
</h2>
<hr class="half-width">
<p>By this point, R now knows that:</p>
<ol style="list-style-type: decimal">
<li><p>Users might select new columns in our input widget
(<strong>events</strong>),</p></li>
<li><p>It should watch out for any such events, specifically inside
<code>renderTable({})</code>’s reactive expression (because it contains
a linkage to the widget’s current value), and</p></li>
<li><p>If any events occur, it should re-execute the
<code>renderTable({})</code> , re-generating the table in line with the
generalized instructions we’ve provided.</p></li>
</ol>
<p>In this circumstance (a simple table that users can adjust via just
one input widget), this setup is <em>probably</em> fine.</p>
<p>However, imagine users had several widgets instead of one. If we used
this same approach to handle events from all those inputs, a user
adjusting any one input would trigger the table re-rendering
process.</p>
<p>That might make our table <em>undesirably</em> reactive! Users often
expect to have some say in when <em>exactly</em> an app changes states.
Maybe they expect to be able to experiment with widgets to find the
combination of selections they are most interested in <em>before</em>
the app responds. Maybe the table loads slowly, so users would prefer
not to wait through the rebuilding process until they’re “ready.” Maybe
some users just want to be “in control” because they’d find the updating
process distracting when it happens not on <em>their</em> terms.</p>
<p>In any case, we can give users greater control by adding another
input widget: an <code>actionButton()</code>.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="do">##This code should **replace** the "sidebar" cell contained within the main fluidRow() of your ui.R file!</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="do">##... other UI code...</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="do">###SIDEBAR CELL</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>    <span class="fu">column</span>(</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>      <span class="fu">selectInput</span>(</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>        <span class="at">inputId =</span> <span class="st">"sorted_column"</span>,</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"Select a column to sort the table by."</span>,</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>        <span class="at">choices =</span> <span class="fu">c</span>(</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>          <span class="st">"Country"</span> <span class="ot">=</span> <span class="st">"country"</span>,</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>          <span class="st">"Continent"</span> <span class="ot">=</span> <span class="st">"continent"</span>,</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>          <span class="st">"Year"</span> <span class="ot">=</span> <span class="st">"year"</span>,</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>          <span class="st">"Life expectancy"</span> <span class="ot">=</span> <span class="st">"lifeExp"</span>,</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>          <span class="st">"Population size"</span> <span class="ot">=</span> <span class="st">"pop"</span>,</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>          <span class="st">"GDP per capita"</span> <span class="ot">=</span> <span class="st">"gdpPercap"</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>        )</span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>      ),</span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>      <span class="do">##ADD AN actionButton(). PAY </span><span class="al">ATTENTION</span><span class="do"> TO COMMAS/PARENTHESES AROUND THIS NEW CODE!</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>      <span class="fu">actionButton</span>(<span class="at">inputId =</span> <span class="st">"go_button"</span>, <span class="at">label =</span> <span class="st">"Go!"</span>)</span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a>    ),</span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a>  </span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a><span class="do">##... other UI code...</span></span></code></pre>
</div>
<p>This adds a simple, button-style input widget to our app’s sidebar.
It says <code>Go!</code> on it (<code>label</code>), and it’s current
value (a number equal to the number of times it has been pressed, or
<code>NULL</code> if it hasn’t been pressed yet) will be passed from the
UI to the server via <code>input$go_button</code>.</p>
<figure><img src="fig/go%20button.png" alt="A new “Go” button has been added to the app’s sidebar panel." class="figure mx-auto d-block"><div class="figcaption">A new “Go” button has been added to the app’s
sidebar panel.</div>
</figure><p>Now, we need to tell R how to <strong>handle</strong> presses of our
button (until then, pressing it won’t do anything!).</p>
<p>Here, we want the table to update <em>only</em> whenever the button
is pressed (<em>i.e.</em>, whenever <code>input$go_button</code>
changes). By extention, then, we no longer want changes to
<code>input$sorted_column</code> to cause the table to update.</p>
<p>Here’s where we hit a snag: <code>renderTable({})</code>’s reactive
context is “indiscriminate;” <em>any</em> change in <em>any</em>
reactive object it contains will trigger the reactive context to rerun.
So, simply adding <code>input$go_button</code> to that reactive context
will <em>not</em> prevent changes in <code>input$sorted_column</code>
from triggering a rerun. And we can’t just remove
<code>input$sorted_column</code> from the reactive context because,
then, we couldn’t use its value to decide what column to sort by. We’re
stuck!</p>
<p>Thankfully, Shiny has a function for these kinds of sticky
situations: <code>isolate()</code>. Wrapping any reactive object in
<code>isolate()</code> allows R to use its current value to do work but
prevents changes in that value from <strong>invalidating</strong>
(<em>i.e.</em>, rendering “outdated”) the reactive context it appears
in.</p>
<p>Here’s how we can use <code>isolate()</code> to achieve our goal:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the renderTable({}) call contained within your server.R file!</span></span>
<span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">basic_table</span> <span class="op">=</span> <span class="fu">renderTable</span><span class="op">(</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="co">#BY PLACING input$go_button IN THIS REACTIVE EXPRESSION (EVEN IF WE DON'T ACTUALLY USE IT!), THIS EXPRESSION WILL RE-RUN EVERY TIME input$go_button CHANGES IN VALUE. </span></span>
<span>  <span class="va">input</span><span class="op">$</span><span class="va">go_button</span></span>
<span>  </span>
<span>  <span class="co">#USING isolate() PREVENTS input$sorted_column FROM BEING REACTIVE (ITS EVENTS HERE ARE NO LONGER WATCHED) BUT STILL ALLOWS USE OF ITS CURRENT VALUE.</span></span>
<span>  <span class="va">gap</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="fu">isolate</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Now, when users fiddle with the drop-down widget, nothing
happens…<em>until</em> they press the button. Then, and only then, does
the table re-render, using their most recent selection in the drop-down
as guidance.</p>
<figure><img src="fig/go%20button%20works.gif" alt="Thanks to isolate(), our table only re-renders when the “Go” button is pressed, but the drop-down menu’s current value is still used in that process." class="figure mx-auto d-block"><div class="figcaption">Thanks to isolate(), our table only re-renders
when the “Go” button is pressed, but the drop-down menu’s current value
is still used in that process.</div>
</figure></section><section><h2 class="section-heading" id="being-observant">Being observant<a class="anchor" aria-label="anchor" href="#being-observant"></a>
</h2>
<hr class="half-width">
<p>This <em>works</em>, but it can get unwieldy if you have
<em>many</em> inputs that would need isolating. For those situations in
which you want the app to respond a <em>specific</em> way <em>only</em>
when a <em>specific</em> reactive object changes, especially when the
response involves a bunch of other reactive objects you <em>don’t</em>
want watched, we can make our event handling way more precise using
<code>observeEvent({},{})</code>:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the renderTable({}) call contained within your server.R file!</span></span>
<span></span>
<span><span class="co">#FIRST, WE REDUCE OUR renderTable({}) CALL BACK TO BASICS. THIS WILL PRODUCE ONLY THE DEFAULT VERSION OF OUR TABLE.</span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">basic_table</span> <span class="op">=</span> <span class="fu">renderTable</span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">gap</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">##TABLE OBSERVER (BUTTON)</span></span>
<span><span class="co">#observeEvent({},{}) TAKES TWO EXPRESSIONS, WATCHING THE FIRST FOR EVENTS AND, WHEN IT SPOTS ONE, RESPONDING BY RUNNING THE SECOND. </span></span>
<span><span class="co">#SO, THE **FIRST** EXPRESSION IS REACTIVE, BUT NOT THE **SECOND**!</span></span>
<span><span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">go_button</span>, <span class="op">{</span> </span>
<span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_table</span> <span class="op">=</span> <span class="fu">renderTable</span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">gap</span> <span class="op">%&gt;%</span> </span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span> <span class="co">#&lt;--NO NEED FOR isolate(); EVENTS RELATED TO input$sorted_column DON'T MATTER HERE. </span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#IF YOU RUN THE APP WITH THIS CHANGE, IT SHOULD BEHAVE THE SAME AS IN THE PREVIOUS EXAMPLE!</span></span></code></pre>
</div>
<p>Notice we write <code>observeEvent({},{})</code> with <em>two</em>
sets of braces. That’s because we give it, as inputs, <em>two</em>
<strong>expressions</strong>. These have a particular and interesting
relationship:</p>
<ol style="list-style-type: decimal">
<li><p>R watches <em>only</em> the <em>first</em> for events (it’s the
only <strong>reactive</strong> <strong>expression</strong>).</p></li>
<li><p>R only ever actually <strong>executes</strong> the
<em>second</em> expression, and <em>only</em> in response to changes in
the <em>first</em>). In a sense, it’s like the <em>entire</em> second
expression is <code>isolate()</code>d!</p></li>
</ol>
<p>So, <code>observeEvent({},{})</code> is the equivalent of telling R
“if <em>exactly</em> [first expression] changes, do <em>exactly</em>
[second expression],” which is a level of precision we very often want
when handling events!</p>
<p>It’s for this reason I use many <code>observeEvent({},{}</code>s in
my own apps—they make an app’s behaviors far more predictable. [However,
if you have a lot of events to handle, this may be a verbose way to
handle them. Check out <code>observe({})</code> as a potential
alternative.]</p>
</section><section><h2 class="section-heading" id="totally-tabular">Totally tabular<a class="anchor" aria-label="anchor" href="#totally-tabular"></a>
</h2>
<hr class="half-width">
<p>We now have all the conceptual tools needed to build a really cool
app! In the next lesson, we’ll replace this table with a cooler one, and
we’ll add map and graph widgets. To keep all this organized, though,
let’s add <strong>tabs</strong> to our main content area, one for each
new feature we’ll add.</p>
<p>We do this using the Shiny functions <code>tabsetPanel()</code>, a
box to hold all the individual tabs, and <code>tabPanel()</code>, which
makes the box for the contents of one tab:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="do">##This code should **replace** the content of the "main panel" cell within the BODY section of your ui.R file!</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="do">##... other UI code...</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="do">###MAIN PANEL CELL</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="do">##NEST YOUR UI ELEMENTS **CAREFULLY**!</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>    <span class="fu">column</span>(<span class="at">width =</span> <span class="dv">8</span>, <span class="fu">tabsetPanel</span>(</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>      <span class="do">###TABLE TAB</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>      <span class="fu">tabPanel</span>(<span class="at">title =</span> <span class="st">"Table"</span>, </span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>               <span class="fu">tableOutput</span>(<span class="st">"basic_table"</span>)),</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>      <span class="do">###MAP TAB</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>      <span class="fu">tabPanel</span>(<span class="at">title =</span> <span class="st">"Map"</span>),</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>      <span class="do">###GRAPH TAB</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>      <span class="fu">tabPanel</span>(<span class="at">title =</span> <span class="st">"Graph"</span>)</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>    ))</span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>   <span class="er">)</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="do">##... other UI code...</span></span></code></pre>
</div>
<p>Now, if we look at our app, we’ll see we have three tabs in our main
panel area, with <code>title</code>s as specified in our code.</p>
<figure><img src="fig/new%20tabset%20.png" alt="We’ve split our “main panel” into three tab panels inside a tabset panel, with one tab per fancy widget we will eventually have." class="figure mx-auto d-block"><div class="figcaption">We’ve split our “main panel” into three tab
panels inside a tabset panel, with one tab per fancy widget we will
eventually have.</div>
</figure><p>We can swap between tabs using each tab panel’s tab (yes, the
terminology here is awkward), just like in a browser. The second and
third tab panels are empty, but we’ll soon fix that!</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>Complex UI elements, like tables, first need to be
<strong>rendered</strong> server-side and then placed within our UI
using an <code>*Output()</code> function.</li>
<li>Rendered entities are passed from the server to the UI via the
<code>output</code> object using the <code>outputId</code>’s we gave
these entities when we <strong>rendered</strong> them.</li>
<li>
<strong>Input widgets</strong> are UI elements that allow users to
interact with our app in simple, pre-defined and familiar ways. The
current values of these widgets are passed from the UI to the server via
the <code>input</code> object using the <code>inputId</code>’s we gave
these widgets when we created them.</li>
<li>R knows to watch <strong>reactive objects</strong> (like those
attached to <code>input</code>) for changes. Any such changes are
<strong>events</strong>. <strong>Event handling</strong> is coding how
the app should respond to an event.</li>
<li>The primary way Shiny handles events is by re-running any
<strong>reactive contexts</strong> containing the reactive object(s)
that changed (unless they’re <code>isolate()</code>d).</li>
<li>Server-side, reactive contexts are triggered to run
<strong>directively</strong> (when a precipitating event occurs), not
<strong>imperatively</strong> (when a coder hits “run”). They might run
in any order, or never—it all depends on what the user and app do.</li>
<li>However, <em>once</em> a reactive context begins executing, it’s
contents are executed imperatively like “normal” R code until they
complete (even if that takes a long time!), during which time the app
will be unresponsive.</li>
<li>
<strong>Observers</strong> (like <code>observeEvent({},{})</code>)
allow for more precise event-handling; <code>observeEvent({},{})</code>s
only rerun their second expression and only when events occur in their
first expression, so they enable “If X, then Y” event handling.</li>
<li>
<code>tabPanel()</code> and <code>tabsetPanel()</code> create a
“tabular layout,” dividing up one UI space into several, only one of
which is visible at a time.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-shiny_4"><p>Content from <a href="shiny_4.html">DTs and Leaflets and Plotlys, Oh my!</a></p>
<hr>
<p>Last updated on 2024-08-20 |

        <a href="https://github.com/carpentries/r_shiny_workshop/edit/main/episodes/shiny_4.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I add an interactive map/table/graph to my app?</li>
<li>What features do these widgets have?</li>
<li>How do I adjust the aesthetics of these widgets?</li>
<li>How can I modify these widgets to handle user actions without
“starting over?”</li>
<li>What events related to these widgets can I watch for, and how would
I handle them?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Name essential tools from the <code>DT</code>, <code>leaflet</code>
and <code>plotly</code> packages.</li>
<li>Experiment with the interactive features baked into the
plots/tables/maps produced by these packages.</li>
<li>Customize the look and feel of these complex interactive
graphics.</li>
<li>Update complex interactive graphics instead of remaking them when
possible by using <strong>proxies</strong>.</li>
<li>Recognize events a user might trigger with respect to these complex
interactive graphics, and know how to watch for and handle them.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="disclaimer">Disclaimer<a class="anchor" aria-label="anchor" href="#disclaimer"></a>
</h3>
<p><em>At points in this lesson, the example code produces
<strong>warnings</strong> (not <strong>errors</strong>!) when executed.
These can be ignored!</em></p>
</div>
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>While <strong>input widgets</strong> like drop-down menus and buttons
are powerful ways to give users control, they aren’t always
transformative <em>by themselves</em>. There are <em>much</em> more
powerful widgets out there!</p>
<p>And, since our app’s server side is powered by R—a programming
language <em>designed for</em> data work—it make senses we’d include
widgets that put <em>data</em> at our users’ fingertips in interesting
ways.</p>
<p>Of all the data-centered widgets, few are more familiar than
<strong>tables</strong>, <strong>maps</strong>, and
<strong>graphs</strong>. Because these are <em>so</em> ubiquitous, it
probably won’t surprise you that there are JavaScript-native packages
for creating web-enabled, interactive versions of these graphic
types.</p>
<p>While there are other such packages, here we’ll explore
<code>DT</code> (for tables), <code>leaflet</code> (for maps), and
<code>plotly</code> (for graphs), since each has been ported into R + R
Shiny via packages of the same names.</p>
<p>Each of these could <em>easily</em> be a course unto itself! As such,
we’ll look <em>only</em> at the cross-cutting basics—greater depth can
be found elsewhere once you’ve learned the ropes.</p>
<p>Learning <code>leaflet</code> and <code>plotly</code>, specifically,
come with challenges we’ll have to skirt around:</p>
<ul>
<li><p><code>leaflet</code> builds maps, which represent <strong>spatial
data</strong>. These, and the packages that work with them
(<em>e.g.</em>, <code>sf</code>), are <em>complicated</em>! I’ll gloss
over the details, but we’ll still need to occasionally borrow tools from
<code>sf</code> to accomplish anything at all.</p></li>
<li><p>If you’re familiar with <code>ggplot2</code> (or a comparable
data viz package), you already know that learning programmatica
graph-making has a steep learning curve. <code>plotly</code> has the
same curve (perhaps even a steeper one for R users, since it’s
<em>very</em> JavaScript-like, whereas <code>ggplot2</code> is more
R-like). Again, I’ll gloss over the details, but even the basics may be
a heavy lift for some.</p></li>
</ul>
<p>Let’s start simple—let’s swap out our functional but drab table for a
better, <code>DT</code> table. Of the packages we’re learning here,
<code>DT</code> is easiest (IMHO), and it can introduce us to all the
key concepts we’ll need to tackle <code>leaflet</code> and
<code>plotly</code>.</p>
</div>
<section><h2 class="section-heading" id="turning-the-tables">Turning the tables<a class="anchor" aria-label="anchor" href="#turning-the-tables"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="basic-table">Basic table<a class="anchor" aria-label="anchor" href="#basic-table"></a>
</h3>
<p>All we have to do to swap our tables is change our
<code>renderTable({})</code> and <code>tableOutput()</code> calls into
<code>renderDT({})</code> and <code>dataTableOutput()</code> calls,
which yield a <code>DT</code> table instead:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** ALL table-related code contained within your server.R file!</span></span>
<span></span>
<span><span class="co">###BASIC GAPMINDER TABLE</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_table</span> <span class="op">=</span> <span class="fu">renderDT</span><span class="op">(</span><span class="op">{</span> <span class="co">#&lt;--ONLY CHANGES HERE.</span></span>
<span>    <span class="va">gap</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co">##TABLE OBSERVER (BUTTON)</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">go_button</span>, <span class="op">{</span> </span>
<span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">basic_table</span> <span class="op">=</span> <span class="fu">renderDT</span><span class="op">(</span><span class="op">{</span> <span class="co">#&lt;--...AND HERE.</span></span>
<span>      <span class="va">gap</span> <span class="op">%&gt;%</span> </span>
<span>        <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span> </span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the content of the "main panel" cell within the BODY section of your ui.R file!</span></span>
<span></span>
<span><span class="co">##... other UI code...</span></span>
<span></span>
<span><span class="co">###MAIN PANEL CELL</span></span>
<span>    <span class="fu">column</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">8</span>, <span class="fu">tabsetPanel</span><span class="op">(</span></span>
<span>      <span class="co">###TABLE TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Table"</span>, </span>
<span>               <span class="fu">dataTableOutput</span><span class="op">(</span><span class="st">"basic_table"</span><span class="op">)</span><span class="op">)</span>, <span class="co">#&lt;--ONLY CHANGE HERE</span></span>
<span>      <span class="co">###MAP TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map"</span><span class="op">)</span>,</span>
<span>      <span class="co">###GRAPH TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Graph"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>   <span class="op">)</span></span>
<span></span>
<span><span class="co">##... other UI code...</span></span></code></pre>
</div>
<p>Once you’ve made those swaps, restart your app.</p>
<p>When you do, you’ll <em>immediately</em> notice our table looks
<em>very</em> different:</p>
<figure><img src="fig/DT%20table%20features.png" alt="The DT table above shows off several of the features that come standard, including pagination, searching, row selection, and column sorting." class="figure mx-auto d-block"><div class="figcaption">The DT table above shows off several of the
features that come standard, including pagination, searching, row
selection, and column sorting.</div>
</figure><ul>
<li><p>It’s <strong>paginated</strong>, <em>i.e.</em>,“divided into
pages.” Users flip pages using buttons in the bottom-right. Users can
also change page length using a drop-down menu in the top-left. These
features allow users to limit how much data is shown at once, and they
also keep the table from being long vertically if there’s a lot of data
to show.</p></li>
<li><p>It’s <strong>searchable</strong>—users can type
<strong>strings</strong> (chunks of letters/numbers/symbols) into the
search box in the upper-right; the table will filter to only rows
containing that string in any column.</p></li>
<li><p>It’s <strong>sortable</strong>—users can click the up/down arrows
next to each column name to sort the table by that column. You’ll note
this functionality makes our drop-down menu a bit redundant!</p></li>
<li><p>It’s (modestly) styled—it’s snazzier than our previous table
because it comes with <em>some</em> automatic CSS (bolded column names
and row “zebra striping,” as two examples).<br><br>
[Side-note: Web developers call elements with pre-set CSS
<strong>opinionated</strong>. Opinionated elements are nice in that they
often require less custom styling, but if you do choose to restyle them,
it can be hard to overcome their “opinions.”]</p></li>
<li><p>It’s <strong>selectable</strong>—users can click to highlight
(“select”) rows. This <strong>event</strong> doesn’t actually do
anything by default besides changing the table’s appearance, but it
could.</p></li>
</ul>
<p>Now that we have a <code>DT</code> table (a complex interactive
graphic), there are four things we’ll <em>very</em> commonly want to do
with one (or any similarly complex interactive graphic):</p>
<ol style="list-style-type: decimal">
<li><p>Simplify it,</p></li>
<li><p>Restyle it,</p></li>
<li><p>Watch it for <strong>events</strong>, and</p></li>
<li><p>Update it to <strong>handle</strong> those events.</p></li>
</ol>
<p>Let’s tackle the first two items above first.</p>
</div>
<div class="section level3">
<h3 id="more-or-less-basic-dt">More (or less) basic DT<a class="anchor" aria-label="anchor" href="#more-or-less-basic-dt"></a>
</h3>
<p>As we just saw, <code>DT</code>s come with many interactive features!
However, “more” is not always “better” from a <strong>UX</strong>
(<strong>user experience</strong>) standpoint. Some users might find
certain features confusing, especially if they aren’t necessary, are
poorly explained, or don’t result in any obvious responses. Others may
find having a lot of features overwhelming, even if they understand them
all.</p>
<p>The <code>datatable()</code> function’s <code>options</code> allows
us to reel in the features our table comes with:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** ALL table-related code contained within your server.R file!</span></span>
<span></span>
<span><span class="co">###BASIC GAPMINDER TABLE</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_table</span> <span class="op">=</span> <span class="fu">renderDT</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">gap</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">datatable</span><span class="op">(</span></span>
<span>        selection <span class="op">=</span> <span class="st">"none"</span>, <span class="co">#&lt;--TURNS OFF ROW SELECTION</span></span>
<span>        options <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>          info <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#&lt;--NO BOTTOM-LEFT INFO</span></span>
<span>          ordering <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#&lt;--NO SORTING</span></span>
<span>          searching <span class="op">=</span> <span class="cn">FALSE</span> <span class="co">#&lt;--NO SEARCH BAR</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">##TABLE OBSERVER (BUTTON)</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">go_button</span>, <span class="op">{</span> </span>
<span>    </span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">basic_table</span> <span class="op">=</span> <span class="fu">renderDT</span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="va">gap</span> <span class="op">%&gt;%</span> </span>
<span>        <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>        <span class="co">#SAME AS ABOVE</span></span>
<span>        <span class="fu">datatable</span><span class="op">(</span></span>
<span>          selection <span class="op">=</span> <span class="st">"none"</span>, </span>
<span>          options <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>            info <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>            ordering <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            searching <span class="op">=</span> <span class="cn">FALSE</span> </span>
<span>          <span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>That’s better! This version might be more digestible and intuitive
for most users (and easier for us to explain and program around!).</p>
<figure><img src="fig/disabled%20DT.png" alt="Notice that, in this DT, there are no sorting arrows, no search bar, no current page info in the bottom-left, and no row selection." class="figure mx-auto d-block"><div class="figcaption">Notice that, in this DT, there are no sorting
arrows, no search bar, no current page info in the bottom-left, and no
row selection.</div>
</figure><p>More broadly, <em>if a <code>DT</code> table (or any other complex
interactive graphic) has a feature, you should assume you can turn it
off (you may just have to Google for the specific input
needed).</em></p>
<p>Next, let’s tinker with our table’s aesthetics. Let’s make three
(idosyncratic) changes:</p>
<ol style="list-style-type: decimal">
<li><p>Round the GDP per capita data.</p></li>
<li><p>Make the <code>continent</code> column center-aligned.</p></li>
<li><p>Highlight in pink all rows with <code>lifeExp</code> values &gt;
<code>70</code>.</p></li>
</ol>
<p>We’ll use functions from the <code>format*()</code> and
<code>style*()</code> families for this: specifically,
<code>formatRound()</code>, <code>formatStyle()</code>, and
<code>styleEqual()</code>:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** ALL table-related code contained within your server.R file!</span></span>
<span></span>
<span><span class="co">###BASIC GAPMINDER TABLE</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_table</span> <span class="op">=</span> <span class="fu">renderDT</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">gap</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">datatable</span><span class="op">(</span></span>
<span>        selection <span class="op">=</span> <span class="st">"none"</span>, <span class="co">#&lt;--TURNS OFF ROW SELECTION</span></span>
<span>        options <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>          info <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#&lt;--NO BOTTOM-LEFT INFO</span></span>
<span>          ordering <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co">#&lt;--NO SORTING</span></span>
<span>          searching <span class="op">=</span> <span class="cn">FALSE</span> <span class="co">#&lt;--NO SEARCH BAR</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="co">#IN THESE FUNCTIONS, WE WRITE 'R-LIKE' CSS CODE. WE USE camelCase FOR PROPERTIES, TEXT STRINGS FOR VALUES, AND = INSTEAD OF : TO SEPARATE THEM.</span></span>
<span>      <span class="fu">formatRound</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"gdpPercap"</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">formatStyle</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"continent"</span>, textAlign <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--COMPARE TO [text-align: center;]</span></span>
<span>      <span class="fu">formatStyle</span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="st">"lifeExp"</span>, <span class="co">#&lt;--wHAT COLUMN WILL WE USE TO CONDITIONALLY FORMAT?</span></span>
<span>        target <span class="op">=</span> <span class="st">"row"</span>, <span class="co">#&lt;--WILL WE STYLE ROWS OR CELLS?</span></span>
<span>        backgroundColor <span class="op">=</span> <span class="fu">styleEqual</span><span class="op">(</span></span>
<span>          levels <span class="op">=</span> <span class="va">gap</span><span class="op">$</span><span class="va">lifeExp</span>, </span>
<span>          values <span class="op">=</span> <span class="fu">ifelse</span><span class="op">(</span><span class="va">gap</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="fl">70</span>, <span class="st">"lightpink"</span>, <span class="st">"white"</span><span class="op">)</span> <span class="co">#WHAT RULE WILL WE USE, AND WHAT NEW CSS VALUES WILL WE SET TO EACH POSSIBILITY?</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">##TABLE OBSERVER (BUTTON)</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">go_button</span>, <span class="op">{</span> </span>
<span>    </span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">basic_table</span> <span class="op">=</span> <span class="fu">renderDT</span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="va">gap</span> <span class="op">%&gt;%</span> </span>
<span>        <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">datatable</span><span class="op">(</span></span>
<span>          selection <span class="op">=</span> <span class="st">"none"</span>, </span>
<span>          options <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>            info <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>            ordering <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            searching <span class="op">=</span> <span class="cn">FALSE</span> </span>
<span>          <span class="op">)</span></span>
<span>        <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>        <span class="co">#SAME AS ABOVE</span></span>
<span>        <span class="fu">formatRound</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"gdpPercap"</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">formatStyle</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"continent"</span>, textAlign <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>        <span class="fu">formatStyle</span><span class="op">(</span></span>
<span>          columns <span class="op">=</span> <span class="st">"lifeExp"</span>, </span>
<span>          target <span class="op">=</span> <span class="st">"row"</span>, </span>
<span>          backgroundColor <span class="op">=</span> <span class="fu">styleEqual</span><span class="op">(</span></span>
<span>            levels <span class="op">=</span> <span class="va">gap</span><span class="op">$</span><span class="va">lifeExp</span>, </span>
<span>            values <span class="op">=</span> <span class="fu">ifelse</span><span class="op">(</span><span class="va">gap</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="fl">70</span>, <span class="st">"lightpink"</span>, <span class="st">"white"</span><span class="op">)</span></span>
<span>          <span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/SPIFFY%20dt.png" alt="Now, our continent column values are center-aligned instead of left-aligned, our GDP data are less unruly (because we’ve rounded them), and any row with a life expectancy value &gt; 70 is now light pink, perhaps helping these rows stand out from all others." class="figure mx-auto d-block"><div class="figcaption">Now, our continent column values are
center-aligned instead of left-aligned, our GDP data are less unruly
(because we’ve rounded them), and any row with a life expectancy value
&gt; 70 is now light pink, perhaps helping these rows stand out from all
others.</div>
</figure><p><code>format*()</code> functions ask us to pick 1+ columns to
restyle. Then, we provide <strong>property</strong> and
<strong>value</strong> pairings as inputs, just as we would using CSS
code, but using “R-like” syntax instead, <em>e.g.</em>,
<code>textAlign = center</code> versus
<code>text-align: center;</code>.</p>
<p>If we want to format a column <strong>conditionally</strong>,
<em>i.e.</em>, formatting only <em>some</em> rows according to a rule,
we use the <code>style*()</code> functions. In the example above, we
used <code>styleEqual()</code> to apply a light pink background to only
rows with life expectancy greater than <code>70</code>. This might now
stand out to users in ways that enable certain workflows.</p>
</div>
</section><section><h2 class="section-heading" id="update-dont-remake-dt-edition">Update, don’t remake, DT edition!<a class="anchor" aria-label="anchor" href="#update-dont-remake-dt-edition"></a>
</h2>
<hr class="half-width">
<p>So far, when user actions have dictated change to the data in our
table (<em>e.g.</em>, how it’s sorted), we’ve re-rendered the
<em>entire</em> table to <strong>handle</strong> those
<strong>events</strong>.</p>
<p>This works, but it’s undesirable for (at least) three reasons:</p>
<ol style="list-style-type: decimal">
<li><p>With large data sets, it could be <em>slow</em>! Remember that,
as R code executes server-side, the app will become completely
unresponsive, so your users will have to sit around while your code
finishes.</p></li>
<li>
<p>To the user, the table may appear to “flicker” out and in again
as it’s remade (if that’s fast).</p>
<ol style="list-style-type: decimal">
<li>If it’s slow, the table will instead “gray out” and the whole app
will “freeze” while the code completes.</li>
</ol>
</li>
<li><p>If the user had customized the table in any way (they’ve
navigated to a specific page, <em>e.g.</em>), those customizations will
be lost if we rebuild the table.</p></li>
</ol>
<p>If you think about it, if <em>all</em> we’re doing is changing the
data in our table, there’s no need to remake the <em>whole</em>
table—why blow up and rebuild all the rows, columns, and cells when we
just need to change what’s <em>in</em> the cells? <em>Whenever
possible,</em> <em>we should update a complex interactive graphic
element rather than remake it.</em></p>
<p>To update complex interactive graphic elements”on the fly,” we use
<strong>proxies.</strong> These are like a telephone that lets R (server
side) and JavaScript (client side) talk directly to adjust a widget
without refashioning any aspects that don’t need adjustment.</p>
<p><code>DT</code>’s <code>dataTableProxy()</code> function takes as
input the <code>outputId</code> of the table we’re updating. We then
pipe it into a helper function such as <code>replaceData()</code>, which
specifically swaps out the data inside the table’s cells (adjusting cell
number as needed).</p>
<p>Before that though, we should create a reason we’d <em>need</em> to
swap data sets! Earlier, I mentioned that <code>DT</code> tables have a
<code>selection</code> feature, which allows users to select
rows/columns/cells, an <strong>event</strong> Shiny can watch for.
Although these events are not handled by default, we can change
that!</p>
<p>Let’s create a system in which users can click any cell to select it.
When they do, we’ll filter the table to only rows sharing that same
value in that column (<em>e.g.</em>, clicking a cell containing
<code>Asia</code> will filter to only rows also containing
<code>Asia</code> for <code>continent</code>).</p>
<p>Meanwhile, when no cell is selected (or, equivalently, a selected
cell gets deselected), no filtering is applied.</p>
<p>Sounds complicated? Well, yes and no. There are a number of steps
involved, but none are particularly involved.</p>
<p>So, we’ll go one step at a time. For each, implement the coding
change, run the app, and make sure you understand any changes to the
app’s behaviors.</p>
<p>First, let’s turn on <code>selection</code> inside
<code>datatable()</code> by changing the input from <code>"none"</code>
to <code>list(mode = "single", target = "cell")</code>, which will
enable users to select one cell at a time:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** ALL table-related code contained within your server.R file!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">###BASIC GAPMINDER TABLE</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_table</span> <span class="op">=</span> <span class="fu">renderDT</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">gap</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">datatable</span><span class="op">(</span></span>
<span>        selection <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"single"</span>, target <span class="op">=</span> <span class="st">"cell"</span><span class="op">)</span>, <span class="co">#&lt;--TURN ON SINGLE-CELL SELECTION</span></span>
<span>        options <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>          info <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>          ordering <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>          searching <span class="op">=</span> <span class="cn">FALSE</span> </span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">formatRound</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"gdpPercap"</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">formatStyle</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"continent"</span>, textAlign <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">formatStyle</span><span class="op">(</span></span>
<span>        columns <span class="op">=</span> <span class="st">"lifeExp"</span>, </span>
<span>        target <span class="op">=</span> <span class="st">"row"</span>, </span>
<span>        backgroundColor <span class="op">=</span> <span class="fu">styleEqual</span><span class="op">(</span></span>
<span>          levels <span class="op">=</span> <span class="va">gap</span><span class="op">$</span><span class="va">lifeExp</span>, </span>
<span>          values <span class="op">=</span> <span class="fu">ifelse</span><span class="op">(</span><span class="va">gap</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="fl">70</span>, <span class="st">"lightpink"</span>, <span class="st">"white"</span><span class="op">)</span> </span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">##TABLE OBSERVER (BUTTON)</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">go_button</span>, <span class="op">{</span> </span>
<span>    </span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">basic_table</span> <span class="op">=</span> <span class="fu">renderDT</span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="va">gap</span> <span class="op">%&gt;%</span> </span>
<span>        <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>        <span class="fu">datatable</span><span class="op">(</span></span>
<span>          selection <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"single"</span>, target <span class="op">=</span> <span class="st">"cell"</span><span class="op">)</span>, <span class="co">#&lt;--SAME AS ABOVE</span></span>
<span>          options <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>            info <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>            ordering <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            searching <span class="op">=</span> <span class="cn">FALSE</span> </span>
<span>          <span class="op">)</span></span>
<span>        <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">formatRound</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"gdpPercap"</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">formatStyle</span><span class="op">(</span>columns <span class="op">=</span> <span class="st">"continent"</span>, textAlign <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>        <span class="fu">formatStyle</span><span class="op">(</span></span>
<span>          columns <span class="op">=</span> <span class="st">"lifeExp"</span>, </span>
<span>          target <span class="op">=</span> <span class="st">"row"</span>, </span>
<span>          backgroundColor <span class="op">=</span> <span class="fu">styleEqual</span><span class="op">(</span></span>
<span>            levels <span class="op">=</span> <span class="va">gap</span><span class="op">$</span><span class="va">lifeExp</span>, </span>
<span>            values <span class="op">=</span> <span class="fu">ifelse</span><span class="op">(</span><span class="va">gap</span><span class="op">$</span><span class="va">lifeExp</span> <span class="op">&gt;</span> <span class="fl">70</span>, <span class="st">"lightpink"</span>, <span class="st">"white"</span><span class="op">)</span></span>
<span>          <span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>At this point, our table allows cell selection but doesn’t yet
respond to it. Perhaps more glaringly, though, we’re still re-rendering
the <em>entire</em> table every time the “Go!” button is pressed even
though the “bones” of the table aren’t changing. This requires us to
duplicate a <em>lot</em> of code (pretty much all contents of our
<code>renderDT({})</code>s—that’s a sign we’re being inefficient!</p>
<p>Let’s fix that by adjusting our <code>observeEvent({},{})</code> so
that it uses <code>dataTableProxy()</code> and
<code>replaceData()</code> to update, rather than remake, the table:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the TABLE OBSERVER subsection of your server.R file!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">##TABLE OBSERVER (BUTTON)</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">go_button</span>, <span class="op">{</span> </span>
<span>    </span>
<span>    <span class="co">#SORT THE DATA AS USUAL...</span></span>
<span>   <span class="va">gap_sorted</span> <span class="op">=</span> <span class="va">gap</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">#FEED THE SORTED DATA INTO A PROXY...</span></span>
<span>    <span class="fu">dataTableProxy</span><span class="op">(</span><span class="st">"basic_table"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="co">#THEN, SIMPLY SWAP OUT THE OLD DATA FOR THE NEW (NO RE-RENDERING!). ALSO, KEEP CELL SELECTION AS IT WAS.</span></span>
<span>      <span class="fu">replaceData</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gap_sorted</span>, <span class="co">#&lt;--NOTE CHANGE IN DF REFERENCED HERE.</span></span>
<span>                  clearSelection <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="co">##IF YOU MAKE THIS CHANGE, THE APP SHOULD WORK AS IT HAS, EXCEPT THE CHANGES TO THE TABLE WHEN HITTING THE GO BUTTON SHOULD BE SUBTLER AND SMOOTHER THAN BEFORE.</span></span></code></pre>
</div>
<p>This observer is now much cleaner than before. All adjustments to the
table’s features and aesthetics happen up front and then never again in
the original <code>renderDT({})</code> call, whereas the sorting (and
<em>only</em> the sorting) happens in the observer. We also don’t
re-render the table; instead, we use a proxy to swap in new data.</p>
<p>…Of course, we still need to also watch for changes in cell
selection. But how?</p>
<p>Like others widget, <em><code>DT</code>s pass information from the UI
to the server using the <code>input</code> object</em>,and we can access
that information server-side using <code>input$outputId_*</code>
format.</p>
<p>In this case, the <code>*</code> will be <code>cells_selected</code>
because that’s the <strong>event type</strong> of interest:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added to** your server.R file, below all previous code but within your server function!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">##TABLE OBSERVER (CELL SELECTION)</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span>, <span class="op">{</span></span>
<span>    </span>
<span>    <span class="fu">print</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span><span class="op">)</span> <span class="co">#&lt;--PRINT TO THE R CONSOLE THE CONTENTS OF THIS OBJECT EVERY TIME THIS EXPRESSION EXECUTES.</span></span>
<span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Here, we learn a little trick: R’s <code>print()</code> function can
be used to show the current value of a <strong>reactive object</strong>
at specific time points. This is useful for seeing what reactive objects
look like, as in this case. It can also be useful for debugging
(<em>e.g.</em>, to see when an observer detects (or fails to detect) an
event).</p>
<p>If you run the app now and start selecting cells, you’ll observe that
<code>input$basic_table_cells_selected</code> returns a matrix when
accessed. Either this matrix has no rows (when no cell is selected, such
as on start-up) or one row with two values: row and column numbers for
the selected cell.</p>
<figure><img src="fig/cell%20selection.gif" alt="By using print(), we can see when our observer executes its second expression and also what our cell selection reactive object looks like when that happens." class="figure mx-auto d-block"><div class="figcaption">By using print(), we can see when our observer
executes its second expression and also what our cell selection reactive
object looks like when that happens.</div>
</figure><p>We can use that info being tracked to find the value in the selected
cell plus the name of the column of the selected cell. We can then
filter our data set accordingly (this just requires some good,
old-fashioned “R” data wrangling! If the R code here is too much for
you, just copy-paste it and don’t worry too much about what exactly it
does):</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the TABLE OBSERVER subsection of your server.R file!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">##TABLE OBSERVER (CELL SELECTION)</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span>, <span class="op">{</span></span>
<span>    </span>
<span>    <span class="fu">req</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span><span class="op">)</span> <span class="co">#&lt;--THE req() FUNCTION WORKS A BIT LIKE IF--IF THE CONTENTS DON'T EXIST, NOTHING ELSE BELOW req() WILL RUN.</span></span>
<span>    </span>
<span>    <span class="co">#WHAT WAS THE VALUE IN THE SELECTED CELL?</span></span>
<span>    <span class="va">val2match</span> <span class="op">=</span> <span class="va">gap</span><span class="op">[</span><span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                    <span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                    drop <span class="op">=</span> <span class="cn">T</span><span class="op">]</span> <span class="co">#&lt;--PRODUCE A VECTOR, NOT A DATA FRAME</span></span>
<span>    </span>
<span>    <span class="co">#WHAT WAS THE NAME OF THE COLUMN OF THE SELECTED CELL?</span></span>
<span>    <span class="va">col2match</span> <span class="op">=</span> <span class="fu">names</span><span class="op">(</span><span class="va">gap</span><span class="op">)</span><span class="op">[</span><span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="co">#FILTER THE DATA SET BY THAT COLUMN TO ONLY CELLS WITH THAT SAME VALUE.</span></span>
<span>    <span class="va">gap_filtered</span> <span class="op">=</span> <span class="va">gap</span><span class="op">[</span><span class="va">gap</span><span class="op">[</span>, <span class="va">col2match</span><span class="op">]</span> <span class="op">==</span> <span class="va">val2match</span>, <span class="op">]</span></span>
<span>    </span>
<span>    <span class="fu">dataTableProxy</span><span class="op">(</span><span class="st">"basic_table"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">replaceData</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gap_filtered</span>, <span class="co">#&lt;--REFERENCE gap_filtered HERE. </span></span>
<span>                  clearSelection <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Here, we meet another handy tool: <code>req()</code>.
<code>req()</code> checks to make sure its contents exist
(<em>i.e.</em>, aren’t <code>NULL</code>, <code>NA</code>, blank, etc.).
If they don’t, all remaining code beneath <code>req()</code> won’t
run.</p>
<p>We need it here because <code>input$basic_table_cells_selected</code>
won’t exist sometimes (like on start-up and when no cells are selected).
In those instances, the rest of our code in this observer would
break.</p>
<p>Our observer works! …Or does it? Try it and see:</p>
<figure><img src="fig/bad%20filtering.gif" alt="The filtering doesn’t work the way it ought to–when we click on an ‘Asia’ cell, we get back ‘Africa’ results. What gives?" class="figure mx-auto d-block"><div class="figcaption">The filtering doesn’t work the way it ought
to–when we click on an ‘Asia’ cell, we get back ‘Africa’ results. What
gives?</div>
</figure><p>On the first click, we get the behavior we expect—if we click a cell
containing <code>Asia</code>, we get back <em>only</em> other results
from <code>Asia</code>. However, depending upon where we click next, we
might get back the wrong results. Can you guess why?</p>
<p>The issue is this command:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">val2match</span> <span class="op">=</span> <span class="va">gap</span><span class="op">[</span><span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>                <span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, </span>
<span>                drop <span class="op">=</span> <span class="cn">T</span><span class="op">]</span></span></code></pre>
</div>
<p>We use the row and column numbers in
<code>input$basic_table_cells_selected</code> to find the value inside
the cell selected by finding that same cell in <code>gap</code>.</p>
<p>This works great…the <em>first</em> time. However, the
<em>second</em> time, <code>input$basic_table_cells_selected</code>
contains row and column numbers based on a <em>filtered</em> version of
<code>gap</code>, but we still try to use those row and column numbers
to pull a value out of the <em>original</em> version of
<code>gap</code>. They probably won’t line up!</p>
<p>It seems we need to track the data set so that we’re always
referencing the one users can actually see, especially if they’ve
already filtered one or more times.</p>
<p>This looks like a job for a <strong>reactive value</strong>! Like
<code>input</code> and <code>output</code>, a reactive value is a
“changeable object” that R knows to watch for events. Unlike
<code>input</code> and <code>output</code>, though, we create reactive
values ourselves and can code exactly when and how they change. We
create a reactive value using <code>reactiveVal()</code>, placing the
starting value inside the parentheses:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **added to** your server.R file anywhere inside your server function but outside any reactive contexts!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span><span class="va">current_data</span> <span class="op">=</span> <span class="fu">reactiveVal</span><span class="op">(</span><span class="va">gap</span><span class="op">)</span> <span class="co">#&lt;--WHEN THE APP STARTS, WE STORE gap AS THE STARTING DATA SET.</span></span></code></pre>
</div>
<p>From then on, if we want to access the reactive value’s current
value, we use its name like a function, <em>e.g.</em>,
<code>current_data()</code>. If we want to <em>change</em> the reactive
value’s current value, we can put the new value inside the parentheses,
<em>e.g.</em>, <code>current_data(new)</code>.</p>
<p>Let’s enhance both our observers so that they reference</p>
<p>…Except there’s no “undo.” Once we select a cell, we filter out all
rows that don’t match, and those rows are “lost” to the user because
there’s no way to restore them. And further clicks only cause loss of
more rows!</p>
<p>This is because we didn’t <strong>handle</strong> the <em>other</em>
possibility: that the user has not selected any cell (or that they’ve
de-selected the cell they just had selected, which is functionally the
same).</p>
<p>Whenever no cell is selected, we need to “return” to the original
<code>gapminder</code> data set, albeit sorted appropriately. We can
handle this scenario using <code>if()/else</code>:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the observeEvent({},{}) we introduced in the previous example!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span>  <span class="co">###TABLE OBSERVER (CELL SELECTION)</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="fu">list</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">go_button</span>, <span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span><span class="op">)</span>, <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co">##STEP 6: WE ADD IN AN IF/ELSE PAIR. WE RESPOND ACCORDINGLY WHETHER THERE IS A CELL SELECTED OR NOT.</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu">nrow</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      </span>
<span>      <span class="va">val2match</span> <span class="op">=</span> <span class="va">gap</span><span class="op">[</span><span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, drop <span class="op">=</span> <span class="cn">T</span><span class="op">]</span></span>
<span>      </span>
<span>      <span class="va">col2match</span> <span class="op">=</span> <span class="fu">names</span><span class="op">(</span><span class="va">gap</span><span class="op">)</span><span class="op">[</span><span class="va">input</span><span class="op">$</span><span class="va">basic_table_cells_selected</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>      </span>
<span>      <span class="va">gap_filtered</span> <span class="op">=</span> <span class="va">gap</span><span class="op">[</span><span class="va">gap</span><span class="op">[</span>, <span class="va">col2match</span><span class="op">]</span> <span class="op">==</span> <span class="va">val2match</span>, <span class="op">]</span></span>
<span>      </span>
<span>      <span class="va">gap_sorted</span> <span class="op">=</span> <span class="va">gap_filtered</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="fu">dataTableProxy</span><span class="op">(</span><span class="st">"basic_table"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">replaceData</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gap_sorted</span>, clearSelection <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>      </span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="co">#OTHERWISE, WE SIMPLY SORT THE ORIGINAL GAPMINDER DATA SET AS WE HAVE PREVIOUSLY. </span></span>
<span>      <span class="va">gap_sorted</span> <span class="op">=</span> <span class="va">gap</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">arrange</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu">sym</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">sorted_column</span><span class="op">)</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="fu">dataTableProxy</span><span class="op">(</span><span class="st">"basic_table"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">replaceData</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gap_sorted</span>, clearSelection <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>      </span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Now, we can filter and unfilter our table with just a click! This
functionality could empower a variety of dynamic, engaging workflows for
your users.</p>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Using if/else to handle “undoing” previous actions works really well,
but some users could find it unintuitive. They might not even realize
it’s something they can do!</p>
<p>A more conventional, “expected” approach might be a “reset” button
that restores the original table when pressed.</p>
<p>See if you can figure out how to build such a button <em>without</em>
losing <em>any</em> of the app’s current functionality.</p>
<p>If you succeed, consider whether you, as a user, would prefer the
“select nothing to undo” functionality or the “reset button”
functionality, or if you’d prefer having both.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>First, we add the reset button to our UI, just below the current
“Go!” button:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="do">##This code should **be added to** the "sidebar" content of the Table tabPanel in the BODY section of your ui.R file!</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="do">##... other UI code...</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="fu">actionButton</span>(<span class="at">inputId =</span> <span class="st">"go_button"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>                        <span class="at">label =</span> <span class="st">"Go!"</span>)<span class="er">)</span>,</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="fu">actionButton</span>(<span class="at">inputId =</span> <span class="st">"reset_button"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>                        <span class="at">label =</span> <span class="st">"Reset!"</span>)<span class="er">)</span>,</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>  <span class="do">##... other UI code...</span></span></code></pre>
</div>
<p>Then, in our server file, we add a new observer to watch that button
and handle when a user presses it. This is pretty simple here: we use
our proxy to restore the original <code>gapminder</code> data set:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added to** your server.R file, underneath all other contents inside of your server function!</span></span>
<span></span>
<span><span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">reset_button</span>, <span class="op">{</span></span>
<span>              </span>
<span>  <span class="co">##WE REWIND ALL THE WAY BACK TO THE ORIGINAL GAPMINDER DATA AND CLEAR ANY SELECTIONS THE USER MAY ALREADY HAVE MADE.</span></span>
<span>    <span class="fu">dataTableProxy</span><span class="op">(</span><span class="st">"basic_table"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">replaceData</span><span class="op">(</span>data <span class="op">=</span> <span class="va">gap</span>, </span>
<span>                clearSelection <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span>     </span>
<span> <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>As for what I prefer, I think I’d rather have both functionalities.
Together, they make our app more accessible because, while the “click to
undo” approach is easy and precise as an undo mechanism, not every user
may discover or understand it (unless they’re trained well!).</p>
<p>A reset button, meanwhile, is something nearly everyone understands
intuitively. The way we’ve coded it here is pretty “aggressive” in that
it undoes <em>everything</em>, but that will at least match with the
expectations of most users.</p>
<p>And, on the plus side, the reset button enables undoing any sorting,
functionality that didn’t previously exist in any previous version we’ve
had!</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="putting-us-on-the-map">Putting us on the map<a class="anchor" aria-label="anchor" href="#putting-us-on-the-map"></a>
</h3>
<div class="section level4">
<h4 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h4>
<p>Before we go any further, we need to “massage” our data set to make
it ready for mapping (spatial data are complicated!). Add the following
to your <code>global.R</code> file at the end <em>verbatim</em>. Don’t
worry about what it does, though!</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">###MASSAGE DATA SET FOR MAKING MAPS</span></span>
<span><span class="va">gap</span><span class="op">$</span><span class="va">country</span> <span class="op">=</span> <span class="fu">as.character</span><span class="op">(</span><span class="va">gap</span><span class="op">$</span><span class="va">country</span><span class="op">)</span></span>
<span><span class="va">gap</span><span class="op">$</span><span class="va">continent</span> <span class="op">=</span> <span class="fu">as.character</span><span class="op">(</span><span class="va">gap</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gap</span><span class="op">$</span><span class="va">ID</span> <span class="op">=</span> <span class="fu">countrycode</span><span class="op">(</span><span class="va">gap</span><span class="op">$</span><span class="va">country</span>, <span class="st">"country.name"</span>, <span class="st">"iso3c"</span><span class="op">)</span></span>
<span><span class="va">world</span> <span class="op">=</span> <span class="fu">read_sf</span><span class="op">(</span><span class="st">"TM_WORLD_BORDERS_SIMPL-0.3.shp"</span><span class="op">)</span> <span class="co">#&lt;--THIS FILE CAN BE DOWNLOADED VIA &lt;https://drive.google.com/file/d/1Ta0GSnoJPyEMFjjbpzE3Z8RD0Mq18RL7/view?usp=sharing&gt;. MAKE SURE TO UNZIP IT AND MOVE IT AND ALL ITS COMPANION FILES INTO YOUR R PROJECT FOLDER!</span></span>
<span></span>
<span><span class="va">world2</span> <span class="op">=</span> <span class="va">world</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">ISO3</span>, <span class="va">geometry</span><span class="op">)</span></span>
<span><span class="va">gap_map</span> <span class="op">=</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">gap</span>, <span class="va">world2</span>, by <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"ID"</span> <span class="op">=</span> <span class="st">"ISO3"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">gap_map</span> <span class="op">=</span> <span class="fu">st_as_sf</span><span class="op">(</span><span class="va">gap_map</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level4">
<h4 id="preface">Preface<a class="anchor" aria-label="anchor" href="#preface"></a>
</h4>
<p><code>DT</code> has shown us how more complex widgets operate in R
Shiny, so we can switch to making map widgets using
<code>leaflet</code>. We’ll follow the same roadmap we just used for
<code>DT</code>:</p>
<ol style="list-style-type: decimal">
<li><p>We’ll start with a basic map.</p></li>
<li><p>Then, we’ll adjust some features and dress up its
aesthetics.</p></li>
<li><p>Lastly, we’ll learn about map-specific events and how to handle
those events <em>without</em> redrawing the entire map.</p></li>
</ol>
<p>The specifics will be different, but all the concepts here we’ve
already been introduced to, so we can get another round of practice with
them.</p>
</div>
<div class="section level4">
<h4 id="basic-map">Basic map<a class="anchor" aria-label="anchor" href="#basic-map"></a>
</h4>
<p>Let’s make a <code>leaflet</code> map showing the countries in our
data set colored by their 2007 life expectancy data. We’ll place the
result in our UI’s “Map” tab panel.</p>
<p>Every <code>leaflet</code> map has three building blocks:</p>
<ol style="list-style-type: decimal">
<li><p>A <code>leaflet()</code> call. This function is like
<code>ggplot()</code> from the <code>ggplot2</code> package—it “sets the
stage” for the rest of the graphic, and you can specify some settings
here that’ll apply to all subsequent components.</p></li>
<li><p>A <code>addTiles()</code> call. This function place’s a “tile,”
or background, on your map. This is that thing indicating where lakes
and roads and boundaries are! We’ll use the default tile here, but there
are many others to choose from.</p></li>
<li>
<p>At least one <code>add*()</code> function call for adding
<strong>spatial data</strong> to our map. There are others, but the
three most commonly used ones are:</p>
<ol style="list-style-type: decimal">
<li><p><code>addMarkers()</code> adds <strong>spatial point</strong>
(0-dimensional) <strong>data</strong> (like the locations of
restaurants).</p></li>
<li><p><code>addLines()</code> adds <strong>spatial line/curve</strong>
(1-dimensional) <strong>data</strong> (like roads or rivers).</p></li>
<li><p><code>addPolygons()</code> adds <strong>spatial polygon</strong>
(2-dimensional) <strong>data</strong> (like country
boundaries).</p></li>
</ol>
</li>
</ol>
<p>Here, we’ll use <code>addPolygons()</code>:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **swapped** for the the "main panel" content in the BODY section of your ui.R file!</span></span>
<span></span>
<span><span class="co">##... other UI code...</span></span>
<span></span>
<span><span class="co">###MAIN PANEL CELL</span></span>
<span>    <span class="fu">column</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">8</span>, <span class="fu">tabsetPanel</span><span class="op">(</span></span>
<span>      <span class="co">###TABLE TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Table"</span>, <span class="fu">dataTableOutput</span><span class="op">(</span><span class="st">"basic_table"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="co">###MAP TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map"</span>, <span class="fu">leafletOutput</span><span class="op">(</span><span class="st">"basic_map"</span><span class="op">)</span><span class="op">)</span>, <span class="co">#&lt;--ADD OUR NEW MAP.</span></span>
<span>      <span class="co">###GRAPH TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Graph"</span>,</span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co">##... other UI code...</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added to** your server.R file, underneath all other contents inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="co">##FILTER TO ONLY 2007 DATA.</span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu">leaflet</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--GETS THINGS STARTED</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--ADDS A BACKGROUND </span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>, <span class="co">#SPECIFY OUR SPATIAL DATA (geometry IS AN sf PACKAGE CONSTRUCTION)</span></span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>, <span class="co">#&lt;-BLACK OUTLINE</span></span>
<span>        weight <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co">#THICKER-THAN-DEFAULT OUTLINE.</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>The code above creates a nice, if somewhat basic, interactive map
showing the countries for which we have data, outlined in black. Notice
that you can <strong>pan</strong> the map by clicking anywhere, holding
the click, and moving the mouse.</p>
<p>Notice that you can also <strong>zoom</strong> the map in or out
using your mouse wheel (if you have one), or by using the plus/minus
buttons in the top-left corner. Double-clicking on the map also zooms
in.</p>
<p>If you zoom in a lot, you’ll see the tile change to show greater
detail. If you zoom out, you’ll see the world actually repeat several
times left-to-right, if your screen is wide enough…pretty weird!</p>
</div>
<div class="section level4">
<h4 id="more-or-less-basic-map">More (or less) basic map<a class="anchor" aria-label="anchor" href="#more-or-less-basic-map"></a>
</h4>
<p>As we just saw, it often doesn’t make sense to allow users to
<strong>pan</strong> and <strong>zoom</strong> without any
guardrails—they can get lost or produce unhelpful visual quirks to
arise. As I noted earlier, <code>leaflet()</code> contains many global
settings we can apply to our map. For example, we can set min and max
zoom levels like so:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co">##THE leaflet() FUNCTION HAS A LIST OF OPTIONS WE CAN ADJUST, SUCH AS THE MIN AND MAX ZOOM LEVELS.</span></span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>        weight <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>A <code>minZoom</code> of 2 is one in which <em>almost</em> the
entire world is visible at once (on my laptop, anyway!). A
<code>maxZoom</code> of 6 allows users to zoom into specific continental
regions but no further. This keeps users from zooming in or out to a
degree that doesn’t really make sense given our data.</p>
<p>We can also set <strong>maximum bounds</strong>—users can’t
<strong>pan</strong> the map past these:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">#THE SF PACKAGE'S st_bbox() FUNCTION GETS THE FOUR POINTS THAT WOULD CREATE A BOX FULLY BOUNDING ALL SPATIAL DATA WE GIVE IT AS INPUTS.</span></span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>        weight <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>  </span>
<span>      <span class="co">##setMaxBounds() TAKES, AS INPUTS, THOSE EXACT SAME FOUR POINTS.</span></span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>When a user tries to pan past the bounds, the map will “snap back” to
a focus point within the bounds.</p>
<p>While there are other features we could adjust or disable, setting
bounds and a minimum and maximum zoom are two things you’ll generally
want to do to every map you make.</p>
<div class="section level5">
<h5 id="adding-some-pizzazz">Adding some pizzazz<a class="anchor" aria-label="anchor" href="#adding-some-pizzazz"></a>
</h5>
<p>Our map is still rather basic-looking. In fact, it doesn’t even
fulfill the minimum specifications we’d set—it doesn’t show the life
expectancy data yet.</p>
<p>To fix that, we need to set up a <strong>color palette</strong> so
<code>leaflet</code> knows <em>how</em> to fill our country polygons
(it’s a <em>little</em> fussy!). We can build a color palette using
<code>leaflet</code>’s <code>colorNumeric()</code> function.</p>
<p>This function has two required inputs: a <code>palette</code>, the
name of the R color palette we’d like to use, and a <code>domain</code>,
the set of values we’ll need colors for in our final palette:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co">#ESTABLISH A COLOR SCHEME TO USE FOR OUR FILLS.</span></span>
<span>    <span class="va">map_palette</span> <span class="op">=</span> <span class="fu">colorNumeric</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Blues"</span>, domain <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>        weight <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>  </span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Once <code>leaflet</code> knows every value it’ll need a color for
(<code>domain</code>) and every color it should use
(<code>palette</code>), we can add coloring instructions to
<code>addPolygons()</code>:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">map_palette</span> <span class="op">=</span> <span class="fu">colorNumeric</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Blues"</span>, domain <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>, <span class="co">#&lt;--NOTICE THAT THE OUTLINE ("STROKE") HAS A DIFFERENT COLOR PARAMETER THAN THE FILL.</span></span>
<span>        weight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        fillColor <span class="op">=</span> <span class="fu">map_palette</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span>, <span class="co">#&lt;--WE USE OUR NEW COLOR PALETTE LIKE A FUNCTION, SPECIFYING OUR DATA AS INPUTS.</span></span>
<span>        fillOpacity <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co">#&lt;--THE DEFAULT, 0.5, WASHES OUT THE COLORS TOO MUCH.</span></span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>This is already a <em>much</em> cooler map!</p>
<p>But shouldn’t there be a <strong>legend</strong> that clarifies what
colors go with what values? We can add one using
<code>addLegend()</code>:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>   <span class="va">map_palette</span> <span class="op">=</span> <span class="fu">colorNumeric</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Blues"</span>, domain <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        weight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        fillColor <span class="op">=</span> <span class="fu">map_palette</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>        fillOpacity <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="co">#ADD A LEGEND TO THE MAP</span></span>
<span>      <span class="fu">addLegend</span><span class="op">(</span></span>
<span>        position <span class="op">=</span> <span class="st">"bottomleft"</span>, <span class="co">#&lt;--WHERE TO PUT IT.</span></span>
<span>        pal <span class="op">=</span> <span class="va">map_palette</span>, <span class="co">#&lt;--COLOR SCHEME TO USE.</span></span>
<span>        values <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span>, <span class="co">#WHAT SCALE ANCHORS ("BREAKS") TO USE.</span></span>
<span>        opacity <span class="op">=</span> <span class="fl">0.75</span>, <span class="co">#LEGEND TRANSPARENCY.</span></span>
<span>        bins <span class="op">=</span> <span class="fl">5</span>, <span class="co">#NUMBER OF BREAKS TO HAVE.</span></span>
<span>        title <span class="op">=</span> <span class="st">"Life&lt;br&gt;expectancy ('07)"</span> <span class="co">#LEGEND TITLE.</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>This is a nice looking map!</p>
<p>…But what if our users don’t know much geography, so they don’t know
which countries are which? Or what if they wanted to know the
<em>exact</em> life expectancy value for a country? This map couldn’t
easily address either issue.</p>
<p>Adding <strong>tooltips</strong> would help address both. A tooltip
is a small pop-up that might appear on mouse hover (in
<code>leaflet</code>, those are called “labels”), on mouse click
(leaflet calls these “popups”), or after some other action.</p>
<p>Using the <code>popup</code> parameter inside
<code>addPolygons()</code>, we can add tooltips that appear and
disappear on mouse click. Inside these, we’ll put the name of the
country being clicked on, in case users don’t know their countries
well:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">map_palette</span> <span class="op">=</span> <span class="fu">colorNumeric</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Blues"</span>, domain <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        weight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        fillColor <span class="op">=</span> <span class="fu">map_palette</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>        fillOpacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        popup <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">country</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--MAKE A TOOLTIP HOLDING THE RELEVANT COUNTRY APPEAR/DISAPPEAR ON MOUSE CLICK. </span></span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addLegend</span><span class="op">(</span></span>
<span>        position <span class="op">=</span> <span class="st">"bottomleft"</span>,</span>
<span>        pal <span class="op">=</span> <span class="va">map_palette</span>,</span>
<span>        values <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span>,</span>
<span>        opacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        bins <span class="op">=</span> <span class="fl">5</span>,</span>
<span>        title <span class="op">=</span> <span class="st">"Life&lt;br&gt;expectancy ('07)"</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>This is a nice addition, but what if we wanted to add life expectancy
values too? And keep the result human-readable? There are many
approaches we could take, but one using “Normal R’s” versatile
<code>paste0()</code> function plus the HTML line break element
(<code>&lt;br&gt;</code>) is straightforward:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">map_palette</span> <span class="op">=</span> <span class="fu">colorNumeric</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Blues"</span>, domain <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        weight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        fillColor <span class="op">=</span> <span class="fu">map_palette</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>        fillOpacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        popup <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span><span class="st">"County: "</span>, <span class="co">#&lt;--WE USE R'S paste0() FUNCTION AND THE HTML LINE BREAK ELEMENT &lt;br&gt; TO MAKE THE TOOLTIP TEXT VERY READABLE AND INFO-RICH.</span></span>
<span>                       <span class="va">gap_map2007</span><span class="op">$</span><span class="va">country</span>,</span>
<span>                       <span class="st">"&lt;br&gt;Life Expectancy: "</span>,</span>
<span>                       <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addLegend</span><span class="op">(</span></span>
<span>        position <span class="op">=</span> <span class="st">"bottomleft"</span>,</span>
<span>        pal <span class="op">=</span> <span class="va">map_palette</span>,</span>
<span>        values <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span>,</span>
<span>        opacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        bins <span class="op">=</span> <span class="fl">5</span>,</span>
<span>        title <span class="op">=</span> <span class="st">"Life&lt;br&gt;expectancy ('07)"</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Now, our map is both snazzy and informative!</p>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>In the previous example, we used <code>popup</code> to build our
tooltips. Try using the <code>label</code> parameter instead. For
whatever reason, this requires more “normal R” data wrangling, so here’s
the <em>exact</em> code you’ll need (feel free to copy and paste
it!):</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">label</span> <span class="op">=</span> <span class="fu">lapply</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu">nrow</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span> </span>
<span>                    <span class="fu">HTML</span><span class="op">(</span><span class="fu">paste0</span><span class="op">(</span><span class="st">"County: "</span>,</span>
<span>                                 <span class="va">gap_map2007</span><span class="op">$</span><span class="va">country</span><span class="op">[</span><span class="va">x</span><span class="op">]</span>, </span>
<span>                                 <span class="st">"&lt;br&gt;Life Expectancy: "</span>, </span>
<span>                                <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>What changes? Which do you prefer? Which would be better if a lot of
your users will use mobile devices, do you think?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>If we use <code>label</code>, we get tooltips that appears on mouse
hover instead of on mouse click. Actually, this is <em>probably</em>
more intuitive for most users; many will not expect a click to do
anything and may only discover our on-click-style tooltips by
accident!</p>
<p>On the other hand, tooltips that appear on hover can be annoying if a
user is trying to, <em>e.g.</em>, trace a path with their mouse and
irrelevant tooltips keep getting in the way or providing
distractions.</p>
<p>Also, an advantage of on-click tooltips is that they <em>don’t</em>
disappear until a user is ready for them to do so, whereas tooltips that
disappear when the mouse is moved can prevent users from consulting a
tooltip while also using their mouse somewhere else on the page.</p>
<p>However, the biggest potential disadvantage of “on-hover” tooltips is
that, while there is an equivalent to a mouse click on touchscreen
devices (a finger press), there is no <em>universal</em> equivalent to a
mouse hover (some browsers and platforms use a “long press” for this,
but not all, and many users are not accustomed to taking that action
anyway!).</p>
<p>So, mobile users won’t generally see tooltips if they appear
<em>only</em> on hover. If we’re aiming for “mobile-first” design, the
<code>popup</code> option is better (which is why I picked it)!</p>
<p>However, note that by using <code>labelOptions</code>, we can adjust
which events cause tooltips to appear, <em>e.g.</em>, we can make them
appear on both hover and on touch.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="update-dont-remake-leaflet-edition">Update, don’t remake, <code>leaflet</code> edition!<a class="anchor" aria-label="anchor" href="#update-dont-remake-leaflet-edition"></a>
</h3>
<p>At this stage, our users have <em>no</em> control over <em>which</em>
data are shown in our map. Let’s give them that control by adding a
<strong>slider input widget</strong> that will let them select which
year’s data is plotted:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="do">##This code should **replace** the "sidebar panel" cell's content within the BODY section of your ui.R file!</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="do">##... other UI code...</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a><span class="do">###SIDEBAR CELL</span></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>    <span class="fu">column</span>(</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>      <span class="fu">selectInput</span>(</span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a>        <span class="at">inputId =</span> <span class="st">"sorted_column"</span>,</span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"Select a column to sort the table by."</span>,</span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a>        <span class="at">choices =</span> <span class="fu">c</span>(</span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a>          <span class="st">"Country"</span> <span class="ot">=</span> <span class="st">"country"</span>,</span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a>          <span class="st">"Continent"</span> <span class="ot">=</span> <span class="st">"continent"</span>,</span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a>          <span class="st">"Year"</span> <span class="ot">=</span> <span class="st">"year"</span>,</span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a>          <span class="st">"Life expectancy"</span> <span class="ot">=</span> <span class="st">"lifeExp"</span>,</span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a>          <span class="st">"Population size"</span> <span class="ot">=</span> <span class="st">"pop"</span>,</span>
<span id="cb25-17"><a href="#cb25-17" tabindex="-1"></a>          <span class="st">"GDP per capita"</span> <span class="ot">=</span> <span class="st">"gdpPercap"</span></span>
<span id="cb25-18"><a href="#cb25-18" tabindex="-1"></a>        )</span>
<span id="cb25-19"><a href="#cb25-19" tabindex="-1"></a>      ),</span>
<span id="cb25-20"><a href="#cb25-20" tabindex="-1"></a>      <span class="fu">actionButton</span>(<span class="at">inputId =</span> <span class="st">"go_button"</span>, <span class="at">label =</span> <span class="st">"Go!"</span>),</span>
<span id="cb25-21"><a href="#cb25-21" tabindex="-1"></a>      <span class="co"># actionButton(inputId = "reset_button",</span></span>
<span id="cb25-22"><a href="#cb25-22" tabindex="-1"></a>      <span class="co">#                   label = "Reset!"),</span></span>
<span id="cb25-23"><a href="#cb25-23" tabindex="-1"></a>      <span class="co">#ADD OUR NEWEST SLIDER WIDGET</span></span>
<span id="cb25-24"><a href="#cb25-24" tabindex="-1"></a>      <span class="fu">sliderInput</span>(</span>
<span id="cb25-25"><a href="#cb25-25" tabindex="-1"></a>        <span class="at">inputId =</span> <span class="st">"year_slider"</span>,</span>
<span id="cb25-26"><a href="#cb25-26" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"Pick what year's data are shown in the map."</span>,</span>
<span id="cb25-27"><a href="#cb25-27" tabindex="-1"></a>        <span class="at">value =</span> <span class="dv">2007</span>, <span class="co">#&lt;--SET THE DEFAULT CHOICE</span></span>
<span id="cb25-28"><a href="#cb25-28" tabindex="-1"></a>        <span class="at">min =</span> <span class="fu">min</span>(gap<span class="sc">$</span>year), <span class="co">#&lt;--MIN AND MAX POSSIBLE SELECTIONS</span></span>
<span id="cb25-29"><a href="#cb25-29" tabindex="-1"></a>        <span class="at">max =</span> <span class="fu">max</span>(gap<span class="sc">$</span>year),</span>
<span id="cb25-30"><a href="#cb25-30" tabindex="-1"></a>        <span class="at">step =</span> <span class="dv">5</span>, <span class="co">#&lt;--HOW FAR APART CAN CHOICES BE?</span></span>
<span id="cb25-31"><a href="#cb25-31" tabindex="-1"></a>        <span class="at">sep =</span> <span class="st">""</span> <span class="co">#&lt;--DON'T USE COMMAS TO SEPARATE THE THOUSANDS PLACE.</span></span>
<span id="cb25-32"><a href="#cb25-32" tabindex="-1"></a>      )),</span>
<span id="cb25-33"><a href="#cb25-33" tabindex="-1"></a>  <span class="do">##... other UI code...</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###MAP</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="co">##WE'LL KEEP THIS DATASET NAMED AFTER YEAR 2007. WE'LL SEE WHY A BIT LATER.</span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">year_slider</span><span class="op">)</span><span class="op">)</span> <span class="co">#&lt;--INTRODUCE THE  SLIDER'S CURRENT VALUE. EVERY CHANGE TO THIS WILL TRIGGER'S OUR renderLeaflet({}) CODE TO RERUN.</span></span>
<span>    </span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">map_palette</span> <span class="op">=</span> <span class="fu">colorNumeric</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Blues"</span>, domain <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        weight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        fillColor <span class="op">=</span> <span class="fu">map_palette</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>        fillOpacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        popup <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span><span class="st">"County: "</span>,</span>
<span>                       <span class="va">gap_map2007</span><span class="op">$</span><span class="va">country</span>,</span>
<span>                       <span class="st">"&lt;br&gt;Life Expectancy: "</span>,</span>
<span>                       <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span></span>
<span>        <span class="co"># label = lapply(1:nrow(gap_map2007), function(x) {</span></span>
<span>        <span class="co">#   HTML(</span></span>
<span>        <span class="co">#     paste0(</span></span>
<span>        <span class="co">#       "County: ",</span></span>
<span>        <span class="co">#       gap_map2007$country[x],</span></span>
<span>        <span class="co">#       "&lt;br&gt;Life Expectancy: ",</span></span>
<span>        <span class="co">#       gap_map2007$lifeExp[x]</span></span>
<span>        <span class="co">#     )</span></span>
<span>        <span class="co">#   )</span></span>
<span>        <span class="co"># })</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addLegend</span><span class="op">(</span></span>
<span>        position <span class="op">=</span> <span class="st">"bottomleft"</span>,</span>
<span>        pal <span class="op">=</span> <span class="va">map_palette</span>,</span>
<span>        values <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span>,</span>
<span>        opacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        bins <span class="op">=</span> <span class="fl">5</span>,</span>
<span>        title <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span><span class="st">"Life&lt;br&gt;expectancy ("</span>, <span class="va">gap_map2007</span><span class="op">$</span><span class="va">year</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">")"</span><span class="op">)</span> <span class="co">#&lt;-HERE, WE GET FANCY USING R's paste0() FUNCTION TO MAKE SURE THE "RIGHT" YEAR IS ALWAYS THE ONE IN THE LEGEND TITLE.</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>This new functionality gives users a new and exciting way to explore
the data!</p>
<p>…However, the way we handle events involving this new input is
<em>not</em> ideal. Each time a user adjusts the slider, the map is
<em>entirely</em> rebuilt. With maps, this can be <em>especially</em>
problematic because spatial data can be <em>very</em> voluminous, so
re-rendering a map from scratch can cause long loading times.</p>
<p>Just as with <code>DT</code>, <code>leaflet</code> features a
<strong>proxy system</strong> that will let us update a map, only
changing features that <em>need</em> to change.</p>
<p>Let’s switch to using that proxy system. The approach will be the
same as with <code>DT</code>:</p>
<ol style="list-style-type: decimal">
<li><p>We use <code>renderLeaflet({})</code> to produce <em>just</em>
the “starting” version of the map that the user sees upon
startup.</p></li>
<li><p>We use a new <code>observeEvent({},{})</code> to watch for
relevant events.</p></li>
<li><p>Inside the observer, we use a proxy built using
<code>leafletProxy()</code>, which is analogous to
<code>dataTableProxy()</code>, to update our map:</p></li>
</ol>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **swapped for** the renderLeaflet({}) code provided previously, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">###MAP</span></span>
<span><span class="co">#renderLeaflet({}) ONLY BUILDS THE FIRST VERSION OF THE MAP. NO REACTIVE OBJECTS HERE, SO IT'LL NEVER RERUN.</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_map</span> <span class="op">=</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">gap_map2007</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span> <span class="co">#&lt;--RESTORE THIS TO 2007 (OUR DEFAULT YEAR).</span></span>
<span>    </span>
<span>    <span class="va">bounds</span> <span class="op">=</span> <span class="fu">unname</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>     <span class="co">#WE MOVE THE CODE MAKING map_palette TO GLOBAL.R SO IT ONLY RUNS ONCE EVER.</span></span>
<span>    </span>
<span>    <span class="fu">leaflet</span><span class="op">(</span>options <span class="op">=</span> <span class="fu">tileOptions</span><span class="op">(</span>maxZoom <span class="op">=</span> <span class="fl">6</span>, minZoom <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">geometry</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        weight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        fillColor <span class="op">=</span> <span class="fu">map_palette</span><span class="op">(</span><span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>        fillOpacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        popup <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span><span class="st">"County: "</span>,</span>
<span>                       <span class="va">gap_map2007</span><span class="op">$</span><span class="va">country</span>,</span>
<span>                       <span class="st">"&lt;br&gt;Life Expectancy: "</span>,</span>
<span>                       <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span></span>
<span>        <span class="co"># label = lapply(1:nrow(gap_map2007), function(x) {</span></span>
<span>        <span class="co">#   HTML(</span></span>
<span>        <span class="co">#     paste0(</span></span>
<span>        <span class="co">#       "County: ",</span></span>
<span>        <span class="co">#       gap_map2007$country[x],</span></span>
<span>        <span class="co">#       "&lt;br&gt;Life Expectancy: ",</span></span>
<span>        <span class="co">#       gap_map2007$lifeExp[x]</span></span>
<span>        <span class="co">#     )</span></span>
<span>        <span class="co">#   )</span></span>
<span>        <span class="co"># })</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">setMaxBounds</span><span class="op">(</span><span class="va">bounds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bounds</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addLegend</span><span class="op">(</span></span>
<span>        position <span class="op">=</span> <span class="st">"bottomleft"</span>,</span>
<span>        pal <span class="op">=</span> <span class="va">map_palette</span>,</span>
<span>        values <span class="op">=</span> <span class="va">gap_map2007</span><span class="op">$</span><span class="va">lifeExp</span>,</span>
<span>        opacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        bins <span class="op">=</span> <span class="fl">5</span>,</span>
<span>        title <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span><span class="st">"Life&lt;br&gt;expectancy ("</span>, <span class="va">gap_map2007</span><span class="op">$</span><span class="va">year</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">")"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">###MAP OBSERVER (SLIDER)</span></span>
<span>  <span class="co">#A NEW OBSERVER WATCHES FOR EVENTS INVOLVING OUR NEW SLIDER.</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">year_slider</span>, <span class="op">{</span></span>
<span>    <span class="va">gap_map</span> <span class="op">=</span> <span class="va">gap_map</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--NOTE THE NAME CHANGE OF THE PRODUCT HERE.</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">year_slider</span><span class="op">)</span><span class="op">)</span> <span class="co">#&lt;--SLOT THAT SLIDER'S INPUT OBJECT HERE.</span></span>
<span>    </span>
<span>  <span class="co">#WE USE leafletProxy({}) TO UPDATE OUR MAP INSTEAD OF RE-RENDERING IT. </span></span>
<span>    <span class="fu">leafletProxy</span><span class="op">(</span><span class="st">"basic_map"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="co">#WE DON'T HAVE TO MESS WITH THE ZOOM, BOUNDS, OR TILES BECAUSE THOSE ASPECTS AREN'T CHANGING. </span></span>
<span>      <span class="fu">clearMarkers</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--WE DO NEED TO REMOVE THE OLD MARKERS THOUGH BECAUSE THEIR COLORS WILL CHANGE.</span></span>
<span>      <span class="fu">clearControls</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--SAME WITH THE LEGEND ("CONTROL") FOR THE SAME REASON.</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span> <span class="co">#&lt;--WE RE-BUILD OUR POLYGONS EXACTLY THE SAME AS ALWAYS...</span></span>
<span>        data <span class="op">=</span> <span class="va">gap_map</span><span class="op">$</span><span class="va">geometry</span>, <span class="co">#&lt;--EXCEPT WE REFERENCE gap_map THROUGHOUT.</span></span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        weight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        fillColor <span class="op">=</span> <span class="fu">map_palette</span><span class="op">(</span><span class="va">gap_map</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span>,</span>
<span>        fillOpacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        popup <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span><span class="st">"County: "</span>,</span>
<span>                       <span class="va">gap_map</span><span class="op">$</span><span class="va">country</span>,</span>
<span>                       <span class="st">"&lt;br&gt;Life Expectancy: "</span>,</span>
<span>                       <span class="va">gap_map</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span></span>
<span>        <span class="co"># label = lapply(1:nrow(gap_map), function(x) {</span></span>
<span>        <span class="co">#   HTML(</span></span>
<span>        <span class="co">#     paste0(</span></span>
<span>        <span class="co">#       "County: ",</span></span>
<span>        <span class="co">#       gap_map$country[x],</span></span>
<span>        <span class="co">#       "&lt;br&gt;Life Expectancy: ",</span></span>
<span>        <span class="co">#       gap_map$lifeExp[x]</span></span>
<span>        <span class="co">#     )</span></span>
<span>        <span class="co">#   )</span></span>
<span>        <span class="co"># })</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">addLegend</span><span class="op">(</span> <span class="co">#&lt;--WE RE-BUILD OUR LEGEND EXACTLY THE SAME WAY TOO. </span></span>
<span>        position <span class="op">=</span> <span class="st">"bottomleft"</span>,</span>
<span>        pal <span class="op">=</span> <span class="va">map_palette</span>,</span>
<span>        values <span class="op">=</span> <span class="va">gap_map</span><span class="op">$</span><span class="va">lifeExp</span>,</span>
<span>        opacity <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        bins <span class="op">=</span> <span class="fl">5</span>,</span>
<span>        title <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span><span class="st">"Life&lt;br&gt;expectancy ("</span>, <span class="va">gap_map</span><span class="op">$</span><span class="va">year</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">")"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added** to the bottom of your global.R file, after gap_map is made!</span></span>
<span></span>
<span><span class="co">###MAP COLOR PALETTE</span></span>
<span><span class="co">#WE MOVE THIS CODE TO GLOBAL.R SO IT NEED ONLY EVER RUN ONCE.</span></span>
<span><span class="va">map_palette</span> <span class="op">=</span> <span class="fu">colorNumeric</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Blues"</span>, domain <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">gap_map</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Since this overhaul was a little involved, let’s break down the key
pieces:</p>
<ol style="list-style-type: decimal">
<li>
<p>First, for simplicity, we removed the code producing our
<code>map_palette</code> from <code>renderLeaflet({})</code>. Why? Now
that we will use this palette in two places, it’s more efficient to have
this code in <code>global.R</code> where it can run just once ever and
be reused whenever needed.</p>
<ul>
<li>This has the added benefit of ensuring every version of our map will
always use the exact same color-value mapping! Otherwise, our
<code>domain</code>s would shift, depending upon which year’s data are
being shown, making it harder to see patterns over time.</li>
</ul>
</li>
<li><p>We “strip back” the code in <code>renderLeaflet({})</code> such
that it contains no reactive objects (<em>e.g.</em>,
<code>input$year_slider</code>). As such, it’ll run once when the app
starts up but never again.</p></li>
<li><p>We create a new <code>observeEvent({},{})</code> watching our
slider. When it’s value changes, <code>leafletProxy()</code> will
dictate what happens.</p></li>
<li>
<p>We feed our proxy <em>only</em> commands affecting aspects that
<em>need</em> to change—in this case, we reference just our polygons and
legend (because their colors need to change).</p>
<ul>
<li><p>We first remove the old versions using <code>clear*()</code>
functions.</p></li>
<li><p>Then, we rebuild each exactly as we built them originally but
based on new data selected by the user.</p></li>
</ul>
</li>
</ol>
<p>Once you’ve made these changes, start the app and observe what
happens when you adjust the slider. You’ll hopefully notice that doing
so results in “smoother” updates than before.</p>
</div>
<div class="section level3">
<h3 id="watch-and-learn">Watch and learn<a class="anchor" aria-label="anchor" href="#watch-and-learn"></a>
</h3>
<p><code>leaflet</code> maps are <strong>widgets</strong> just like all
the rest we’ve seen, so information about user interactions with them
are being <em>constantly</em> passed from the UI to the server by
<code>input</code>. These data can be accessed using
<code>input$outputId_*</code> format.</p>
<p>For example, whenever a user <strong>double-clicks</strong> a
location, this is registered as a “double click event,” and we can
access information about that location using
<code>input$outputId_dblclick</code> format server-side. [There is
“single-click event tracking” too, but because our popups respond to
single clicks already, let’s consider double-clicks here.]</p>
<p>A cool feature of <code>leaflet</code> maps is <code>flyTo()</code>,
which will pan and zoom a map to center on a specific location.</p>
<p>Let’s combine these two features (<code>flyTo</code> plus
double-click event tracking)! Let’s create a new observer that watches
for double-clicks, and, when one happens, a <code>leafletProxy()</code>
centers the map on that location:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added** to the bottom of your server.R file, but still within your server function!</span></span>
<span></span>
<span><span class="co">###MAP OBSERVER (DOUBLE CLICKS)</span></span>
<span><span class="co">#WE TRACK CHANGES IN THE DOUBLE-CLICK STATUS OF OUR MAP AND USE THAT INFO TO FLY TO THE LOCATION OF THE DOUBLE-CLICK.</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">basic_map_dblclick</span>, <span class="op">{</span></span>
<span>    <span class="fu">leafletProxy</span><span class="op">(</span><span class="st">"basic_map"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">flyTo</span><span class="op">(</span></span>
<span>        lat <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">basic_map_dblclick</span><span class="op">$</span><span class="va">lat</span>,</span>
<span>        lng <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">basic_map_dblclick</span><span class="op">$</span><span class="va">lng</span>,</span>
<span>        zoom <span class="op">=</span> <span class="fl">5</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
</div>
</section><section><h2 class="section-heading" id="getting-graphic">Getting graphic<a class="anchor" aria-label="anchor" href="#getting-graphic"></a>
</h2>
<hr class="half-width">
<p>We’ll now turn to <code>plotly</code>, a package for producing
graphs, similar to <code>ggplot2</code>, but that are
<em>interactive</em> <em>by design</em>.</p>
<p>Regular R users who know <code>ggplot2</code> know that learning a
graphics package is like learning a new language! The learning curve is
<em>significant</em>; these packages give users <em>all</em> the tools
needed to design an entire, complex graph piece by piece. That’s a lot
of tools to learn and to keep straight!</p>
<p><code>plotly</code> is no different—you can create ultra-detailed,
publication-quality graphics with <code>plotly</code> too, but you’ll
need to learn a new vernacular to do it, one that may feel similar to
<code>ggplot2</code> but probably not ultra-similar.</p>
<p>As such, covering <code>plotly</code> in depth is outside our scope
here. Thankfully, we actually don’t <em>need</em> to learn it;
<code>plotly</code> comes with an <em>incredible</em> “cheat code” that,
while imperfect, will work fine here: the <code>ggplotly()</code>
function.</p>
<p><code>ggplotly()</code> takes a fully realized <code>ggplot</code>,
breaks it down into pieces, and rebuilds it piece by piece in
<code>plotly</code>’s system (as best as it can). Because the two
systems are ultimately similar, you’ll get a similar-looking graph out
the end, but it’ll now have all the interactive features a scratch-built
<code>plotly</code> graph would have.</p>
<p>However, the two systems <em>don’t</em> map 1-to-1, so the result
will never look <em>exactly</em> the same as the input graph. In
particular, complex customizations using <code>ggplot</code>’s
<code>theme()</code>, text-related components, advanced or new features,
and so on don’t make the transition well.</p>
<p>So, it’s probably correct to say that <code>ggplotly</code> produces
a <code>plotly</code> graph in the spirit of the <code>ggplot2</code>
graph we put in, not an exact replica.</p>
<p>Still, that means we don’t need to learn how to produce a
<code>plotly</code> graph to explore the associated features and use
cases, so that’s a pretty good deal!</p>
<p>To get started, let’s build the <code>ggplot2</code> graph we’ll use
as an input. Let’s make it a scatterplot of GDP vs. population for a
given year (we’ll start by looking at 2007), with each continent getting
a different color. Additionally, we’ll plot a best-fit regression line
for each continent:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added** to the bottom of your global.R file!</span></span>
<span></span>
<span><span class="co">###FILTERED DATA SET FOR MAP</span></span>
<span><span class="va">gap2007</span> <span class="op">=</span> <span class="va">gap</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span></span>
<span></span>
<span><span class="co">###BASE GGPLOT FOR CONVERSION TO PLOTLY</span></span>
<span><span class="co">#IF GGPLOT IS FAMILIAR TO YOU, STUDY THE SPECIFICS HERE TO GET A SENSE OF THE GRAPH WE'RE BUILDING. IF NOT, DON'T WORRY ABOUT THE DETAILS! JUST COPY-PASTE THIS CODE INTO PLACE.</span></span>
<span><span class="va">p1</span> <span class="op">=</span> <span class="fu">ggplot</span><span class="op">(</span></span>
<span>  <span class="va">gap2007</span>,</span>
<span>  <span class="fu">aes</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu">log</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="va">gdpPercap</span>,</span>
<span>    color <span class="op">=</span> <span class="va">continent</span>,</span>
<span>    group <span class="op">=</span> <span class="va">continent</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      size <span class="op">=</span> <span class="fl">16</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"bold"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,</span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.line <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span><span class="st">"GDP per capita\n"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span><span class="st">"\nPopulation size (log)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_discrete</span><span class="op">(</span><span class="st">"Continent\n"</span><span class="op">)</span></span></code></pre>
</div>
<p>If you don’t know <code>ggplot2</code>, the above code will probably
look terrifying! No worries—just copy-paste the code and don’t worry too
much about what each piece does.</p>
<p>For those who <em>do</em> know <code>ggplot2</code>, you’ll hopefully
agree that, although this graph is not terrible remarkable, it looks
pretty good. More importantly, it’s just complex enough that it’ll be a
good test of how well <code>ggplotly()</code> does:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added** to the bottom of your global.R file!</span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu">ggplotly</span><span class="op">(</span><span class="va">p1</span><span class="op">)</span></span></code></pre>
</div>
<p>Now that we have our <code>plotly</code>-ized version of our graph,
it hopefully won’t surprise you to learn there are
<code>renderPlotly({})</code> and <code>plotlyOutput()</code> functions
we can use to add this graph to our app:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **swapped** for the the "main panel" content in the BODY section of your ui.R file!</span></span>
<span></span>
<span><span class="co">##... other UI code...</span></span>
<span><span class="co">###MAIN PANEL CELL</span></span>
<span>    <span class="fu">column</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">8</span>, <span class="fu">tabsetPanel</span><span class="op">(</span></span>
<span>      <span class="co">###TABLE TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Table"</span>, <span class="fu">dataTableOutput</span><span class="op">(</span><span class="st">"basic_table"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="co">###MAP TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map"</span>, <span class="fu">leafletOutput</span><span class="op">(</span><span class="st">"basic_map"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="co">###GRAPH TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Graph"</span>,</span>
<span>        <span class="fu">plotlyOutput</span><span class="op">(</span><span class="st">"basic_graph"</span><span class="op">)</span> <span class="co">#&lt;--ADD THE GRAPH HERE.</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##... other UI code...</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should be **added to** your server.R file, underneath all other contents inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">basic_graph</span> <span class="op">=</span> <span class="fu">renderPlotly</span><span class="op">(</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">p2</span> <span class="co">#Put our pre-built ggplotly() output here.</span></span>
<span>    </span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>If we launch our app, we should see our new <code>plotly</code> graph
on the Graph tab panel. It looks quite similar to our
<code>ggplot</code> graph!</p>
<p>The only difference I really notice is in the placement of the
legend; while <code>ggplot</code>s center their legends vertically in
the available space by default, <code>plotly</code> graphs top-align
them instead.</p>
<p>We’ll adjust that in a moment! Meanwhile, let’s focus on the new
interactive features this graph comes with out of the box (it’s a
lot!):</p>
<ul>
<li><p><strong>Tooltips</strong>: If you hover over a point, you’ll get
a <strong>tooltip</strong> showing the data point’s associated
<code>x</code>, <code>y</code>, and <code>group</code> (continent)
values. These tooltips don’t look “pretty” in a human-readability sense,
but that too is something we’ll soon change.</p></li>
<li><p><strong>Click+drag to zoom</strong>: If you click anywhere, drag
your cursor to highlight a region, and let go, you will zoom the graph
to only the highlighted region. Double-clicking will restore the
original zoom level.</p></li>
<li><p><strong>Interactive “modebar:”</strong> <code>plotly</code>
graphs come with a toolbar (called a “modebar”) in the top-right (when
hovering over the graph) featuring several buttons. These allow you to
download an image of the graph, zoom and pan, select specific data in
various ways, reset the graph in various ways, and change how the
tooltips work. In particular, click the “compare data on hover” button
and see how this changes the behavior of the tooltips!</p></li>
<li><p><strong>Legend group (de)selection</strong>: If you click any of
the legend keys (such as “Asia”), all the data points from that group
will be redacted, and the axes will readjust as though those data
weren’t present. Double-clicking a legend key will reduce the data shown
to <em>only</em> those from that group. This functionality might allow a
user to exclude data extraneous to them personally and to focus of data
that <em>are</em> of interest.</p></li>
</ul>
<p>That’s a lot of interactivity for minimal effort on our part!</p>
<div class="section level3">
<h3 id="more-or-less-basic-graph">More (or less) basic graph<a class="anchor" aria-label="anchor" href="#more-or-less-basic-graph"></a>
</h3>
<p>…which means it’s time to discuss how to disable features if we want.
Unfortunately, disabling features in <code>plotly</code> is not
<em>as</em> easy as in <code>DT</code> or <code>leaflet</code>; to do
so, we must engage with two of the core functions involved in assembly
of a scratch-made <code>plotly</code> graph: <code>layout()</code> and
<code>config()</code>.</p>
<p><code>layout()</code> is <em>sort of</em> equivalent to
<code>ggplot2</code>’s <code>theme()</code> in that it controls many of
the specifics of how the plot looks. Inside <code>layout()</code> are
<code>xaxis</code> and <code>yaxis</code> parameters, which we can
provide with specific instructions.</p>
<p>If we give both of these parameters a list containing the instruction
<code>fixedrange = TRUE</code>, this will prohibit zooming:</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the renderPlotly({}) code in your server.R file, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###GRAPH</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_graph</span> <span class="op">=</span> <span class="fu">renderPlotly</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">p2</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">layout</span><span class="op">(</span> <span class="co">#&lt;--layout() ADJUSTS PLOTLY GRAPH AESTHETICS.</span></span>
<span>        <span class="co">#PLOTLY CODE LOOKS "JAVASCRIPT-LIKE" RATHER THAN "R-LIKE," HENCE LISTS!</span></span>
<span>        xaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        yaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>In my experience, most (but not all!) graphs don’t benefit from
zooming, and some users find it hard to figure out how to reverse an
accidental zoom.</p>
<p>We can also use <code>layout()</code> to adjust how the legend
responds to clicks. For example, if we want to turn off the
functionality that redacts a group when its legend key is clicked on, we
can set the <code>itemclick</code> instruction for the
<code>legend</code> parameter to <code>FALSE</code>:</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the renderPlotly({}) code in your server.R file, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###GRAPH</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_graph</span> <span class="op">=</span> <span class="fu">renderPlotly</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">p2</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">layout</span><span class="op">(</span></span>
<span>        xaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        yaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        legend <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>          itemclick <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co">#&lt;--THE ONLY ADDITION--TURN OFF GROUP REDACTION UPON CLICKING ON LEGEND KEYS.</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">basic_graph</span> <span class="op">=</span> <span class="fu">renderPlotly</span><span class="op">(</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">p2</span> <span class="op">%&gt;%</span> </span>
<span>     <span class="fu">layout</span><span class="op">(</span>xaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            yaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            legend <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>itemclick <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="co">#&lt;-THE ONLY ADDITION HERE.</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>The <code>config()</code> function, meanwhile, can remove buttons
from the modebar, although you may need Google’s help to find the names
of the buttons you want to remove:</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the renderPlotly({}) code in your server.R file, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server </span></span>
<span><span class="co">###GRAPH</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_graph</span> <span class="op">=</span> <span class="fu">renderPlotly</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">p2</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">layout</span><span class="op">(</span></span>
<span>        xaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        yaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        legend <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>          itemclick <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">config</span><span class="op">(</span>modeBarButtonsToRemove <span class="op">=</span> <span class="fu">list</span><span class="op">(</span><span class="st">"lasso2d"</span><span class="op">)</span><span class="op">)</span> <span class="co">#&lt;--REMOVING THE "LASSO" SELECTION BUTTON.</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>As noted earlier, when considering UX, “less” can be “more.” If your
user might not understand it or won’t use it, remove it!</p>
<div class="section level4">
<h4 id="making-some-adjustments">Making some adjustments<a class="anchor" aria-label="anchor" href="#making-some-adjustments"></a>
</h4>
<p>Earlier, we identified two dissatisfying aspects of our graph. First,
the legend isn’t centered vertically, like in our original. Second, the
tooltip text could look nicer.</p>
<p>The first issue is easily solved using the <code>legend</code>
parameter inside of <code>layout()</code>, which we’ve already dabbled
with:</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the renderPlotly({}) code in your server.R file, inside of your server function!</span></span>
<span></span>
<span> <span class="co">##... other server code...</span></span>
<span><span class="co">###GRAPH</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_graph</span> <span class="op">=</span> <span class="fu">renderPlotly</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">p2</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">layout</span><span class="op">(</span></span>
<span>        xaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        yaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        legend <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>          itemclick <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          y <span class="op">=</span> <span class="fl">0.5</span>, <span class="co">#&lt;--PUT THE LEGEND HALFWAY DOWN.</span></span>
<span>          yanchor <span class="op">=</span> <span class="st">"middle"</span> <span class="co">#&lt;--SPECIFICALLY, PUT THE **CENTER** HALFWAY DOWN.</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">config</span><span class="op">(</span>modeBarButtonsToRemove <span class="op">=</span> <span class="fu">list</span><span class="op">(</span><span class="st">"lasso2d"</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>As for the second issue, the best way to beautify our tooltip
contents will be to use the <code>style()</code> function.</p>
<p>This is a multi-step process:</p>
<ol style="list-style-type: decimal">
<li><p>First, let’s “pre-generate” the text we want to use in each
tooltip, (using the <code>dplyr</code> verb
<code>mutate()</code>).</p></li>
<li><p>Second, let’s pass this text through our <code>ggplot</code> call
so it gets packaged up with everything else being passed to
<code>ggplotly()</code>.</p></li>
<li><p>Lastly, let’s use <code>style()</code> to make the contents of
our tooltips <em>only</em> the custom text we’ve cooked up:</p></li>
</ol>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the previous plotly-related code in your global.R file!</span></span>
<span></span>
<span> <span class="co">##... other global code...</span></span>
<span><span class="co">###FILTERED DATA SET FOR MAP</span></span>
<span><span class="va">gap2007</span> <span class="op">=</span> <span class="va">gap</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2007</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>tooltip_text <span class="op">=</span> <span class="fu">paste0</span><span class="op">(</span> <span class="co">#&lt;--HERE, WE GENERATE A NEW COLUMN CALLED tooltip_text USING paste0() THAT CONTAINS THE GDP AND POPULATION DATA IN A MORE READABLE FORMAT. </span></span>
<span>    <span class="st">"GDP: "</span>,</span>
<span>    <span class="fu">round</span><span class="op">(</span><span class="va">gdpPercap</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="st">"&lt;br&gt;"</span>,</span>
<span>    <span class="st">"Population: "</span>,</span>
<span>    <span class="fu">round</span><span class="op">(</span><span class="va">pop</span>, <span class="op">-</span><span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">###BASE GGPLOT FOR CONVERSION TO PLOTLY</span></span>
<span><span class="va">p1</span> <span class="op">=</span> <span class="fu">ggplot</span><span class="op">(</span></span>
<span>  <span class="va">gap2007</span>,</span>
<span>  <span class="fu">aes</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu">log</span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="va">gdpPercap</span>,</span>
<span>    color <span class="op">=</span> <span class="va">continent</span>,</span>
<span>    group <span class="op">=</span> <span class="va">continent</span>,</span>
<span>    text <span class="op">=</span> <span class="va">tooltip_text</span> <span class="co">#&lt;--HERE, WE PASS OUR CUSTOM TOOLTIP TEXT IN AS AN AESTHETIC. EVEN THOUGH OUR GGPLOT NEVER USES THIS INFO, IT'LL BE PASSED ALONG TO OUR PLOTLY GRAPH BY ggplotly(). </span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span></span>
<span>      size <span class="op">=</span> <span class="fl">16</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>      face <span class="op">=</span> <span class="st">"bold"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    panel.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,</span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span>,</span>
<span>    panel.grid.minor <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.line <span class="op">=</span> <span class="fu">element_line</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, linewidth <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span><span class="st">"GDP per capita\n"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_continuous</span><span class="op">(</span><span class="st">"\nPopulation size (log)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_discrete</span><span class="op">(</span><span class="st">"Continent\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">###PLOTLY CONVERSION</span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu">ggplotly</span><span class="op">(</span><span class="va">p1</span>, </span>
<span>              tooltip <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--HERE, WE TELL GGPLOTLY() TO POPULATE TOOLTIPS WITH OUR CUSTOM TEXT AESTHETICS. </span></span>
<span>  <span class="fu">style</span><span class="op">(</span>hoverinfo <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span> <span class="co">#&lt;--HERE, WE USE style() TO ASK THAT TOOLTIPS CONTAIN ONLY THE CUSTOM TEXT PROVIDED--OTHERWISE, WE'LL GET OURS PLUS THE DEFAULT ONES!</span></span></code></pre>
</div>
<p>Now those tooltips are looking great!</p>
<p>Between <code>layout()</code>, <code>style()</code>, and
<code>config()</code>, you can adjust virtually any aspect of a
<code>plotly</code> graph to meet your desires, much as you can use
various <code>ggplot2</code> functions to customize your
<code>ggplot</code>s. It just may require some Googling and
experimentation to figure out <em>exactly</em> how to do it.</p>
</div>
</div>
<div class="section level3">
<h3 id="update-dont-remake-plotly-edition">Update, don’t remake, <code>plotly</code> edition!<a class="anchor" aria-label="anchor" href="#update-dont-remake-plotly-edition"></a>
</h3>
<p>Once again, it’s time to see how to update a <code>plotly</code>
graph “on the fly” in response to user actions without re-rendering the
whole thing!</p>
<p>That means first giving users a means of affecting the graph beyond
what the graph itself already provides. Let’s create a drop-down
selector that lets users pick a new color scheme:</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="do">##This code should **replace** the "sidebar panel" cell's content within the BODY section of your ui.R file!</span></span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a><span class="do">##... other UI code...</span></span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a><span class="do">###SIDEBAR CELL</span></span>
<span id="cb39-5"><a href="#cb39-5" tabindex="-1"></a>    <span class="fu">column</span>(</span>
<span id="cb39-6"><a href="#cb39-6" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">4</span>,</span>
<span id="cb39-7"><a href="#cb39-7" tabindex="-1"></a>      <span class="fu">selectInput</span>(</span>
<span id="cb39-8"><a href="#cb39-8" tabindex="-1"></a>        <span class="at">inputId =</span> <span class="st">"sorted_column"</span>,</span>
<span id="cb39-9"><a href="#cb39-9" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"Select a column to sort the table by."</span>,</span>
<span id="cb39-10"><a href="#cb39-10" tabindex="-1"></a>        <span class="at">choices =</span> <span class="fu">c</span>(</span>
<span id="cb39-11"><a href="#cb39-11" tabindex="-1"></a>          <span class="st">"Country"</span> <span class="ot">=</span> <span class="st">"country"</span>,</span>
<span id="cb39-12"><a href="#cb39-12" tabindex="-1"></a>          <span class="st">"Continent"</span> <span class="ot">=</span> <span class="st">"continent"</span>,</span>
<span id="cb39-13"><a href="#cb39-13" tabindex="-1"></a>          <span class="st">"Year"</span> <span class="ot">=</span> <span class="st">"year"</span>,</span>
<span id="cb39-14"><a href="#cb39-14" tabindex="-1"></a>          <span class="st">"Life expectancy"</span> <span class="ot">=</span> <span class="st">"lifeExp"</span>,</span>
<span id="cb39-15"><a href="#cb39-15" tabindex="-1"></a>          <span class="st">"Population size"</span> <span class="ot">=</span> <span class="st">"pop"</span>,</span>
<span id="cb39-16"><a href="#cb39-16" tabindex="-1"></a>          <span class="st">"GDP per capita"</span> <span class="ot">=</span> <span class="st">"gdpPercap"</span></span>
<span id="cb39-17"><a href="#cb39-17" tabindex="-1"></a>        )</span>
<span id="cb39-18"><a href="#cb39-18" tabindex="-1"></a>      ),</span>
<span id="cb39-19"><a href="#cb39-19" tabindex="-1"></a>      <span class="fu">actionButton</span>(<span class="at">inputId =</span> <span class="st">"go_button"</span>, <span class="at">label =</span> <span class="st">"Go!"</span>),</span>
<span id="cb39-20"><a href="#cb39-20" tabindex="-1"></a>    <span class="co"># actionButton(inputId = "reset_button",</span></span>
<span id="cb39-21"><a href="#cb39-21" tabindex="-1"></a>      <span class="co">#                   label = "Reset!"),</span></span>
<span id="cb39-22"><a href="#cb39-22" tabindex="-1"></a>      <span class="fu">sliderInput</span>(</span>
<span id="cb39-23"><a href="#cb39-23" tabindex="-1"></a>        <span class="at">inputId =</span> <span class="st">"year_slider"</span>,</span>
<span id="cb39-24"><a href="#cb39-24" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"Pick what year's data are shown in the map."</span>,</span>
<span id="cb39-25"><a href="#cb39-25" tabindex="-1"></a>        <span class="at">value =</span> <span class="dv">2007</span>,</span>
<span id="cb39-26"><a href="#cb39-26" tabindex="-1"></a>        <span class="at">min =</span> <span class="fu">min</span>(gap<span class="sc">$</span>year),</span>
<span id="cb39-27"><a href="#cb39-27" tabindex="-1"></a>        <span class="at">max =</span> <span class="fu">max</span>(gap<span class="sc">$</span>year),</span>
<span id="cb39-28"><a href="#cb39-28" tabindex="-1"></a>        <span class="at">step =</span> <span class="dv">5</span>,</span>
<span id="cb39-29"><a href="#cb39-29" tabindex="-1"></a>        <span class="at">sep =</span> <span class="st">""</span></span>
<span id="cb39-30"><a href="#cb39-30" tabindex="-1"></a>      ),</span>
<span id="cb39-31"><a href="#cb39-31" tabindex="-1"></a>      <span class="fu">selectInput</span>(  <span class="co">#&lt;--ADD IN A COLOR SCHEME SELECTOR</span></span>
<span id="cb39-32"><a href="#cb39-32" tabindex="-1"></a>        <span class="at">inputId =</span> <span class="st">"color_scheme"</span>,</span>
<span id="cb39-33"><a href="#cb39-33" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"Pick a color scheme for the graph."</span>,</span>
<span id="cb39-34"><a href="#cb39-34" tabindex="-1"></a>        <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"viridis"</span>, <span class="st">"plasma"</span>, <span class="st">"magma"</span>)</span>
<span id="cb39-35"><a href="#cb39-35" tabindex="-1"></a>      )</span>
<span id="cb39-36"><a href="#cb39-36" tabindex="-1"></a>    ),</span>
<span id="cb39-37"><a href="#cb39-37" tabindex="-1"></a><span class="do">##... other UI code...</span></span></code></pre>
</div>
<p>In <code>plotly</code>, the color scheme is generally specified
inside the <code>plot_ly()</code> call (the equivalent of
<code>ggplot()</code>) or inside an <code>add_*()</code> function call
(the equivalents of <code>geom</code>s in <code>ggplot2</code>).
However, one can be specified or modified using <code>style()</code>
too.</p>
<p>To update rather than remake our graph, we’ll use the
<code>plotly</code> functions <code>plotlyProxy()</code> and
<code>plotlyProxyInvoke()</code>, which are a like
<code>dataTableProxy()</code> and its helper functions like
<code>replaceData()</code> in that they are a “package deal;” both are
needed to accomplish the task. Specifically, we’ll use the
<code>"restyle"</code> method inside <code>plotProxyInvoke()</code> to
trigger a re-styling of the graph.</p>
<p>As in previous examples, we’ll also need to separate the
<code>renderPlotly({})</code> call that makes our original, default
graph from a new observer that watches <code>input$color_scheme</code>
and triggers restyling using <code>plotlyProxy()</code>. Let’s see all
these pieces in action:</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** all your plotly-related code to date in your server.R file!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">##ALL OUR renderPlotly({}) call will now do is make a "base" version of the graph.</span></span>
<span><span class="co">###GRAPH</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">basic_graph</span> <span class="op">=</span> <span class="fu">renderPlotly</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">p2</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">layout</span><span class="op">(</span></span>
<span>        xaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        yaxis <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>fixedrange <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        legend <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>          itemclick <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>          y <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>          yanchor <span class="op">=</span> <span class="st">"middle"</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">config</span><span class="op">(</span>modeBarButtonsToRemove <span class="op">=</span> <span class="fu">list</span><span class="op">(</span><span class="st">"lasso2d"</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">###GRAPH OBSERVER (COLOR SCHEME SELECTOR)</span></span>
<span><span class="co">#A NEW OBSERVER WILL WATCH FOR CHANGES TO OUR INPUT WIDGET.</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">color_scheme</span>, <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co">#WE "BORROW" LEAFLET'S colorFactor() TO DESIGN AN APPROPRIATE COLOR SCHEME GIVEN THE USER'S SELECTION.</span></span>
<span>    <span class="va">new_pal</span> <span class="op">=</span> <span class="fu">colorFactor</span><span class="op">(</span>palette <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">color_scheme</span>,</span>
<span>                          domain <span class="op">=</span> <span class="va">gap2007</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">plotlyProxy</span><span class="op">(</span><span class="st">"basic_graph"</span>, <span class="va">session</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">#&lt;--plotlyProxy() JUST NEEDS WHICH GRAPH (OF POTENTIALLY MANY) TO UPDATE.</span></span>
<span>      <span class="fu">plotlyProxyInvoke</span><span class="op">(</span><span class="st">"restyle"</span>, <span class="fu">list</span><span class="op">(</span>marker <span class="op">=</span> <span class="fu">list</span><span class="op">(</span></span>
<span>        color <span class="op">=</span> <span class="fu">new_pal</span><span class="op">(</span><span class="va">gap2007</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">11.3</span></span>
<span>      <span class="op">)</span><span class="op">)</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="co">#&lt;--INPUTS TO plotProxyInvoke() INCLUDE A METHOD (HERE, "RESTYLE"), A LIST OF LISTS (WHAT STUFF TO CHANGING AND HOW), AND A LIST OF TRACES BEING CHANGED (HERE, ALL FIVE WE HAD BEFORE).</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>The first input to <code>plotlyProxyInvoke()</code> is a method name.
Here, we’re using <code>"restyle"</code> to adjust things the
<code>style()</code> function would regulate, such as the graph’s color
scheme. There’s also a <code>"relayout"</code> method for adjusting
things that <code>layout()</code> controls, such as the legend.</p>
<p>The second input is a list of lists—this is another place where we’re
<em>very nearly</em> writing JavaScript code, because if there’s one
thing JS loves, it’s lists! Each aspect we want to restyle gets named
(here, <code>marker</code>s are the only thing we want to restyle.</p>
<p>Then, we give each named aspect a list of inputs—what features do we
want to change about that aspect of the graph? Here, we’re changing the
<code>color</code>s, setting them equal to the new colors we’ve
generated using <code>colorFactor()</code> from
<code>leaflet</code>.</p>
<p>However, we also specify <code>size</code>s for these points. Why?
Because, if <code>plotlyProxy()</code> redraws our graph’s markers, it
will do so “from scratch,” using defaults for any properties we don’t
specify. Since our original graph featured custom-sized points, we need
to “override the default” size to arrive at the same size of points as
though we have before the restyle.</p>
<p>The last input to <code>plotlyProxyInvoke()</code> is a list of
<strong>trace numbers</strong>. A <code>plotly</code>
<strong>trace</strong> is one “set” of data being graphed. In our case,
we have five traces, one for each continent, and we’re modifying all
five, so you’d think we’d put <code>1:5</code> here.</p>
<p>However, JS starts counting all things at 0, not 1 (it’s a
“zero-indexed language,” whereas R is a “one-indexed language”), so we
specify <code>0:4</code> for this last input instead.</p>
<p>You’ll notice that, with this new proxy in place, our points change
colors as we adjust our new selector. However, our lines don’t, and our
legend keys also change to the wrong colors. These are fixable problems,
but not without <em>some</em> grief in our case—the TL:DR version is
that the graph conversion performed by <code>ggplotly()</code> comes
with baggage we’re running up against here. If we want to go further
down this route, we’d be better off rebuilding our graph in
<code>plotly</code>.</p>
</div>
<div class="section level3">
<h3 id="point-and-click">
<strong>Point and click</strong><a class="anchor" aria-label="anchor" href="#point-and-click"></a>
</h3>
<p>As with all other widgets we’ve seen, user interactions with
<code>plotly</code> graphs can constitute events we can handle
server-side.</p>
<p>However, <code>plotly</code> is unusual in that info about these
events is <em>not</em> being passed automatically and constantly from
the UI to the server via <code>input</code>. Instead,
<code>plotly</code> has an alternative passing system that uses the
functions <code>event_register()</code> to specify which events to track
and <code>event_data()</code> to pass the relevant event data from the
UI to the server. This <em>sounds</em> a more complicated than what
we’re used to, but it’s really the same idea, just with more parts:</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the "main panel" cell's content within the BODY section of your ui.R file!</span></span>
<span></span>
<span><span class="co">##... other UI code...</span></span>
<span><span class="co">###MAIN PANEL CELL</span></span>
<span>    <span class="fu">column</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">8</span>, <span class="fu">tabsetPanel</span><span class="op">(</span></span>
<span>      <span class="co">###TABLE TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Table"</span>, <span class="fu">dataTableOutput</span><span class="op">(</span><span class="st">"basic_table"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="co">###MAP TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Map"</span>, <span class="fu">leafletOutput</span><span class="op">(</span><span class="st">"basic_map"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="co">###GRAPH TAB</span></span>
<span>      <span class="fu">tabPanel</span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Graph"</span>,</span>
<span>        <span class="fu">plotlyOutput</span><span class="op">(</span><span class="st">"basic_graph"</span><span class="op">)</span>,</span>
<span>        <span class="fu">textOutput</span><span class="op">(</span><span class="st">"point_clicked"</span><span class="op">)</span> <span class="co">#&lt;--ADD AN OUTPUT REPORTING DATA ON WHAT'S BEEN CLICKED.</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">##... other UI code...</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **replace** the ggplotly() call within your global.R file!</span></span>
<span></span>
<span><span class="co">##... other global code...</span></span>
<span><span class="co">###PLOTLY CONVERSION</span></span>
<span><span class="va">p2</span> <span class="op">=</span> <span class="fu">ggplotly</span><span class="op">(</span><span class="va">p1</span>, tooltip <span class="op">=</span> <span class="st">"text"</span>, </span>
<span>              source <span class="op">=</span> <span class="st">"our_graph"</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co">#&lt;--PLOTLY EVENT TRACKING USES A SPECIAL ATTRIBUTE CALLED "SOURCE."</span></span>
<span>  <span class="fu">event_register</span><span class="op">(</span><span class="st">"plotly_click"</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co">##&lt;--WATCH THIS GRAPH FOR USER CLICKS, SPECIFICALLY.</span></span>
<span>  <span class="fu">style</span><span class="op">(</span>hoverinfo <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##This code should **added to** the bottom of your server.R file, within the server function!</span></span>
<span></span>
<span><span class="co">##... other server code...</span></span>
<span></span>
<span><span class="co">#WE USE EVENT_DATA() LIKE input HERE, SPECIFYING WHICH GRAPH AND EVENT TO WATCH FOR.</span></span>
<span><span class="fu">observeEvent</span><span class="op">(</span><span class="fu">event_data</span><span class="op">(</span>event <span class="op">=</span> <span class="st">"plotly_click"</span>, source <span class="op">=</span> <span class="st">"our_graph"</span><span class="op">)</span>, <span class="op">{</span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">point_clicked</span> <span class="op">=</span> <span class="fu">renderText</span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="fu">paste0</span><span class="op">(</span></span>
<span>        <span class="st">"The exact GDP per capita value for this point is: "</span>,</span>
<span>        <span class="fu">event_data</span><span class="op">(</span>event <span class="op">=</span> <span class="st">"plotly_click"</span>, source <span class="op">=</span> <span class="st">"our_graph"</span><span class="op">)</span><span class="op">$</span><span class="va">y</span> <span class="co">#&lt;--WE ACCESS THE EXACT Y VALUE OF THE POINT CLICKED LIKE THIS.</span></span>
<span>      <span class="op">)</span></span>
<span>      </span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>In this setup, we are creating something equivalent to
<code>input</code>—but the values being passed by this new thing are
related only to our graph and only to specific events we’ve
designated.</p>
<p>We’ve also had to give our graph a new “nickname” for use in just
this system: a <code>source</code> attribute, which we set to
<code>our_graph</code>. This really is not much different from how we
specify and use <code>inputId</code>s as nicknames when interfacing with
<code>input</code>, except that <code>source</code> values don’t double
as CSS <code>id</code>s.</p>
<p>We also had to specify what type of event we want to watch:
<code>plotly_clicks</code>. For whatever reason, <code>plotly</code>
graphs don’t watch for all possible events, just those we specify.</p>
<p>Lastly, we watch our <code>event_data()</code> call, just like we
would watch <code>input$widget_name</code>, with our new observer.
Whenever an event triggers, we use <code>renderText({})</code> and
<code>textOutput()</code> to print into the UI some specific information
about the point clicked. This is not a very exciting use of this
functionality, but it hopefully shows what’s possible.</p>
<p>So, ultimately, this system of event watching and handling is not
<em>much</em> harder the one used elsewhere in R Shiny apps involving
<code>input</code>; it’s more difficult only in that it’s different.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul>
<li>The <code>DT</code>, <code>leaflet</code>, and <code>plotly</code>
packages can be used to produce web-ready, interactive tables, maps, and
graphs, respectively, for incorporation into Shiny apps.</li>
<li>Each of the graphics created by these packages come with tons of
interactive functionality out of the box. Because some of this
functionality might be confusing or unnecessary for all users, it’s
valuable to know you can adjust or disable any or all of these
features.</li>
<li>Any aesthetic component of these graphics can be adjusted or
customized, but the specifics of how to do this (and how easy or
intuitive it will be) will vary quite widely between packages and
aesthetics.</li>
<li>We should strive to update graphics, changing only the aspects that
need changing, rather than remaking graphics from scratch wherever
possible. This often means handling events using observers and proxies
rather than using <code>render*({})</code> functions.</li>
<li>Like with other widgets, user interactions with these graphics can
be tracked by the UI and passed to the server for handling. This passing
happens with the <code>input</code> object for <code>DT</code> and
<code>leaflet</code>, but an equivalent system must be used for
<code>plotly</code>.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/carpentries/r_shiny_workshop/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/carpentries/r_shiny_workshop/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/carpentries/r_shiny_workshop/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries/r_shiny_workshop/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.6" class="external-link">sandpaper (0.16.6)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.6" class="external-link">pegboard (0.7.6)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.4" class="external-link">varnish (1.0.4)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://carpentries.github.io/r_shiny_workshop/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, r, The Carpentries",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://carpentries.github.io/r_shiny_workshop/aio.html",
  "identifier": "https://carpentries.github.io/r_shiny_workshop/aio.html",
  "dateCreated": "2024-07-10",
  "dateModified": "2024-08-26",
  "datePublished": "2024-08-26"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

